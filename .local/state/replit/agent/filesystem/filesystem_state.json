{"file_contents":{"client/src/components/LoadingScreen.tsx":{"content":"import logoImage from \"@assets/WhatsApp_Image_2025-12-17_at_12.49.33_1766008177672.jpeg\";\n\ninterface LoadingScreenProps {\n  message?: string;\n}\n\nexport default function LoadingScreen({ message = \"Loading...\" }: LoadingScreenProps) {\n  return (\n    <div \n      className=\"min-h-screen flex flex-col items-center justify-center bg-background\"\n      data-testid=\"loading-screen\"\n    >\n      <div className=\"flex flex-col items-center gap-6\">\n        <div className=\"relative\">\n          <img \n            src={logoImage} \n            alt=\"Sports Reels\" \n            className=\"w-24 h-24 object-contain animate-pulse\"\n          />\n        </div>\n        <div className=\"flex flex-col items-center gap-2\">\n          <div className=\"w-8 h-8 border-3 border-primary border-t-transparent rounded-full animate-spin\" />\n          <p className=\"text-sm text-muted-foreground\">{message}</p>\n        </div>\n      </div>\n    </div>\n  );\n}\n\nexport function LoadingSpinner({ size = \"md\" }: { size?: \"sm\" | \"md\" | \"lg\" }) {\n  const sizeClasses = {\n    sm: \"w-4 h-4\",\n    md: \"w-8 h-8\", \n    lg: \"w-12 h-12\"\n  };\n  \n  return (\n    <div className={`${sizeClasses[size]} border-2 border-primary border-t-transparent rounded-full animate-spin`} />\n  );\n}\n\nexport function LogoWithSpinner() {\n  return (\n    <div className=\"flex flex-col items-center gap-4\">\n      <img \n        src={logoImage} \n        alt=\"Sports Reels\" \n        className=\"w-16 h-16 object-contain\"\n      />\n      <LoadingSpinner size=\"sm\" />\n    </div>\n  );\n}\n","path":null,"size_bytes":1509,"size_tokens":null},"client/src/components/ui/chart.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as RechartsPrimitive from \"recharts\"\n\nimport { cn } from \"@/lib/utils\"\n\n// Format: { THEME_NAME: CSS_SELECTOR }\nconst THEMES = { light: \"\", dark: \".dark\" } as const\n\nexport type ChartConfig = {\n  [k in string]: {\n    label?: React.ReactNode\n    icon?: React.ComponentType\n  } & (\n    | { color?: string; theme?: never }\n    | { color?: never; theme: Record<keyof typeof THEMES, string> }\n  )\n}\n\ntype ChartContextProps = {\n  config: ChartConfig\n}\n\nconst ChartContext = React.createContext<ChartContextProps | null>(null)\n\nfunction useChart() {\n  const context = React.useContext(ChartContext)\n\n  if (!context) {\n    throw new Error(\"useChart must be used within a <ChartContainer />\")\n  }\n\n  return context\n}\n\nconst ChartContainer = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & {\n    config: ChartConfig\n    children: React.ComponentProps<\n      typeof RechartsPrimitive.ResponsiveContainer\n    >[\"children\"]\n  }\n>(({ id, className, children, config, ...props }, ref) => {\n  const uniqueId = React.useId()\n  const chartId = `chart-${id || uniqueId.replace(/:/g, \"\")}`\n\n  return (\n    <ChartContext.Provider value={{ config }}>\n      <div\n        data-chart={chartId}\n        ref={ref}\n        className={cn(\n          \"flex aspect-video justify-center text-xs [&_.recharts-cartesian-axis-tick_text]:fill-muted-foreground [&_.recharts-cartesian-grid_line[stroke='#ccc']]:stroke-border/50 [&_.recharts-curve.recharts-tooltip-cursor]:stroke-border [&_.recharts-dot[stroke='#fff']]:stroke-transparent [&_.recharts-layer]:outline-none [&_.recharts-polar-grid_[stroke='#ccc']]:stroke-border [&_.recharts-radial-bar-background-sector]:fill-muted [&_.recharts-rectangle.recharts-tooltip-cursor]:fill-muted [&_.recharts-reference-line_[stroke='#ccc']]:stroke-border [&_.recharts-sector[stroke='#fff']]:stroke-transparent [&_.recharts-sector]:outline-none [&_.recharts-surface]:outline-none\",\n          className\n        )}\n        {...props}\n      >\n        <ChartStyle id={chartId} config={config} />\n        <RechartsPrimitive.ResponsiveContainer>\n          {children}\n        </RechartsPrimitive.ResponsiveContainer>\n      </div>\n    </ChartContext.Provider>\n  )\n})\nChartContainer.displayName = \"Chart\"\n\nconst ChartStyle = ({ id, config }: { id: string; config: ChartConfig }) => {\n  const colorConfig = Object.entries(config).filter(\n    ([, config]) => config.theme || config.color\n  )\n\n  if (!colorConfig.length) {\n    return null\n  }\n\n  return (\n    <style\n      dangerouslySetInnerHTML={{\n        __html: Object.entries(THEMES)\n          .map(\n            ([theme, prefix]) => `\n${prefix} [data-chart=${id}] {\n${colorConfig\n  .map(([key, itemConfig]) => {\n    const color =\n      itemConfig.theme?.[theme as keyof typeof itemConfig.theme] ||\n      itemConfig.color\n    return color ? `  --color-${key}: ${color};` : null\n  })\n  .join(\"\\n\")}\n}\n`\n          )\n          .join(\"\\n\"),\n      }}\n    />\n  )\n}\n\nconst ChartTooltip = RechartsPrimitive.Tooltip\n\nconst ChartTooltipContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<typeof RechartsPrimitive.Tooltip> &\n    React.ComponentProps<\"div\"> & {\n      hideLabel?: boolean\n      hideIndicator?: boolean\n      indicator?: \"line\" | \"dot\" | \"dashed\"\n      nameKey?: string\n      labelKey?: string\n    }\n>(\n  (\n    {\n      active,\n      payload,\n      className,\n      indicator = \"dot\",\n      hideLabel = false,\n      hideIndicator = false,\n      label,\n      labelFormatter,\n      labelClassName,\n      formatter,\n      color,\n      nameKey,\n      labelKey,\n    },\n    ref\n  ) => {\n    const { config } = useChart()\n\n    const tooltipLabel = React.useMemo(() => {\n      if (hideLabel || !payload?.length) {\n        return null\n      }\n\n      const [item] = payload\n      const key = `${labelKey || item?.dataKey || item?.name || \"value\"}`\n      const itemConfig = getPayloadConfigFromPayload(config, item, key)\n      const value =\n        !labelKey && typeof label === \"string\"\n          ? config[label as keyof typeof config]?.label || label\n          : itemConfig?.label\n\n      if (labelFormatter) {\n        return (\n          <div className={cn(\"font-medium\", labelClassName)}>\n            {labelFormatter(value, payload)}\n          </div>\n        )\n      }\n\n      if (!value) {\n        return null\n      }\n\n      return <div className={cn(\"font-medium\", labelClassName)}>{value}</div>\n    }, [\n      label,\n      labelFormatter,\n      payload,\n      hideLabel,\n      labelClassName,\n      config,\n      labelKey,\n    ])\n\n    if (!active || !payload?.length) {\n      return null\n    }\n\n    const nestLabel = payload.length === 1 && indicator !== \"dot\"\n\n    return (\n      <div\n        ref={ref}\n        className={cn(\n          \"grid min-w-[8rem] items-start gap-1.5 rounded-lg border border-border/50 bg-background px-2.5 py-1.5 text-xs shadow-xl\",\n          className\n        )}\n      >\n        {!nestLabel ? tooltipLabel : null}\n        <div className=\"grid gap-1.5\">\n          {payload.map((item, index) => {\n            const key = `${nameKey || item.name || item.dataKey || \"value\"}`\n            const itemConfig = getPayloadConfigFromPayload(config, item, key)\n            const indicatorColor = color || item.payload.fill || item.color\n\n            return (\n              <div\n                key={item.dataKey}\n                className={cn(\n                  \"flex w-full flex-wrap items-stretch gap-2 [&>svg]:h-2.5 [&>svg]:w-2.5 [&>svg]:text-muted-foreground\",\n                  indicator === \"dot\" && \"items-center\"\n                )}\n              >\n                {formatter && item?.value !== undefined && item.name ? (\n                  formatter(item.value, item.name, item, index, item.payload)\n                ) : (\n                  <>\n                    {itemConfig?.icon ? (\n                      <itemConfig.icon />\n                    ) : (\n                      !hideIndicator && (\n                        <div\n                          className={cn(\n                            \"shrink-0 rounded-[2px] border-[--color-border] bg-[--color-bg]\",\n                            {\n                              \"h-2.5 w-2.5\": indicator === \"dot\",\n                              \"w-1\": indicator === \"line\",\n                              \"w-0 border-[1.5px] border-dashed bg-transparent\":\n                                indicator === \"dashed\",\n                              \"my-0.5\": nestLabel && indicator === \"dashed\",\n                            }\n                          )}\n                          style={\n                            {\n                              \"--color-bg\": indicatorColor,\n                              \"--color-border\": indicatorColor,\n                            } as React.CSSProperties\n                          }\n                        />\n                      )\n                    )}\n                    <div\n                      className={cn(\n                        \"flex flex-1 justify-between leading-none\",\n                        nestLabel ? \"items-end\" : \"items-center\"\n                      )}\n                    >\n                      <div className=\"grid gap-1.5\">\n                        {nestLabel ? tooltipLabel : null}\n                        <span className=\"text-muted-foreground\">\n                          {itemConfig?.label || item.name}\n                        </span>\n                      </div>\n                      {item.value && (\n                        <span className=\"font-mono font-medium tabular-nums text-foreground\">\n                          {item.value.toLocaleString()}\n                        </span>\n                      )}\n                    </div>\n                  </>\n                )}\n              </div>\n            )\n          })}\n        </div>\n      </div>\n    )\n  }\n)\nChartTooltipContent.displayName = \"ChartTooltip\"\n\nconst ChartLegend = RechartsPrimitive.Legend\n\nconst ChartLegendContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> &\n    Pick<RechartsPrimitive.LegendProps, \"payload\" | \"verticalAlign\"> & {\n      hideIcon?: boolean\n      nameKey?: string\n    }\n>(\n  (\n    { className, hideIcon = false, payload, verticalAlign = \"bottom\", nameKey },\n    ref\n  ) => {\n    const { config } = useChart()\n\n    if (!payload?.length) {\n      return null\n    }\n\n    return (\n      <div\n        ref={ref}\n        className={cn(\n          \"flex items-center justify-center gap-4\",\n          verticalAlign === \"top\" ? \"pb-3\" : \"pt-3\",\n          className\n        )}\n      >\n        {payload.map((item) => {\n          const key = `${nameKey || item.dataKey || \"value\"}`\n          const itemConfig = getPayloadConfigFromPayload(config, item, key)\n\n          return (\n            <div\n              key={item.value}\n              className={cn(\n                \"flex items-center gap-1.5 [&>svg]:h-3 [&>svg]:w-3 [&>svg]:text-muted-foreground\"\n              )}\n            >\n              {itemConfig?.icon && !hideIcon ? (\n                <itemConfig.icon />\n              ) : (\n                <div\n                  className=\"h-2 w-2 shrink-0 rounded-[2px]\"\n                  style={{\n                    backgroundColor: item.color,\n                  }}\n                />\n              )}\n              {itemConfig?.label}\n            </div>\n          )\n        })}\n      </div>\n    )\n  }\n)\nChartLegendContent.displayName = \"ChartLegend\"\n\n// Helper to extract item config from a payload.\nfunction getPayloadConfigFromPayload(\n  config: ChartConfig,\n  payload: unknown,\n  key: string\n) {\n  if (typeof payload !== \"object\" || payload === null) {\n    return undefined\n  }\n\n  const payloadPayload =\n    \"payload\" in payload &&\n    typeof payload.payload === \"object\" &&\n    payload.payload !== null\n      ? payload.payload\n      : undefined\n\n  let configLabelKey: string = key\n\n  if (\n    key in payload &&\n    typeof payload[key as keyof typeof payload] === \"string\"\n  ) {\n    configLabelKey = payload[key as keyof typeof payload] as string\n  } else if (\n    payloadPayload &&\n    key in payloadPayload &&\n    typeof payloadPayload[key as keyof typeof payloadPayload] === \"string\"\n  ) {\n    configLabelKey = payloadPayload[\n      key as keyof typeof payloadPayload\n    ] as string\n  }\n\n  return configLabelKey in config\n    ? config[configLabelKey]\n    : config[key as keyof typeof config]\n}\n\nexport {\n  ChartContainer,\n  ChartTooltip,\n  ChartTooltipContent,\n  ChartLegend,\n  ChartLegendContent,\n  ChartStyle,\n}\n","path":null,"size_bytes":10481,"size_tokens":null},"client/src/components/ui/avatar.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as AvatarPrimitive from \"@radix-ui/react-avatar\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Avatar = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Root\n    ref={ref}\n    className={cn(`\n      after:content-[''] after:block after:absolute after:inset-0 after:rounded-full after:pointer-events-none after:border after:border-black/10 dark:after:border-white/10\n      relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full`,\n      className\n    )}\n    {...props}\n  />\n))\nAvatar.displayName = AvatarPrimitive.Root.displayName\n\nconst AvatarImage = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Image>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Image>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Image\n    ref={ref}\n    className={cn(\"aspect-square h-full w-full\", className)}\n    {...props}\n  />\n))\nAvatarImage.displayName = AvatarPrimitive.Image.displayName\n\nconst AvatarFallback = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Fallback>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Fallback>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Fallback\n    ref={ref}\n    className={cn(\n      \"flex h-full w-full items-center justify-center rounded-full bg-muted\",\n      className\n    )}\n    {...props}\n  />\n))\nAvatarFallback.displayName = AvatarPrimitive.Fallback.displayName\n\nexport { Avatar, AvatarImage, AvatarFallback }\n","path":null,"size_bytes":1592,"size_tokens":null},"client/src/components/ui/tooltip.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as TooltipPrimitive from \"@radix-ui/react-tooltip\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst TooltipProvider = TooltipPrimitive.Provider\n\nconst Tooltip = TooltipPrimitive.Root\n\nconst TooltipTrigger = TooltipPrimitive.Trigger\n\nconst TooltipContent = React.forwardRef<\n  React.ElementRef<typeof TooltipPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof TooltipPrimitive.Content>\n>(({ className, sideOffset = 4, ...props }, ref) => (\n  <TooltipPrimitive.Content\n    ref={ref}\n    sideOffset={sideOffset}\n    className={cn(\n      \"z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-tooltip-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nTooltipContent.displayName = TooltipPrimitive.Content.displayName\n\nexport { Tooltip, TooltipTrigger, TooltipContent, TooltipProvider }\n","path":null,"size_bytes":1209,"size_tokens":null},"client/src/components/ui/carousel.tsx":{"content":"import * as React from \"react\"\nimport useEmblaCarousel, {\n  type UseEmblaCarouselType,\n} from \"embla-carousel-react\"\nimport { ArrowLeft, ArrowRight } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Button } from \"@/components/ui/button\"\n\ntype CarouselApi = UseEmblaCarouselType[1]\ntype UseCarouselParameters = Parameters<typeof useEmblaCarousel>\ntype CarouselOptions = UseCarouselParameters[0]\ntype CarouselPlugin = UseCarouselParameters[1]\n\ntype CarouselProps = {\n  opts?: CarouselOptions\n  plugins?: CarouselPlugin\n  orientation?: \"horizontal\" | \"vertical\"\n  setApi?: (api: CarouselApi) => void\n}\n\ntype CarouselContextProps = {\n  carouselRef: ReturnType<typeof useEmblaCarousel>[0]\n  api: ReturnType<typeof useEmblaCarousel>[1]\n  scrollPrev: () => void\n  scrollNext: () => void\n  canScrollPrev: boolean\n  canScrollNext: boolean\n} & CarouselProps\n\nconst CarouselContext = React.createContext<CarouselContextProps | null>(null)\n\nfunction useCarousel() {\n  const context = React.useContext(CarouselContext)\n\n  if (!context) {\n    throw new Error(\"useCarousel must be used within a <Carousel />\")\n  }\n\n  return context\n}\n\nconst Carousel = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement> & CarouselProps\n>(\n  (\n    {\n      orientation = \"horizontal\",\n      opts,\n      setApi,\n      plugins,\n      className,\n      children,\n      ...props\n    },\n    ref\n  ) => {\n    const [carouselRef, api] = useEmblaCarousel(\n      {\n        ...opts,\n        axis: orientation === \"horizontal\" ? \"x\" : \"y\",\n      },\n      plugins\n    )\n    const [canScrollPrev, setCanScrollPrev] = React.useState(false)\n    const [canScrollNext, setCanScrollNext] = React.useState(false)\n\n    const onSelect = React.useCallback((api: CarouselApi) => {\n      if (!api) {\n        return\n      }\n\n      setCanScrollPrev(api.canScrollPrev())\n      setCanScrollNext(api.canScrollNext())\n    }, [])\n\n    const scrollPrev = React.useCallback(() => {\n      api?.scrollPrev()\n    }, [api])\n\n    const scrollNext = React.useCallback(() => {\n      api?.scrollNext()\n    }, [api])\n\n    const handleKeyDown = React.useCallback(\n      (event: React.KeyboardEvent<HTMLDivElement>) => {\n        if (event.key === \"ArrowLeft\") {\n          event.preventDefault()\n          scrollPrev()\n        } else if (event.key === \"ArrowRight\") {\n          event.preventDefault()\n          scrollNext()\n        }\n      },\n      [scrollPrev, scrollNext]\n    )\n\n    React.useEffect(() => {\n      if (!api || !setApi) {\n        return\n      }\n\n      setApi(api)\n    }, [api, setApi])\n\n    React.useEffect(() => {\n      if (!api) {\n        return\n      }\n\n      onSelect(api)\n      api.on(\"reInit\", onSelect)\n      api.on(\"select\", onSelect)\n\n      return () => {\n        api?.off(\"select\", onSelect)\n      }\n    }, [api, onSelect])\n\n    return (\n      <CarouselContext.Provider\n        value={{\n          carouselRef,\n          api: api,\n          opts,\n          orientation:\n            orientation || (opts?.axis === \"y\" ? \"vertical\" : \"horizontal\"),\n          scrollPrev,\n          scrollNext,\n          canScrollPrev,\n          canScrollNext,\n        }}\n      >\n        <div\n          ref={ref}\n          onKeyDownCapture={handleKeyDown}\n          className={cn(\"relative\", className)}\n          role=\"region\"\n          aria-roledescription=\"carousel\"\n          {...props}\n        >\n          {children}\n        </div>\n      </CarouselContext.Provider>\n    )\n  }\n)\nCarousel.displayName = \"Carousel\"\n\nconst CarouselContent = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const { carouselRef, orientation } = useCarousel()\n\n  return (\n    <div ref={carouselRef} className=\"overflow-hidden\">\n      <div\n        ref={ref}\n        className={cn(\n          \"flex\",\n          orientation === \"horizontal\" ? \"-ml-4\" : \"-mt-4 flex-col\",\n          className\n        )}\n        {...props}\n      />\n    </div>\n  )\n})\nCarouselContent.displayName = \"CarouselContent\"\n\nconst CarouselItem = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const { orientation } = useCarousel()\n\n  return (\n    <div\n      ref={ref}\n      role=\"group\"\n      aria-roledescription=\"slide\"\n      className={cn(\n        \"min-w-0 shrink-0 grow-0 basis-full\",\n        orientation === \"horizontal\" ? \"pl-4\" : \"pt-4\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nCarouselItem.displayName = \"CarouselItem\"\n\nconst CarouselPrevious = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<typeof Button>\n>(({ className, variant = \"outline\", size = \"icon\", ...props }, ref) => {\n  const { orientation, scrollPrev, canScrollPrev } = useCarousel()\n\n  return (\n    <Button\n      ref={ref}\n      variant={variant}\n      size={size}\n      className={cn(\n        \"absolute  h-8 w-8 rounded-full\",\n        orientation === \"horizontal\"\n          ? \"-left-12 top-1/2 -translate-y-1/2\"\n          : \"-top-12 left-1/2 -translate-x-1/2 rotate-90\",\n        className\n      )}\n      disabled={!canScrollPrev}\n      onClick={scrollPrev}\n      {...props}\n    >\n      <ArrowLeft className=\"h-4 w-4\" />\n      <span className=\"sr-only\">Previous slide</span>\n    </Button>\n  )\n})\nCarouselPrevious.displayName = \"CarouselPrevious\"\n\nconst CarouselNext = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<typeof Button>\n>(({ className, variant = \"outline\", size = \"icon\", ...props }, ref) => {\n  const { orientation, scrollNext, canScrollNext } = useCarousel()\n\n  return (\n    <Button\n      ref={ref}\n      variant={variant}\n      size={size}\n      className={cn(\n        \"absolute h-8 w-8 rounded-full\",\n        orientation === \"horizontal\"\n          ? \"-right-12 top-1/2 -translate-y-1/2\"\n          : \"-bottom-12 left-1/2 -translate-x-1/2 rotate-90\",\n        className\n      )}\n      disabled={!canScrollNext}\n      onClick={scrollNext}\n      {...props}\n    >\n      <ArrowRight className=\"h-4 w-4\" />\n      <span className=\"sr-only\">Next slide</span>\n    </Button>\n  )\n})\nCarouselNext.displayName = \"CarouselNext\"\n\nexport {\n  type CarouselApi,\n  Carousel,\n  CarouselContent,\n  CarouselItem,\n  CarouselPrevious,\n  CarouselNext,\n}\n","path":null,"size_bytes":6210,"size_tokens":null},"client/src/components/ui/collapsible.tsx":{"content":"\"use client\"\n\nimport * as CollapsiblePrimitive from \"@radix-ui/react-collapsible\"\n\nconst Collapsible = CollapsiblePrimitive.Root\n\nconst CollapsibleTrigger = CollapsiblePrimitive.CollapsibleTrigger\n\nconst CollapsibleContent = CollapsiblePrimitive.CollapsibleContent\n\nexport { Collapsible, CollapsibleTrigger, CollapsibleContent }\n","path":null,"size_bytes":329,"size_tokens":null},"client/src/components/ui/drawer.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport { Drawer as DrawerPrimitive } from \"vaul\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Drawer = ({\n  shouldScaleBackground = true,\n  ...props\n}: React.ComponentProps<typeof DrawerPrimitive.Root>) => (\n  <DrawerPrimitive.Root\n    shouldScaleBackground={shouldScaleBackground}\n    {...props}\n  />\n)\nDrawer.displayName = \"Drawer\"\n\nconst DrawerTrigger = DrawerPrimitive.Trigger\n\nconst DrawerPortal = DrawerPrimitive.Portal\n\nconst DrawerClose = DrawerPrimitive.Close\n\nconst DrawerOverlay = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Overlay\n    ref={ref}\n    className={cn(\"fixed inset-0 z-50 bg-black/80\", className)}\n    {...props}\n  />\n))\nDrawerOverlay.displayName = DrawerPrimitive.Overlay.displayName\n\nconst DrawerContent = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <DrawerPortal>\n    <DrawerOverlay />\n    <DrawerPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed inset-x-0 bottom-0 z-50 mt-24 flex h-auto flex-col rounded-t-[10px] border bg-background\",\n        className\n      )}\n      {...props}\n    >\n      <div className=\"mx-auto mt-4 h-2 w-[100px] rounded-full bg-muted\" />\n      {children}\n    </DrawerPrimitive.Content>\n  </DrawerPortal>\n))\nDrawerContent.displayName = \"DrawerContent\"\n\nconst DrawerHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\"grid gap-1.5 p-4 text-center sm:text-left\", className)}\n    {...props}\n  />\n)\nDrawerHeader.displayName = \"DrawerHeader\"\n\nconst DrawerFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\"mt-auto flex flex-col gap-2 p-4\", className)}\n    {...props}\n  />\n)\nDrawerFooter.displayName = \"DrawerFooter\"\n\nconst DrawerTitle = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Title\n    ref={ref}\n    className={cn(\n      \"text-lg font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nDrawerTitle.displayName = DrawerPrimitive.Title.displayName\n\nconst DrawerDescription = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nDrawerDescription.displayName = DrawerPrimitive.Description.displayName\n\nexport {\n  Drawer,\n  DrawerPortal,\n  DrawerOverlay,\n  DrawerTrigger,\n  DrawerClose,\n  DrawerContent,\n  DrawerHeader,\n  DrawerFooter,\n  DrawerTitle,\n  DrawerDescription,\n}\n","path":null,"size_bytes":3021,"size_tokens":null},"client/src/pages/scout-dashboard.tsx":{"content":"import { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { useState } from \"react\";\nimport { Link } from \"wouter\";\nimport { Search, User, Globe, Award, ChevronRight, Plus, Trash2, Star, AlertCircle, CheckCircle, Coins } from \"lucide-react\";\nimport type { Player, EligibilityScore, ScoutShortlist } from \"@shared/schema\";\nimport { LoadingSpinner } from \"@/components/LoadingScreen\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { useCheckTokens, useSpendTokens } from \"@/hooks/use-tokens\";\nimport {\n  AlertDialog,\n  AlertDialogAction,\n  AlertDialogCancel,\n  AlertDialogContent,\n  AlertDialogDescription,\n  AlertDialogFooter,\n  AlertDialogHeader,\n  AlertDialogTitle,\n} from \"@/components/ui/alert-dialog\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\n\ninterface PlayerWithScores extends Player {\n  eligibilityScores: EligibilityScore[];\n  hasEligibilityData: boolean;\n}\n\ninterface ShortlistEntry extends ScoutShortlist {\n  player: Player;\n}\n\nexport default function ScoutDashboard() {\n  const [searchTerm, setSearchTerm] = useState(\"\");\n  const [positionFilter, setPositionFilter] = useState<string>(\"all\");\n  const [tokenConfirmOpen, setTokenConfirmOpen] = useState(false);\n  const [pendingShortlistPlayer, setPendingShortlistPlayer] = useState<{ playerId: string; priority: string } | null>(null);\n  const { toast } = useToast();\n  const { balance, canAfford, getCost } = useCheckTokens();\n  const spendTokensMutation = useSpendTokens();\n\n  const { data: players = [], isLoading: playersLoading } = useQuery<PlayerWithScores[]>({\n    queryKey: [\"/api/scout/players\"],\n  });\n\n  const { data: shortlist = [], isLoading: shortlistLoading } = useQuery<ShortlistEntry[]>({\n    queryKey: [\"/api/scout/shortlist\"],\n  });\n\n  const addToShortlistMutation = useMutation({\n    mutationFn: async (data: { playerId: string; priority: string }) => {\n      const response = await apiRequest(\"POST\", \"/api/scout/shortlist\", data);\n      return await response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/scout/shortlist\"] });\n      toast({ title: \"Added to shortlist\" });\n    },\n    onError: (error: any) => {\n      toast({ title: \"Error\", description: error.message, variant: \"destructive\" });\n    },\n  });\n\n  const updatePriorityMutation = useMutation({\n    mutationFn: async ({ id, priority }: { id: string; priority: string }) => {\n      const response = await apiRequest(\"PATCH\", `/api/scout/shortlist/${id}`, { priority });\n      return await response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/scout/shortlist\"] });\n      toast({ title: \"Priority updated\" });\n    },\n  });\n\n  const removeFromShortlistMutation = useMutation({\n    mutationFn: async (id: string) => {\n      await apiRequest(\"DELETE\", `/api/scout/shortlist/${id}`);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/scout/shortlist\"] });\n      toast({ title: \"Removed from shortlist\" });\n    },\n  });\n\n  const shortlistPlayerIds = new Set(shortlist.map(s => s.playerId));\n\n  const filteredPlayers = players.filter(player => {\n    const matchesSearch = `${player.firstName} ${player.lastName}`.toLowerCase().includes(searchTerm.toLowerCase()) ||\n      player.nationality.toLowerCase().includes(searchTerm.toLowerCase()) ||\n      player.position.toLowerCase().includes(searchTerm.toLowerCase());\n    const matchesPosition = positionFilter === \"all\" || player.position === positionFilter;\n    return matchesSearch && matchesPosition;\n  });\n\n  const positions = Array.from(new Set(players.map(p => p.position))).filter(Boolean);\n\n  const getOverallStatus = (scores: EligibilityScore[]) => {\n    if (scores.length === 0) return \"pending\";\n    const avgScore = scores.reduce((sum, s) => sum + s.score, 0) / scores.length;\n    if (avgScore >= 60) return \"green\";\n    if (avgScore >= 35) return \"yellow\";\n    return \"red\";\n  };\n\n  const statusColors = {\n    green: \"bg-green-500/10 text-green-600 border-green-200 dark:border-green-800\",\n    yellow: \"bg-yellow-500/10 text-yellow-600 border-yellow-200 dark:border-yellow-800\",\n    red: \"bg-red-500/10 text-red-600 border-red-200 dark:border-red-800\",\n    pending: \"bg-muted text-muted-foreground\",\n  };\n\n  const priorityConfig = {\n    amber: { label: \"Highest\", color: \"bg-amber-500/10 text-amber-600 border-amber-200 dark:border-amber-800\", icon: Star },\n    green: { label: \"Medium\", color: \"bg-green-500/10 text-green-600 border-green-200 dark:border-green-800\", icon: CheckCircle },\n    red: { label: \"Lowest\", color: \"bg-red-500/10 text-red-600 border-red-200 dark:border-red-800\", icon: AlertCircle },\n  };\n\n  const groupedShortlist = {\n    amber: shortlist.filter(s => s.priority === \"amber\"),\n    green: shortlist.filter(s => s.priority === \"green\"),\n    red: shortlist.filter(s => s.priority === \"red\"),\n  };\n\n  const handleShortlistClick = (playerId: string, priority: string = \"green\") => {\n    if (!canAfford(\"shortlist\")) {\n      toast({\n        title: \"Insufficient Tokens\",\n        description: `You need ${getCost(\"shortlist\")} token to add to shortlist. Current balance: ${balance}`,\n        variant: \"destructive\",\n      });\n      return;\n    }\n    setPendingShortlistPlayer({ playerId, priority });\n    setTokenConfirmOpen(true);\n  };\n\n  const confirmShortlistWithTokens = async () => {\n    if (!pendingShortlistPlayer) return;\n    \n    try {\n      await spendTokensMutation.mutateAsync({\n        action: \"shortlist\",\n        playerId: pendingShortlistPlayer.playerId,\n      });\n      await addToShortlistMutation.mutateAsync(pendingShortlistPlayer);\n    } catch (error) {\n    }\n    setTokenConfirmOpen(false);\n    setPendingShortlistPlayer(null);\n  };\n\n  if (playersLoading || shortlistLoading) {\n    return (\n      <div className=\"flex items-center justify-center h-full\">\n        <LoadingSpinner size=\"lg\" />\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"p-6 space-y-6\">\n      <div className=\"flex flex-col gap-4 md:flex-row md:items-center md:justify-between\">\n        <div>\n          <h1 className=\"text-2xl font-bold\" data-testid=\"text-page-title\">Scout Dashboard</h1>\n          <p className=\"text-muted-foreground\">Discover players and manage your shortlist</p>\n        </div>\n      </div>\n\n      <Tabs defaultValue=\"players\" className=\"space-y-4\">\n        <TabsList>\n          <TabsTrigger value=\"players\" data-testid=\"tab-players\">All Players</TabsTrigger>\n          <TabsTrigger value=\"shortlist\" data-testid=\"tab-shortlist\">\n            My Shortlist\n            {shortlist.length > 0 && (\n              <Badge variant=\"secondary\" className=\"ml-2\">{shortlist.length}</Badge>\n            )}\n          </TabsTrigger>\n        </TabsList>\n\n        <TabsContent value=\"players\" className=\"space-y-4\">\n          <div className=\"flex flex-col gap-4 md:flex-row md:items-center\">\n            <div className=\"relative flex-1 max-w-sm\">\n              <Search className=\"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground\" />\n              <Input\n                placeholder=\"Search players...\"\n                className=\"pl-10\"\n                value={searchTerm}\n                onChange={(e) => setSearchTerm(e.target.value)}\n                data-testid=\"input-search-players\"\n              />\n            </div>\n            <Select value={positionFilter} onValueChange={setPositionFilter}>\n              <SelectTrigger className=\"w-[180px]\" data-testid=\"select-position-filter\">\n                <SelectValue placeholder=\"Filter by position\" />\n              </SelectTrigger>\n              <SelectContent>\n                <SelectItem value=\"all\">All Positions</SelectItem>\n                {positions.map(pos => (\n                  <SelectItem key={pos} value={pos}>{pos}</SelectItem>\n                ))}\n              </SelectContent>\n            </Select>\n          </div>\n\n          <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\">\n            {filteredPlayers.map((player) => {\n              const status = getOverallStatus(player.eligibilityScores);\n              const topScore = player.eligibilityScores.length > 0\n                ? Math.max(...player.eligibilityScores.map(s => s.score))\n                : null;\n              const isInShortlist = shortlistPlayerIds.has(player.id);\n\n              return (\n                <Card key={player.id} className=\"hover-elevate\" data-testid={`card-player-${player.id}`}>\n                  <CardHeader className=\"pb-3\">\n                    <div className=\"flex items-start justify-between gap-2\">\n                      <div className=\"flex items-center gap-3\">\n                        <div className=\"h-10 w-10 rounded-full bg-primary/10 flex items-center justify-center\">\n                          <User className=\"h-5 w-5 text-primary\" />\n                        </div>\n                        <div>\n                          <CardTitle className=\"text-base\">\n                            {player.firstName} {player.lastName}\n                          </CardTitle>\n                          <CardDescription>{player.position}</CardDescription>\n                        </div>\n                      </div>\n                      <Badge className={statusColors[status]} variant=\"outline\">\n                        {status === \"pending\" ? \"No Data\" : status.toUpperCase()}\n                      </Badge>\n                    </div>\n                  </CardHeader>\n                  <CardContent className=\"space-y-3\">\n                    <div className=\"flex items-center gap-2 text-sm text-muted-foreground\">\n                      <Globe className=\"h-4 w-4\" />\n                      <span>{player.nationality}</span>\n                    </div>\n                    {player.nationalTeamCaps && player.nationalTeamCaps > 0 && (\n                      <div className=\"flex items-center gap-2 text-sm text-muted-foreground\">\n                        <Award className=\"h-4 w-4\" />\n                        <span>{player.nationalTeamCaps} international caps</span>\n                      </div>\n                    )}\n                    {topScore !== null && (\n                      <div className=\"flex items-center gap-2 text-sm\">\n                        <span className=\"text-muted-foreground\">Top Eligibility:</span>\n                        <span className=\"font-medium\">{topScore.toFixed(0)}%</span>\n                      </div>\n                    )}\n                    <div className=\"flex gap-2 pt-2 flex-wrap\">\n                      <Link href={`/scout/player/${player.id}`}>\n                        <Button variant=\"outline\" size=\"sm\" data-testid={`button-view-player-${player.id}`}>\n                          View Profile\n                          <ChevronRight className=\"ml-1 h-4 w-4\" />\n                        </Button>\n                      </Link>\n                      {!isInShortlist && (\n                        <Button\n                          size=\"sm\"\n                          variant=\"secondary\"\n                          onClick={() => handleShortlistClick(player.id, \"green\")}\n                          disabled={addToShortlistMutation.isPending || spendTokensMutation.isPending}\n                          data-testid={`button-add-shortlist-${player.id}`}\n                        >\n                          <Plus className=\"h-4 w-4 mr-1\" />\n                          <Coins className=\"h-3 w-3 mr-1\" />\n                          1 Token\n                        </Button>\n                      )}\n                      {isInShortlist && (\n                        <Badge variant=\"outline\" className=\"bg-primary/10\">In Shortlist</Badge>\n                      )}\n                    </div>\n                  </CardContent>\n                </Card>\n              );\n            })}\n          </div>\n\n          {filteredPlayers.length === 0 && (\n            <Card>\n              <CardContent className=\"py-12 text-center\">\n                <p className=\"text-muted-foreground\">No players found matching your search.</p>\n              </CardContent>\n            </Card>\n          )}\n        </TabsContent>\n\n        <TabsContent value=\"shortlist\" className=\"space-y-6\">\n          {shortlist.length === 0 ? (\n            <Card>\n              <CardContent className=\"py-12 text-center\">\n                <Star className=\"h-12 w-12 mx-auto text-muted-foreground mb-4\" />\n                <p className=\"text-muted-foreground\">Your shortlist is empty.</p>\n                <p className=\"text-sm text-muted-foreground mt-2\">Add players from the All Players tab to start tracking them.</p>\n              </CardContent>\n            </Card>\n          ) : (\n            Object.entries(groupedShortlist).map(([priority, entries]) => {\n              if (entries.length === 0) return null;\n              const config = priorityConfig[priority as keyof typeof priorityConfig];\n              const Icon = config.icon;\n              \n              return (\n                <div key={priority} className=\"space-y-3\">\n                  <div className=\"flex items-center gap-2\">\n                    <Icon className={`h-5 w-5 ${priority === 'amber' ? 'text-amber-600' : priority === 'green' ? 'text-green-600' : 'text-red-600'}`} />\n                    <h3 className=\"text-lg font-semibold capitalize\">{config.label} Priority</h3>\n                    <Badge variant=\"outline\">{entries.length}</Badge>\n                  </div>\n                  \n                  <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\">\n                    {entries.map((entry) => (\n                      <Card key={entry.id} className={`border-l-4 ${priority === 'amber' ? 'border-l-amber-500' : priority === 'green' ? 'border-l-green-500' : 'border-l-red-500'}`} data-testid={`card-shortlist-${entry.id}`}>\n                        <CardHeader className=\"pb-3\">\n                          <div className=\"flex items-start justify-between gap-2\">\n                            <div className=\"flex items-center gap-3\">\n                              <div className=\"h-10 w-10 rounded-full bg-primary/10 flex items-center justify-center\">\n                                <User className=\"h-5 w-5 text-primary\" />\n                              </div>\n                              <div>\n                                <CardTitle className=\"text-base\">\n                                  {entry.player.firstName} {entry.player.lastName}\n                                </CardTitle>\n                                <CardDescription>{entry.player.position}</CardDescription>\n                              </div>\n                            </div>\n                          </div>\n                        </CardHeader>\n                        <CardContent className=\"space-y-3\">\n                          <div className=\"flex items-center gap-2 text-sm text-muted-foreground\">\n                            <Globe className=\"h-4 w-4\" />\n                            <span>{entry.player.nationality}</span>\n                          </div>\n                          \n                          <div className=\"space-y-2\">\n                            <label className=\"text-xs text-muted-foreground\">Priority</label>\n                            <Select\n                              value={entry.priority}\n                              onValueChange={(value) => updatePriorityMutation.mutate({ id: entry.id, priority: value })}\n                            >\n                              <SelectTrigger className=\"h-8\" data-testid={`select-priority-${entry.id}`}>\n                                <SelectValue />\n                              </SelectTrigger>\n                              <SelectContent>\n                                <SelectItem value=\"amber\">\n                                  <span className=\"flex items-center gap-2\">\n                                    <Star className=\"h-4 w-4 text-amber-600\" />\n                                    Highest Priority\n                                  </span>\n                                </SelectItem>\n                                <SelectItem value=\"green\">\n                                  <span className=\"flex items-center gap-2\">\n                                    <CheckCircle className=\"h-4 w-4 text-green-600\" />\n                                    Medium Priority\n                                  </span>\n                                </SelectItem>\n                                <SelectItem value=\"red\">\n                                  <span className=\"flex items-center gap-2\">\n                                    <AlertCircle className=\"h-4 w-4 text-red-600\" />\n                                    Lowest Priority\n                                  </span>\n                                </SelectItem>\n                              </SelectContent>\n                            </Select>\n                          </div>\n\n                          <div className=\"flex gap-2 pt-2 flex-wrap\">\n                            <Link href={`/scout/player/${entry.player.id}`}>\n                              <Button variant=\"outline\" size=\"sm\" data-testid={`button-view-shortlist-player-${entry.id}`}>\n                                View Profile\n                                <ChevronRight className=\"ml-1 h-4 w-4\" />\n                              </Button>\n                            </Link>\n                            <Button\n                              size=\"sm\"\n                              variant=\"ghost\"\n                              onClick={() => removeFromShortlistMutation.mutate(entry.id)}\n                              disabled={removeFromShortlistMutation.isPending}\n                              data-testid={`button-remove-shortlist-${entry.id}`}\n                            >\n                              <Trash2 className=\"h-4 w-4\" />\n                            </Button>\n                          </div>\n                        </CardContent>\n                      </Card>\n                    ))}\n                  </div>\n                </div>\n              );\n            })\n          )}\n        </TabsContent>\n      </Tabs>\n\n      <AlertDialog open={tokenConfirmOpen} onOpenChange={setTokenConfirmOpen}>\n        <AlertDialogContent data-testid=\"dialog-token-confirm\">\n          <AlertDialogHeader>\n            <AlertDialogTitle className=\"flex items-center gap-2\">\n              <Coins className=\"h-5 w-5\" />\n              Spend 1 Token?\n            </AlertDialogTitle>\n            <AlertDialogDescription>\n              Adding this player to your shortlist costs 1 token. Your current balance is {balance} tokens.\n            </AlertDialogDescription>\n          </AlertDialogHeader>\n          <AlertDialogFooter>\n            <AlertDialogCancel data-testid=\"button-token-cancel\">Cancel</AlertDialogCancel>\n            <AlertDialogAction\n              onClick={confirmShortlistWithTokens}\n              disabled={spendTokensMutation.isPending || addToShortlistMutation.isPending}\n              data-testid=\"button-token-confirm\"\n            >\n              {spendTokensMutation.isPending ? \"Processing...\" : \"Confirm\"}\n            </AlertDialogAction>\n          </AlertDialogFooter>\n        </AlertDialogContent>\n      </AlertDialog>\n    </div>\n  );\n}\n","path":null,"size_bytes":19641,"size_tokens":null},"client/src/components/ui/dialog.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as DialogPrimitive from \"@radix-ui/react-dialog\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Dialog = DialogPrimitive.Root\n\nconst DialogTrigger = DialogPrimitive.Trigger\n\nconst DialogPortal = DialogPrimitive.Portal\n\nconst DialogClose = DialogPrimitive.Close\n\nconst DialogOverlay = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Overlay\n    ref={ref}\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n  />\n))\nDialogOverlay.displayName = DialogPrimitive.Overlay.displayName\n\nconst DialogContent = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <DialogPortal>\n    <DialogOverlay />\n    <DialogPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg\",\n        className\n      )}\n      {...props}\n    >\n      {children}\n      <DialogPrimitive.Close className=\"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground\">\n        <X className=\"h-4 w-4\" />\n        <span className=\"sr-only\">Close</span>\n      </DialogPrimitive.Close>\n    </DialogPrimitive.Content>\n  </DialogPortal>\n))\nDialogContent.displayName = DialogPrimitive.Content.displayName\n\nconst DialogHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-1.5 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nDialogHeader.displayName = \"DialogHeader\"\n\nconst DialogFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nDialogFooter.displayName = \"DialogFooter\"\n\nconst DialogTitle = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Title\n    ref={ref}\n    className={cn(\n      \"text-lg font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nDialogTitle.displayName = DialogPrimitive.Title.displayName\n\nconst DialogDescription = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nDialogDescription.displayName = DialogPrimitive.Description.displayName\n\nexport {\n  Dialog,\n  DialogPortal,\n  DialogOverlay,\n  DialogClose,\n  DialogTrigger,\n  DialogContent,\n  DialogHeader,\n  DialogFooter,\n  DialogTitle,\n  DialogDescription,\n}\n","path":null,"size_bytes":3848,"size_tokens":null},"client/src/components/EmbassyVerificationTable.tsx":{"content":"import { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from \"@/components/ui/table\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Button } from \"@/components/ui/button\";\nimport { Eye, CheckCircle, XCircle, Clock } from \"lucide-react\";\nimport type { EmbassyVerification } from \"@/lib/types\";\n\ninterface EmbassyVerificationTableProps {\n  verifications: EmbassyVerification[];\n  onView?: (id: string) => void;\n  onApprove?: (id: string) => void;\n  onReject?: (id: string) => void;\n}\n\nexport default function EmbassyVerificationTable({ \n  verifications, \n  onView, \n  onApprove, \n  onReject \n}: EmbassyVerificationTableProps) {\n  const getStatusBadge = (status: EmbassyVerification[\"status\"]) => {\n    const config = {\n      pending: { label: \"Pending\", className: \"bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-400\" },\n      under_review: { label: \"Under Review\", className: \"bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-400\" },\n      approved: { label: \"Approved\", className: \"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400\" },\n      rejected: { label: \"Rejected\", className: \"bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-400\" },\n    };\n    return config[status];\n  };\n\n  return (\n    <div className=\"border rounded-md overflow-hidden\" data-testid=\"table-embassy-verifications\">\n      <Table>\n        <TableHeader>\n          <TableRow>\n            <TableHead className=\"font-bold text-xs uppercase\">Player</TableHead>\n            <TableHead className=\"font-bold text-xs uppercase\">Club</TableHead>\n            <TableHead className=\"font-bold text-xs uppercase\">Visa Type</TableHead>\n            <TableHead className=\"font-bold text-xs uppercase\">Target</TableHead>\n            <TableHead className=\"font-bold text-xs uppercase\">Status</TableHead>\n            <TableHead className=\"font-bold text-xs uppercase\">Submitted</TableHead>\n            <TableHead className=\"font-bold text-xs uppercase text-right\">Actions</TableHead>\n          </TableRow>\n        </TableHeader>\n        <TableBody>\n          {verifications.map((verification) => {\n            const statusConfig = getStatusBadge(verification.status);\n            return (\n              <TableRow key={verification.id} data-testid={`row-verification-${verification.id}`}>\n                <TableCell className=\"font-medium\">{verification.playerName}</TableCell>\n                <TableCell>{verification.clubName}</TableCell>\n                <TableCell>{verification.visaType}</TableCell>\n                <TableCell>{verification.targetCountry}</TableCell>\n                <TableCell>\n                  <Badge variant=\"secondary\" className={statusConfig.className}>\n                    {statusConfig.label}\n                  </Badge>\n                </TableCell>\n                <TableCell className=\"text-muted-foreground text-sm\">\n                  {new Date(verification.submittedAt).toLocaleDateString()}\n                </TableCell>\n                <TableCell>\n                  <div className=\"flex items-center justify-end gap-1\">\n                    <Button \n                      size=\"icon\" \n                      variant=\"ghost\"\n                      onClick={() => onView?.(verification.id)}\n                      data-testid={`button-view-verification-${verification.id}`}\n                    >\n                      <Eye className=\"h-4 w-4\" />\n                    </Button>\n                    {verification.status === \"under_review\" && (\n                      <>\n                        <Button \n                          size=\"icon\" \n                          variant=\"ghost\"\n                          className=\"text-green-600 hover:text-green-700\"\n                          onClick={() => onApprove?.(verification.id)}\n                          data-testid={`button-approve-${verification.id}`}\n                        >\n                          <CheckCircle className=\"h-4 w-4\" />\n                        </Button>\n                        <Button \n                          size=\"icon\" \n                          variant=\"ghost\"\n                          className=\"text-red-600 hover:text-red-700\"\n                          onClick={() => onReject?.(verification.id)}\n                          data-testid={`button-reject-${verification.id}`}\n                        >\n                          <XCircle className=\"h-4 w-4\" />\n                        </Button>\n                      </>\n                    )}\n                  </div>\n                </TableCell>\n              </TableRow>\n            );\n          })}\n        </TableBody>\n      </Table>\n    </div>\n  );\n}\n","path":null,"size_bytes":4650,"size_tokens":null},"server/index.ts":{"content":"import express, { type Request, Response, NextFunction } from \"express\";\nimport session from \"express-session\";\nimport { registerRoutes } from \"./routes\";\nimport { serveStatic } from \"./static\";\nimport { createServer } from \"http\";\n\nconst app = express();\nconst httpServer = createServer(app);\n\ndeclare module \"http\" {\n  interface IncomingMessage {\n    rawBody: unknown;\n  }\n}\n\napp.use(\n  express.json({\n    verify: (req, _res, buf) => {\n      req.rawBody = buf;\n    },\n  }),\n);\n\napp.use(express.urlencoded({ extended: false }));\n\napp.use(session({\n  secret: process.env.SESSION_SECRET || \"sports-reels-secret-key\",\n  resave: false,\n  saveUninitialized: false,\n  cookie: {\n    secure: process.env.NODE_ENV === \"production\",\n    httpOnly: true,\n    maxAge: 24 * 60 * 60 * 1000,\n  },\n}));\n\nexport function log(message: string, source = \"express\") {\n  const formattedTime = new Date().toLocaleTimeString(\"en-US\", {\n    hour: \"numeric\",\n    minute: \"2-digit\",\n    second: \"2-digit\",\n    hour12: true,\n  });\n\n  console.log(`${formattedTime} [${source}] ${message}`);\n}\n\napp.use((req, res, next) => {\n  const start = Date.now();\n  const path = req.path;\n  let capturedJsonResponse: Record<string, any> | undefined = undefined;\n\n  const originalResJson = res.json;\n  res.json = function (bodyJson, ...args) {\n    capturedJsonResponse = bodyJson;\n    return originalResJson.apply(res, [bodyJson, ...args]);\n  };\n\n  res.on(\"finish\", () => {\n    const duration = Date.now() - start;\n    if (path.startsWith(\"/api\")) {\n      let logLine = `${req.method} ${path} ${res.statusCode} in ${duration}ms`;\n      if (capturedJsonResponse) {\n        logLine += ` :: ${JSON.stringify(capturedJsonResponse)}`;\n      }\n\n      log(logLine);\n    }\n  });\n\n  next();\n});\n\n(async () => {\n  await registerRoutes(httpServer, app);\n\n  app.use((err: any, _req: Request, res: Response, _next: NextFunction) => {\n    const status = err.status || err.statusCode || 500;\n    const message = err.message || \"Internal Server Error\";\n\n    res.status(status).json({ message });\n    throw err;\n  });\n\n  // importantly only setup vite in development and after\n  // setting up all the other routes so the catch-all route\n  // doesn't interfere with the other routes\n  if (process.env.NODE_ENV === \"production\") {\n    serveStatic(app);\n  } else {\n    const { setupVite } = await import(\"./vite\");\n    await setupVite(httpServer, app);\n  }\n\n  // ALWAYS serve the app on the port specified in the environment variable PORT\n  // Other ports are firewalled. Default to 5000 if not specified.\n  // this serves both the API and the client.\n  // It is the only port that is not firewalled.\n  const port = parseInt(process.env.PORT || \"5000\", 10);\n  httpServer.listen(\n    {\n      port,\n      host: \"0.0.0.0\",\n      reusePort: true,\n    },\n    () => {\n      log(`serving on port ${port}`);\n    },\n  );\n})();\n","path":null,"size_bytes":2856,"size_tokens":null},"server/storage.ts":{"content":"import { \n  type User, type InsertUser, \n  type Team, type InsertTeam,\n  type Player, type InsertPlayer,\n  type PlayerMetrics, type InsertPlayerMetrics,\n  type Video, type InsertVideo,\n  type VideoInsights, type InsertVideoInsights,\n  type EligibilityScore, type InsertEligibilityScore,\n  type TransferEligibilityAssessment, type InsertTransferEligibilityAssessment,\n  type TransferReport, type InsertTransferReport,\n  type ComplianceOrder, type InsertComplianceOrder,\n  type ComplianceDocument, type InsertComplianceDocument,\n  type EmbassyVerification, type InsertEmbassyVerification,\n  type ScoutingInquiry, type InsertScoutingInquiry,\n  type Payment, type InsertPayment,\n  type Club, type InsertClub,\n  type MedicalRecord, type InsertMedicalRecord,\n  type BiometricData, type InsertBiometricData,\n  type EmbassyProfile, type InsertEmbassyProfile,\n  type InvitationLetter, type InsertInvitationLetter,\n  type ConsularReport, type InsertConsularReport,\n  type Conversation, type InsertConversation,\n  type ConversationParticipant, type InsertConversationParticipant,\n  type Message, type InsertMessage,\n  type EmbassyDocumentAccess, type InsertEmbassyDocumentAccess,\n  type SharedVideo, type InsertSharedVideo,\n  type ActionLog, type InsertActionLog,\n  type TransferTarget, type InsertTransferTarget,\n  type VideoPlayerTag, type InsertVideoPlayerTag,\n  type PlayerInternationalRecord, type InsertPlayerInternationalRecord,\n  type TeamSheet, type InsertTeamSheet,\n  type TeamSheetPlayer, type InsertTeamSheetPlayer,\n  type PlayerDocument, type InsertPlayerDocument,\n  type FederationLetterRequest, type InsertFederationLetterRequest,\n  type FederationProfile, type InsertFederationProfile,\n  type FederationFeeSchedule, type InsertFederationFeeSchedule,\n  type FederationRequestActivity, type InsertFederationRequestActivity,\n  type FederationRequestMessage, type InsertFederationRequestMessage,\n  type FederationIssuedDocument, type InsertFederationIssuedDocument,\n  type ScoutShortlist, type InsertScoutShortlist,\n  type TokenBalance, type InsertTokenBalance,\n  type TokenTransaction, type InsertTokenTransaction,\n  type TokenPack, type InsertTokenPack,\n  type TokenPurchase, type InsertTokenPurchase,\n  users, teams, players, playerMetrics, videos, videoInsights,\n  eligibilityScores, transferEligibilityAssessments, transferReports, complianceOrders, complianceDocuments,\n  embassyVerifications, scoutingInquiries, payments, clubs,\n  medicalRecords, biometricData, embassyProfiles, invitationLetters, consularReports,\n  conversations, conversationParticipants, messages,\n  embassyDocumentAccess, sharedVideos, actionLogs, transferTargets,\n  videoPlayerTags, playerInternationalRecords, teamSheets, teamSheetPlayers, playerDocuments,\n  federationLetterRequests, federationProfiles, federationFeeSchedules, federationRequestActivities,\n  federationRequestMessages, federationIssuedDocuments, scoutShortlists,\n  tokenBalances, tokenTransactions, tokenPacks, tokenPurchases\n} from \"@shared/schema\";\nimport { db } from \"./db\";\nimport { eq, and, desc } from \"drizzle-orm\";\nimport { randomUUID } from \"crypto\";\n\nexport interface IStorage {\n  getUser(id: string): Promise<User | undefined>;\n  getUserByUsername(username: string): Promise<User | undefined>;\n  createUser(user: InsertUser): Promise<User>;\n  updateUser(id: string, updates: Partial<InsertUser>): Promise<User | undefined>;\n  \n  getTeam(id: string): Promise<Team | undefined>;\n  createTeam(team: InsertTeam): Promise<Team>;\n  getTeamsByUser(userId: string): Promise<Team[]>;\n  \n  getPlayers(teamId?: string): Promise<Player[]>;\n  getPlayer(id: string): Promise<Player | undefined>;\n  createPlayer(player: InsertPlayer): Promise<Player>;\n  updatePlayer(id: string, updates: Partial<InsertPlayer>): Promise<Player | undefined>;\n  \n  getPlayerMetrics(playerId: string): Promise<PlayerMetrics[]>;\n  createPlayerMetrics(metrics: InsertPlayerMetrics): Promise<PlayerMetrics>;\n  \n  getVideos(playerId?: string): Promise<Video[]>;\n  getVideo(id: string): Promise<Video | undefined>;\n  createVideo(video: InsertVideo): Promise<Video>;\n  updateVideo(id: string, updates: Partial<InsertVideo>): Promise<Video | undefined>;\n  \n  getVideoInsights(videoId: string): Promise<VideoInsights | undefined>;\n  createVideoInsights(insights: InsertVideoInsights): Promise<VideoInsights>;\n  \n  getEligibilityScores(playerId: string): Promise<EligibilityScore[]>;\n  createEligibilityScore(score: InsertEligibilityScore): Promise<EligibilityScore>;\n  \n  getTransferEligibilityAssessment(playerId: string): Promise<TransferEligibilityAssessment | undefined>;\n  createTransferEligibilityAssessment(assessment: InsertTransferEligibilityAssessment): Promise<TransferEligibilityAssessment>;\n  updateTransferEligibilityAssessment(id: string, updates: Partial<InsertTransferEligibilityAssessment>): Promise<TransferEligibilityAssessment | undefined>;\n  \n  getTransferReports(teamId: string): Promise<TransferReport[]>;\n  getTransferReport(id: string): Promise<TransferReport | undefined>;\n  getTransferReportsByPlayer(playerId: string): Promise<TransferReport[]>;\n  createTransferReport(report: InsertTransferReport): Promise<TransferReport>;\n  updateTransferReport(id: string, updates: Partial<InsertTransferReport>): Promise<TransferReport | undefined>;\n  deleteTransferReport(id: string): Promise<boolean>;\n  \n  getComplianceOrders(teamId: string): Promise<ComplianceOrder[]>;\n  getComplianceOrder(id: string): Promise<ComplianceOrder | undefined>;\n  createComplianceOrder(order: InsertComplianceOrder): Promise<ComplianceOrder>;\n  updateComplianceOrder(id: string, updates: Partial<InsertComplianceOrder>): Promise<ComplianceOrder | undefined>;\n  \n  getComplianceDocuments(orderId: string): Promise<ComplianceDocument[]>;\n  getComplianceDocument(id: string): Promise<ComplianceDocument | undefined>;\n  createComplianceDocument(doc: InsertComplianceDocument): Promise<ComplianceDocument>;\n  \n  getEmbassyVerifications(teamId?: string): Promise<EmbassyVerification[]>;\n  createEmbassyVerification(verification: InsertEmbassyVerification): Promise<EmbassyVerification>;\n  updateEmbassyVerification(id: string, updates: Partial<InsertEmbassyVerification>): Promise<EmbassyVerification | undefined>;\n  \n  getScoutingInquiries(teamId?: string): Promise<ScoutingInquiry[]>;\n  createScoutingInquiry(inquiry: InsertScoutingInquiry): Promise<ScoutingInquiry>;\n  \n  getPayment(id: string): Promise<Payment | undefined>;\n  getPaymentByOrderId(orderId: string): Promise<Payment | undefined>;\n  createPayment(payment: InsertPayment): Promise<Payment>;\n  updatePayment(id: string, updates: Partial<InsertPayment>): Promise<Payment | undefined>;\n  \n  getClubs(): Promise<Club[]>;\n  getClub(id: string): Promise<Club | undefined>;\n  createClub(club: InsertClub): Promise<Club>;\n  \n  getMedicalRecords(playerId: string): Promise<MedicalRecord[]>;\n  createMedicalRecord(record: InsertMedicalRecord): Promise<MedicalRecord>;\n  \n  getBiometricData(playerId: string): Promise<BiometricData[]>;\n  createBiometricData(data: InsertBiometricData): Promise<BiometricData>;\n  \n  getEmbassyProfile(id: string): Promise<EmbassyProfile | undefined>;\n  getEmbassyProfileByCountry(country: string): Promise<EmbassyProfile | undefined>;\n  getEmbassyProfileByUserId(userId: string): Promise<EmbassyProfile | undefined>;\n  createEmbassyProfile(profile: InsertEmbassyProfile): Promise<EmbassyProfile>;\n  \n  getInvitationLetters(playerId: string): Promise<InvitationLetter[]>;\n  getAllInvitationLetters(teamId?: string): Promise<InvitationLetter[]>;\n  getInvitationLetter(id: string): Promise<InvitationLetter | undefined>;\n  createInvitationLetter(letter: InsertInvitationLetter): Promise<InvitationLetter>;\n  updateInvitationLetter(id: string, updates: Partial<InsertInvitationLetter>): Promise<InvitationLetter | undefined>;\n  deleteInvitationLetter(id: string): Promise<boolean>;\n  \n  getConsularReports(playerId: string): Promise<ConsularReport[]>;\n  getConsularReport(id: string): Promise<ConsularReport | undefined>;\n  getConsularReportByVerificationCode(code: string): Promise<ConsularReport | undefined>;\n  createConsularReport(report: InsertConsularReport): Promise<ConsularReport>;\n  updateConsularReport(id: string, updates: Partial<InsertConsularReport>): Promise<ConsularReport | undefined>;\n  \n  getConversations(userId: string): Promise<Conversation[]>;\n  getConversation(id: string): Promise<Conversation | undefined>;\n  createConversation(conversation: InsertConversation): Promise<Conversation>;\n  addConversationParticipant(participant: InsertConversationParticipant): Promise<ConversationParticipant>;\n  getConversationParticipants(conversationId: string): Promise<ConversationParticipant[]>;\n  \n  getMessages(conversationId: string): Promise<Message[]>;\n  createMessage(message: InsertMessage): Promise<Message>;\n  \n  logEmbassyDocumentAccess(access: InsertEmbassyDocumentAccess): Promise<EmbassyDocumentAccess>;\n  getEmbassyDocumentAccessLogs(documentId: string): Promise<EmbassyDocumentAccess[]>;\n  \n  shareVideo(share: InsertSharedVideo): Promise<SharedVideo>;\n  getSharedVideos(userId: string): Promise<SharedVideo[]>;\n  \n  logAction(log: InsertActionLog): Promise<ActionLog>;\n  getActionLogs(entityType: string, entityId: string): Promise<ActionLog[]>;\n  \n  createTransferTarget(target: InsertTransferTarget): Promise<TransferTarget>;\n  getTransferTargets(playerId: string): Promise<TransferTarget[]>;\n  getTransferTarget(id: string): Promise<TransferTarget | undefined>;\n  updateTransferTarget(id: string, updates: Partial<InsertTransferTarget>): Promise<TransferTarget | undefined>;\n  \n  createVideoPlayerTag(tag: InsertVideoPlayerTag): Promise<VideoPlayerTag>;\n  getVideoPlayerTags(videoId: string): Promise<VideoPlayerTag[]>;\n  getVideoPlayerTagsForPlayer(playerId: string): Promise<Array<VideoPlayerTag & { video: Video | null }>>;\n  getVideoPlayerTag(id: string): Promise<VideoPlayerTag | undefined>;\n  updateVideoPlayerTag(id: string, updates: Partial<InsertVideoPlayerTag>): Promise<VideoPlayerTag | undefined>;\n  deleteVideoPlayerTag(id: string): Promise<void>;\n  getPlayerVideoMinutes(playerId: string): Promise<number>;\n  \n  getPlayerInternationalRecords(playerId: string): Promise<PlayerInternationalRecord[]>;\n  getPlayerInternationalRecord(id: string): Promise<PlayerInternationalRecord | undefined>;\n  createPlayerInternationalRecord(record: InsertPlayerInternationalRecord): Promise<PlayerInternationalRecord>;\n  updatePlayerInternationalRecord(id: string, updates: Partial<InsertPlayerInternationalRecord>): Promise<PlayerInternationalRecord | undefined>;\n  deletePlayerInternationalRecord(id: string): Promise<void>;\n  \n  getTeamSheets(teamId: string): Promise<TeamSheet[]>;\n  getTeamSheet(id: string): Promise<TeamSheet | undefined>;\n  createTeamSheet(sheet: InsertTeamSheet): Promise<TeamSheet>;\n  updateTeamSheet(id: string, updates: Partial<InsertTeamSheet>): Promise<TeamSheet | undefined>;\n  deleteTeamSheet(id: string): Promise<void>;\n  \n  getTeamSheetPlayers(teamSheetId: string): Promise<TeamSheetPlayer[]>;\n  createTeamSheetPlayer(player: InsertTeamSheetPlayer): Promise<TeamSheetPlayer>;\n  updateTeamSheetPlayer(id: string, updates: Partial<InsertTeamSheetPlayer>): Promise<TeamSheetPlayer | undefined>;\n  deleteTeamSheetPlayer(id: string): Promise<void>;\n  deleteTeamSheetPlayersBySheet(teamSheetId: string): Promise<void>;\n  \n  getPlayerDocuments(playerId: string): Promise<PlayerDocument[]>;\n  getPlayerDocument(id: string): Promise<PlayerDocument | undefined>;\n  createPlayerDocument(doc: InsertPlayerDocument): Promise<PlayerDocument>;\n  updatePlayerDocument(id: string, updates: Partial<InsertPlayerDocument>): Promise<PlayerDocument | undefined>;\n  deletePlayerDocument(id: string): Promise<void>;\n  \n  getScoutShortlist(scoutId: string): Promise<ScoutShortlist[]>;\n  getScoutShortlistWithPlayers(scoutId: string): Promise<Array<ScoutShortlist & { player: Player }>>;\n  addToShortlist(shortlist: InsertScoutShortlist): Promise<ScoutShortlist>;\n  updateShortlistPriority(id: string, priority: string, notes?: string): Promise<ScoutShortlist | undefined>;\n  removeFromShortlist(id: string): Promise<void>;\n  getShortlistEntry(scoutId: string, playerId: string): Promise<ScoutShortlist | undefined>;\n  \n  // Token System\n  getTokenBalance(userId: string): Promise<TokenBalance | undefined>;\n  createTokenBalance(balance: InsertTokenBalance): Promise<TokenBalance>;\n  updateTokenBalance(userId: string, balance: number, lifetimePurchased?: number, lifetimeSpent?: number): Promise<TokenBalance | undefined>;\n  getTokenTransactions(userId: string, limit?: number): Promise<TokenTransaction[]>;\n  createTokenTransaction(transaction: InsertTokenTransaction): Promise<TokenTransaction>;\n  getTokenPacks(): Promise<TokenPack[]>;\n  getTokenPack(id: string): Promise<TokenPack | undefined>;\n  createTokenPack(pack: InsertTokenPack): Promise<TokenPack>;\n  getTokenPurchases(userId: string): Promise<TokenPurchase[]>;\n  createTokenPurchase(purchase: InsertTokenPurchase): Promise<TokenPurchase>;\n  updateTokenPurchase(id: string, updates: Partial<InsertTokenPurchase>): Promise<TokenPurchase | undefined>;\n}\n\nexport class DatabaseStorage implements IStorage {\n  async getUser(id: string): Promise<User | undefined> {\n    const [user] = await db.select().from(users).where(eq(users.id, id));\n    return user;\n  }\n\n  async getUserByUsername(username: string): Promise<User | undefined> {\n    const [user] = await db.select().from(users).where(eq(users.username, username));\n    return user;\n  }\n\n  async createUser(insertUser: InsertUser): Promise<User> {\n    const [user] = await db.insert(users).values(insertUser).returning();\n    return user;\n  }\n\n  async updateUser(id: string, updates: Partial<InsertUser>): Promise<User | undefined> {\n    const [user] = await db.update(users).set(updates).where(eq(users.id, id)).returning();\n    return user;\n  }\n\n  async getTeam(id: string): Promise<Team | undefined> {\n    const [team] = await db.select().from(teams).where(eq(teams.id, id));\n    return team;\n  }\n\n  async createTeam(team: InsertTeam): Promise<Team> {\n    const [newTeam] = await db.insert(teams).values(team).returning();\n    return newTeam;\n  }\n\n  async getTeamsByUser(userId: string): Promise<Team[]> {\n    const user = await this.getUser(userId);\n    if (!user?.teamId) return [];\n    const team = await this.getTeam(user.teamId);\n    return team ? [team] : [];\n  }\n\n  async getPlayers(teamId?: string): Promise<Player[]> {\n    if (teamId) {\n      return db.select().from(players).where(eq(players.teamId, teamId)).orderBy(desc(players.updatedAt));\n    }\n    return db.select().from(players).orderBy(desc(players.updatedAt));\n  }\n\n  async getPlayer(id: string): Promise<Player | undefined> {\n    const [player] = await db.select().from(players).where(eq(players.id, id));\n    return player;\n  }\n\n  async createPlayer(player: InsertPlayer): Promise<Player> {\n    const [newPlayer] = await db.insert(players).values(player).returning();\n    return newPlayer;\n  }\n\n  async updatePlayer(id: string, updates: Partial<InsertPlayer>): Promise<Player | undefined> {\n    const [player] = await db.update(players).set(updates).where(eq(players.id, id)).returning();\n    return player;\n  }\n\n  async getPlayerMetrics(playerId: string): Promise<PlayerMetrics[]> {\n    return db.select().from(playerMetrics).where(eq(playerMetrics.playerId, playerId));\n  }\n\n  async createPlayerMetrics(metrics: InsertPlayerMetrics): Promise<PlayerMetrics> {\n    const [newMetrics] = await db.insert(playerMetrics).values(metrics).returning();\n    return newMetrics;\n  }\n\n  async getVideos(playerId?: string): Promise<Video[]> {\n    if (playerId) {\n      return db.select().from(videos).where(eq(videos.playerId, playerId)).orderBy(desc(videos.uploadDate));\n    }\n    return db.select().from(videos).orderBy(desc(videos.uploadDate));\n  }\n\n  async getVideo(id: string): Promise<Video | undefined> {\n    const [video] = await db.select().from(videos).where(eq(videos.id, id));\n    return video;\n  }\n\n  async createVideo(video: InsertVideo): Promise<Video> {\n    const [newVideo] = await db.insert(videos).values(video).returning();\n    return newVideo;\n  }\n\n  async updateVideo(id: string, updates: Partial<InsertVideo>): Promise<Video | undefined> {\n    const [video] = await db.update(videos).set(updates).where(eq(videos.id, id)).returning();\n    return video;\n  }\n\n  async getVideoInsights(videoId: string): Promise<VideoInsights | undefined> {\n    const [insights] = await db.select().from(videoInsights).where(eq(videoInsights.videoId, videoId));\n    return insights;\n  }\n\n  async createVideoInsights(insights: InsertVideoInsights): Promise<VideoInsights> {\n    const [newInsights] = await db.insert(videoInsights).values(insights).returning();\n    return newInsights;\n  }\n\n  async getEligibilityScores(playerId: string): Promise<EligibilityScore[]> {\n    return db.select().from(eligibilityScores).where(eq(eligibilityScores.playerId, playerId));\n  }\n\n  async createEligibilityScore(score: InsertEligibilityScore): Promise<EligibilityScore> {\n    const [newScore] = await db.insert(eligibilityScores).values(score).returning();\n    return newScore;\n  }\n\n  async getTransferEligibilityAssessment(playerId: string): Promise<TransferEligibilityAssessment | undefined> {\n    const [assessment] = await db.select().from(transferEligibilityAssessments)\n      .where(eq(transferEligibilityAssessments.playerId, playerId))\n      .orderBy(desc(transferEligibilityAssessments.calculatedAt))\n      .limit(1);\n    return assessment;\n  }\n\n  async createTransferEligibilityAssessment(assessment: InsertTransferEligibilityAssessment): Promise<TransferEligibilityAssessment> {\n    const [newAssessment] = await db.insert(transferEligibilityAssessments).values(assessment).returning();\n    return newAssessment;\n  }\n\n  async updateTransferEligibilityAssessment(id: string, updates: Partial<InsertTransferEligibilityAssessment>): Promise<TransferEligibilityAssessment | undefined> {\n    const [updated] = await db.update(transferEligibilityAssessments)\n      .set(updates)\n      .where(eq(transferEligibilityAssessments.id, id))\n      .returning();\n    return updated;\n  }\n\n  async getTransferReports(teamId: string): Promise<TransferReport[]> {\n    return db.select().from(transferReports).where(eq(transferReports.teamId, teamId)).orderBy(desc(transferReports.generatedAt));\n  }\n\n  async getTransferReport(id: string): Promise<TransferReport | undefined> {\n    const [report] = await db.select().from(transferReports).where(eq(transferReports.id, id));\n    return report;\n  }\n\n  async getTransferReportsByPlayer(playerId: string): Promise<TransferReport[]> {\n    return db.select().from(transferReports).where(eq(transferReports.playerId, playerId)).orderBy(desc(transferReports.generatedAt));\n  }\n\n  async createTransferReport(report: InsertTransferReport): Promise<TransferReport> {\n    const [newReport] = await db.insert(transferReports).values(report).returning();\n    return newReport;\n  }\n\n  async updateTransferReport(id: string, updates: Partial<InsertTransferReport>): Promise<TransferReport | undefined> {\n    const [updated] = await db.update(transferReports).set(updates).where(eq(transferReports.id, id)).returning();\n    return updated;\n  }\n\n  async deleteTransferReport(id: string): Promise<boolean> {\n    const result = await db.delete(transferReports).where(eq(transferReports.id, id));\n    return true;\n  }\n\n  async getComplianceOrders(teamId: string): Promise<ComplianceOrder[]> {\n    return db.select().from(complianceOrders).where(eq(complianceOrders.teamId, teamId)).orderBy(desc(complianceOrders.createdAt));\n  }\n\n  async getComplianceOrder(id: string): Promise<ComplianceOrder | undefined> {\n    const [order] = await db.select().from(complianceOrders).where(eq(complianceOrders.id, id));\n    return order;\n  }\n\n  async createComplianceOrder(order: InsertComplianceOrder): Promise<ComplianceOrder> {\n    const [newOrder] = await db.insert(complianceOrders).values(order).returning();\n    return newOrder;\n  }\n\n  async updateComplianceOrder(id: string, updates: Partial<InsertComplianceOrder>): Promise<ComplianceOrder | undefined> {\n    const [order] = await db.update(complianceOrders).set(updates).where(eq(complianceOrders.id, id)).returning();\n    return order;\n  }\n\n  async getComplianceDocuments(orderId: string): Promise<ComplianceDocument[]> {\n    return db.select().from(complianceDocuments).where(eq(complianceDocuments.orderId, orderId));\n  }\n\n  async getComplianceDocument(id: string): Promise<ComplianceDocument | undefined> {\n    const [doc] = await db.select().from(complianceDocuments).where(eq(complianceDocuments.id, id));\n    return doc;\n  }\n\n  async createComplianceDocument(doc: InsertComplianceDocument): Promise<ComplianceDocument> {\n    const [newDoc] = await db.insert(complianceDocuments).values(doc).returning();\n    return newDoc;\n  }\n\n  async getEmbassyVerifications(teamId?: string): Promise<EmbassyVerification[]> {\n    return db.select().from(embassyVerifications).orderBy(desc(embassyVerifications.submittedAt));\n  }\n\n  async createEmbassyVerification(verification: InsertEmbassyVerification): Promise<EmbassyVerification> {\n    const [newVerification] = await db.insert(embassyVerifications).values(verification).returning();\n    return newVerification;\n  }\n\n  async updateEmbassyVerification(id: string, updates: Partial<InsertEmbassyVerification>): Promise<EmbassyVerification | undefined> {\n    const [verification] = await db.update(embassyVerifications).set(updates).where(eq(embassyVerifications.id, id)).returning();\n    return verification;\n  }\n\n  async getScoutingInquiries(teamId?: string): Promise<ScoutingInquiry[]> {\n    return db.select().from(scoutingInquiries).orderBy(desc(scoutingInquiries.createdAt));\n  }\n\n  async createScoutingInquiry(inquiry: InsertScoutingInquiry): Promise<ScoutingInquiry> {\n    const [newInquiry] = await db.insert(scoutingInquiries).values(inquiry).returning();\n    return newInquiry;\n  }\n\n  async getPayment(id: string): Promise<Payment | undefined> {\n    const [payment] = await db.select().from(payments).where(eq(payments.id, id));\n    return payment;\n  }\n\n  async getPaymentByOrderId(orderId: string): Promise<Payment | undefined> {\n    const [payment] = await db.select().from(payments).where(eq(payments.orderId, orderId));\n    return payment;\n  }\n\n  async createPayment(payment: InsertPayment): Promise<Payment> {\n    const [newPayment] = await db.insert(payments).values(payment).returning();\n    return newPayment;\n  }\n\n  async updatePayment(id: string, updates: Partial<InsertPayment>): Promise<Payment | undefined> {\n    const [payment] = await db.update(payments).set(updates).where(eq(payments.id, id)).returning();\n    return payment;\n  }\n\n  async getClubs(): Promise<Club[]> {\n    return db.select().from(clubs);\n  }\n\n  async getClub(id: string): Promise<Club | undefined> {\n    const [club] = await db.select().from(clubs).where(eq(clubs.id, id));\n    return club;\n  }\n\n  async createClub(club: InsertClub): Promise<Club> {\n    const [newClub] = await db.insert(clubs).values(club).returning();\n    return newClub;\n  }\n\n  async getMedicalRecords(playerId: string): Promise<MedicalRecord[]> {\n    return db.select().from(medicalRecords).where(eq(medicalRecords.playerId, playerId));\n  }\n\n  async createMedicalRecord(record: InsertMedicalRecord): Promise<MedicalRecord> {\n    const [newRecord] = await db.insert(medicalRecords).values(record).returning();\n    return newRecord;\n  }\n\n  async getBiometricData(playerId: string): Promise<BiometricData[]> {\n    return db.select().from(biometricData).where(eq(biometricData.playerId, playerId));\n  }\n\n  async createBiometricData(data: InsertBiometricData): Promise<BiometricData> {\n    const [newData] = await db.insert(biometricData).values(data).returning();\n    return newData;\n  }\n\n  async getEmbassyProfile(id: string): Promise<EmbassyProfile | undefined> {\n    const [profile] = await db.select().from(embassyProfiles).where(eq(embassyProfiles.id, id));\n    return profile;\n  }\n\n  async getEmbassyProfileByCountry(country: string): Promise<EmbassyProfile | undefined> {\n    const [profile] = await db.select().from(embassyProfiles).where(eq(embassyProfiles.country, country));\n    return profile;\n  }\n\n  async getEmbassyProfileByUserId(userId: string): Promise<EmbassyProfile | undefined> {\n    const [profile] = await db.select().from(embassyProfiles).where(eq(embassyProfiles.userId, userId));\n    return profile;\n  }\n\n  async createEmbassyProfile(profile: InsertEmbassyProfile): Promise<EmbassyProfile> {\n    const [newProfile] = await db.insert(embassyProfiles).values(profile).returning();\n    return newProfile;\n  }\n\n  async getInvitationLetters(playerId: string): Promise<InvitationLetter[]> {\n    return db.select().from(invitationLetters).where(eq(invitationLetters.playerId, playerId)).orderBy(desc(invitationLetters.uploadedAt));\n  }\n\n  async getInvitationLetter(id: string): Promise<InvitationLetter | undefined> {\n    const [letter] = await db.select().from(invitationLetters).where(eq(invitationLetters.id, id));\n    return letter;\n  }\n\n  async createInvitationLetter(letter: InsertInvitationLetter): Promise<InvitationLetter> {\n    const [newLetter] = await db.insert(invitationLetters).values(letter).returning();\n    return newLetter;\n  }\n\n  async updateInvitationLetter(id: string, updates: Partial<InsertInvitationLetter>): Promise<InvitationLetter | undefined> {\n    const [letter] = await db.update(invitationLetters).set(updates).where(eq(invitationLetters.id, id)).returning();\n    return letter;\n  }\n\n  async deleteInvitationLetter(id: string): Promise<boolean> {\n    const result = await db.delete(invitationLetters).where(eq(invitationLetters.id, id));\n    return true;\n  }\n\n  async getAllInvitationLetters(teamId?: string): Promise<InvitationLetter[]> {\n    if (teamId) {\n      return db.select().from(invitationLetters).where(eq(invitationLetters.fromTeamId, teamId)).orderBy(desc(invitationLetters.uploadedAt));\n    }\n    return db.select().from(invitationLetters).orderBy(desc(invitationLetters.uploadedAt));\n  }\n\n  async getConsularReports(playerId: string): Promise<ConsularReport[]> {\n    return db.select().from(consularReports).where(eq(consularReports.playerId, playerId)).orderBy(desc(consularReports.generatedAt));\n  }\n\n  async getConsularReport(id: string): Promise<ConsularReport | undefined> {\n    const [report] = await db.select().from(consularReports).where(eq(consularReports.id, id));\n    return report;\n  }\n\n  async getConsularReportByVerificationCode(code: string): Promise<ConsularReport | undefined> {\n    const [report] = await db.select().from(consularReports).where(eq(consularReports.verificationCode, code));\n    return report;\n  }\n\n  async createConsularReport(report: InsertConsularReport): Promise<ConsularReport> {\n    const [newReport] = await db.insert(consularReports).values(report).returning();\n    return newReport;\n  }\n\n  async updateConsularReport(id: string, updates: Partial<InsertConsularReport>): Promise<ConsularReport | undefined> {\n    const [report] = await db.update(consularReports).set(updates).where(eq(consularReports.id, id)).returning();\n    return report;\n  }\n\n  async getConversations(userId: string): Promise<Conversation[]> {\n    const participantRecords = await db.select().from(conversationParticipants).where(eq(conversationParticipants.userId, userId));\n    const conversationIds = participantRecords.map(p => p.conversationId);\n    if (conversationIds.length === 0) return [];\n    const results = [];\n    for (const convId of conversationIds) {\n      const [conv] = await db.select().from(conversations).where(eq(conversations.id, convId));\n      if (conv) results.push(conv);\n    }\n    return results.sort((a, b) => new Date(b.updatedAt || 0).getTime() - new Date(a.updatedAt || 0).getTime());\n  }\n\n  async getConversation(id: string): Promise<Conversation | undefined> {\n    const [conversation] = await db.select().from(conversations).where(eq(conversations.id, id));\n    return conversation;\n  }\n\n  async createConversation(conversation: InsertConversation): Promise<Conversation> {\n    const [newConversation] = await db.insert(conversations).values(conversation).returning();\n    return newConversation;\n  }\n\n  async addConversationParticipant(participant: InsertConversationParticipant): Promise<ConversationParticipant> {\n    const [newParticipant] = await db.insert(conversationParticipants).values(participant).returning();\n    return newParticipant;\n  }\n\n  async getConversationParticipants(conversationId: string): Promise<ConversationParticipant[]> {\n    return db.select().from(conversationParticipants).where(eq(conversationParticipants.conversationId, conversationId));\n  }\n\n  async getMessages(conversationId: string): Promise<Message[]> {\n    return db.select().from(messages).where(eq(messages.conversationId, conversationId)).orderBy(messages.createdAt);\n  }\n\n  async createMessage(message: InsertMessage): Promise<Message> {\n    const [newMessage] = await db.insert(messages).values(message).returning();\n    await db.update(conversations).set({ updatedAt: new Date() }).where(eq(conversations.id, message.conversationId));\n    return newMessage;\n  }\n\n  async logEmbassyDocumentAccess(access: InsertEmbassyDocumentAccess): Promise<EmbassyDocumentAccess> {\n    const [log] = await db.insert(embassyDocumentAccess).values(access).returning();\n    return log;\n  }\n\n  async getEmbassyDocumentAccessLogs(documentId: string): Promise<EmbassyDocumentAccess[]> {\n    return db.select().from(embassyDocumentAccess).where(eq(embassyDocumentAccess.documentId, documentId)).orderBy(desc(embassyDocumentAccess.accessedAt));\n  }\n\n  async shareVideo(share: InsertSharedVideo): Promise<SharedVideo> {\n    const [sharedVideo] = await db.insert(sharedVideos).values(share).returning();\n    return sharedVideo;\n  }\n\n  async getSharedVideos(userId: string): Promise<SharedVideo[]> {\n    return db.select().from(sharedVideos).where(eq(sharedVideos.sharedWithUserId, userId)).orderBy(desc(sharedVideos.sharedAt));\n  }\n\n  async logAction(log: InsertActionLog): Promise<ActionLog> {\n    const [actionLog] = await db.insert(actionLogs).values(log).returning();\n    return actionLog;\n  }\n\n  async getActionLogs(entityType: string, entityId: string): Promise<ActionLog[]> {\n    return db.select().from(actionLogs).where(and(eq(actionLogs.entityType, entityType), eq(actionLogs.entityId, entityId))).orderBy(desc(actionLogs.timestamp));\n  }\n\n  async createTransferTarget(target: InsertTransferTarget): Promise<TransferTarget> {\n    const [newTarget] = await db.insert(transferTargets).values(target).returning();\n    return newTarget;\n  }\n\n  async getTransferTargets(playerId: string): Promise<TransferTarget[]> {\n    return db.select().from(transferTargets).where(eq(transferTargets.playerId, playerId)).orderBy(desc(transferTargets.createdAt));\n  }\n\n  async getTransferTarget(id: string): Promise<TransferTarget | undefined> {\n    const [target] = await db.select().from(transferTargets).where(eq(transferTargets.id, id));\n    return target;\n  }\n\n  async updateTransferTarget(id: string, updates: Partial<InsertTransferTarget>): Promise<TransferTarget | undefined> {\n    const [target] = await db.update(transferTargets).set(updates).where(eq(transferTargets.id, id)).returning();\n    return target;\n  }\n\n  async createVideoPlayerTag(tag: InsertVideoPlayerTag): Promise<VideoPlayerTag> {\n    const [newTag] = await db.insert(videoPlayerTags).values(tag).returning();\n    return newTag;\n  }\n\n  async getVideoPlayerTags(videoId: string): Promise<VideoPlayerTag[]> {\n    return db.select().from(videoPlayerTags).where(eq(videoPlayerTags.videoId, videoId)).orderBy(desc(videoPlayerTags.createdAt));\n  }\n\n  async getVideoPlayerTagsForPlayer(playerId: string): Promise<Array<VideoPlayerTag & { video: Video | null }>> {\n    const rows = await db.select({\n      tag: videoPlayerTags,\n      video: videos\n    })\n    .from(videoPlayerTags)\n    .leftJoin(videos, eq(videoPlayerTags.videoId, videos.id))\n    .where(eq(videoPlayerTags.playerId, playerId));\n    \n    return rows.map(row => ({\n      ...row.tag,\n      video: row.video\n    }));\n  }\n\n  async getVideoPlayerTag(id: string): Promise<VideoPlayerTag | undefined> {\n    const [tag] = await db.select().from(videoPlayerTags).where(eq(videoPlayerTags.id, id));\n    return tag;\n  }\n\n  async updateVideoPlayerTag(id: string, updates: Partial<InsertVideoPlayerTag>): Promise<VideoPlayerTag | undefined> {\n    const [tag] = await db.update(videoPlayerTags).set(updates).where(eq(videoPlayerTags.id, id)).returning();\n    return tag;\n  }\n\n  async deleteVideoPlayerTag(id: string): Promise<void> {\n    await db.delete(videoPlayerTags).where(eq(videoPlayerTags.id, id));\n  }\n\n  async getPlayerVideoMinutes(playerId: string): Promise<number> {\n    const tags = await db.select().from(videoPlayerTags).where(eq(videoPlayerTags.playerId, playerId));\n    return tags.reduce((total, tag) => total + (tag.minutesPlayed || 0), 0);\n  }\n\n  async getPlayerInternationalRecords(playerId: string): Promise<PlayerInternationalRecord[]> {\n    return db.select().from(playerInternationalRecords).where(eq(playerInternationalRecords.playerId, playerId)).orderBy(desc(playerInternationalRecords.createdAt));\n  }\n\n  async getPlayerInternationalRecord(id: string): Promise<PlayerInternationalRecord | undefined> {\n    const [record] = await db.select().from(playerInternationalRecords).where(eq(playerInternationalRecords.id, id));\n    return record;\n  }\n\n  async createPlayerInternationalRecord(record: InsertPlayerInternationalRecord): Promise<PlayerInternationalRecord> {\n    const [newRecord] = await db.insert(playerInternationalRecords).values(record).returning();\n    return newRecord;\n  }\n\n  async updatePlayerInternationalRecord(id: string, updates: Partial<InsertPlayerInternationalRecord>): Promise<PlayerInternationalRecord | undefined> {\n    const [record] = await db.update(playerInternationalRecords).set({ ...updates, updatedAt: new Date() }).where(eq(playerInternationalRecords.id, id)).returning();\n    return record;\n  }\n\n  async deletePlayerInternationalRecord(id: string): Promise<void> {\n    await db.delete(playerInternationalRecords).where(eq(playerInternationalRecords.id, id));\n  }\n\n  async getTeamSheets(teamId: string): Promise<TeamSheet[]> {\n    return db.select().from(teamSheets).where(eq(teamSheets.teamId, teamId)).orderBy(desc(teamSheets.createdAt));\n  }\n\n  async getTeamSheet(id: string): Promise<TeamSheet | undefined> {\n    const [sheet] = await db.select().from(teamSheets).where(eq(teamSheets.id, id));\n    return sheet;\n  }\n\n  async createTeamSheet(sheet: InsertTeamSheet): Promise<TeamSheet> {\n    const [newSheet] = await db.insert(teamSheets).values(sheet).returning();\n    return newSheet;\n  }\n\n  async updateTeamSheet(id: string, updates: Partial<InsertTeamSheet>): Promise<TeamSheet | undefined> {\n    const [sheet] = await db.update(teamSheets).set({ ...updates, updatedAt: new Date() }).where(eq(teamSheets.id, id)).returning();\n    return sheet;\n  }\n\n  async deleteTeamSheet(id: string): Promise<void> {\n    await db.delete(teamSheetPlayers).where(eq(teamSheetPlayers.teamSheetId, id));\n    await db.delete(teamSheets).where(eq(teamSheets.id, id));\n  }\n\n  async getTeamSheetPlayers(teamSheetId: string): Promise<TeamSheetPlayer[]> {\n    return db.select().from(teamSheetPlayers).where(eq(teamSheetPlayers.teamSheetId, teamSheetId)).orderBy(teamSheetPlayers.positionOrder);\n  }\n\n  async createTeamSheetPlayer(player: InsertTeamSheetPlayer): Promise<TeamSheetPlayer> {\n    const [newPlayer] = await db.insert(teamSheetPlayers).values(player).returning();\n    return newPlayer;\n  }\n\n  async updateTeamSheetPlayer(id: string, updates: Partial<InsertTeamSheetPlayer>): Promise<TeamSheetPlayer | undefined> {\n    const [player] = await db.update(teamSheetPlayers).set(updates).where(eq(teamSheetPlayers.id, id)).returning();\n    return player;\n  }\n\n  async deleteTeamSheetPlayer(id: string): Promise<void> {\n    await db.delete(teamSheetPlayers).where(eq(teamSheetPlayers.id, id));\n  }\n\n  async deleteTeamSheetPlayersBySheet(teamSheetId: string): Promise<void> {\n    await db.delete(teamSheetPlayers).where(eq(teamSheetPlayers.teamSheetId, teamSheetId));\n  }\n\n  async getPlayerDocuments(playerId: string): Promise<PlayerDocument[]> {\n    return db.select().from(playerDocuments).where(eq(playerDocuments.playerId, playerId)).orderBy(desc(playerDocuments.uploadedAt));\n  }\n\n  async getPlayerDocument(id: string): Promise<PlayerDocument | undefined> {\n    const [doc] = await db.select().from(playerDocuments).where(eq(playerDocuments.id, id));\n    return doc;\n  }\n\n  async createPlayerDocument(doc: InsertPlayerDocument): Promise<PlayerDocument> {\n    const [newDoc] = await db.insert(playerDocuments).values(doc).returning();\n    return newDoc;\n  }\n\n  async updatePlayerDocument(id: string, updates: Partial<InsertPlayerDocument>): Promise<PlayerDocument | undefined> {\n    const [doc] = await db.update(playerDocuments).set(updates).where(eq(playerDocuments.id, id)).returning();\n    return doc;\n  }\n\n  async deletePlayerDocument(id: string): Promise<void> {\n    await db.delete(playerDocuments).where(eq(playerDocuments.id, id));\n  }\n\n  async getFederationLetterRequests(teamId?: string): Promise<FederationLetterRequest[]> {\n    if (teamId) {\n      return db.select().from(federationLetterRequests).where(eq(federationLetterRequests.teamId, teamId)).orderBy(desc(federationLetterRequests.createdAt));\n    }\n    return db.select().from(federationLetterRequests).orderBy(desc(federationLetterRequests.createdAt));\n  }\n\n  async getFederationLetterRequest(id: string): Promise<FederationLetterRequest | undefined> {\n    const [request] = await db.select().from(federationLetterRequests).where(eq(federationLetterRequests.id, id));\n    return request;\n  }\n\n  async getFederationLetterRequestByNumber(requestNumber: string): Promise<FederationLetterRequest | undefined> {\n    const [request] = await db.select().from(federationLetterRequests).where(eq(federationLetterRequests.requestNumber, requestNumber));\n    return request;\n  }\n\n  async createFederationLetterRequest(request: InsertFederationLetterRequest): Promise<FederationLetterRequest> {\n    const [newRequest] = await db.insert(federationLetterRequests).values(request).returning();\n    return newRequest;\n  }\n\n  async updateFederationLetterRequest(id: string, updates: Partial<InsertFederationLetterRequest>): Promise<FederationLetterRequest | undefined> {\n    const [request] = await db.update(federationLetterRequests).set({ ...updates, updatedAt: new Date() }).where(eq(federationLetterRequests.id, id)).returning();\n    return request;\n  }\n\n  async deleteFederationLetterRequest(id: string): Promise<void> {\n    await db.delete(federationLetterRequests).where(eq(federationLetterRequests.id, id));\n  }\n\n  async getFederationLetterRequestsByPlayer(playerId: string): Promise<FederationLetterRequest[]> {\n    return db.select().from(federationLetterRequests).where(eq(federationLetterRequests.playerId, playerId)).orderBy(desc(federationLetterRequests.createdAt));\n  }\n\n  async getFederationLetterRequestsByStatus(status: string): Promise<FederationLetterRequest[]> {\n    return db.select().from(federationLetterRequests).where(eq(federationLetterRequests.status, status)).orderBy(desc(federationLetterRequests.createdAt));\n  }\n\n  async getFederationProfiles(): Promise<FederationProfile[]> {\n    return db.select().from(federationProfiles).orderBy(desc(federationProfiles.createdAt));\n  }\n\n  async getFederationProfile(id: string): Promise<FederationProfile | undefined> {\n    const [profile] = await db.select().from(federationProfiles).where(eq(federationProfiles.id, id));\n    return profile;\n  }\n\n  async getFederationProfileByCountry(country: string): Promise<FederationProfile | undefined> {\n    const [profile] = await db.select().from(federationProfiles).where(eq(federationProfiles.country, country));\n    return profile;\n  }\n\n  async createFederationProfile(profile: InsertFederationProfile): Promise<FederationProfile> {\n    const [newProfile] = await db.insert(federationProfiles).values(profile).returning();\n    return newProfile;\n  }\n\n  async updateFederationProfile(id: string, updates: Partial<InsertFederationProfile>): Promise<FederationProfile | undefined> {\n    const [profile] = await db.update(federationProfiles).set({ ...updates, updatedAt: new Date() }).where(eq(federationProfiles.id, id)).returning();\n    return profile;\n  }\n\n  async getFederationFeeSchedules(federationId: string): Promise<FederationFeeSchedule[]> {\n    return db.select().from(federationFeeSchedules).where(eq(federationFeeSchedules.federationId, federationId)).orderBy(desc(federationFeeSchedules.createdAt));\n  }\n\n  async getAllFederationFeeSchedules(): Promise<FederationFeeSchedule[]> {\n    return db.select().from(federationFeeSchedules).orderBy(desc(federationFeeSchedules.createdAt));\n  }\n\n  async getFederationFeeScheduleByCountry(federationId: string, country: string): Promise<FederationFeeSchedule | undefined> {\n    const [schedule] = await db.select().from(federationFeeSchedules).where(\n      and(eq(federationFeeSchedules.federationId, federationId), eq(federationFeeSchedules.country, country), eq(federationFeeSchedules.isActive, true))\n    );\n    return schedule;\n  }\n\n  async createFederationFeeSchedule(schedule: InsertFederationFeeSchedule): Promise<FederationFeeSchedule> {\n    const [newSchedule] = await db.insert(federationFeeSchedules).values(schedule).returning();\n    return newSchedule;\n  }\n\n  async updateFederationFeeSchedule(id: string, updates: Partial<InsertFederationFeeSchedule>): Promise<FederationFeeSchedule | undefined> {\n    const [schedule] = await db.update(federationFeeSchedules).set({ ...updates, updatedAt: new Date() }).where(eq(federationFeeSchedules.id, id)).returning();\n    return schedule;\n  }\n\n  async deleteFederationFeeSchedule(id: string): Promise<void> {\n    await db.delete(federationFeeSchedules).where(eq(federationFeeSchedules.id, id));\n  }\n\n  async getFederationRequestActivities(requestId: string): Promise<FederationRequestActivity[]> {\n    return db.select().from(federationRequestActivities).where(eq(federationRequestActivities.requestId, requestId)).orderBy(desc(federationRequestActivities.timestamp));\n  }\n\n  async createFederationRequestActivity(activity: InsertFederationRequestActivity): Promise<FederationRequestActivity> {\n    const [newActivity] = await db.insert(federationRequestActivities).values(activity).returning();\n    return newActivity;\n  }\n\n  async getFederationDashboardStats(federationId?: string): Promise<{ totalRequests: number; processed: number; pending: number; totalRevenue: number }> {\n    const allRequests = await db.select().from(federationLetterRequests);\n    const processed = allRequests.filter(r => r.status === 'issued').length;\n    const pending = allRequests.filter(r => r.status === 'submitted' || r.status === 'processing').length;\n    const totalRevenue = allRequests.filter(r => r.status === 'issued').reduce((sum, r) => sum + (r.feeAmount || 0), 0);\n    return { totalRequests: allRequests.length, processed, pending, totalRevenue };\n  }\n\n  async getFederationRequestMessages(requestId: string): Promise<FederationRequestMessage[]> {\n    return db.select().from(federationRequestMessages).where(eq(federationRequestMessages.requestId, requestId)).orderBy(desc(federationRequestMessages.createdAt));\n  }\n\n  async getUnreadMessagesForPortal(portal: string): Promise<FederationRequestMessage[]> {\n    return db.select().from(federationRequestMessages).where(\n      and(eq(federationRequestMessages.recipientPortal, portal), eq(federationRequestMessages.isRead, false))\n    ).orderBy(desc(federationRequestMessages.createdAt));\n  }\n\n  async createFederationRequestMessage(message: InsertFederationRequestMessage): Promise<FederationRequestMessage> {\n    const [newMessage] = await db.insert(federationRequestMessages).values(message).returning();\n    return newMessage;\n  }\n\n  async markMessageAsRead(id: string): Promise<FederationRequestMessage | undefined> {\n    const [message] = await db.update(federationRequestMessages)\n      .set({ isRead: true, readAt: new Date() })\n      .where(eq(federationRequestMessages.id, id))\n      .returning();\n    return message;\n  }\n\n  async getFederationIssuedDocuments(requestId: string): Promise<FederationIssuedDocument[]> {\n    return db.select().from(federationIssuedDocuments).where(eq(federationIssuedDocuments.requestId, requestId)).orderBy(desc(federationIssuedDocuments.createdAt));\n  }\n\n  async createFederationIssuedDocument(document: InsertFederationIssuedDocument): Promise<FederationIssuedDocument> {\n    const [newDoc] = await db.insert(federationIssuedDocuments).values(document).returning();\n    return newDoc;\n  }\n\n  async incrementDocumentDownloadCount(id: string): Promise<void> {\n    const [doc] = await db.select().from(federationIssuedDocuments).where(eq(federationIssuedDocuments.id, id));\n    if (doc) {\n      await db.update(federationIssuedDocuments)\n        .set({ downloadCount: (doc.downloadCount || 0) + 1, lastDownloadedAt: new Date() })\n        .where(eq(federationIssuedDocuments.id, id));\n    }\n  }\n\n  async getRequestWithFullHistory(requestId: string): Promise<{\n    request: FederationLetterRequest | undefined;\n    activities: FederationRequestActivity[];\n    messages: FederationRequestMessage[];\n    documents: FederationIssuedDocument[];\n  }> {\n    const [request] = await db.select().from(federationLetterRequests).where(eq(federationLetterRequests.id, requestId));\n    const activities = await this.getFederationRequestActivities(requestId);\n    const messagesList = await this.getFederationRequestMessages(requestId);\n    const documents = await this.getFederationIssuedDocuments(requestId);\n    return { request, activities, messages: messagesList, documents };\n  }\n\n  async logFederationActivity(\n    requestId: string,\n    activityType: string,\n    description: string,\n    actorId?: string,\n    actorName?: string,\n    actorRole?: string,\n    previousStatus?: string,\n    newStatus?: string,\n    metadata?: Record<string, any>\n  ): Promise<FederationRequestActivity> {\n    return this.createFederationRequestActivity({\n      requestId,\n      activityType,\n      description,\n      actorId,\n      actorName,\n      actorRole,\n      previousStatus,\n      newStatus,\n      metadata\n    });\n  }\n\n  async getScoutShortlist(scoutId: string): Promise<ScoutShortlist[]> {\n    return db.select().from(scoutShortlists).where(eq(scoutShortlists.scoutId, scoutId)).orderBy(desc(scoutShortlists.addedAt));\n  }\n\n  async getScoutShortlistWithPlayers(scoutId: string): Promise<Array<ScoutShortlist & { player: Player }>> {\n    const shortlistEntries = await db.select().from(scoutShortlists).where(eq(scoutShortlists.scoutId, scoutId)).orderBy(desc(scoutShortlists.addedAt));\n    const results: Array<ScoutShortlist & { player: Player }> = [];\n    for (const entry of shortlistEntries) {\n      const [player] = await db.select().from(players).where(eq(players.id, entry.playerId));\n      if (player) {\n        results.push({ ...entry, player });\n      }\n    }\n    return results;\n  }\n\n  async addToShortlist(shortlist: InsertScoutShortlist): Promise<ScoutShortlist> {\n    const [entry] = await db.insert(scoutShortlists).values(shortlist).returning();\n    return entry;\n  }\n\n  async updateShortlistPriority(id: string, priority: string, notes?: string): Promise<ScoutShortlist | undefined> {\n    const updates: Partial<InsertScoutShortlist> = { priority };\n    if (notes !== undefined) {\n      updates.notes = notes;\n    }\n    const [entry] = await db.update(scoutShortlists).set(updates).where(eq(scoutShortlists.id, id)).returning();\n    return entry;\n  }\n\n  async removeFromShortlist(id: string): Promise<void> {\n    await db.delete(scoutShortlists).where(eq(scoutShortlists.id, id));\n  }\n\n  async getShortlistEntry(scoutId: string, playerId: string): Promise<ScoutShortlist | undefined> {\n    const [entry] = await db.select().from(scoutShortlists).where(\n      and(eq(scoutShortlists.scoutId, scoutId), eq(scoutShortlists.playerId, playerId))\n    );\n    return entry;\n  }\n\n  // Token System Methods\n  async getTokenBalance(userId: string): Promise<TokenBalance | undefined> {\n    const [balance] = await db.select().from(tokenBalances).where(eq(tokenBalances.userId, userId));\n    return balance;\n  }\n\n  async createTokenBalance(balance: InsertTokenBalance): Promise<TokenBalance> {\n    const [newBalance] = await db.insert(tokenBalances).values(balance).returning();\n    return newBalance;\n  }\n\n  async updateTokenBalance(userId: string, balance: number, lifetimePurchased?: number, lifetimeSpent?: number): Promise<TokenBalance | undefined> {\n    const updates: any = { balance, updatedAt: new Date() };\n    if (lifetimePurchased !== undefined) updates.lifetimePurchased = lifetimePurchased;\n    if (lifetimeSpent !== undefined) updates.lifetimeSpent = lifetimeSpent;\n    const [updated] = await db.update(tokenBalances).set(updates).where(eq(tokenBalances.userId, userId)).returning();\n    return updated;\n  }\n\n  async getTokenTransactions(userId: string, limit?: number): Promise<TokenTransaction[]> {\n    const query = db.select().from(tokenTransactions).where(eq(tokenTransactions.userId, userId)).orderBy(desc(tokenTransactions.createdAt));\n    if (limit) {\n      return query.limit(limit);\n    }\n    return query;\n  }\n\n  async createTokenTransaction(transaction: InsertTokenTransaction): Promise<TokenTransaction> {\n    const [newTransaction] = await db.insert(tokenTransactions).values(transaction).returning();\n    return newTransaction;\n  }\n\n  async getTokenPacks(): Promise<TokenPack[]> {\n    return db.select().from(tokenPacks).where(eq(tokenPacks.isActive, true)).orderBy(tokenPacks.sortOrder);\n  }\n\n  async getTokenPack(id: string): Promise<TokenPack | undefined> {\n    const [pack] = await db.select().from(tokenPacks).where(eq(tokenPacks.id, id));\n    return pack;\n  }\n\n  async createTokenPack(pack: InsertTokenPack): Promise<TokenPack> {\n    const [newPack] = await db.insert(tokenPacks).values(pack).returning();\n    return newPack;\n  }\n\n  async getTokenPurchases(userId: string): Promise<TokenPurchase[]> {\n    return db.select().from(tokenPurchases).where(eq(tokenPurchases.userId, userId)).orderBy(desc(tokenPurchases.createdAt));\n  }\n\n  async createTokenPurchase(purchase: InsertTokenPurchase): Promise<TokenPurchase> {\n    const [newPurchase] = await db.insert(tokenPurchases).values(purchase).returning();\n    return newPurchase;\n  }\n\n  async updateTokenPurchase(id: string, updates: Partial<InsertTokenPurchase>): Promise<TokenPurchase | undefined> {\n    const [updated] = await db.update(tokenPurchases).set(updates).where(eq(tokenPurchases.id, id)).returning();\n    return updated;\n  }\n}\n\nexport const storage = new DatabaseStorage();\n","path":null,"size_bytes":50939,"size_tokens":null},"client/src/index.css":{"content":"@tailwind base;\n@tailwind components;\n@tailwind utilities;\n\n/* LIGHT MODE - Black & Mauve/Pink Theme */\n:root {\n  --button-outline: rgba(0,0,0, .10);\n  --badge-outline: rgba(0,0,0, .05);\n  --opaque-button-border-intensity: -8;\n  --elevate-1: rgba(0,0,0, .03);\n  --elevate-2: rgba(0,0,0, .08);\n  --background: 0 0% 98%;\n  --foreground: 0 0% 8%;\n  --border: 350 10% 88%;\n  --card: 0 0% 100%;\n  --card-foreground: 0 0% 8%;\n  --card-border: 350 10% 92%;\n  --sidebar: 0 0% 6%;\n  --sidebar-foreground: 0 0% 95%;\n  --sidebar-border: 0 0% 12%;\n  --sidebar-primary: 353 65% 65%;\n  --sidebar-primary-foreground: 0 0% 100%;\n  --sidebar-accent: 353 30% 20%;\n  --sidebar-accent-foreground: 0 0% 95%;\n  --sidebar-ring: 353 65% 65%;\n  --popover: 0 0% 100%;\n  --popover-foreground: 0 0% 8%;\n  --popover-border: 350 10% 90%;\n  --primary: 353 65% 60%;\n  --primary-foreground: 0 0% 100%;\n  --secondary: 350 15% 92%;\n  --secondary-foreground: 0 0% 8%;\n  --muted: 350 10% 94%;\n  --muted-foreground: 0 0% 40%;\n  --accent: 353 20% 90%;\n  --accent-foreground: 0 0% 8%;\n  --destructive: 0 84% 48%;\n  --destructive-foreground: 0 0% 98%;\n  --input: 350 10% 75%;\n  --ring: 353 65% 60%;\n  --chart-1: 353 65% 60%;\n  --chart-2: 142 76% 36%;\n  --chart-3: 320 60% 55%;\n  --chart-4: 32 95% 44%;\n  --chart-5: 280 70% 55%;\n  --font-sans: Open Sans, sans-serif;\n  --font-serif: Georgia, serif;\n  --font-mono: Menlo, monospace;\n  --radius: .5rem;\n  --shadow-2xs: 0px 2px 0px 0px hsl(220 8% 50% / 0.00);\n  --shadow-xs: 0px 2px 0px 0px hsl(220 8% 50% / 0.00);\n  --shadow-sm: 0px 2px 0px 0px hsl(220 8% 50% / 0.00), 0px 1px 2px -1px hsl(220 8% 50% / 0.00);\n  --shadow: 0px 2px 0px 0px hsl(220 8% 50% / 0.00), 0px 1px 2px -1px hsl(220 8% 50% / 0.00);\n  --shadow-md: 0px 2px 0px 0px hsl(220 8% 50% / 0.00), 0px 2px 4px -1px hsl(220 8% 50% / 0.00);\n  --shadow-lg: 0px 2px 0px 0px hsl(220 8% 50% / 0.00), 0px 4px 6px -1px hsl(220 8% 50% / 0.00);\n  --shadow-xl: 0px 2px 0px 0px hsl(220 8% 50% / 0.00), 0px 8px 10px -1px hsl(220 8% 50% / 0.00);\n  --shadow-2xl: 0px 2px 0px 0px hsl(220 8% 50% / 0.00);\n  --tracking-normal: 0em;\n  --spacing: 0.25rem;\n\n/* Fallback for older browsers */\n  --sidebar-primary-border: hsl(var(--sidebar-primary));\n  --sidebar-primary-border: hsl(from hsl(var(--sidebar-primary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --sidebar-accent-border: hsl(var(--sidebar-accent));\n  --sidebar-accent-border: hsl(from hsl(var(--sidebar-accent)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --primary-border: hsl(var(--primary));\n  --primary-border: hsl(from hsl(var(--primary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --secondary-border: hsl(var(--secondary));\n  --secondary-border: hsl(from hsl(var(--secondary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --muted-border: hsl(var(--muted));\n  --muted-border: hsl(from hsl(var(--muted)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --accent-border: hsl(var(--accent));\n  --accent-border: hsl(from hsl(var(--accent)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --destructive-border: hsl(var(--destructive));\n  --destructive-border: hsl(from hsl(var(--destructive)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n}\n\n/* DARK MODE - Black & Mauve/Pink Theme */\n.dark {\n  --button-outline: rgba(255,255,255, .10);\n  --badge-outline: rgba(255,255,255, .05);\n  --opaque-button-border-intensity: 9;\n  --elevate-1: rgba(255,255,255, .04);\n  --elevate-2: rgba(255,255,255, .09);\n  --background: 0 0% 4%;\n  --foreground: 0 0% 95%;\n  --border: 0 0% 15%;\n  --card: 0 0% 7%;\n  --card-foreground: 0 0% 95%;\n  --card-border: 0 0% 12%;\n  --sidebar: 0 0% 3%;\n  --sidebar-foreground: 0 0% 95%;\n  --sidebar-border: 0 0% 10%;\n  --sidebar-primary: 353 65% 65%;\n  --sidebar-primary-foreground: 0 0% 100%;\n  --sidebar-accent: 353 30% 18%;\n  --sidebar-accent-foreground: 0 0% 95%;\n  --sidebar-ring: 353 65% 65%;\n  --popover: 0 0% 8%;\n  --popover-foreground: 0 0% 95%;\n  --popover-border: 0 0% 15%;\n  --primary: 353 65% 62%;\n  --primary-foreground: 0 0% 100%;\n  --secondary: 0 0% 12%;\n  --secondary-foreground: 0 0% 95%;\n  --muted: 0 0% 12%;\n  --muted-foreground: 0 0% 60%;\n  --accent: 353 20% 15%;\n  --accent-foreground: 0 0% 95%;\n  --destructive: 0 84% 48%;\n  --destructive-foreground: 0 0% 98%;\n  --input: 0 0% 25%;\n  --ring: 353 65% 62%;\n  --chart-1: 353 65% 65%;\n  --chart-2: 142 76% 55%;\n  --chart-3: 320 60% 60%;\n  --chart-4: 32 95% 60%;\n  --chart-5: 280 70% 60%;\n  --shadow-2xs: 0px 2px 0px 0px hsl(220 13% 9% / 0.00);\n  --shadow-xs: 0px 2px 0px 0px hsl(220 13% 9% / 0.00);\n  --shadow-sm: 0px 2px 0px 0px hsl(220 13% 9% / 0.00), 0px 1px 2px -1px hsl(220 13% 9% / 0.00);\n  --shadow: 0px 2px 0px 0px hsl(220 13% 9% / 0.00), 0px 1px 2px -1px hsl(220 13% 9% / 0.00);\n  --shadow-md: 0px 2px 0px 0px hsl(220 13% 9% / 0.00), 0px 2px 4px -1px hsl(220 13% 9% / 0.00);\n  --shadow-lg: 0px 2px 0px 0px hsl(220 13% 9% / 0.00), 0px 4px 6px -1px hsl(220 13% 9% / 0.00);\n  --shadow-xl: 0px 2px 0px 0px hsl(220 13% 9% / 0.00), 0px 8px 10px -1px hsl(220 13% 9% / 0.00);\n  --shadow-2xl: 0px 2px 0px 0px hsl(220 13% 9% / 0.00);\n\n/* Fallback for older browsers */\n  --sidebar-primary-border: hsl(var(--sidebar-primary));\n  --sidebar-primary-border: hsl(from hsl(var(--sidebar-primary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --sidebar-accent-border: hsl(var(--sidebar-accent));\n  --sidebar-accent-border: hsl(from hsl(var(--sidebar-accent)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --primary-border: hsl(var(--primary));\n  --primary-border: hsl(from hsl(var(--primary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --secondary-border: hsl(var(--secondary));\n  --secondary-border: hsl(from hsl(var(--secondary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --muted-border: hsl(var(--muted));\n  --muted-border: hsl(from hsl(var(--muted)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --accent-border: hsl(var(--accent));\n  --accent-border: hsl(from hsl(var(--accent)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --destructive-border: hsl(var(--destructive));\n  --destructive-border: hsl(from hsl(var(--destructive)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n}\n\n@layer base {\n  * {\n    @apply border-border;\n  }\n\n  body {\n    @apply font-sans antialiased bg-background text-foreground;\n  }\n}\n\n/**\n * Using the elevate system.\n * Automatic contrast adjustment.\n *\n * <element className=\"hover-elevate\" />\n * <element className=\"active-elevate-2\" />\n *\n * // Using the tailwind utility when a data attribute is \"on\"\n * <element className=\"toggle-elevate data-[state=on]:toggle-elevated\" />\n * // Or manually controlling the toggle state\n * <element className=\"toggle-elevate toggle-elevated\" />\n *\n * Elevation systems have to handle many states.\n * - not-hovered, vs. hovered vs. active  (three mutually exclusive states)\n * - toggled or not\n * - focused or not (this is not handled with these utilities)\n *\n * Even without handling focused or not, this is six possible combinations that\n * need to be distinguished from eachother visually.\n */\n@layer utilities {\n\n  /* Hide ugly search cancel button in Chrome until we can style it properly */\n  input[type=\"search\"]::-webkit-search-cancel-button {\n    @apply hidden;\n  }\n\n  /* Placeholder styling for contentEditable div */\n  [contenteditable][data-placeholder]:empty::before {\n    content: attr(data-placeholder);\n    color: hsl(var(--muted-foreground));\n    pointer-events: none;\n  }\n\n  /* .no-default-hover-elevate/no-default-active-elevate is an escape hatch so consumers of\n   * buttons/badges can remove the automatic brightness adjustment on interactions\n   * and program their own. */\n  .no-default-hover-elevate {}\n\n  .no-default-active-elevate {}\n\n\n  /**\n   * Toggleable backgrounds go behind the content. Hoverable/active goes on top.\n   * This way they can stack/compound. Both will overlap the parent's borders!\n   * So borders will be automatically adjusted both on toggle, and hover/active,\n   * and they will be compounded.\n   */\n  .toggle-elevate::before,\n  .toggle-elevate-2::before {\n    content: \"\";\n    pointer-events: none;\n    position: absolute;\n    inset: 0px;\n    /*border-radius: inherit;   match rounded corners */\n    border-radius: inherit;\n    z-index: -1;\n    /* sits behind content but above backdrop */\n  }\n\n  .toggle-elevate.toggle-elevated::before {\n    background-color: var(--elevate-2);\n  }\n\n  /* If there's a 1px border, adjust the inset so that it covers that parent's border */\n  .border.toggle-elevate::before {\n    inset: -1px;\n  }\n\n  /* Does not work on elements with overflow:hidden! */\n  .hover-elevate:not(.no-default-hover-elevate),\n  .active-elevate:not(.no-default-active-elevate),\n  .hover-elevate-2:not(.no-default-hover-elevate),\n  .active-elevate-2:not(.no-default-active-elevate) {\n    position: relative;\n    z-index: 0;\n  }\n\n  .hover-elevate:not(.no-default-hover-elevate)::after,\n  .active-elevate:not(.no-default-active-elevate)::after,\n  .hover-elevate-2:not(.no-default-hover-elevate)::after,\n  .active-elevate-2:not(.no-default-active-elevate)::after {\n    content: \"\";\n    pointer-events: none;\n    position: absolute;\n    inset: 0px;\n    /*border-radius: inherit;   match rounded corners */\n    border-radius: inherit;\n    z-index: 999;\n    /* sits in front of content */\n  }\n\n  .hover-elevate:hover:not(.no-default-hover-elevate)::after,\n  .active-elevate:active:not(.no-default-active-elevate)::after {\n    background-color: var(--elevate-1);\n  }\n\n  .hover-elevate-2:hover:not(.no-default-hover-elevate)::after,\n  .active-elevate-2:active:not(.no-default-active-elevate)::after {\n    background-color: var(--elevate-2);\n  }\n\n  /* If there's a 1px border, adjust the inset so that it covers that parent's border */\n  .border.hover-elevate:not(.no-hover-interaction-elevate)::after,\n  .border.active-elevate:not(.no-active-interaction-elevate)::after,\n  .border.hover-elevate-2:not(.no-hover-interaction-elevate)::after,\n  .border.active-elevate-2:not(.no-active-interaction-elevate)::after,\n  .border.hover-elevate:not(.no-hover-interaction-elevate)::after {\n    inset: -1px;\n  }\n}\n","path":null,"size_bytes":10707,"size_tokens":null},"client/src/components/examples/AppSidebar.tsx":{"content":"import AppSidebar from \"../AppSidebar\";\nimport { SidebarProvider } from \"@/components/ui/sidebar\";\n\nexport default function AppSidebarExample() {\n  return (\n    <SidebarProvider>\n      <div className=\"flex h-[400px] w-full\">\n        <AppSidebar userName=\"John Smith\" userRole=\"Sporting Director\" pendingVerifications={3} />\n      </div>\n    </SidebarProvider>\n  );\n}\n","path":null,"size_bytes":367,"size_tokens":null},"client/src/components/AppSidebar.tsx":{"content":"import { useLocation, Link } from \"wouter\";\nimport {\n  Sidebar,\n  SidebarContent,\n  SidebarGroup,\n  SidebarGroupContent,\n  SidebarGroupLabel,\n  SidebarHeader,\n  SidebarMenu,\n  SidebarMenuButton,\n  SidebarMenuItem,\n  SidebarFooter,\n} from \"@/components/ui/sidebar\";\nimport { Avatar, AvatarFallback } from \"@/components/ui/avatar\";\nimport { Badge } from \"@/components/ui/badge\";\nimport {\n  LayoutDashboard,\n  Users,\n  Video,\n  FileText,\n  Building2,\n  Search,\n  Settings,\n  LogOut,\n  Bell,\n  Shield,\n  MessageSquare,\n  Mail,\n  ClipboardList,\n  FileCheck,\n  Coins,\n} from \"lucide-react\";\nimport logoImage from \"@assets/WhatsApp_Image_2025-12-17_at_12.49.33_1766008177672.jpeg\";\n\ninterface AppSidebarProps {\n  userName?: string;\n  userRole?: string;\n  userRoleRaw?: string;\n  pendingVerifications?: number;\n}\n\nexport default function AppSidebar({ \n  userName = \"John Smith\", \n  userRole = \"Sporting Director\",\n  userRoleRaw = \"sporting_director\",\n  pendingVerifications = 3 \n}: AppSidebarProps) {\n  const [location] = useLocation();\n\n  const teamNavItems = [\n    { title: \"Dashboard\", url: \"/\", icon: LayoutDashboard },\n    { title: \"Players\", url: \"/players\", icon: Users },\n    { title: \"Videos\", url: \"/videos\", icon: Video },\n    { title: \"Team Sheets\", url: \"/team-sheets\", icon: ClipboardList },\n    { title: \"Reports\", url: \"/reports\", icon: FileText },\n    { title: \"Scouting\", url: \"/scouting\", icon: Search },\n    { title: \"Invitation Letters\", url: \"/invitation-letters\", icon: Mail },\n    { title: \"Federation Letters\", url: \"/federation-letters\", icon: FileCheck },\n    { title: \"Messages\", url: \"/messages\", icon: MessageSquare },\n    { title: \"Token Bank\", url: \"/token-bank\", icon: Coins },\n  ];\n\n  const scoutNavItems = [\n    { title: \"Player Search\", url: \"/\", icon: Search },\n    { title: \"Messages\", url: \"/messages\", icon: MessageSquare },\n    { title: \"Token Bank\", url: \"/token-bank\", icon: Coins },\n  ];\n\n  const embassyNavItems = [\n    { title: \"Documents\", url: \"/\", icon: FileText },\n  ];\n\n  const adminNavItems = [\n    { title: \"Embassy Verification\", url: \"/embassy\", icon: Building2, badge: pendingVerifications },\n    { title: \"Access Control\", url: \"/access\", icon: Shield },\n    { title: \"Settings\", url: \"/settings\", icon: Settings },\n  ];\n\n  const federationAdminNavItems = [\n    { title: \"Dashboard\", url: \"/\", icon: LayoutDashboard },\n    { title: \"Request Queue\", url: \"/federation-admin\", icon: FileCheck },\n    { title: \"Settings\", url: \"/settings\", icon: Settings },\n  ];\n\n  const isEmbassy = userRoleRaw === \"embassy\";\n  const isScout = userRoleRaw === \"scout\" || userRoleRaw === \"agent\";\n  const isFederationAdmin = userRoleRaw === \"federation_admin\";\n  const mainNavItems = isFederationAdmin ? federationAdminNavItems : isEmbassy ? embassyNavItems : isScout ? scoutNavItems : teamNavItems;\n\n  const isActive = (url: string) => {\n    if (url === \"/\") return location === \"/\";\n    return location.startsWith(url);\n  };\n\n  return (\n    <Sidebar data-testid=\"sidebar-main\">\n      <SidebarHeader className=\"p-4 border-b border-sidebar-border\">\n        <div className=\"flex items-center gap-3\">\n          <img \n            src={logoImage} \n            alt=\"Sports Reels\" \n            className=\"h-10 w-10 object-contain rounded-md\"\n          />\n          <div>\n            <h1 className=\"font-semibold text-lg text-sidebar-foreground\">Sports Reels</h1>\n            <p className=\"text-xs text-sidebar-foreground/60\">Compliance Platform</p>\n          </div>\n        </div>\n      </SidebarHeader>\n      \n      <SidebarContent>\n        <SidebarGroup>\n          <SidebarGroupLabel>Navigation</SidebarGroupLabel>\n          <SidebarGroupContent>\n            <SidebarMenu>\n              {mainNavItems.map((item) => (\n                <SidebarMenuItem key={item.title}>\n                  <SidebarMenuButton \n                    asChild \n                    isActive={isActive(item.url)}\n                    data-testid={`nav-${item.title.toLowerCase()}`}\n                  >\n                    <Link href={item.url}>\n                      <item.icon className=\"h-4 w-4\" />\n                      <span>{item.title}</span>\n                    </Link>\n                  </SidebarMenuButton>\n                </SidebarMenuItem>\n              ))}\n            </SidebarMenu>\n          </SidebarGroupContent>\n        </SidebarGroup>\n\n        {!isEmbassy && !isScout && !isFederationAdmin && (\n          <SidebarGroup>\n            <SidebarGroupLabel>Administration</SidebarGroupLabel>\n            <SidebarGroupContent>\n              <SidebarMenu>\n                {adminNavItems.map((item) => (\n                  <SidebarMenuItem key={item.title}>\n                    <SidebarMenuButton \n                      asChild \n                      isActive={isActive(item.url)}\n                      data-testid={`nav-${item.title.toLowerCase().replace(/\\s+/g, \"-\")}`}\n                    >\n                      <Link href={item.url}>\n                        <item.icon className=\"h-4 w-4\" />\n                        <span>{item.title}</span>\n                        {item.badge && item.badge > 0 && (\n                          <Badge \n                            variant=\"secondary\" \n                            className=\"ml-auto bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-400\"\n                          >\n                            {item.badge}\n                          </Badge>\n                        )}\n                      </Link>\n                    </SidebarMenuButton>\n                  </SidebarMenuItem>\n                ))}\n              </SidebarMenu>\n            </SidebarGroupContent>\n          </SidebarGroup>\n        )}\n      </SidebarContent>\n\n      <SidebarFooter className=\"border-t border-sidebar-border p-4\">\n        <div className=\"flex items-center gap-3\">\n          <Avatar className=\"h-9 w-9\">\n            <AvatarFallback className=\"bg-primary text-primary-foreground text-sm\">\n              {userName.split(\" \").map(n => n[0]).join(\"\")}\n            </AvatarFallback>\n          </Avatar>\n          <div className=\"flex-1 min-w-0\">\n            <p className=\"text-sm font-medium truncate\">{userName}</p>\n            <p className=\"text-xs text-muted-foreground truncate\">{userRole}</p>\n          </div>\n          <SidebarMenuButton \n            asChild \n            className=\"w-auto p-2\"\n            data-testid=\"button-logout\"\n          >\n            <a href=\"/api/logout\">\n              <LogOut className=\"h-4 w-4\" />\n            </a>\n          </SidebarMenuButton>\n        </div>\n      </SidebarFooter>\n    </Sidebar>\n  );\n}\n","path":null,"size_bytes":6578,"size_tokens":null},"client/src/components/ui/badge.tsx":{"content":"import * as React from \"react\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst badgeVariants = cva(\n  // Whitespace-nowrap: Badges should never wrap.\n  \"whitespace-nowrap inline-flex items-center rounded-md border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2\" +\n  \" hover-elevate \" ,\n  {\n    variants: {\n      variant: {\n        default:\n          \"border-transparent bg-primary text-primary-foreground shadow-xs\",\n        secondary: \"border-transparent bg-secondary text-secondary-foreground\",\n        destructive:\n          \"border-transparent bg-destructive text-destructive-foreground shadow-xs\",\n\n        outline: \" border [border-color:var(--badge-outline)] shadow-xs\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  },\n)\n\nexport interface BadgeProps\n  extends React.HTMLAttributes<HTMLDivElement>,\n    VariantProps<typeof badgeVariants> {}\n\nfunction Badge({ className, variant, ...props }: BadgeProps) {\n  return (\n    <div className={cn(badgeVariants({ variant }), className)} {...props} />\n  );\n}\n\nexport { Badge, badgeVariants }\n","path":null,"size_bytes":1202,"size_tokens":null},"client/src/lib/utils.ts":{"content":"import { clsx, type ClassValue } from \"clsx\"\nimport { twMerge } from \"tailwind-merge\"\n\nexport function cn(...inputs: ClassValue[]) {\n  return twMerge(clsx(inputs))\n}\n","path":null,"size_bytes":166,"size_tokens":null},"client/src/components/examples/PerformanceMetrics.tsx":{"content":"import PerformanceMetrics from \"../PerformanceMetrics\";\nimport { mockPlayers } from \"@/lib/mock-data\";\n\nexport default function PerformanceMetricsExample() {\n  return <PerformanceMetrics player={mockPlayers[0]} />;\n}\n","path":null,"size_bytes":217,"size_tokens":null},"client/src/components/ThemeToggle.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Moon, Sun } from \"lucide-react\";\n\nexport default function ThemeToggle() {\n  const [theme, setTheme] = useState<\"light\" | \"dark\">(\"light\");\n\n  useEffect(() => {\n    const stored = localStorage.getItem(\"theme\") as \"light\" | \"dark\" | null;\n    if (stored) {\n      setTheme(stored);\n      document.documentElement.classList.toggle(\"dark\", stored === \"dark\");\n    } else if (window.matchMedia(\"(prefers-color-scheme: dark)\").matches) {\n      setTheme(\"dark\");\n      document.documentElement.classList.add(\"dark\");\n    }\n  }, []);\n\n  const toggleTheme = () => {\n    const newTheme = theme === \"light\" ? \"dark\" : \"light\";\n    setTheme(newTheme);\n    localStorage.setItem(\"theme\", newTheme);\n    document.documentElement.classList.toggle(\"dark\", newTheme === \"dark\");\n  };\n\n  return (\n    <Button \n      size=\"icon\" \n      variant=\"ghost\" \n      onClick={toggleTheme}\n      data-testid=\"button-theme-toggle\"\n    >\n      {theme === \"light\" ? <Moon className=\"h-4 w-4\" /> : <Sun className=\"h-4 w-4\" />}\n    </Button>\n  );\n}\n","path":null,"size_bytes":1117,"size_tokens":null},"server/static.ts":{"content":"import express, { type Express } from \"express\";\nimport fs from \"fs\";\nimport path from \"path\";\n\nexport function serveStatic(app: Express) {\n  const distPath = path.resolve(__dirname, \"public\");\n  if (!fs.existsSync(distPath)) {\n    throw new Error(\n      `Could not find the build directory: ${distPath}, make sure to build the client first`,\n    );\n  }\n\n  app.use(express.static(distPath));\n\n  // fall through to index.html if the file doesn't exist\n  app.use(\"*\", (_req, res) => {\n    res.sendFile(path.resolve(distPath, \"index.html\"));\n  });\n}\n","path":null,"size_bytes":547,"size_tokens":null},"server/replit_integrations/auth/storage.ts":{"content":"import { users, type User, type UpsertUser } from \"@shared/models/auth\";\nimport { db } from \"../../db\";\nimport { eq } from \"drizzle-orm\";\n\n// Interface for auth storage operations\n// (IMPORTANT) These user operations are mandatory for Replit Auth.\nexport interface IAuthStorage {\n  getUser(id: string): Promise<User | undefined>;\n  upsertUser(user: UpsertUser): Promise<User>;\n}\n\nclass AuthStorage implements IAuthStorage {\n  async getUser(id: string): Promise<User | undefined> {\n    const [user] = await db.select().from(users).where(eq(users.id, id));\n    return user;\n  }\n\n  async upsertUser(userData: UpsertUser): Promise<User> {\n    const [user] = await db\n      .insert(users)\n      .values(userData)\n      .onConflictDoUpdate({\n        target: users.id,\n        set: {\n          ...userData,\n          updatedAt: new Date(),\n        },\n      })\n      .returning();\n    return user;\n  }\n}\n\nexport const authStorage = new AuthStorage();\n","path":null,"size_bytes":943,"size_tokens":null},"client/src/components/ui/scroll-area.tsx":{"content":"import * as React from \"react\"\nimport * as ScrollAreaPrimitive from \"@radix-ui/react-scroll-area\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ScrollArea = React.forwardRef<\n  React.ElementRef<typeof ScrollAreaPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ScrollAreaPrimitive.Root>\n>(({ className, children, ...props }, ref) => (\n  <ScrollAreaPrimitive.Root\n    ref={ref}\n    className={cn(\"relative overflow-hidden\", className)}\n    {...props}\n  >\n    <ScrollAreaPrimitive.Viewport className=\"h-full w-full rounded-[inherit]\">\n      {children}\n    </ScrollAreaPrimitive.Viewport>\n    <ScrollBar />\n    <ScrollAreaPrimitive.Corner />\n  </ScrollAreaPrimitive.Root>\n))\nScrollArea.displayName = ScrollAreaPrimitive.Root.displayName\n\nconst ScrollBar = React.forwardRef<\n  React.ElementRef<typeof ScrollAreaPrimitive.ScrollAreaScrollbar>,\n  React.ComponentPropsWithoutRef<typeof ScrollAreaPrimitive.ScrollAreaScrollbar>\n>(({ className, orientation = \"vertical\", ...props }, ref) => (\n  <ScrollAreaPrimitive.ScrollAreaScrollbar\n    ref={ref}\n    orientation={orientation}\n    className={cn(\n      \"flex touch-none select-none transition-colors\",\n      orientation === \"vertical\" &&\n        \"h-full w-2.5 border-l border-l-transparent p-[1px]\",\n      orientation === \"horizontal\" &&\n        \"h-2.5 flex-col border-t border-t-transparent p-[1px]\",\n      className\n    )}\n    {...props}\n  >\n    <ScrollAreaPrimitive.ScrollAreaThumb className=\"relative flex-1 rounded-full bg-border\" />\n  </ScrollAreaPrimitive.ScrollAreaScrollbar>\n))\nScrollBar.displayName = ScrollAreaPrimitive.ScrollAreaScrollbar.displayName\n\nexport { ScrollArea, ScrollBar }\n","path":null,"size_bytes":1642,"size_tokens":null},"client/src/lib/types.ts":{"content":"export type UserRole = \"sporting_director\" | \"legal\" | \"scout\" | \"coach\" | \"admin\";\n\nexport type VisaStatus = \"green\" | \"yellow\" | \"red\";\n\nexport type VisaType = \n  | \"schengen_sports\" \n  | \"uk_gbe\" \n  | \"us_p1\" \n  | \"us_o1\" \n  | \"fifa_transfer\" \n  | \"middle_east\" \n  | \"asia_sports\";\n\nexport type LeagueBand = 1 | 2 | 3 | 4 | 5;\n\nexport interface Player {\n  id: string;\n  firstName: string;\n  lastName: string;\n  nationality: string;\n  dateOfBirth: string;\n  position: string;\n  currentClub: string;\n  currentLeague: string;\n  leagueBand: LeagueBand;\n  leaguePosition: number;\n  profileImageUrl?: string;\n  nationalTeamCaps: number;\n  nationalTeamDebut?: string;\n  internationalCaps: number;\n  continentalGames: number;\n  currentSeasonMinutes: number;\n  totalCareerMinutes: number;\n  height?: number;\n  weight?: number;\n  preferredFoot?: string;\n  contractEndDate?: string;\n  marketValue?: number;\n  medicalDataAvailable: boolean;\n  gpsDataAvailable: boolean;\n  schengenScore: number;\n  ukGbeScore: number;\n  usP1Score: number;\n  usO1Score: number;\n  middleEastScore: number;\n  asiaScore: number;\n  fifaTransferScore: number;\n  overallEligibilityScore: number;\n  lastUpdated: string;\n}\n\nexport interface PhysicalData {\n  height: number;\n  weight: number;\n  restingHeartRate?: number;\n  vo2Max?: number;\n  bodyFatPercentage?: number;\n  muscleMass?: number;\n  sprintSpeed?: number;\n}\n\nexport interface BiometricData {\n  id: string;\n  playerId: string;\n  recordDate: string;\n  restingHeartRate?: number;\n  vo2Max?: number;\n  bodyFatPercentage?: number;\n  muscleMass?: number;\n  hydrationLevel?: number;\n  sleepQuality?: number;\n  fatigueIndex?: number;\n  gpsDataAvailable: boolean;\n}\n\nexport interface MedicalRecord {\n  id: string;\n  playerId: string;\n  recordDate: string;\n  recordType: string;\n  description?: string;\n  fitnessLevel?: string;\n  injuryHistory?: any[];\n  clearanceStatus?: string;\n  expiryDate?: string;\n}\n\nexport interface PlayerMetrics {\n  id: string;\n  playerId: string;\n  season: string;\n  currentSeasonMinutes: number;\n  totalCareerMinutes: number;\n  gamesPlayed: number;\n  goals: number;\n  assists: number;\n  yellowCards: number;\n  redCards: number;\n  passAccuracy?: number;\n  tacklesWon: number;\n  aerialDuelsWon: number;\n  distanceCovered?: number;\n  sprintSpeed?: number;\n  clubLeaguePosition?: number;\n}\n\nexport interface Video {\n  id: string;\n  playerId: string;\n  title: string;\n  source: \"manual\" | \"wyscout\" | \"transfermarkt\" | \"veo\";\n  uploadDate: string;\n  duration: string;\n  fileUrl?: string;\n  thumbnailUrl?: string;\n  matchDate?: string;\n  competition?: string;\n  opponent?: string;\n  minutesPlayed?: number;\n  processed: boolean;\n}\n\nexport interface VideoInsights {\n  id: string;\n  videoId: string;\n  playerId: string;\n  minutesPlayed: number;\n  distanceCovered?: number;\n  sprintCount: number;\n  passesAttempted: number;\n  passesCompleted: number;\n  shotsOnTarget: number;\n  tackles: number;\n  interceptions: number;\n  duelsWon: number;\n  aiAnalysis?: string;\n}\n\nexport interface TeamSheet {\n  id: string;\n  matchDate: string;\n  homeTeam: string;\n  awayTeam: string;\n  competition: string;\n  players: string[];\n}\n\nexport interface VisaEligibility {\n  visaType: VisaType;\n  visaName: string;\n  score: number;\n  status: VisaStatus;\n  breakdown: EligibilityBreakdown[];\n  leagueBandApplied: LeagueBand;\n  recommendation: string;\n}\n\nexport interface EligibilityBreakdown {\n  criteria: string;\n  points: number;\n  maxPoints: number;\n  description: string;\n}\n\nexport interface VisaRule {\n  id: string;\n  visaType: VisaType;\n  country: string;\n  category: string;\n  ruleName: string;\n  description?: string;\n  minPoints?: number;\n  maxPoints?: number;\n  criteria: any;\n  leagueBandMultipliers: LeagueBandMultipliers;\n  active: boolean;\n}\n\nexport interface LeagueBandMultipliers {\n  band1: number;\n  band2: number;\n  band3: number;\n  band4: number;\n  band5: number;\n}\n\nexport interface ConsularSummary {\n  id: string;\n  playerId: string;\n  generatedAt: string;\n  generatedBy: string;\n  dataRangeStart: string;\n  dataRangeEnd: string;\n  eligibilityScore: number;\n  status: \"draft\" | \"submitted\" | \"verified\" | \"rejected\";\n  embassyNotified: boolean;\n}\n\nexport interface ComplianceOrder {\n  id: string;\n  playerId: string;\n  teamId: string;\n  requestedBy: string;\n  visaType: VisaType;\n  targetCountry?: string;\n  status: \"pending_payment\" | \"paid\" | \"processing\" | \"completed\" | \"failed\";\n  amount: number;\n  currency: string;\n  stripePaymentIntentId?: string;\n  paidAt?: string;\n  createdAt: string;\n}\n\nexport interface ComplianceDocument {\n  id: string;\n  orderId: string;\n  playerId: string;\n  documentType: string;\n  generatedAt: string;\n  generatedBy?: string;\n  dataRangeStart?: string;\n  dataRangeEnd?: string;\n  fileUrl?: string;\n  aiSummary?: string;\n  playerProfile: PlayerProfile;\n  physicalData: PhysicalData;\n  performanceStats: PerformanceStats;\n  eligibilityData: VisaEligibility[];\n  status: \"draft\" | \"generating\" | \"completed\" | \"failed\";\n}\n\nexport interface PlayerProfile {\n  fullName: string;\n  nationality: string;\n  dateOfBirth: string;\n  position: string;\n  currentClub: string;\n  currentLeague: string;\n  leagueBand: LeagueBand;\n  leaguePosition: number;\n  contractEndDate?: string;\n  marketValue?: number;\n}\n\nexport interface PerformanceStats {\n  totalMinutesPlayed: number;\n  currentSeasonMinutes: number;\n  gamesPlayed: number;\n  goals: number;\n  assists: number;\n  nationalTeamCaps: number;\n  internationalCaps: number;\n  continentalGames: number;\n  clubLeaguePosition: number;\n}\n\nexport interface EmbassyVerification {\n  id: string;\n  documentId: string;\n  playerId: string;\n  playerName: string;\n  clubName: string;\n  submittedAt: string;\n  status: \"pending\" | \"under_review\" | \"approved\" | \"rejected\";\n  visaType: VisaType;\n  targetCountry: string;\n  verificationCode?: string;\n  verifiedAt?: string;\n  notes?: string;\n}\n\nexport interface ScoutingInquiry {\n  id: string;\n  playerId: string;\n  buyingClub: string;\n  sellingClub: string;\n  status: \"inquiry\" | \"negotiation\" | \"due_diligence\" | \"closed\";\n  complianceScore: number;\n  createdAt: string;\n  lastMessage?: string;\n}\n\nexport interface DashboardStats {\n  totalPlayers: number;\n  greenStatus: number;\n  yellowStatus: number;\n  redStatus: number;\n  pendingVerifications: number;\n  activeInquiries: number;\n  reportsGenerated: number;\n}\n\nexport interface Team {\n  id: string;\n  name: string;\n  clubName?: string;\n  country?: string;\n  leagueBand: LeagueBand;\n  createdAt: string;\n}\n\nexport interface Club {\n  id: string;\n  name: string;\n  country: string;\n  league: string;\n  leagueBand: LeagueBand;\n  leaguePosition?: number;\n  continentalCompetition?: string;\n  fifaRanking?: number;\n}\n\nexport interface Payment {\n  id: string;\n  orderId: string;\n  stripePaymentIntentId?: string;\n  stripeCustomerId?: string;\n  amount: number;\n  currency: string;\n  status: \"pending\" | \"processing\" | \"succeeded\" | \"failed\" | \"refunded\";\n  createdAt: string;\n  completedAt?: string;\n}\n\nexport const VISA_TYPES: { type: VisaType; name: string; country: string }[] = [\n  { type: \"schengen_sports\", name: \"Schengen Sports Visa\", country: \"EU\" },\n  { type: \"uk_gbe\", name: \"UK GBE Points System\", country: \"UK\" },\n  { type: \"us_p1\", name: \"US P-1 Athlete Visa\", country: \"USA\" },\n  { type: \"us_o1\", name: \"US O-1 Extraordinary Ability\", country: \"USA\" },\n  { type: \"fifa_transfer\", name: \"FIFA Transfer Rules\", country: \"Global\" },\n  { type: \"middle_east\", name: \"Middle East Sports Visa\", country: \"UAE/Saudi\" },\n  { type: \"asia_sports\", name: \"Asia Sports Visa\", country: \"Asia\" },\n];\n\nexport const LEAGUE_BANDS: { band: LeagueBand; description: string; examples: string }[] = [\n  { band: 1, description: \"Top 5 European Leagues\", examples: \"EPL, La Liga, Bundesliga, Serie A, Ligue 1\" },\n  { band: 2, description: \"Strong European Leagues\", examples: \"Eredivisie, Portuguese Liga, Belgian Pro League\" },\n  { band: 3, description: \"Mid-tier European & Top Other\", examples: \"Scottish Prem, Turkish Super Lig, MLS\" },\n  { band: 4, description: \"Developing Leagues\", examples: \"Championship, Liga MX, A-League\" },\n  { band: 5, description: \"Emerging Markets\", examples: \"African Leagues, Asian Leagues, Lower divisions\" },\n];\n\nexport const COMPLIANCE_DOCUMENT_PRICE = 49.99;\n","path":null,"size_bytes":8271,"size_tokens":null},"client/src/components/ui/toaster.tsx":{"content":"import { useToast } from \"@/hooks/use-toast\"\nimport {\n  Toast,\n  ToastClose,\n  ToastDescription,\n  ToastProvider,\n  ToastTitle,\n  ToastViewport,\n} from \"@/components/ui/toast\"\n\nexport function Toaster() {\n  const { toasts } = useToast()\n\n  return (\n    <ToastProvider>\n      {toasts.map(function ({ id, title, description, action, ...props }) {\n        return (\n          <Toast key={id} {...props}>\n            <div className=\"grid gap-1\">\n              {title && <ToastTitle>{title}</ToastTitle>}\n              {description && (\n                <ToastDescription>{description}</ToastDescription>\n              )}\n            </div>\n            {action}\n            <ToastClose />\n          </Toast>\n        )\n      })}\n      <ToastViewport />\n    </ToastProvider>\n  )\n}\n","path":null,"size_bytes":772,"size_tokens":null},"client/src/components/ui/toggle-group.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as ToggleGroupPrimitive from \"@radix-ui/react-toggle-group\"\nimport { type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\nimport { toggleVariants } from \"@/components/ui/toggle\"\n\nconst ToggleGroupContext = React.createContext<\n  VariantProps<typeof toggleVariants>\n>({\n  size: \"default\",\n  variant: \"default\",\n})\n\nconst ToggleGroup = React.forwardRef<\n  React.ElementRef<typeof ToggleGroupPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ToggleGroupPrimitive.Root> &\n    VariantProps<typeof toggleVariants>\n>(({ className, variant, size, children, ...props }, ref) => (\n  <ToggleGroupPrimitive.Root\n    ref={ref}\n    className={cn(\"flex items-center justify-center gap-1\", className)}\n    {...props}\n  >\n    <ToggleGroupContext.Provider value={{ variant, size }}>\n      {children}\n    </ToggleGroupContext.Provider>\n  </ToggleGroupPrimitive.Root>\n))\n\nToggleGroup.displayName = ToggleGroupPrimitive.Root.displayName\n\nconst ToggleGroupItem = React.forwardRef<\n  React.ElementRef<typeof ToggleGroupPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof ToggleGroupPrimitive.Item> &\n    VariantProps<typeof toggleVariants>\n>(({ className, children, variant, size, ...props }, ref) => {\n  const context = React.useContext(ToggleGroupContext)\n\n  return (\n    <ToggleGroupPrimitive.Item\n      ref={ref}\n      className={cn(\n        toggleVariants({\n          variant: context.variant || variant,\n          size: context.size || size,\n        }),\n        className\n      )}\n      {...props}\n    >\n      {children}\n    </ToggleGroupPrimitive.Item>\n  )\n})\n\nToggleGroupItem.displayName = ToggleGroupPrimitive.Item.displayName\n\nexport { ToggleGroup, ToggleGroupItem }\n","path":null,"size_bytes":1753,"size_tokens":null},"client/src/lib/mock-data.ts":{"content":"import type { Player, Video, ConsularSummary, EmbassyVerification, ScoutingInquiry, DashboardStats, TeamSheet, LeagueBand, VisaEligibility, VisaType } from \"./types\";\n\nexport const mockPlayers: Player[] = [\n  {\n    id: \"1\",\n    firstName: \"Emmanuel\",\n    lastName: \"Okonkwo\",\n    nationality: \"Nigeria\",\n    dateOfBirth: \"1998-03-15\",\n    position: \"Striker\",\n    currentClub: \"Enyimba FC\",\n    currentLeague: \"Nigerian Professional League\",\n    leagueBand: 5 as LeagueBand,\n    leaguePosition: 3,\n    nationalTeamCaps: 12,\n    nationalTeamDebut: \"2021-06-15\",\n    internationalCaps: 12,\n    continentalGames: 8,\n    currentSeasonMinutes: 1850,\n    totalCareerMinutes: 8500,\n    height: 183,\n    weight: 78,\n    preferredFoot: \"Right\",\n    medicalDataAvailable: true,\n    gpsDataAvailable: true,\n    schengenScore: 78,\n    ukGbeScore: 72,\n    usP1Score: 65,\n    usO1Score: 58,\n    middleEastScore: 85,\n    asiaScore: 80,\n    fifaTransferScore: 90,\n    overallEligibilityScore: 68,\n    lastUpdated: \"2024-12-10\",\n  },\n  {\n    id: \"2\",\n    firstName: \"Kwame\",\n    lastName: \"Mensah\",\n    nationality: \"Ghana\",\n    dateOfBirth: \"2000-07-22\",\n    position: \"Midfielder\",\n    currentClub: \"Accra Hearts of Oak\",\n    currentLeague: \"Ghana Premier League\",\n    leagueBand: 5 as LeagueBand,\n    leaguePosition: 2,\n    nationalTeamCaps: 5,\n    nationalTeamDebut: \"2023-01-10\",\n    internationalCaps: 5,\n    continentalGames: 4,\n    currentSeasonMinutes: 920,\n    totalCareerMinutes: 4200,\n    medicalDataAvailable: true,\n    gpsDataAvailable: false,\n    schengenScore: 45,\n    ukGbeScore: 42,\n    usP1Score: 38,\n    usO1Score: 32,\n    middleEastScore: 55,\n    asiaScore: 52,\n    fifaTransferScore: 75,\n    overallEligibilityScore: 39,\n    lastUpdated: \"2024-12-08\",\n  },\n  {\n    id: \"3\",\n    firstName: \"Ahmed\",\n    lastName: \"El-Sayed\",\n    nationality: \"Egypt\",\n    dateOfBirth: \"1996-11-03\",\n    position: \"Defender\",\n    currentClub: \"Al Ahly SC\",\n    currentLeague: \"Egyptian Premier League\",\n    leagueBand: 4 as LeagueBand,\n    leaguePosition: 1,\n    nationalTeamCaps: 28,\n    nationalTeamDebut: \"2019-03-20\",\n    internationalCaps: 28,\n    continentalGames: 22,\n    currentSeasonMinutes: 2340,\n    totalCareerMinutes: 15800,\n    height: 186,\n    weight: 82,\n    preferredFoot: \"Left\",\n    medicalDataAvailable: true,\n    gpsDataAvailable: true,\n    schengenScore: 92,\n    ukGbeScore: 88,\n    usP1Score: 82,\n    usO1Score: 78,\n    middleEastScore: 95,\n    asiaScore: 90,\n    fifaTransferScore: 95,\n    overallEligibilityScore: 85,\n    lastUpdated: \"2024-12-12\",\n  },\n  {\n    id: \"4\",\n    firstName: \"Carlos\",\n    lastName: \"Ramirez\",\n    nationality: \"Colombia\",\n    dateOfBirth: \"2001-05-18\",\n    position: \"Winger\",\n    currentClub: \"Atletico Nacional\",\n    currentLeague: \"Colombian Primera A\",\n    leagueBand: 4 as LeagueBand,\n    leaguePosition: 5,\n    nationalTeamCaps: 2,\n    internationalCaps: 2,\n    continentalGames: 6,\n    currentSeasonMinutes: 650,\n    totalCareerMinutes: 2100,\n    medicalDataAvailable: false,\n    gpsDataAvailable: false,\n    schengenScore: 28,\n    ukGbeScore: 25,\n    usP1Score: 22,\n    usO1Score: 18,\n    middleEastScore: 35,\n    asiaScore: 32,\n    fifaTransferScore: 60,\n    overallEligibilityScore: 23,\n    lastUpdated: \"2024-12-05\",\n  },\n];\n\nexport const mockVideos: Video[] = [\n  {\n    id: \"v1\",\n    playerId: \"1\",\n    title: \"NPFL Week 15 - Full Match Highlights\",\n    source: \"manual\",\n    uploadDate: \"2024-12-08\",\n    duration: \"12:45\",\n    matchDate: \"2024-12-07\",\n    competition: \"NPFL\",\n    opponent: \"Kano Pillars\",\n    minutesPlayed: 90,\n    processed: true,\n  },\n  {\n    id: \"v2\",\n    playerId: \"1\",\n    title: \"CAF Champions League Group Stage\",\n    source: \"wyscout\",\n    uploadDate: \"2024-11-20\",\n    duration: \"90:00\",\n    matchDate: \"2024-11-19\",\n    competition: \"CAF Champions League\",\n    opponent: \"Al Ahly SC\",\n    minutesPlayed: 85,\n    processed: true,\n  },\n  {\n    id: \"v3\",\n    playerId: \"3\",\n    title: \"Egyptian Super Cup Final\",\n    source: \"veo\",\n    uploadDate: \"2024-10-15\",\n    duration: \"95:30\",\n    matchDate: \"2024-10-14\",\n    competition: \"Egyptian Super Cup\",\n    opponent: \"Zamalek SC\",\n    minutesPlayed: 90,\n    processed: true,\n  },\n];\n\nexport const mockTeamSheets: TeamSheet[] = [\n  {\n    id: \"ts1\",\n    matchDate: \"2024-12-07\",\n    homeTeam: \"Enyimba FC\",\n    awayTeam: \"Kano Pillars\",\n    competition: \"NPFL\",\n    players: [\"1\"],\n  },\n  {\n    id: \"ts2\",\n    matchDate: \"2024-10-14\",\n    homeTeam: \"Al Ahly SC\",\n    awayTeam: \"Zamalek SC\",\n    competition: \"Egyptian Super Cup\",\n    players: [\"3\"],\n  },\n];\n\nexport const mockConsularSummaries: ConsularSummary[] = [\n  {\n    id: \"cs1\",\n    playerId: \"1\",\n    generatedAt: \"2024-12-10T14:30:00Z\",\n    generatedBy: \"John Smith\",\n    dataRangeStart: \"2024-06-01\",\n    dataRangeEnd: \"2024-12-10\",\n    eligibilityScore: 68,\n    status: \"submitted\",\n    embassyNotified: true,\n  },\n  {\n    id: \"cs2\",\n    playerId: \"3\",\n    generatedAt: \"2024-12-12T09:15:00Z\",\n    generatedBy: \"Maria Garcia\",\n    dataRangeStart: \"2024-06-01\",\n    dataRangeEnd: \"2024-12-12\",\n    eligibilityScore: 85,\n    status: \"verified\",\n    embassyNotified: true,\n  },\n];\n\nexport const mockEmbassyVerifications: EmbassyVerification[] = [\n  {\n    id: \"ev1\",\n    documentId: \"cs1\",\n    playerId: \"1\",\n    playerName: \"Emmanuel Okonkwo\",\n    clubName: \"Enyimba FC\",\n    submittedAt: \"2024-12-10T14:35:00Z\",\n    status: \"under_review\",\n    visaType: \"schengen_sports\" as VisaType,\n    targetCountry: \"Germany\",\n    verificationCode: \"SR-2024-001\",\n  },\n  {\n    id: \"ev2\",\n    documentId: \"cs2\",\n    playerId: \"3\",\n    playerName: \"Ahmed El-Sayed\",\n    clubName: \"Al Ahly SC\",\n    submittedAt: \"2024-12-12T09:20:00Z\",\n    status: \"approved\",\n    visaType: \"uk_gbe\" as VisaType,\n    targetCountry: \"United Kingdom\",\n    verificationCode: \"SR-2024-002\",\n    verifiedAt: \"2024-12-14T10:00:00Z\",\n  },\n];\n\nexport const mockScoutingInquiries: ScoutingInquiry[] = [\n  {\n    id: \"si1\",\n    playerId: \"1\",\n    buyingClub: \"VfL Wolfsburg\",\n    sellingClub: \"Enyimba FC\",\n    status: \"due_diligence\",\n    complianceScore: 68,\n    createdAt: \"2024-12-01\",\n    lastMessage: \"Requesting additional medical documentation\",\n  },\n  {\n    id: \"si2\",\n    playerId: \"3\",\n    buyingClub: \"Leicester City FC\",\n    sellingClub: \"Al Ahly SC\",\n    status: \"negotiation\",\n    complianceScore: 85,\n    createdAt: \"2024-11-28\",\n    lastMessage: \"Terms sheet under review\",\n  },\n];\n\nexport const mockDashboardStats: DashboardStats = {\n  totalPlayers: 48,\n  greenStatus: 18,\n  yellowStatus: 20,\n  redStatus: 10,\n  pendingVerifications: 5,\n  activeInquiries: 12,\n  reportsGenerated: 34,\n};\n\nexport const mockVisaEligibilities: Record<string, VisaEligibility[]> = {\n  \"1\": [\n    {\n      visaType: \"schengen_sports\" as VisaType,\n      visaName: \"Schengen Sports Visa\",\n      score: 78,\n      status: \"green\",\n      breakdown: [\n        { criteria: \"Professional Contract\", points: 20, maxPoints: 20, description: \"Valid professional contract\" },\n        { criteria: \"Match Minutes\", points: 18, maxPoints: 20, description: \"1850 minutes this season\" },\n        { criteria: \"National Team Caps\", points: 12, maxPoints: 15, description: \"12 international caps\" },\n        { criteria: \"Continental Experience\", points: 10, maxPoints: 15, description: \"8 CAF competition games\" },\n        { criteria: \"Club Standing\", points: 10, maxPoints: 15, description: \"Club in 3rd position\" },\n        { criteria: \"Age Factor\", points: 8, maxPoints: 15, description: \"Prime age (26)\" },\n      ],\n      leagueBandApplied: 5 as LeagueBand,\n      recommendation: \"Strong candidate for Schengen sports visa approval.\"\n    },\n    {\n      visaType: \"uk_gbe\" as VisaType,\n      visaName: \"UK GBE Points System\",\n      score: 72,\n      status: \"green\",\n      breakdown: [\n        { criteria: \"International Appearances\", points: 12, maxPoints: 15, description: \"12 senior caps\" },\n        { criteria: \"Continental Club Competition\", points: 8, maxPoints: 15, description: \"CAF Champions League\" },\n        { criteria: \"Domestic League Quality\", points: 6, maxPoints: 15, description: \"Band 5 - Nigeria\" },\n        { criteria: \"Club Domestic Position\", points: 12, maxPoints: 15, description: \"Club finished 3rd\" },\n        { criteria: \"Individual Performance\", points: 18, maxPoints: 20, description: \"Strong goal contribution\" },\n        { criteria: \"Transfer Value\", points: 16, maxPoints: 20, description: \"Market value consideration\" },\n      ],\n      leagueBandApplied: 5 as LeagueBand,\n      recommendation: \"Meets GBE threshold. Apply with supporting documentation.\"\n    },\n    {\n      visaType: \"fifa_transfer\" as VisaType,\n      visaName: \"FIFA Transfer Rules\",\n      score: 90,\n      status: \"green\",\n      breakdown: [\n        { criteria: \"Player Registration\", points: 25, maxPoints: 25, description: \"Registered with NFF\" },\n        { criteria: \"Contract Status\", points: 20, maxPoints: 20, description: \"Valid contract\" },\n        { criteria: \"Training Compensation\", points: 20, maxPoints: 20, description: \"Training clubs documented\" },\n        { criteria: \"Solidarity Mechanism\", points: 15, maxPoints: 15, description: \"Eligible clubs identified\" },\n        { criteria: \"ITC Eligibility\", points: 10, maxPoints: 10, description: \"No disputes\" },\n        { criteria: \"Protection Period\", points: 0, maxPoints: 10, description: \"Compensation required\" },\n      ],\n      leagueBandApplied: 5 as LeagueBand,\n      recommendation: \"FIFA compliant - ready for international transfer.\"\n    },\n    {\n      visaType: \"middle_east\" as VisaType,\n      visaName: \"Middle East Sports Visa\",\n      score: 85,\n      status: \"green\",\n      breakdown: [\n        { criteria: \"Professional Status\", points: 25, maxPoints: 25, description: \"Active professional\" },\n        { criteria: \"Club Contract\", points: 20, maxPoints: 20, description: \"Valid employment\" },\n        { criteria: \"Medical Clearance\", points: 15, maxPoints: 15, description: \"Medical data available\" },\n        { criteria: \"Age Eligibility\", points: 15, maxPoints: 15, description: \"Within range\" },\n        { criteria: \"Background Check\", points: 10, maxPoints: 15, description: \"Standard processing\" },\n        { criteria: \"Skills Assessment\", points: 0, maxPoints: 10, description: \"Pending\" },\n      ],\n      leagueBandApplied: 5 as LeagueBand,\n      recommendation: \"Excellent candidate for UAE/Saudi leagues.\"\n    },\n  ],\n  \"3\": [\n    {\n      visaType: \"schengen_sports\" as VisaType,\n      visaName: \"Schengen Sports Visa\",\n      score: 92,\n      status: \"green\",\n      breakdown: [\n        { criteria: \"Professional Contract\", points: 20, maxPoints: 20, description: \"Valid professional contract\" },\n        { criteria: \"Match Minutes\", points: 20, maxPoints: 20, description: \"2340 minutes this season\" },\n        { criteria: \"National Team Caps\", points: 15, maxPoints: 15, description: \"28 international caps\" },\n        { criteria: \"Continental Experience\", points: 15, maxPoints: 15, description: \"22 CAF competition games\" },\n        { criteria: \"Club Standing\", points: 15, maxPoints: 15, description: \"Club in 1st position\" },\n        { criteria: \"Age Factor\", points: 7, maxPoints: 15, description: \"Experienced (28)\" },\n      ],\n      leagueBandApplied: 4 as LeagueBand,\n      recommendation: \"Excellent candidate - priority processing recommended.\"\n    },\n    {\n      visaType: \"uk_gbe\" as VisaType,\n      visaName: \"UK GBE Points System\",\n      score: 88,\n      status: \"green\",\n      breakdown: [\n        { criteria: \"International Appearances\", points: 15, maxPoints: 15, description: \"28 senior caps\" },\n        { criteria: \"Continental Club Competition\", points: 15, maxPoints: 15, description: \"CAF Champions League winner\" },\n        { criteria: \"Domestic League Quality\", points: 8, maxPoints: 15, description: \"Band 4 - Egypt\" },\n        { criteria: \"Club Domestic Position\", points: 15, maxPoints: 15, description: \"League champions\" },\n        { criteria: \"Individual Performance\", points: 18, maxPoints: 20, description: \"Strong defensive stats\" },\n        { criteria: \"Transfer Value\", points: 17, maxPoints: 20, description: \"High market value\" },\n      ],\n      leagueBandApplied: 4 as LeagueBand,\n      recommendation: \"Automatic GBE approval expected.\"\n    },\n  ],\n};\n","path":null,"size_bytes":12305,"size_tokens":null},"client/src/pages/not-found.tsx":{"content":"import { Card, CardContent } from \"@/components/ui/card\";\nimport { AlertCircle } from \"lucide-react\";\n\nexport default function NotFound() {\n  return (\n    <div className=\"min-h-screen w-full flex items-center justify-center bg-gray-50\">\n      <Card className=\"w-full max-w-md mx-4\">\n        <CardContent className=\"pt-6\">\n          <div className=\"flex mb-4 gap-2\">\n            <AlertCircle className=\"h-8 w-8 text-red-500\" />\n            <h1 className=\"text-2xl font-bold text-gray-900\">404 Page Not Found</h1>\n          </div>\n\n          <p className=\"mt-4 text-sm text-gray-600\">\n            Did you forget to add the page to the router?\n          </p>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","path":null,"size_bytes":711,"size_tokens":null},"client/src/components/examples/StatusBadge.tsx":{"content":"import StatusBadge from \"../StatusBadge\";\n\nexport default function StatusBadgeExample() {\n  return (\n    <div className=\"flex flex-wrap gap-4\">\n      <StatusBadge score={85} />\n      <StatusBadge score={45} />\n      <StatusBadge score={20} />\n      <StatusBadge score={60} size=\"sm\" />\n    </div>\n  );\n}\n","path":null,"size_bytes":304,"size_tokens":null},"client/src/components/ScoutingInquiryCard.tsx":{"content":"import { Card, CardContent, CardHeader } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Button } from \"@/components/ui/button\";\nimport StatusBadge from \"./StatusBadge\";\nimport { MessageSquare, ArrowRight, ClipboardCheck } from \"lucide-react\";\nimport type { ScoutingInquiry } from \"@/lib/types\";\n\ninterface ScoutingInquiryCardProps {\n  inquiry: ScoutingInquiry;\n  playerName: string;\n  onViewDetails?: (id: string) => void;\n  onMessage?: (id: string) => void;\n}\n\nexport default function ScoutingInquiryCard({ \n  inquiry, \n  playerName, \n  onViewDetails, \n  onMessage \n}: ScoutingInquiryCardProps) {\n  const getStatusConfig = (status: ScoutingInquiry[\"status\"]) => {\n    const config = {\n      inquiry: { label: \"Inquiry\", className: \"bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-400\" },\n      negotiation: { label: \"Negotiation\", className: \"bg-purple-100 text-purple-800 dark:bg-purple-900/30 dark:text-purple-400\" },\n      due_diligence: { label: \"Due Diligence\", className: \"bg-orange-100 text-orange-800 dark:bg-orange-900/30 dark:text-orange-400\" },\n      closed: { label: \"Closed\", className: \"bg-gray-100 text-gray-800 dark:bg-gray-900/30 dark:text-gray-400\" },\n    };\n    return config[status];\n  };\n\n  const statusConfig = getStatusConfig(inquiry.status);\n\n  return (\n    <Card className=\"hover-elevate\" data-testid={`card-inquiry-${inquiry.id}`}>\n      <CardHeader className=\"pb-2\">\n        <div className=\"flex items-start justify-between gap-4\">\n          <div>\n            <h3 className=\"font-semibold\">{playerName}</h3>\n            <div className=\"flex items-center gap-2 text-sm text-muted-foreground mt-1\">\n              <span>{inquiry.sellingClub}</span>\n              <ArrowRight className=\"h-3 w-3\" />\n              <span>{inquiry.buyingClub}</span>\n            </div>\n          </div>\n          <Badge variant=\"secondary\" className={statusConfig.className}>\n            {statusConfig.label}\n          </Badge>\n        </div>\n      </CardHeader>\n      <CardContent className=\"space-y-4\">\n        <div className=\"flex items-center justify-between gap-4\">\n          <div>\n            <p className=\"text-xs text-muted-foreground uppercase tracking-wide\">Compliance Score</p>\n            <StatusBadge score={inquiry.complianceScore} size=\"sm\" />\n          </div>\n          <div className=\"text-right\">\n            <p className=\"text-xs text-muted-foreground uppercase tracking-wide\">Created</p>\n            <p className=\"text-sm\">{new Date(inquiry.createdAt).toLocaleDateString()}</p>\n          </div>\n        </div>\n\n        {inquiry.lastMessage && (\n          <div className=\"p-3 bg-muted rounded-md\">\n            <p className=\"text-xs text-muted-foreground mb-1\">Latest Message</p>\n            <p className=\"text-sm truncate\">{inquiry.lastMessage}</p>\n          </div>\n        )}\n\n        <div className=\"flex gap-2\">\n          <Button \n            variant=\"outline\" \n            size=\"sm\" \n            className=\"flex-1\"\n            onClick={() => onViewDetails?.(inquiry.id)}\n            data-testid={`button-view-inquiry-${inquiry.id}`}\n          >\n            <ClipboardCheck className=\"h-4 w-4 mr-1\" />\n            Details\n          </Button>\n          <Button \n            size=\"sm\" \n            className=\"flex-1\"\n            onClick={() => onMessage?.(inquiry.id)}\n            data-testid={`button-message-inquiry-${inquiry.id}`}\n          >\n            <MessageSquare className=\"h-4 w-4 mr-1\" />\n            Message\n          </Button>\n        </div>\n      </CardContent>\n    </Card>\n  );\n}\n","path":null,"size_bytes":3571,"size_tokens":null},"client/src/components/ui/table.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Table = React.forwardRef<\n  HTMLTableElement,\n  React.HTMLAttributes<HTMLTableElement>\n>(({ className, ...props }, ref) => (\n  <div className=\"relative w-full overflow-auto\">\n    <table\n      ref={ref}\n      className={cn(\"w-full caption-bottom text-sm\", className)}\n      {...props}\n    />\n  </div>\n))\nTable.displayName = \"Table\"\n\nconst TableHeader = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <thead ref={ref} className={cn(\"[&_tr]:border-b\", className)} {...props} />\n))\nTableHeader.displayName = \"TableHeader\"\n\nconst TableBody = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <tbody\n    ref={ref}\n    className={cn(\"[&_tr:last-child]:border-0\", className)}\n    {...props}\n  />\n))\nTableBody.displayName = \"TableBody\"\n\nconst TableFooter = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <tfoot\n    ref={ref}\n    className={cn(\n      \"border-t bg-muted/50 font-medium [&>tr]:last:border-b-0\",\n      className\n    )}\n    {...props}\n  />\n))\nTableFooter.displayName = \"TableFooter\"\n\nconst TableRow = React.forwardRef<\n  HTMLTableRowElement,\n  React.HTMLAttributes<HTMLTableRowElement>\n>(({ className, ...props }, ref) => (\n  <tr\n    ref={ref}\n    className={cn(\n      \"border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted\",\n      className\n    )}\n    {...props}\n  />\n))\nTableRow.displayName = \"TableRow\"\n\nconst TableHead = React.forwardRef<\n  HTMLTableCellElement,\n  React.ThHTMLAttributes<HTMLTableCellElement>\n>(({ className, ...props }, ref) => (\n  <th\n    ref={ref}\n    className={cn(\n      \"h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0\",\n      className\n    )}\n    {...props}\n  />\n))\nTableHead.displayName = \"TableHead\"\n\nconst TableCell = React.forwardRef<\n  HTMLTableCellElement,\n  React.TdHTMLAttributes<HTMLTableCellElement>\n>(({ className, ...props }, ref) => (\n  <td\n    ref={ref}\n    className={cn(\"p-4 align-middle [&:has([role=checkbox])]:pr-0\", className)}\n    {...props}\n  />\n))\nTableCell.displayName = \"TableCell\"\n\nconst TableCaption = React.forwardRef<\n  HTMLTableCaptionElement,\n  React.HTMLAttributes<HTMLTableCaptionElement>\n>(({ className, ...props }, ref) => (\n  <caption\n    ref={ref}\n    className={cn(\"mt-4 text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nTableCaption.displayName = \"TableCaption\"\n\nexport {\n  Table,\n  TableHeader,\n  TableBody,\n  TableFooter,\n  TableHead,\n  TableRow,\n  TableCell,\n  TableCaption,\n}\n","path":null,"size_bytes":2765,"size_tokens":null},"client/src/components/ui/sheet.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as SheetPrimitive from \"@radix-ui/react-dialog\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Sheet = SheetPrimitive.Root\n\nconst SheetTrigger = SheetPrimitive.Trigger\n\nconst SheetClose = SheetPrimitive.Close\n\nconst SheetPortal = SheetPrimitive.Portal\n\nconst SheetOverlay = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Overlay\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  />\n))\nSheetOverlay.displayName = SheetPrimitive.Overlay.displayName\n\nconst sheetVariants = cva(\n  \"fixed z-50 gap-4 bg-background p-6 shadow-lg transition ease-in-out data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:duration-300 data-[state=open]:duration-500\",\n  {\n    variants: {\n      side: {\n        top: \"inset-x-0 top-0 border-b data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top\",\n        bottom:\n          \"inset-x-0 bottom-0 border-t data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom\",\n        left: \"inset-y-0 left-0 h-full w-3/4 border-r data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left sm:max-w-sm\",\n        right:\n          \"inset-y-0 right-0 h-full w-3/4  border-l data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:max-w-sm\",\n      },\n    },\n    defaultVariants: {\n      side: \"right\",\n    },\n  }\n)\n\ninterface SheetContentProps\n  extends React.ComponentPropsWithoutRef<typeof SheetPrimitive.Content>,\n    VariantProps<typeof sheetVariants> {}\n\nconst SheetContent = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Content>,\n  SheetContentProps\n>(({ side = \"right\", className, children, ...props }, ref) => (\n  <SheetPortal>\n    <SheetOverlay />\n    <SheetPrimitive.Content\n      ref={ref}\n      className={cn(sheetVariants({ side }), className)}\n      {...props}\n    >\n      {children}\n      <SheetPrimitive.Close className=\"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-secondary\">\n        <X className=\"h-4 w-4\" />\n        <span className=\"sr-only\">Close</span>\n      </SheetPrimitive.Close>\n    </SheetPrimitive.Content>\n  </SheetPortal>\n))\nSheetContent.displayName = SheetPrimitive.Content.displayName\n\nconst SheetHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-2 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nSheetHeader.displayName = \"SheetHeader\"\n\nconst SheetFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nSheetFooter.displayName = \"SheetFooter\"\n\nconst SheetTitle = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Title\n    ref={ref}\n    className={cn(\"text-lg font-semibold text-foreground\", className)}\n    {...props}\n  />\n))\nSheetTitle.displayName = SheetPrimitive.Title.displayName\n\nconst SheetDescription = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nSheetDescription.displayName = SheetPrimitive.Description.displayName\n\nexport {\n  Sheet,\n  SheetPortal,\n  SheetOverlay,\n  SheetTrigger,\n  SheetClose,\n  SheetContent,\n  SheetHeader,\n  SheetFooter,\n  SheetTitle,\n  SheetDescription,\n}\n","path":null,"size_bytes":4281,"size_tokens":null},"server/replit_integrations/auth/replitAuth.ts":{"content":"import * as client from \"openid-client\";\nimport { Strategy, type VerifyFunction } from \"openid-client/passport\";\n\nimport passport from \"passport\";\nimport session from \"express-session\";\nimport type { Express, RequestHandler } from \"express\";\nimport memoize from \"memoizee\";\nimport connectPg from \"connect-pg-simple\";\nimport { authStorage } from \"./storage\";\n\nconst getOidcConfig = memoize(\n  async () => {\n    return await client.discovery(\n      new URL(process.env.ISSUER_URL ?? \"https://replit.com/oidc\"),\n      process.env.REPL_ID!\n    );\n  },\n  { maxAge: 3600 * 1000 }\n);\n\nexport function getSession() {\n  const sessionTtl = 7 * 24 * 60 * 60 * 1000; // 1 week\n  const pgStore = connectPg(session);\n  const sessionStore = new pgStore({\n    conString: process.env.DATABASE_URL,\n    createTableIfMissing: false,\n    ttl: sessionTtl,\n    tableName: \"sessions\",\n  });\n  return session({\n    secret: process.env.SESSION_SECRET!,\n    store: sessionStore,\n    resave: false,\n    saveUninitialized: false,\n    cookie: {\n      httpOnly: true,\n      secure: true,\n      maxAge: sessionTtl,\n    },\n  });\n}\n\nfunction updateUserSession(\n  user: any,\n  tokens: client.TokenEndpointResponse & client.TokenEndpointResponseHelpers\n) {\n  user.claims = tokens.claims();\n  user.access_token = tokens.access_token;\n  user.refresh_token = tokens.refresh_token;\n  user.expires_at = user.claims?.exp;\n}\n\nasync function upsertUser(claims: any) {\n  await authStorage.upsertUser({\n    id: claims[\"sub\"],\n    email: claims[\"email\"],\n    firstName: claims[\"first_name\"],\n    lastName: claims[\"last_name\"],\n    profileImageUrl: claims[\"profile_image_url\"],\n  });\n}\n\nexport async function setupAuth(app: Express) {\n  app.set(\"trust proxy\", 1);\n  app.use(getSession());\n  app.use(passport.initialize());\n  app.use(passport.session());\n\n  const config = await getOidcConfig();\n\n  const verify: VerifyFunction = async (\n    tokens: client.TokenEndpointResponse & client.TokenEndpointResponseHelpers,\n    verified: passport.AuthenticateCallback\n  ) => {\n    const user = {};\n    updateUserSession(user, tokens);\n    await upsertUser(tokens.claims());\n    verified(null, user);\n  };\n\n  // Keep track of registered strategies\n  const registeredStrategies = new Set<string>();\n\n  // Helper function to ensure strategy exists for a domain\n  const ensureStrategy = (domain: string) => {\n    const strategyName = `replitauth:${domain}`;\n    if (!registeredStrategies.has(strategyName)) {\n      const strategy = new Strategy(\n        {\n          name: strategyName,\n          config,\n          scope: \"openid email profile offline_access\",\n          callbackURL: `https://${domain}/api/callback`,\n        },\n        verify\n      );\n      passport.use(strategy);\n      registeredStrategies.add(strategyName);\n    }\n  };\n\n  passport.serializeUser((user: Express.User, cb) => cb(null, user));\n  passport.deserializeUser((user: Express.User, cb) => cb(null, user));\n\n  app.get(\"/api/login\", (req, res, next) => {\n    ensureStrategy(req.hostname);\n    passport.authenticate(`replitauth:${req.hostname}`, {\n      prompt: \"login consent\",\n      scope: [\"openid\", \"email\", \"profile\", \"offline_access\"],\n    })(req, res, next);\n  });\n\n  app.get(\"/api/callback\", (req, res, next) => {\n    ensureStrategy(req.hostname);\n    passport.authenticate(`replitauth:${req.hostname}`, {\n      successReturnToOrRedirect: \"/\",\n      failureRedirect: \"/api/login\",\n    })(req, res, next);\n  });\n\n  app.get(\"/api/logout\", (req, res) => {\n    req.logout(() => {\n      res.redirect(\n        client.buildEndSessionUrl(config, {\n          client_id: process.env.REPL_ID!,\n          post_logout_redirect_uri: `${req.protocol}://${req.hostname}`,\n        }).href\n      );\n    });\n  });\n}\n\nexport const isAuthenticated: RequestHandler = async (req, res, next) => {\n  const user = req.user as any;\n\n  if (!req.isAuthenticated() || !user.expires_at) {\n    return res.status(401).json({ message: \"Unauthorized\" });\n  }\n\n  const now = Math.floor(Date.now() / 1000);\n  if (now <= user.expires_at) {\n    return next();\n  }\n\n  const refreshToken = user.refresh_token;\n  if (!refreshToken) {\n    res.status(401).json({ message: \"Unauthorized\" });\n    return;\n  }\n\n  try {\n    const config = await getOidcConfig();\n    const tokenResponse = await client.refreshTokenGrant(config, refreshToken);\n    updateUserSession(user, tokenResponse);\n    return next();\n  } catch (error) {\n    res.status(401).json({ message: \"Unauthorized\" });\n    return;\n  }\n};\n","path":null,"size_bytes":4474,"size_tokens":null},"client/src/components/ui/aspect-ratio.tsx":{"content":"import * as AspectRatioPrimitive from \"@radix-ui/react-aspect-ratio\"\n\nconst AspectRatio = AspectRatioPrimitive.Root\n\nexport { AspectRatio }\n","path":null,"size_bytes":140,"size_tokens":null},"client/src/components/examples/ThemeToggle.tsx":{"content":"import ThemeToggle from \"../ThemeToggle\";\n\nexport default function ThemeToggleExample() {\n  return <ThemeToggle />;\n}\n","path":null,"size_bytes":118,"size_tokens":null},"client/src/components/examples/ConsularSummaryGenerator.tsx":{"content":"import ConsularSummaryGenerator from \"../ConsularSummaryGenerator\";\n\nexport default function ConsularSummaryGeneratorExample() {\n  return (\n    <div className=\"max-w-lg\">\n      <ConsularSummaryGenerator \n        playerName=\"Emmanuel Okonkwo\"\n        onGenerate={(config) => console.log(\"Generate\", config)}\n        onSubmitToEmbassy={(config) => console.log(\"Submit\", config)}\n      />\n    </div>\n  );\n}\n","path":null,"size_bytes":404,"size_tokens":null},"client/src/components/ui/slider.tsx":{"content":"import * as React from \"react\"\nimport * as SliderPrimitive from \"@radix-ui/react-slider\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Slider = React.forwardRef<\n  React.ElementRef<typeof SliderPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof SliderPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <SliderPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative flex w-full touch-none select-none items-center\",\n      className\n    )}\n    {...props}\n  >\n    <SliderPrimitive.Track className=\"relative h-2 w-full grow overflow-hidden rounded-full bg-secondary\">\n      <SliderPrimitive.Range className=\"absolute h-full bg-primary\" />\n    </SliderPrimitive.Track>\n    <SliderPrimitive.Thumb className=\"block h-5 w-5 rounded-full border-2 border-primary bg-background ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50\" />\n  </SliderPrimitive.Root>\n))\nSlider.displayName = SliderPrimitive.Root.displayName\n\nexport { Slider }\n","path":null,"size_bytes":1077,"size_tokens":null},"client/src/pages/login.tsx":{"content":"import { useState } from \"react\";\nimport { useLocation } from \"wouter\";\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription, CardFooter } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Shield, LogIn, Mail, Lock } from \"lucide-react\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { useMutation } from \"@tanstack/react-query\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\n\ninterface LoginData {\n  username: string;\n  password: string;\n}\n\nexport default function Login() {\n  const [, setLocation] = useLocation();\n  const { toast } = useToast();\n  const [formData, setFormData] = useState<LoginData>({\n    username: \"\",\n    password: \"\",\n  });\n\n  const loginMutation = useMutation({\n    mutationFn: async (data: LoginData) => {\n      const response = await apiRequest(\"POST\", \"/api/auth/login\", data);\n      return response.json();\n    },\n    onSuccess: (data: any) => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/auth/me\"] });\n      toast({\n        title: \"Welcome back\",\n        description: \"You have been signed in successfully.\",\n      });\n      \n      // Redirect based on role\n      const role = data.user?.role;\n      if (role === \"embassy\") {\n        setLocation(\"/embassy\");\n      } else if (role === \"scout\" || role === \"agent\") {\n        setLocation(\"/scout\");\n      } else {\n        setLocation(\"/\");\n      }\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Login failed\",\n        description: error.message || \"Invalid username or password\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const handleSubmit = (e: React.FormEvent) => {\n    e.preventDefault();\n    if (!formData.username || !formData.password) {\n      toast({\n        title: \"Missing fields\",\n        description: \"Please enter your username and password\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n    loginMutation.mutate(formData);\n  };\n\n  return (\n    <div className=\"min-h-screen bg-background flex items-center justify-center p-4\" data-testid=\"page-login\">\n      <Card className=\"w-full max-w-md\">\n        <CardHeader className=\"text-center space-y-4\">\n          <div className=\"mx-auto p-3 bg-primary rounded-md w-fit\">\n            <Shield className=\"h-8 w-8 text-primary-foreground\" />\n          </div>\n          <div>\n            <CardTitle className=\"text-2xl\">Sports Reels</CardTitle>\n            <CardDescription>Player Compliance & Visa Eligibility Platform</CardDescription>\n          </div>\n        </CardHeader>\n        \n        <form onSubmit={handleSubmit}>\n          <CardContent className=\"space-y-4\">\n            <div className=\"text-center text-sm text-muted-foreground mb-4\">\n              <p>Sign in to access your club's player compliance dashboard.</p>\n            </div>\n            \n            <div className=\"space-y-2\">\n              <Label htmlFor=\"username\">Username</Label>\n              <div className=\"relative\">\n                <Mail className=\"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground\" />\n                <Input\n                  id=\"username\"\n                  value={formData.username}\n                  onChange={(e) => setFormData({ ...formData, username: e.target.value })}\n                  placeholder=\"Enter your username\"\n                  className=\"pl-10\"\n                  data-testid=\"input-username\"\n                />\n              </div>\n            </div>\n            \n            <div className=\"space-y-2\">\n              <Label htmlFor=\"password\">Password</Label>\n              <div className=\"relative\">\n                <Lock className=\"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground\" />\n                <Input\n                  id=\"password\"\n                  type=\"password\"\n                  value={formData.password}\n                  onChange={(e) => setFormData({ ...formData, password: e.target.value })}\n                  placeholder=\"Enter your password\"\n                  className=\"pl-10\"\n                  data-testid=\"input-password\"\n                />\n              </div>\n            </div>\n          </CardContent>\n          \n          <CardFooter className=\"flex flex-col gap-4\">\n            <Button\n              type=\"submit\"\n              className=\"w-full\"\n              size=\"lg\"\n              disabled={loginMutation.isPending}\n              data-testid=\"button-login\"\n            >\n              {loginMutation.isPending ? (\n                \"Signing in...\"\n              ) : (\n                <>\n                  <LogIn className=\"h-4 w-4 mr-2\" />\n                  Sign In\n                </>\n              )}\n            </Button>\n            \n            <div className=\"relative w-full\">\n              <div className=\"absolute inset-0 flex items-center\">\n                <span className=\"w-full border-t\" />\n              </div>\n              <div className=\"relative flex justify-center text-xs uppercase\">\n                <span className=\"bg-card px-2 text-muted-foreground\">Or</span>\n              </div>\n            </div>\n            \n            <Button\n              type=\"button\"\n              variant=\"outline\"\n              className=\"w-full\"\n              asChild\n              data-testid=\"button-replit-login\"\n            >\n              <a href=\"/api/login\">\n                Sign in with Replit\n              </a>\n            </Button>\n            \n            <p className=\"text-sm text-center text-muted-foreground\">\n              Don't have an account?{\" \"}\n              <a href=\"/signup\" className=\"text-primary hover:underline\" data-testid=\"link-signup\">\n                Create one\n              </a>\n            </p>\n          </CardFooter>\n        </form>\n      </Card>\n    </div>\n  );\n}\n","path":null,"size_bytes":5863,"size_tokens":null},"client/src/components/ui/menubar.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as MenubarPrimitive from \"@radix-ui/react-menubar\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nfunction MenubarMenu({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Menu>) {\n  return <MenubarPrimitive.Menu {...props} />\n}\n\nfunction MenubarGroup({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Group>) {\n  return <MenubarPrimitive.Group {...props} />\n}\n\nfunction MenubarPortal({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Portal>) {\n  return <MenubarPrimitive.Portal {...props} />\n}\n\nfunction MenubarRadioGroup({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.RadioGroup>) {\n  return <MenubarPrimitive.RadioGroup {...props} />\n}\n\nfunction MenubarSub({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Sub>) {\n  return <MenubarPrimitive.Sub data-slot=\"menubar-sub\" {...props} />\n}\n\nconst Menubar = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"flex h-10 items-center space-x-1 rounded-md border bg-background p-1\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubar.displayName = MenubarPrimitive.Root.displayName\n\nconst MenubarTrigger = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Trigger>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-3 py-1.5 text-sm font-medium outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarTrigger.displayName = MenubarPrimitive.Trigger.displayName\n\nconst MenubarSubTrigger = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <MenubarPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto h-4 w-4\" />\n  </MenubarPrimitive.SubTrigger>\n))\nMenubarSubTrigger.displayName = MenubarPrimitive.SubTrigger.displayName\n\nconst MenubarSubContent = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-menubar-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarSubContent.displayName = MenubarPrimitive.SubContent.displayName\n\nconst MenubarContent = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Content>\n>(\n  (\n    { className, align = \"start\", alignOffset = -4, sideOffset = 8, ...props },\n    ref\n  ) => (\n    <MenubarPrimitive.Portal>\n      <MenubarPrimitive.Content\n        ref={ref}\n        align={align}\n        alignOffset={alignOffset}\n        sideOffset={sideOffset}\n        className={cn(\n          \"z-50 min-w-[12rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-menubar-content-transform-origin]\",\n          className\n        )}\n        {...props}\n      />\n    </MenubarPrimitive.Portal>\n  )\n)\nMenubarContent.displayName = MenubarPrimitive.Content.displayName\n\nconst MenubarItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <MenubarPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarItem.displayName = MenubarPrimitive.Item.displayName\n\nconst MenubarCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <MenubarPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <MenubarPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </MenubarPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </MenubarPrimitive.CheckboxItem>\n))\nMenubarCheckboxItem.displayName = MenubarPrimitive.CheckboxItem.displayName\n\nconst MenubarRadioItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <MenubarPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <MenubarPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </MenubarPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </MenubarPrimitive.RadioItem>\n))\nMenubarRadioItem.displayName = MenubarPrimitive.RadioItem.displayName\n\nconst MenubarLabel = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <MenubarPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarLabel.displayName = MenubarPrimitive.Label.displayName\n\nconst MenubarSeparator = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nMenubarSeparator.displayName = MenubarPrimitive.Separator.displayName\n\nconst MenubarShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nMenubarShortcut.displayname = \"MenubarShortcut\"\n\nexport {\n  Menubar,\n  MenubarMenu,\n  MenubarTrigger,\n  MenubarContent,\n  MenubarItem,\n  MenubarSeparator,\n  MenubarLabel,\n  MenubarCheckboxItem,\n  MenubarRadioGroup,\n  MenubarRadioItem,\n  MenubarPortal,\n  MenubarSubContent,\n  MenubarSubTrigger,\n  MenubarGroup,\n  MenubarSub,\n  MenubarShortcut,\n}\n","path":null,"size_bytes":8605,"size_tokens":null},"client/src/pages/players.tsx":{"content":"import { useState } from \"react\";\nimport { useLocation } from \"wouter\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { useForm } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { z } from \"zod\";\nimport PlayerCard from \"@/components/PlayerCard\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogTrigger, DialogDescription } from \"@/components/ui/dialog\";\nimport { Form, FormControl, FormField, FormItem, FormLabel, FormMessage } from \"@/components/ui/form\";\nimport { Search, Plus, Filter, Grid, List, User } from \"lucide-react\";\nimport { mockPlayers } from \"@/lib/mock-data\";\nimport { getVisaStatus } from \"@/components/StatusBadge\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport type { Player } from \"@/lib/types\";\n\nconst playerFormSchema = z.object({\n  firstName: z.string().min(1, \"First name is required\"),\n  lastName: z.string().min(1, \"Last name is required\"),\n  nationality: z.string().min(1, \"Nationality is required\"),\n  dateOfBirth: z.string().optional(),\n  position: z.string().min(1, \"Position is required\"),\n  currentClubId: z.string().optional(),\n  nationalTeamCaps: z.coerce.number().min(0).default(0),\n  internationalCaps: z.coerce.number().min(0).default(0),\n  continentalGames: z.coerce.number().min(0).default(0),\n  height: z.coerce.number().min(0).optional(),\n  weight: z.coerce.number().min(0).optional(),\n  preferredFoot: z.string().optional(),\n});\n\ntype PlayerFormData = z.infer<typeof playerFormSchema>;\n\nexport default function Players() {\n  const [, setLocation] = useLocation();\n  const [searchQuery, setSearchQuery] = useState(\"\");\n  const [statusFilter, setStatusFilter] = useState(\"all\");\n  const [viewMode, setViewMode] = useState<\"grid\" | \"list\">(\"grid\");\n  const [isDialogOpen, setIsDialogOpen] = useState(false);\n  const { toast } = useToast();\n\n  const { data: apiPlayers, isLoading } = useQuery<any[]>({\n    queryKey: [\"/api/players\"],\n  });\n\n  const form = useForm<PlayerFormData>({\n    resolver: zodResolver(playerFormSchema),\n    defaultValues: {\n      firstName: \"\",\n      lastName: \"\",\n      nationality: \"\",\n      position: \"\",\n      nationalTeamCaps: 0,\n      internationalCaps: 0,\n      continentalGames: 0,\n    },\n  });\n\n  const createPlayerMutation = useMutation({\n    mutationFn: async (data: PlayerFormData) => {\n      return apiRequest(\"POST\", \"/api/players\", data);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/players\"] });\n      setIsDialogOpen(false);\n      form.reset();\n      toast({\n        title: \"Player added\",\n        description: \"The player has been added to your database.\",\n      });\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Error\",\n        description: error.message || \"Failed to add player\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const players = (apiPlayers && apiPlayers.length > 0) \n    ? apiPlayers.map((p: any) => ({\n        id: p.id,\n        firstName: p.firstName,\n        lastName: p.lastName,\n        nationality: p.nationality,\n        dateOfBirth: p.dateOfBirth,\n        position: p.position,\n        currentClub: p.currentClubId || \"Unknown Club\",\n        currentLeague: \"Unknown League\",\n        leagueBand: 5 as const,\n        leaguePosition: 0,\n        nationalTeamCaps: p.nationalTeamCaps || 0,\n        internationalCaps: p.internationalCaps || 0,\n        continentalGames: p.continentalGames || 0,\n        currentSeasonMinutes: 0,\n        totalCareerMinutes: 0,\n        height: p.height,\n        weight: p.weight,\n        preferredFoot: p.preferredFoot,\n        medicalDataAvailable: false,\n        gpsDataAvailable: false,\n        schengenScore: 50,\n        ukGbeScore: 50,\n        usP1Score: 50,\n        usO1Score: 50,\n        middleEastScore: 50,\n        asiaScore: 50,\n        fifaTransferScore: 50,\n        overallEligibilityScore: 50,\n        lastUpdated: p.updatedAt || new Date().toISOString(),\n      }))\n    : mockPlayers;\n\n  const filteredPlayers = players.filter((player: Player) => {\n    const matchesSearch =\n      player.firstName.toLowerCase().includes(searchQuery.toLowerCase()) ||\n      player.lastName.toLowerCase().includes(searchQuery.toLowerCase()) ||\n      player.currentClub.toLowerCase().includes(searchQuery.toLowerCase());\n\n    const status = getVisaStatus(player.overallEligibilityScore);\n    const matchesStatus = statusFilter === \"all\" || status === statusFilter;\n\n    return matchesSearch && matchesStatus;\n  });\n\n  const onSubmit = (data: PlayerFormData) => {\n    createPlayerMutation.mutate(data);\n  };\n\n  return (\n    <div className=\"p-6 space-y-6\" data-testid=\"page-players\">\n      <div className=\"flex flex-wrap items-center justify-between gap-4\">\n        <div>\n          <h1 className=\"text-2xl font-semibold\">Players</h1>\n          <p className=\"text-muted-foreground\">Manage player profiles and compliance data</p>\n        </div>\n        <Dialog open={isDialogOpen} onOpenChange={setIsDialogOpen}>\n          <DialogTrigger asChild>\n            <Button data-testid=\"button-add-player\">\n              <Plus className=\"h-4 w-4 mr-2\" />\n              Add Player\n            </Button>\n          </DialogTrigger>\n          <DialogContent className=\"max-w-lg max-h-[90vh] overflow-y-auto\">\n            <DialogHeader>\n              <DialogTitle className=\"flex items-center gap-2\">\n                <User className=\"h-5 w-5\" />\n                Add New Player\n              </DialogTitle>\n              <DialogDescription>\n                Enter the player's basic information. You can add more details later.\n              </DialogDescription>\n            </DialogHeader>\n            <Form {...form}>\n              <form onSubmit={form.handleSubmit(onSubmit)} className=\"space-y-4\">\n                <div className=\"grid grid-cols-2 gap-4\">\n                  <FormField\n                    control={form.control}\n                    name=\"firstName\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>First Name</FormLabel>\n                        <FormControl>\n                          <Input {...field} placeholder=\"Emmanuel\" data-testid=\"input-first-name\" />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n                  <FormField\n                    control={form.control}\n                    name=\"lastName\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>Last Name</FormLabel>\n                        <FormControl>\n                          <Input {...field} placeholder=\"Okonkwo\" data-testid=\"input-last-name\" />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n                </div>\n                \n                <div className=\"grid grid-cols-2 gap-4\">\n                  <FormField\n                    control={form.control}\n                    name=\"nationality\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>Nationality</FormLabel>\n                        <FormControl>\n                          <Input {...field} placeholder=\"Nigeria\" data-testid=\"input-nationality\" />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n                  <FormField\n                    control={form.control}\n                    name=\"position\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>Position</FormLabel>\n                        <Select onValueChange={field.onChange} defaultValue={field.value}>\n                          <FormControl>\n                            <SelectTrigger data-testid=\"select-position\">\n                              <SelectValue placeholder=\"Select position\" />\n                            </SelectTrigger>\n                          </FormControl>\n                          <SelectContent>\n                            <SelectItem value=\"Goalkeeper\">Goalkeeper</SelectItem>\n                            <SelectItem value=\"Defender\">Defender</SelectItem>\n                            <SelectItem value=\"Midfielder\">Midfielder</SelectItem>\n                            <SelectItem value=\"Winger\">Winger</SelectItem>\n                            <SelectItem value=\"Striker\">Striker</SelectItem>\n                          </SelectContent>\n                        </Select>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n                </div>\n\n                <FormField\n                  control={form.control}\n                  name=\"dateOfBirth\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Date of Birth</FormLabel>\n                      <FormControl>\n                        <Input type=\"date\" {...field} data-testid=\"input-dob\" />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                <div className=\"grid grid-cols-3 gap-4\">\n                  <FormField\n                    control={form.control}\n                    name=\"nationalTeamCaps\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>National Caps</FormLabel>\n                        <FormControl>\n                          <Input type=\"number\" {...field} min={0} data-testid=\"input-caps\" />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n                  <FormField\n                    control={form.control}\n                    name=\"height\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>Height (cm)</FormLabel>\n                        <FormControl>\n                          <Input type=\"number\" {...field} min={0} data-testid=\"input-height\" />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n                  <FormField\n                    control={form.control}\n                    name=\"weight\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>Weight (kg)</FormLabel>\n                        <FormControl>\n                          <Input type=\"number\" {...field} min={0} data-testid=\"input-weight\" />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n                </div>\n\n                <div className=\"flex gap-2 pt-4\">\n                  <Button type=\"button\" variant=\"outline\" onClick={() => setIsDialogOpen(false)}>\n                    Cancel\n                  </Button>\n                  <Button type=\"submit\" disabled={createPlayerMutation.isPending} data-testid=\"button-submit-player\">\n                    {createPlayerMutation.isPending ? \"Adding...\" : \"Add Player\"}\n                  </Button>\n                </div>\n              </form>\n            </Form>\n          </DialogContent>\n        </Dialog>\n      </div>\n\n      <div className=\"flex flex-wrap items-center gap-4\">\n        <div className=\"relative flex-1 min-w-64\">\n          <Search className=\"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground\" />\n          <Input\n            placeholder=\"Search by name, club...\"\n            value={searchQuery}\n            onChange={(e) => setSearchQuery(e.target.value)}\n            className=\"pl-9\"\n            data-testid=\"input-search-players\"\n          />\n        </div>\n        <Select value={statusFilter} onValueChange={setStatusFilter}>\n          <SelectTrigger className=\"w-48\" data-testid=\"select-status-filter\">\n            <Filter className=\"h-4 w-4 mr-2\" />\n            <SelectValue placeholder=\"Filter by status\" />\n          </SelectTrigger>\n          <SelectContent>\n            <SelectItem value=\"all\">All Statuses</SelectItem>\n            <SelectItem value=\"green\">Green (Eligible)</SelectItem>\n            <SelectItem value=\"yellow\">Yellow (Conditional)</SelectItem>\n            <SelectItem value=\"red\">Red (Ineligible)</SelectItem>\n          </SelectContent>\n        </Select>\n        <div className=\"flex border rounded-md\">\n          <Button\n            variant={viewMode === \"grid\" ? \"secondary\" : \"ghost\"}\n            size=\"icon\"\n            onClick={() => setViewMode(\"grid\")}\n            data-testid=\"button-view-grid\"\n          >\n            <Grid className=\"h-4 w-4\" />\n          </Button>\n          <Button\n            variant={viewMode === \"list\" ? \"secondary\" : \"ghost\"}\n            size=\"icon\"\n            onClick={() => setViewMode(\"list\")}\n            data-testid=\"button-view-list\"\n          >\n            <List className=\"h-4 w-4\" />\n          </Button>\n        </div>\n      </div>\n\n      {isLoading ? (\n        <div className=\"flex items-center justify-center py-12\">\n          <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-primary\"></div>\n        </div>\n      ) : (\n        <Tabs defaultValue=\"all\" className=\"w-full\">\n          <TabsList>\n            <TabsTrigger value=\"all\" data-testid=\"tab-all\">All ({players.length})</TabsTrigger>\n            <TabsTrigger value=\"green\" data-testid=\"tab-green\">\n              Green ({players.filter((p: Player) => getVisaStatus(p.overallEligibilityScore) === \"green\").length})\n            </TabsTrigger>\n            <TabsTrigger value=\"yellow\" data-testid=\"tab-yellow\">\n              Yellow ({players.filter((p: Player) => getVisaStatus(p.overallEligibilityScore) === \"yellow\").length})\n            </TabsTrigger>\n            <TabsTrigger value=\"red\" data-testid=\"tab-red\">\n              Red ({players.filter((p: Player) => getVisaStatus(p.overallEligibilityScore) === \"red\").length})\n            </TabsTrigger>\n          </TabsList>\n\n          <TabsContent value=\"all\" className=\"mt-6\">\n            <div className={viewMode === \"grid\" \n              ? \"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\" \n              : \"space-y-4\"\n            }>\n              {filteredPlayers.map((player: Player) => (\n                <PlayerCard\n                  key={player.id}\n                  player={player}\n                  onViewProfile={(id) => setLocation(`/players/${id}`)}\n                  onGenerateReport={(id) => setLocation(`/reports?player=${id}`)}\n                />\n              ))}\n            </div>\n            {filteredPlayers.length === 0 && (\n              <div className=\"text-center py-12 text-muted-foreground\">\n                <User className=\"h-12 w-12 mx-auto mb-4 opacity-50\" />\n                <p>No players found matching your criteria.</p>\n                <p className=\"text-sm mt-2\">Add a player to get started.</p>\n              </div>\n            )}\n          </TabsContent>\n\n          {[\"green\", \"yellow\", \"red\"].map((status) => (\n            <TabsContent key={status} value={status} className=\"mt-6\">\n              <div className={viewMode === \"grid\" \n                ? \"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\" \n                : \"space-y-4\"\n              }>\n                {players\n                  .filter((p: Player) => getVisaStatus(p.overallEligibilityScore) === status)\n                  .map((player: Player) => (\n                    <PlayerCard\n                      key={player.id}\n                      player={player}\n                      onViewProfile={(id) => setLocation(`/players/${id}`)}\n                      onGenerateReport={(id) => setLocation(`/reports?player=${id}`)}\n                    />\n                  ))}\n              </div>\n            </TabsContent>\n          ))}\n        </Tabs>\n      )}\n    </div>\n  );\n}\n","path":null,"size_bytes":16494,"size_tokens":null},"client/src/pages/player-profile.tsx":{"content":"import { useState } from \"react\";\nimport { useLocation } from \"wouter\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport PlayerInternationalRecords from \"@/components/PlayerInternationalRecords\";\nimport PlayerProfileEditor from \"@/components/PlayerProfileEditor\";\nimport TransferEligibilityDashboard from \"@/components/TransferEligibilityDashboard\";\nimport PlayerDocumentManager from \"@/components/PlayerDocumentManager\";\nimport VideoPlayer from \"@/components/VideoPlayer\";\nimport { Card } from \"@/components/ui/card\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Button } from \"@/components/ui/button\";\nimport { ArrowLeft, User, Globe, Clock, Activity, Ruler, Weight, Flag, CheckCircle, FileText, Video, Play, Calendar } from \"lucide-react\";\nimport type { Player, Video as VideoType } from \"@shared/schema\";\n\ninterface PlayerProfileProps {\n  params?: { id?: string };\n}\n\nexport default function PlayerProfile({ params }: PlayerProfileProps) {\n  const [, setLocation] = useLocation();\n  const playerId = params?.id || \"\";\n  const [selectedVideo, setSelectedVideo] = useState<VideoType | null>(null);\n  const [isVideoPlayerOpen, setIsVideoPlayerOpen] = useState(false);\n\n  const { data: playerData, isLoading } = useQuery<{\n    player: Player;\n    metrics: any[];\n    eligibilityScores: any[];\n    medicalRecords: any[];\n    biometricData: any[];\n    videos: VideoType[];\n  }>({\n    queryKey: [\"/api/players\", playerId],\n    queryFn: async () => {\n      const res = await fetch(`/api/players/${playerId}`);\n      if (!res.ok) throw new Error(\"Failed to fetch player\");\n      return res.json();\n    },\n    enabled: !!playerId,\n  });\n\n  const videos = playerData?.videos || [];\n\n  if (!playerId) {\n    return (\n      <div className=\"p-6\" data-testid=\"page-player-profile\">\n        <Button variant=\"ghost\" onClick={() => setLocation(\"/players\")} data-testid=\"button-back\">\n          <ArrowLeft className=\"h-4 w-4 mr-2\" />\n          Back to Players\n        </Button>\n        <div className=\"text-center py-12 text-muted-foreground\">\n          <p>No player selected</p>\n        </div>\n      </div>\n    );\n  }\n\n  if (isLoading) {\n    return (\n      <div className=\"p-6\" data-testid=\"page-player-profile\">\n        <Button variant=\"ghost\" onClick={() => setLocation(\"/players\")} data-testid=\"button-back\">\n          <ArrowLeft className=\"h-4 w-4 mr-2\" />\n          Back to Players\n        </Button>\n        <div className=\"flex items-center justify-center py-12\">\n          <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-primary\"></div>\n        </div>\n      </div>\n    );\n  }\n\n  const player = playerData?.player;\n\n  if (!player) {\n    return (\n      <div className=\"p-6\" data-testid=\"page-player-profile\">\n        <Button variant=\"ghost\" onClick={() => setLocation(\"/players\")} data-testid=\"button-back\">\n          <ArrowLeft className=\"h-4 w-4 mr-2\" />\n          Back to Players\n        </Button>\n        <div className=\"text-center py-12 text-muted-foreground\">\n          <p>Player not found</p>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"p-6 space-y-6\" data-testid=\"page-player-profile\">\n      <Button variant=\"ghost\" onClick={() => setLocation(\"/players\")} data-testid=\"button-back\">\n        <ArrowLeft className=\"h-4 w-4 mr-2\" />\n        Back to Players\n      </Button>\n\n      <div className=\"flex items-start gap-6\">\n        <div className=\"h-24 w-24 rounded-full bg-muted flex items-center justify-center\">\n          {player.profileImageUrl ? (\n            <img \n              src={player.profileImageUrl} \n              alt={`${player.firstName} ${player.lastName}`}\n              className=\"h-24 w-24 rounded-full object-cover\"\n            />\n          ) : (\n            <User className=\"h-12 w-12 text-muted-foreground\" />\n          )}\n        </div>\n        <div className=\"flex-1\">\n          <div className=\"flex items-start justify-between gap-4\">\n            <div>\n              <h1 className=\"text-3xl font-bold\" data-testid=\"text-player-name\">\n                {player.firstName} {player.lastName}\n              </h1>\n              <div className=\"flex flex-wrap items-center gap-3 mt-2\">\n                <Badge variant=\"secondary\" data-testid=\"badge-position\">{player.position}</Badge>\n                {player.secondaryPosition && (\n                  <Badge variant=\"outline\">{player.secondaryPosition}</Badge>\n                )}\n                <span className=\"flex items-center gap-1 text-muted-foreground\">\n                  <Flag className=\"h-4 w-4\" />\n                  {player.nationality}\n                  {player.secondNationality && ` / ${player.secondNationality}`}\n                </span>\n                {player.currentClubName && (\n                  <span className=\"text-muted-foreground\">{player.currentClubName}</span>\n                )}\n                {player.jerseyNumber && (\n                  <Badge variant=\"outline\">#{player.jerseyNumber}</Badge>\n                )}\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n\n      <div className=\"grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-4\">\n        <Card className=\"p-4 text-center\">\n          <div className=\"flex items-center justify-center gap-1 text-muted-foreground mb-1\">\n            <Ruler className=\"h-4 w-4\" />\n            <span className=\"text-xs\">Height</span>\n          </div>\n          <p className=\"text-xl font-bold\" data-testid=\"text-height\">\n            {player.height ? `${player.height} ${player.heightUnit || 'cm'}` : '-'}\n          </p>\n        </Card>\n        <Card className=\"p-4 text-center\">\n          <div className=\"flex items-center justify-center gap-1 text-muted-foreground mb-1\">\n            <Weight className=\"h-4 w-4\" />\n            <span className=\"text-xs\">Weight</span>\n          </div>\n          <p className=\"text-xl font-bold\" data-testid=\"text-weight\">\n            {player.weight ? `${player.weight} ${player.weightUnit || 'kg'}` : '-'}\n          </p>\n        </Card>\n        <Card className=\"p-4 text-center\">\n          <div className=\"flex items-center justify-center gap-1 text-muted-foreground mb-1\">\n            <Globe className=\"h-4 w-4\" />\n            <span className=\"text-xs\">Nat&apos;l Caps</span>\n          </div>\n          <p className=\"text-xl font-bold text-primary\" data-testid=\"text-national-caps\">\n            {player.nationalTeamCaps || 0}\n          </p>\n        </Card>\n        <Card className=\"p-4 text-center\">\n          <div className=\"flex items-center justify-center gap-1 text-muted-foreground mb-1\">\n            <Activity className=\"h-4 w-4\" />\n            <span className=\"text-xs\">Goals</span>\n          </div>\n          <p className=\"text-xl font-bold text-green-600\" data-testid=\"text-national-goals\">\n            {player.nationalTeamGoals || 0}\n          </p>\n        </Card>\n        <Card className=\"p-4 text-center\">\n          <div className=\"flex items-center justify-center gap-1 text-muted-foreground mb-1\">\n            <Clock className=\"h-4 w-4\" />\n            <span className=\"text-xs\">Club Mins</span>\n          </div>\n          <p className=\"text-xl font-bold\" data-testid=\"text-club-minutes\">\n            {player.clubMinutesCurrentSeason || 0}\n          </p>\n        </Card>\n        <Card className=\"p-4 text-center\">\n          <div className=\"flex items-center justify-center gap-1 text-muted-foreground mb-1\">\n            <Clock className=\"h-4 w-4\" />\n            <span className=\"text-xs\">Intl Mins</span>\n          </div>\n          <p className=\"text-xl font-bold\" data-testid=\"text-intl-minutes\">\n            {player.internationalMinutesCurrentSeason || 0}\n          </p>\n        </Card>\n      </div>\n\n      <Tabs defaultValue=\"eligibility\" className=\"w-full\">\n        <TabsList className=\"flex-wrap\">\n          <TabsTrigger value=\"eligibility\" data-testid=\"tab-eligibility\">\n            <CheckCircle className=\"h-4 w-4 mr-2\" />\n            Transfer Eligibility\n          </TabsTrigger>\n          <TabsTrigger value=\"profile\" data-testid=\"tab-profile\">Profile</TabsTrigger>\n          <TabsTrigger value=\"international\" data-testid=\"tab-international\">International Career</TabsTrigger>\n          <TabsTrigger value=\"videos\" data-testid=\"tab-videos\">\n            <Video className=\"h-4 w-4 mr-2\" />\n            Videos ({videos.length})\n          </TabsTrigger>\n          <TabsTrigger value=\"documents\" data-testid=\"tab-documents\">\n            <FileText className=\"h-4 w-4 mr-2\" />\n            Documents\n          </TabsTrigger>\n        </TabsList>\n\n        <TabsContent value=\"eligibility\" className=\"mt-6\">\n          <TransferEligibilityDashboard playerId={player.id} />\n        </TabsContent>\n\n        <TabsContent value=\"profile\" className=\"mt-6\">\n          <PlayerProfileEditor player={player} />\n        </TabsContent>\n\n        <TabsContent value=\"international\" className=\"mt-6\">\n          <PlayerInternationalRecords \n            playerId={player.id} \n            playerName={`${player.firstName} ${player.lastName}`} \n          />\n        </TabsContent>\n\n        <TabsContent value=\"videos\" className=\"mt-6\">\n          {videos.length === 0 ? (\n            <Card className=\"p-8 text-center\">\n              <Video className=\"h-12 w-12 mx-auto text-muted-foreground mb-4\" />\n              <p className=\"text-muted-foreground\">No videos tagged to this player yet.</p>\n              <p className=\"text-sm text-muted-foreground mt-1\">Videos uploaded or tracked for this player will appear here.</p>\n            </Card>\n          ) : (\n            <div className=\"grid gap-4 md:grid-cols-2 lg:grid-cols-3\">\n              {videos.map((video) => (\n                <Card key={video.id} className=\"overflow-visible\" data-testid={`card-video-${video.id}`}>\n                  <div className=\"p-4 space-y-3\">\n                    <div className=\"flex items-start justify-between gap-2\">\n                      <div className=\"flex items-center gap-2\">\n                        <div className=\"p-2 rounded-md bg-muted\">\n                          <Play className=\"h-4 w-4\" />\n                        </div>\n                        <div>\n                          <h4 className=\"font-medium text-sm leading-tight\">{video.title}</h4>\n                          <p className=\"text-xs text-muted-foreground\">{video.source}</p>\n                        </div>\n                      </div>\n                      {video.processed && (\n                        <Badge variant=\"secondary\" className=\"text-xs\">Analyzed</Badge>\n                      )}\n                    </div>\n                    \n                    <div className=\"flex flex-wrap gap-2 text-xs text-muted-foreground\">\n                      {video.matchDate && (\n                        <span className=\"flex items-center gap-1\">\n                          <Calendar className=\"h-3 w-3\" />\n                          {video.matchDate}\n                        </span>\n                      )}\n                      {video.duration && (\n                        <span className=\"flex items-center gap-1\">\n                          <Clock className=\"h-3 w-3\" />\n                          {video.duration}\n                        </span>\n                      )}\n                      {video.minutesPlayed && (\n                        <Badge variant=\"outline\" className=\"text-xs\">\n                          {video.minutesPlayed} mins played\n                        </Badge>\n                      )}\n                    </div>\n\n                    {video.competition && (\n                      <p className=\"text-xs text-muted-foreground\">\n                        {video.competition}\n                        {video.opponent && ` vs ${video.opponent}`}\n                      </p>\n                    )}\n\n                    <Button \n                      size=\"sm\" \n                      variant=\"default\"\n                      className=\"w-full\"\n                      onClick={() => {\n                        setSelectedVideo(video);\n                        setIsVideoPlayerOpen(true);\n                      }}\n                      data-testid={`button-play-video-${video.id}`}\n                    >\n                      <Play className=\"h-3 w-3 mr-2\" />\n                      Watch Video\n                    </Button>\n                  </div>\n                </Card>\n              ))}\n            </div>\n          )}\n        </TabsContent>\n\n        <TabsContent value=\"documents\" className=\"mt-6\">\n          <PlayerDocumentManager \n            playerId={player.id} \n            playerName={`${player.firstName} ${player.lastName}`} \n          />\n        </TabsContent>\n      </Tabs>\n\n      <VideoPlayer \n        video={selectedVideo}\n        isOpen={isVideoPlayerOpen}\n        onClose={() => {\n          setIsVideoPlayerOpen(false);\n          setSelectedVideo(null);\n        }}\n      />\n    </div>\n  );\n}\n","path":null,"size_bytes":12900,"size_tokens":null},"client/src/components/examples/ScoutingInquiryCard.tsx":{"content":"import ScoutingInquiryCard from \"../ScoutingInquiryCard\";\nimport { mockScoutingInquiries, mockPlayers } from \"@/lib/mock-data\";\n\nexport default function ScoutingInquiryCardExample() {\n  const inquiry = mockScoutingInquiries[0];\n  const player = mockPlayers.find(p => p.id === inquiry.playerId)!;\n  \n  return (\n    <div className=\"max-w-sm\">\n      <ScoutingInquiryCard \n        inquiry={inquiry}\n        playerName={`${player.firstName} ${player.lastName}`}\n        onViewDetails={(id) => console.log(\"View details\", id)}\n        onMessage={(id) => console.log(\"Message\", id)}\n      />\n    </div>\n  );\n}\n","path":null,"size_bytes":603,"size_tokens":null},"shared/schema.ts":{"content":"import { sql } from \"drizzle-orm\";\nimport { pgTable, text, varchar, integer, boolean, timestamp, doublePrecision, jsonb } from \"drizzle-orm/pg-core\";\nimport { createInsertSchema } from \"drizzle-zod\";\nimport { z } from \"zod\";\n\nexport const users = pgTable(\"users\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  username: text(\"username\").notNull().unique(),\n  password: text(\"password\").notNull(),\n  email: text(\"email\"),\n  firstName: text(\"first_name\"),\n  lastName: text(\"last_name\"),\n  role: text(\"role\").notNull().default(\"scout\"),\n  teamId: varchar(\"team_id\"),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\nexport const teams = pgTable(\"teams\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  name: text(\"name\").notNull(),\n  clubName: text(\"club_name\"),\n  country: text(\"country\"),\n  leagueBand: integer(\"league_band\").default(3),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\nexport const clubs = pgTable(\"clubs\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  name: text(\"name\").notNull(),\n  country: text(\"country\").notNull(),\n  league: text(\"league\").notNull(),\n  leagueBand: integer(\"league_band\").notNull().default(3),\n  leaguePosition: integer(\"league_position\"),\n  continentalCompetition: text(\"continental_competition\"),\n  fifaRanking: integer(\"fifa_ranking\"),\n});\n\nexport const players = pgTable(\"players\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  firstName: text(\"first_name\").notNull(),\n  lastName: text(\"last_name\").notNull(),\n  nationality: text(\"nationality\").notNull(),\n  secondNationality: text(\"second_nationality\"),\n  dateOfBirth: text(\"date_of_birth\"),\n  birthPlace: text(\"birth_place\"),\n  position: text(\"position\").notNull(),\n  secondaryPosition: text(\"secondary_position\"),\n  currentClubId: varchar(\"current_club_id\"),\n  currentClubName: text(\"current_club_name\"),\n  profileImageUrl: text(\"profile_image_url\"),\n  nationalTeamCaps: integer(\"national_team_caps\").default(0),\n  nationalTeamDebut: text(\"national_team_debut\"),\n  nationalTeamGoals: integer(\"national_team_goals\").default(0),\n  continentalGames: integer(\"continental_games\").default(0),\n  internationalCaps: integer(\"international_caps\").default(0),\n  internationalGoals: integer(\"international_goals\").default(0),\n  height: integer(\"height\"),\n  heightUnit: text(\"height_unit\").default(\"cm\"),\n  weight: integer(\"weight\"),\n  weightUnit: text(\"weight_unit\").default(\"kg\"),\n  wingspan: integer(\"wingspan\"),\n  preferredFoot: text(\"preferred_foot\"),\n  bmi: doublePrecision(\"bmi\"),\n  contractEndDate: text(\"contract_end_date\"),\n  marketValue: doublePrecision(\"market_value\"),\n  jerseyNumber: integer(\"jersey_number\"),\n  agentName: text(\"agent_name\"),\n  agentContact: text(\"agent_contact\"),\n  clubMinutesCurrentSeason: integer(\"club_minutes_current_season\").default(0),\n  clubMinutesLast12Months: integer(\"club_minutes_last_12_months\").default(0),\n  internationalMinutesCurrentSeason: integer(\"international_minutes_current_season\").default(0),\n  internationalMinutesLast12Months: integer(\"international_minutes_last_12_months\").default(0),\n  totalCareerMinutes: integer(\"total_career_minutes\").default(0),\n  profileDocumentUrl: text(\"profile_document_url\"),\n  teamId: varchar(\"team_id\"),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\nexport const playerMetrics = pgTable(\"player_metrics\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  playerId: varchar(\"player_id\").notNull(),\n  season: text(\"season\").notNull(),\n  currentSeasonMinutes: integer(\"current_season_minutes\").default(0),\n  totalCareerMinutes: integer(\"total_career_minutes\").default(0),\n  gamesPlayed: integer(\"games_played\").default(0),\n  goals: integer(\"goals\").default(0),\n  assists: integer(\"assists\").default(0),\n  yellowCards: integer(\"yellow_cards\").default(0),\n  redCards: integer(\"red_cards\").default(0),\n  passAccuracy: doublePrecision(\"pass_accuracy\"),\n  tacklesWon: integer(\"tackles_won\").default(0),\n  aerialDuelsWon: integer(\"aerial_duels_won\").default(0),\n  distanceCovered: doublePrecision(\"distance_covered\"),\n  sprintSpeed: doublePrecision(\"sprint_speed\"),\n  clubLeaguePosition: integer(\"club_league_position\"),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\nexport const medicalRecords = pgTable(\"medical_records\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  playerId: varchar(\"player_id\").notNull(),\n  recordDate: timestamp(\"record_date\").defaultNow(),\n  recordType: text(\"record_type\").notNull(),\n  description: text(\"description\"),\n  fitnessLevel: text(\"fitness_level\"),\n  injuryHistory: jsonb(\"injury_history\"),\n  clearanceStatus: text(\"clearance_status\"),\n  expiryDate: text(\"expiry_date\"),\n});\n\nexport const biometricData = pgTable(\"biometric_data\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  playerId: varchar(\"player_id\").notNull(),\n  recordDate: timestamp(\"record_date\").defaultNow(),\n  restingHeartRate: integer(\"resting_heart_rate\"),\n  vo2Max: doublePrecision(\"vo2_max\"),\n  bodyFatPercentage: doublePrecision(\"body_fat_percentage\"),\n  muscleMass: doublePrecision(\"muscle_mass\"),\n  hydrationLevel: doublePrecision(\"hydration_level\"),\n  sleepQuality: doublePrecision(\"sleep_quality\"),\n  fatigueIndex: doublePrecision(\"fatigue_index\"),\n  gpsDataAvailable: boolean(\"gps_data_available\").default(false),\n});\n\nexport const videos = pgTable(\"videos\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  playerId: varchar(\"player_id\").notNull(),\n  title: text(\"title\").notNull(),\n  source: text(\"source\").notNull().default(\"manual\"),\n  uploadDate: timestamp(\"upload_date\").defaultNow(),\n  duration: text(\"duration\"),\n  fileUrl: text(\"file_url\"),\n  thumbnailUrl: text(\"thumbnail_url\"),\n  matchDate: text(\"match_date\"),\n  competition: text(\"competition\"),\n  opponent: text(\"opponent\"),\n  minutesPlayed: integer(\"minutes_played\"),\n  processed: boolean(\"processed\").default(false),\n  teamId: varchar(\"team_id\"),\n  teamSheetId: varchar(\"team_sheet_id\"),\n});\n\nexport const videoInsights = pgTable(\"video_insights\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  videoId: varchar(\"video_id\").notNull(),\n  playerId: varchar(\"player_id\").notNull(),\n  minutesPlayed: integer(\"minutes_played\").default(0),\n  distanceCovered: doublePrecision(\"distance_covered\"),\n  sprintCount: integer(\"sprint_count\").default(0),\n  passesAttempted: integer(\"passes_attempted\").default(0),\n  passesCompleted: integer(\"passes_completed\").default(0),\n  shotsOnTarget: integer(\"shots_on_target\").default(0),\n  tackles: integer(\"tackles\").default(0),\n  interceptions: integer(\"interceptions\").default(0),\n  duelsWon: integer(\"duels_won\").default(0),\n  heatmapData: jsonb(\"heatmap_data\"),\n  aiAnalysis: text(\"ai_analysis\"),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\nexport const visaRules = pgTable(\"visa_rules\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  visaType: text(\"visa_type\").notNull(),\n  country: text(\"country\").notNull(),\n  category: text(\"category\").notNull(),\n  ruleName: text(\"rule_name\").notNull(),\n  description: text(\"description\"),\n  minPoints: integer(\"min_points\"),\n  maxPoints: integer(\"max_points\"),\n  criteria: jsonb(\"criteria\"),\n  leagueBandMultipliers: jsonb(\"league_band_multipliers\"),\n  active: boolean(\"active\").default(true),\n});\n\nexport const eligibilityScores = pgTable(\"eligibility_scores\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  playerId: varchar(\"player_id\").notNull(),\n  visaType: text(\"visa_type\").notNull(),\n  score: doublePrecision(\"score\").notNull(),\n  status: text(\"status\").notNull(),\n  breakdown: jsonb(\"breakdown\"),\n  leagueBandApplied: integer(\"league_band_applied\"),\n  calculatedAt: timestamp(\"calculated_at\").defaultNow(),\n  validUntil: timestamp(\"valid_until\"),\n});\n\nexport const transferEligibilityAssessments = pgTable(\"transfer_eligibility_assessments\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  playerId: varchar(\"player_id\").notNull(),\n  totalMinutesVerified: integer(\"total_minutes_verified\").default(0),\n  clubMinutes: integer(\"club_minutes\").default(0),\n  internationalMinutes: integer(\"international_minutes\").default(0),\n  videoMinutes: integer(\"video_minutes\").default(0),\n  totalCaps: integer(\"total_caps\").default(0),\n  seniorCaps: integer(\"senior_caps\").default(0),\n  continentalAppearances: integer(\"continental_appearances\").default(0),\n  overallStatus: text(\"overall_status\").notNull().default(\"red\"),\n  schengenScore: doublePrecision(\"schengen_score\").default(0),\n  schengenStatus: text(\"schengen_status\").default(\"red\"),\n  o1Score: doublePrecision(\"o1_score\").default(0),\n  o1Status: text(\"o1_status\").default(\"red\"),\n  p1Score: doublePrecision(\"p1_score\").default(0),\n  p1Status: text(\"p1_status\").default(\"red\"),\n  ukGbeScore: doublePrecision(\"uk_gbe_score\").default(0),\n  ukGbeStatus: text(\"uk_gbe_status\").default(\"red\"),\n  escScore: doublePrecision(\"esc_score\").default(0),\n  escStatus: text(\"esc_status\").default(\"red\"),\n  escEligible: boolean(\"esc_eligible\").default(false),\n  minutesNeeded: integer(\"minutes_needed\").default(0),\n  capsNeeded: integer(\"caps_needed\").default(0),\n  recommendations: jsonb(\"recommendations\"),\n  visaBreakdown: jsonb(\"visa_breakdown\"),\n  calculatedAt: timestamp(\"calculated_at\").defaultNow(),\n  validUntil: timestamp(\"valid_until\"),\n});\n\nexport const transferReports = pgTable(\"transfer_reports\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  playerId: varchar(\"player_id\").notNull(),\n  teamId: varchar(\"team_id\").notNull(),\n  generatedBy: varchar(\"generated_by\"),\n  generatedByName: text(\"generated_by_name\"),\n  reportType: text(\"report_type\").notNull().default(\"comprehensive\"),\n  status: text(\"status\").notNull().default(\"draft\"),\n  dataRangeStart: timestamp(\"data_range_start\"),\n  dataRangeEnd: timestamp(\"data_range_end\"),\n  playerProfile: jsonb(\"player_profile\"),\n  internationalCareer: jsonb(\"international_career\"),\n  performanceStats: jsonb(\"performance_stats\"),\n  eligibilityScores: jsonb(\"eligibility_scores\"),\n  videosIncluded: jsonb(\"videos_included\"),\n  documentsIncluded: jsonb(\"documents_included\"),\n  invitationLetters: jsonb(\"invitation_letters\"),\n  embassyVerifications: jsonb(\"embassy_verifications\"),\n  totalMinutesVerified: integer(\"total_minutes_verified\").default(0),\n  overallEligibilityStatus: text(\"overall_eligibility_status\"),\n  recommendations: jsonb(\"recommendations\"),\n  fileUrl: text(\"file_url\"),\n  verificationCode: text(\"verification_code\"),\n  embassyNotified: boolean(\"embassy_notified\").default(false),\n  embassyNotifiedAt: timestamp(\"embassy_notified_at\"),\n  generatedAt: timestamp(\"generated_at\").defaultNow(),\n  validUntil: timestamp(\"valid_until\"),\n});\n\nexport const complianceOrders = pgTable(\"compliance_orders\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  playerId: varchar(\"player_id\").notNull(),\n  teamId: varchar(\"team_id\").notNull(),\n  requestedBy: varchar(\"requested_by\").notNull(),\n  visaType: text(\"visa_type\").notNull(),\n  targetCountry: text(\"target_country\"),\n  status: text(\"status\").notNull().default(\"pending_payment\"),\n  amount: doublePrecision(\"amount\").notNull(),\n  currency: text(\"currency\").default(\"USD\"),\n  stripePaymentIntentId: text(\"stripe_payment_intent_id\"),\n  paidAt: timestamp(\"paid_at\"),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\nexport const complianceDocuments = pgTable(\"compliance_documents\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  orderId: varchar(\"order_id\").notNull(),\n  playerId: varchar(\"player_id\").notNull(),\n  documentType: text(\"document_type\").notNull(),\n  generatedAt: timestamp(\"generated_at\").defaultNow(),\n  generatedBy: varchar(\"generated_by\"),\n  dataRangeStart: text(\"data_range_start\"),\n  dataRangeEnd: text(\"data_range_end\"),\n  fileUrl: text(\"file_url\"),\n  aiSummary: text(\"ai_summary\"),\n  playerProfile: jsonb(\"player_profile\"),\n  physicalData: jsonb(\"physical_data\"),\n  performanceStats: jsonb(\"performance_stats\"),\n  eligibilityData: jsonb(\"eligibility_data\"),\n  status: text(\"status\").default(\"draft\"),\n});\n\nexport const embassyVerifications = pgTable(\"embassy_verifications\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  documentId: varchar(\"document_id\").notNull(),\n  playerId: varchar(\"player_id\").notNull(),\n  embassyCountry: text(\"embassy_country\").notNull(),\n  submittedAt: timestamp(\"submitted_at\").defaultNow(),\n  status: text(\"status\").default(\"pending\"),\n  verificationCode: text(\"verification_code\"),\n  verifiedAt: timestamp(\"verified_at\"),\n  notes: text(\"notes\"),\n});\n\nexport const scoutingInquiries = pgTable(\"scouting_inquiries\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  playerId: varchar(\"player_id\").notNull(),\n  buyingClubId: varchar(\"buying_club_id\"),\n  sellingClubId: varchar(\"selling_club_id\"),\n  buyingClubName: text(\"buying_club_name\").notNull(),\n  sellingClubName: text(\"selling_club_name\").notNull(),\n  status: text(\"status\").default(\"inquiry\"),\n  complianceScore: doublePrecision(\"compliance_score\"),\n  message: text(\"message\"),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\nexport const payments = pgTable(\"payments\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  orderId: varchar(\"order_id\").notNull(),\n  stripePaymentIntentId: text(\"stripe_payment_intent_id\"),\n  stripeCustomerId: text(\"stripe_customer_id\"),\n  amount: doublePrecision(\"amount\").notNull(),\n  currency: text(\"currency\").default(\"USD\"),\n  status: text(\"status\").default(\"pending\"),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  completedAt: timestamp(\"completed_at\"),\n});\n\nexport const embassyProfiles = pgTable(\"embassy_profiles\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  country: text(\"country\").notNull(),\n  jurisdiction: text(\"jurisdiction\"),\n  contactEmail: text(\"contact_email\"),\n  contactPhone: text(\"contact_phone\"),\n  address: text(\"address\"),\n  userId: varchar(\"user_id\"),\n  active: boolean(\"active\").default(true),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\nexport const invitationLetters = pgTable(\"invitation_letters\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  playerId: varchar(\"player_id\").notNull(),\n  fromTeamId: varchar(\"from_team_id\").notNull(),\n  targetClubName: text(\"target_club_name\").notNull(),\n  targetClubAddress: text(\"target_club_address\"),\n  targetLeague: text(\"target_league\").notNull(),\n  targetLeagueBand: integer(\"target_league_band\").notNull(),\n  targetCountry: text(\"target_country\").notNull(),\n  trialStartDate: text(\"trial_start_date\"),\n  trialEndDate: text(\"trial_end_date\"),\n  offerType: text(\"offer_type\").default(\"trial\"),\n  scoutAgentName: text(\"scout_agent_name\"),\n  scoutAgentId: varchar(\"scout_agent_id\"),\n  fileUrl: text(\"file_url\"),\n  status: text(\"status\").default(\"pending\"),\n  uploadedAt: timestamp(\"uploaded_at\").defaultNow(),\n  uploadedBy: varchar(\"uploaded_by\"),\n  verifiedAt: timestamp(\"verified_at\"),\n  expiresAt: timestamp(\"expires_at\"),\n  recalculatedEligibility: jsonb(\"recalculated_eligibility\"),\n  consularReportGenerated: boolean(\"consular_report_generated\").default(false),\n  consularReportUrl: text(\"consular_report_url\"),\n  qrCodeData: text(\"qr_code_data\"),\n  embassyAccessible: boolean(\"embassy_accessible\").default(false),\n});\n\nexport const consularReports = pgTable(\"consular_reports\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  invitationLetterId: varchar(\"invitation_letter_id\").notNull(),\n  playerId: varchar(\"player_id\").notNull(),\n  playerProfile: jsonb(\"player_profile\"),\n  playerStats: jsonb(\"player_stats\"),\n  eligibilityScores: jsonb(\"eligibility_scores\"),\n  videoQrCodes: jsonb(\"video_qr_codes\"),\n  proofOfPlaySummary: text(\"proof_of_play_summary\"),\n  targetClubDetails: jsonb(\"target_club_details\"),\n  verificationCode: varchar(\"verification_code\").notNull(),\n  generatedAt: timestamp(\"generated_at\").defaultNow(),\n  validUntil: timestamp(\"valid_until\"),\n  accessedByEmbassy: boolean(\"accessed_by_embassy\").default(false),\n  embassyAccessLogs: jsonb(\"embassy_access_logs\"),\n});\n\nexport const conversations = pgTable(\"conversations\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  title: text(\"title\"),\n  playerId: varchar(\"player_id\"),\n  inquiryId: varchar(\"inquiry_id\"),\n  type: text(\"type\").notNull().default(\"general\"),\n  status: text(\"status\").default(\"active\"),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\nexport const conversationParticipants = pgTable(\"conversation_participants\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  conversationId: varchar(\"conversation_id\").notNull(),\n  userId: varchar(\"user_id\").notNull(),\n  role: text(\"role\").notNull(),\n  joinedAt: timestamp(\"joined_at\").defaultNow(),\n  lastReadAt: timestamp(\"last_read_at\"),\n});\n\nexport const messages = pgTable(\"messages\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  conversationId: varchar(\"conversation_id\").notNull(),\n  senderId: varchar(\"sender_id\").notNull(),\n  senderRole: text(\"sender_role\").notNull(),\n  content: text(\"content\").notNull(),\n  attachmentUrl: text(\"attachment_url\"),\n  attachmentType: text(\"attachment_type\"),\n  readBy: jsonb(\"read_by\"),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\nexport const embassyDocumentAccess = pgTable(\"embassy_document_access\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  documentId: varchar(\"document_id\").notNull(),\n  embassyProfileId: varchar(\"embassy_profile_id\").notNull(),\n  accessedAt: timestamp(\"accessed_at\").defaultNow(),\n  accessedBy: varchar(\"accessed_by\"),\n  accessType: text(\"access_type\").default(\"view\"),\n  ipAddress: text(\"ip_address\"),\n});\n\nexport const sharedVideos = pgTable(\"shared_videos\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  videoId: varchar(\"video_id\").notNull(),\n  sharedWithUserId: varchar(\"shared_with_user_id\"),\n  sharedWithRole: text(\"shared_with_role\"),\n  sharedByUserId: varchar(\"shared_by_user_id\").notNull(),\n  playerId: varchar(\"player_id\").notNull(),\n  accessLevel: text(\"access_level\").default(\"view\"),\n  sharedAt: timestamp(\"shared_at\").defaultNow(),\n  expiresAt: timestamp(\"expires_at\"),\n});\n\nexport const videoTags = pgTable(\"video_tags\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  videoId: varchar(\"video_id\").notNull(),\n  tagType: text(\"tag_type\").notNull(),\n  tagValue: text(\"tag_value\").notNull(),\n  timestamp: text(\"timestamp\"),\n  createdBy: varchar(\"created_by\"),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\nexport const actionLogs = pgTable(\"action_logs\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  userId: varchar(\"user_id\"),\n  userRole: text(\"user_role\"),\n  action: text(\"action\").notNull(),\n  entityType: text(\"entity_type\").notNull(),\n  entityId: varchar(\"entity_id\"),\n  details: jsonb(\"details\"),\n  ipAddress: text(\"ip_address\"),\n  timestamp: timestamp(\"timestamp\").defaultNow(),\n});\n\nexport const transferTargets = pgTable(\"transfer_targets\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  complianceOrderId: varchar(\"compliance_order_id\").notNull(),\n  playerId: varchar(\"player_id\").notNull(),\n  targetClubName: text(\"target_club_name\").notNull(),\n  targetLeague: text(\"target_league\").notNull(),\n  targetCountry: text(\"target_country\").notNull(),\n  targetLeagueBand: integer(\"target_league_band\").notNull(),\n  invitationLetterId: varchar(\"invitation_letter_id\"),\n  scoutAgentId: varchar(\"scout_agent_id\"),\n  proposedTransferFee: doublePrecision(\"proposed_transfer_fee\"),\n  status: text(\"status\").default(\"pending\"),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\nexport const videoPlayerTags = pgTable(\"video_player_tags\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  videoId: varchar(\"video_id\").notNull(),\n  playerId: varchar(\"player_id\").notNull(),\n  minutesPlayed: integer(\"minutes_played\").default(0),\n  position: text(\"position\"),\n  performanceRating: doublePrecision(\"performance_rating\"),\n  goals: integer(\"goals\").default(0),\n  assists: integer(\"assists\").default(0),\n  passesCompleted: integer(\"passes_completed\").default(0),\n  passesAttempted: integer(\"passes_attempted\").default(0),\n  tackles: integer(\"tackles\").default(0),\n  interceptions: integer(\"interceptions\").default(0),\n  saves: integer(\"saves\").default(0),\n  shotsOnTarget: integer(\"shots_on_target\").default(0),\n  distanceCovered: doublePrecision(\"distance_covered\"),\n  sprintCount: integer(\"sprint_count\").default(0),\n  duelsWon: integer(\"duels_won\").default(0),\n  duelsLost: integer(\"duels_lost\").default(0),\n  aiAnalysis: text(\"ai_analysis\"),\n  positionalMetrics: jsonb(\"positional_metrics\"),\n  keyMoments: jsonb(\"key_moments\"),\n  strengths: text(\"strengths\").array(),\n  areasToImprove: text(\"areas_to_improve\").array(),\n  analyzed: boolean(\"analyzed\").default(false),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\nexport const playerInternationalRecords = pgTable(\"player_international_records\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  playerId: varchar(\"player_id\").notNull(),\n  nationalTeam: text(\"national_team\").notNull(),\n  teamLevel: text(\"team_level\").default(\"senior\"),\n  caps: integer(\"caps\").default(0),\n  goals: integer(\"goals\").default(0),\n  assists: integer(\"assists\").default(0),\n  debutDate: text(\"debut_date\"),\n  lastAppearance: text(\"last_appearance\"),\n  competitionLevel: text(\"competition_level\"),\n  majorTournaments: text(\"major_tournaments\").array(),\n  documentUrl: text(\"document_url\"),\n  verificationStatus: text(\"verification_status\").default(\"pending\"),\n  notes: text(\"notes\"),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\nexport const teamSheets = pgTable(\"team_sheets\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  teamId: varchar(\"team_id\").notNull(),\n  title: text(\"title\").notNull(),\n  matchDate: text(\"match_date\").notNull(),\n  kickoffTime: text(\"kickoff_time\"),\n  competition: text(\"competition\").notNull(),\n  competitionType: text(\"competition_type\").default(\"league\"),\n  stadium: text(\"stadium\"),\n  homeTeam: text(\"home_team\"),\n  awayTeam: text(\"away_team\"),\n  isHome: boolean(\"is_home\").default(true),\n  referee: text(\"referee\"),\n  assistantReferees: text(\"assistant_referees\"),\n  fourthOfficial: text(\"fourth_official\"),\n  formation: text(\"formation\").default(\"4-3-3\"),\n  matchResult: text(\"match_result\"),\n  notes: text(\"notes\"),\n  videoId: varchar(\"video_id\"),\n  status: text(\"status\").default(\"draft\"),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\nexport const teamSheetPlayers = pgTable(\"team_sheet_players\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  teamSheetId: varchar(\"team_sheet_id\").notNull(),\n  playerId: varchar(\"player_id\").notNull(),\n  role: text(\"role\").notNull().default(\"starting\"),\n  shirtNumber: integer(\"shirt_number\"),\n  position: text(\"position\"),\n  positionOrder: integer(\"position_order\"),\n  minutesPlayed: integer(\"minutes_played\").default(0),\n  substituteIn: integer(\"substitute_in\"),\n  substituteOut: integer(\"substitute_out\"),\n  goals: integer(\"goals\").default(0),\n  assists: integer(\"assists\").default(0),\n  yellowCards: integer(\"yellow_cards\").default(0),\n  redCard: boolean(\"red_card\").default(false),\n  notes: text(\"notes\"),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\nexport const playerDocuments = pgTable(\"player_documents\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  playerId: varchar(\"player_id\").notNull(),\n  teamId: varchar(\"team_id\").notNull(),\n  documentType: text(\"document_type\").notNull(),\n  originalName: text(\"original_name\").notNull(),\n  mimeType: text(\"mime_type\"),\n  fileSize: integer(\"file_size\"),\n  storageKey: text(\"storage_key\").notNull(),\n  objectPath: text(\"object_path\"),\n  verificationStatus: text(\"verification_status\").default(\"pending\"),\n  verifiedBy: varchar(\"verified_by\"),\n  verifiedAt: timestamp(\"verified_at\"),\n  expiryDate: text(\"expiry_date\"),\n  documentNumber: text(\"document_number\"),\n  issuingCountry: text(\"issuing_country\"),\n  notes: text(\"notes\"),\n  uploadedBy: varchar(\"uploaded_by\"),\n  uploadedAt: timestamp(\"uploaded_at\").defaultNow(),\n});\n\nexport const federationLetterRequests = pgTable(\"federation_letter_requests\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  requestNumber: text(\"request_number\").notNull(),\n  teamId: varchar(\"team_id\").notNull(),\n  playerId: varchar(\"player_id\").notNull(),\n  federationId: varchar(\"federation_id\"),\n  passportDocumentId: varchar(\"passport_document_id\"),\n  status: text(\"status\").notNull().default(\"pending\"),\n  federationName: text(\"federation_name\"),\n  federationCountry: text(\"federation_country\"),\n  athleteFullName: text(\"athlete_full_name\").notNull(),\n  athleteNationality: text(\"athlete_nationality\").notNull(),\n  athleteDateOfBirth: text(\"athlete_date_of_birth\"),\n  athletePosition: text(\"athlete_position\"),\n  targetClubName: text(\"target_club_name\").notNull(),\n  targetClubCountry: text(\"target_club_country\").notNull(),\n  transferType: text(\"transfer_type\").notNull(),\n  invitationLetterStorageKey: text(\"invitation_letter_storage_key\"),\n  invitationLetterObjectPath: text(\"invitation_letter_object_path\"),\n  invitationLetterOriginalName: text(\"invitation_letter_original_name\"),\n  requestPurpose: text(\"request_purpose\"),\n  additionalNotes: text(\"additional_notes\"),\n  feeAmount: doublePrecision(\"fee_amount\").default(0),\n  serviceCharge: doublePrecision(\"service_charge\").default(0),\n  totalAmount: doublePrecision(\"total_amount\").default(0),\n  paymentStatus: text(\"payment_status\").default(\"unpaid\"),\n  paymentId: varchar(\"payment_id\"),\n  paymentConfirmedAt: timestamp(\"payment_confirmed_at\"),\n  submittedBy: varchar(\"submitted_by\"),\n  submittedAt: timestamp(\"submitted_at\"),\n  processedBy: varchar(\"processed_by\"),\n  processedAt: timestamp(\"processed_at\"),\n  issuedDocumentStorageKey: text(\"issued_document_storage_key\"),\n  issuedDocumentObjectPath: text(\"issued_document_object_path\"),\n  issuedDocumentOriginalName: text(\"issued_document_original_name\"),\n  issuedAt: timestamp(\"issued_at\"),\n  issuedBy: varchar(\"issued_by\"),\n  rejectionReason: text(\"rejection_reason\"),\n  notificationsSent: jsonb(\"notifications_sent\"),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\nexport const scoutShortlists = pgTable(\"scout_shortlists\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  scoutId: varchar(\"scout_id\").notNull(),\n  playerId: varchar(\"player_id\").notNull(),\n  priority: text(\"priority\").notNull().default(\"green\"),\n  notes: text(\"notes\"),\n  addedAt: timestamp(\"added_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\nexport const insertUserSchema = createInsertSchema(users).pick({\n  username: true,\n  password: true,\n  email: true,\n  firstName: true,\n  lastName: true,\n  role: true,\n  teamId: true,\n});\n\nexport const insertTeamSchema = createInsertSchema(teams).pick({\n  name: true,\n  clubName: true,\n  country: true,\n  leagueBand: true,\n});\n\nexport const insertClubSchema = createInsertSchema(clubs).omit({ id: true });\n\nexport const insertPlayerSchema = createInsertSchema(players).omit({ id: true, createdAt: true, updatedAt: true });\n\nexport const insertPlayerMetricsSchema = createInsertSchema(playerMetrics).omit({ id: true, updatedAt: true });\n\nexport const insertMedicalRecordSchema = createInsertSchema(medicalRecords).omit({ id: true });\n\nexport const insertBiometricDataSchema = createInsertSchema(biometricData).omit({ id: true });\n\nexport const insertVideoSchema = createInsertSchema(videos).omit({ id: true, uploadDate: true });\n\nexport const insertVideoInsightsSchema = createInsertSchema(videoInsights).omit({ id: true, createdAt: true });\n\nexport const insertVisaRuleSchema = createInsertSchema(visaRules).omit({ id: true });\n\nexport const insertEligibilityScoreSchema = createInsertSchema(eligibilityScores).omit({ id: true, calculatedAt: true });\n\nexport const insertTransferEligibilityAssessmentSchema = createInsertSchema(transferEligibilityAssessments).omit({ id: true, calculatedAt: true });\n\nexport const insertTransferReportSchema = createInsertSchema(transferReports).omit({ id: true, generatedAt: true });\n\nexport const insertComplianceOrderSchema = createInsertSchema(complianceOrders).omit({ id: true, createdAt: true });\n\nexport const insertComplianceDocumentSchema = createInsertSchema(complianceDocuments).omit({ id: true, generatedAt: true });\n\nexport const insertEmbassyVerificationSchema = createInsertSchema(embassyVerifications).omit({ id: true, submittedAt: true });\n\nexport const insertScoutingInquirySchema = createInsertSchema(scoutingInquiries).omit({ id: true, createdAt: true, updatedAt: true });\n\nexport const insertPaymentSchema = createInsertSchema(payments).omit({ id: true, createdAt: true });\n\nexport const insertEmbassyProfileSchema = createInsertSchema(embassyProfiles).omit({ id: true, createdAt: true });\n\nexport const insertInvitationLetterSchema = createInsertSchema(invitationLetters).omit({ id: true, uploadedAt: true });\n\nexport const insertConsularReportSchema = createInsertSchema(consularReports).omit({ id: true, generatedAt: true });\n\nexport const insertConversationSchema = createInsertSchema(conversations).omit({ id: true, createdAt: true, updatedAt: true });\n\nexport const insertConversationParticipantSchema = createInsertSchema(conversationParticipants).omit({ id: true, joinedAt: true });\n\nexport const insertMessageSchema = createInsertSchema(messages).omit({ id: true, createdAt: true });\n\nexport const insertEmbassyDocumentAccessSchema = createInsertSchema(embassyDocumentAccess).omit({ id: true, accessedAt: true });\n\nexport const insertSharedVideoSchema = createInsertSchema(sharedVideos).omit({ id: true, sharedAt: true });\n\nexport const insertVideoTagSchema = createInsertSchema(videoTags).omit({ id: true, createdAt: true });\n\nexport const insertActionLogSchema = createInsertSchema(actionLogs).omit({ id: true, timestamp: true });\n\nexport const insertTransferTargetSchema = createInsertSchema(transferTargets).omit({ id: true, createdAt: true });\n\nexport const insertVideoPlayerTagSchema = createInsertSchema(videoPlayerTags).omit({ id: true, createdAt: true });\n\nexport const insertPlayerInternationalRecordSchema = createInsertSchema(playerInternationalRecords).omit({ id: true, createdAt: true, updatedAt: true });\n\nexport const insertTeamSheetSchema = createInsertSchema(teamSheets).omit({ id: true, createdAt: true, updatedAt: true });\n\nexport const insertTeamSheetPlayerSchema = createInsertSchema(teamSheetPlayers).omit({ id: true, createdAt: true });\n\nexport const insertPlayerDocumentSchema = createInsertSchema(playerDocuments).omit({ id: true, uploadedAt: true });\n\nexport const insertFederationLetterRequestSchema = createInsertSchema(federationLetterRequests).omit({ id: true, createdAt: true, updatedAt: true });\n\nexport const insertScoutShortlistSchema = createInsertSchema(scoutShortlists).omit({ id: true, addedAt: true, updatedAt: true });\n\nexport const federationProfiles = pgTable(\"federation_profiles\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  name: text(\"name\").notNull(),\n  country: text(\"country\").notNull(),\n  region: text(\"region\"),\n  contactEmail: text(\"contact_email\"),\n  contactPhone: text(\"contact_phone\"),\n  address: text(\"address\"),\n  website: text(\"website\"),\n  logoUrl: text(\"logo_url\"),\n  defaultFee: doublePrecision(\"default_fee\").default(150),\n  platformServiceCharge: doublePrecision(\"platform_service_charge\").default(25),\n  isActive: boolean(\"is_active\").default(true),\n  totalDocumentsProcessed: integer(\"total_documents_processed\").default(0),\n  totalRevenueReceived: doublePrecision(\"total_revenue_received\").default(0),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\nexport const federationFeeSchedules = pgTable(\"federation_fee_schedules\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  federationId: varchar(\"federation_id\").notNull(),\n  country: text(\"country\").notNull(),\n  region: text(\"region\"),\n  baseFee: doublePrecision(\"base_fee\").notNull(),\n  platformServiceCharge: doublePrecision(\"platform_service_charge\").default(25),\n  currency: text(\"currency\").default(\"USD\"),\n  effectiveFrom: timestamp(\"effective_from\").defaultNow(),\n  effectiveTo: timestamp(\"effective_to\"),\n  isActive: boolean(\"is_active\").default(true),\n  notes: text(\"notes\"),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\nexport const federationRequestActivities = pgTable(\"federation_request_activities\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  requestId: varchar(\"request_id\").notNull(),\n  federationId: varchar(\"federation_id\"),\n  actorId: varchar(\"actor_id\"),\n  actorName: text(\"actor_name\"),\n  actorRole: text(\"actor_role\"),\n  activityType: text(\"activity_type\").notNull(),\n  description: text(\"description\"),\n  previousStatus: text(\"previous_status\"),\n  newStatus: text(\"new_status\"),\n  metadata: jsonb(\"metadata\"),\n  timestamp: timestamp(\"timestamp\").defaultNow(),\n});\n\nexport const federationRequestMessages = pgTable(\"federation_request_messages\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  requestId: varchar(\"request_id\").notNull(),\n  senderId: varchar(\"sender_id\").notNull(),\n  senderName: text(\"sender_name\").notNull(),\n  senderRole: text(\"sender_role\").notNull(),\n  senderPortal: text(\"sender_portal\").notNull(),\n  recipientPortal: text(\"recipient_portal\").notNull(),\n  subject: text(\"subject\"),\n  content: text(\"content\").notNull(),\n  attachmentStorageKey: text(\"attachment_storage_key\"),\n  attachmentOriginalName: text(\"attachment_original_name\"),\n  isRead: boolean(\"is_read\").default(false),\n  readAt: timestamp(\"read_at\"),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\nexport const federationIssuedDocuments = pgTable(\"federation_issued_documents\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  requestId: varchar(\"request_id\").notNull(),\n  documentType: text(\"document_type\").notNull(),\n  documentNumber: text(\"document_number\"),\n  storageKey: text(\"storage_key\").notNull(),\n  objectPath: text(\"object_path\"),\n  originalName: text(\"original_name\").notNull(),\n  mimeType: text(\"mime_type\"),\n  fileSize: integer(\"file_size\"),\n  issuedBy: varchar(\"issued_by\").notNull(),\n  issuedByName: text(\"issued_by_name\"),\n  validFrom: timestamp(\"valid_from\").defaultNow(),\n  validTo: timestamp(\"valid_to\"),\n  notes: text(\"notes\"),\n  downloadCount: integer(\"download_count\").default(0),\n  lastDownloadedAt: timestamp(\"last_downloaded_at\"),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\nexport const insertFederationProfileSchema = createInsertSchema(federationProfiles).omit({ id: true, createdAt: true, updatedAt: true });\nexport const insertFederationFeeScheduleSchema = createInsertSchema(federationFeeSchedules).omit({ id: true, createdAt: true, updatedAt: true });\nexport const insertFederationRequestActivitySchema = createInsertSchema(federationRequestActivities).omit({ id: true, timestamp: true });\nexport const insertFederationRequestMessageSchema = createInsertSchema(federationRequestMessages).omit({ id: true, createdAt: true });\nexport const insertFederationIssuedDocumentSchema = createInsertSchema(federationIssuedDocuments).omit({ id: true, createdAt: true });\n\nexport type InsertUser = z.infer<typeof insertUserSchema>;\nexport type User = typeof users.$inferSelect;\nexport type InsertTeam = z.infer<typeof insertTeamSchema>;\nexport type Team = typeof teams.$inferSelect;\nexport type InsertClub = z.infer<typeof insertClubSchema>;\nexport type Club = typeof clubs.$inferSelect;\nexport type InsertPlayer = z.infer<typeof insertPlayerSchema>;\nexport type Player = typeof players.$inferSelect;\nexport type InsertPlayerMetrics = z.infer<typeof insertPlayerMetricsSchema>;\nexport type PlayerMetrics = typeof playerMetrics.$inferSelect;\nexport type InsertMedicalRecord = z.infer<typeof insertMedicalRecordSchema>;\nexport type MedicalRecord = typeof medicalRecords.$inferSelect;\nexport type InsertBiometricData = z.infer<typeof insertBiometricDataSchema>;\nexport type BiometricData = typeof biometricData.$inferSelect;\nexport type InsertVideo = z.infer<typeof insertVideoSchema>;\nexport type Video = typeof videos.$inferSelect;\nexport type InsertVideoInsights = z.infer<typeof insertVideoInsightsSchema>;\nexport type VideoInsights = typeof videoInsights.$inferSelect;\nexport type InsertVisaRule = z.infer<typeof insertVisaRuleSchema>;\nexport type VisaRule = typeof visaRules.$inferSelect;\nexport type InsertEligibilityScore = z.infer<typeof insertEligibilityScoreSchema>;\nexport type EligibilityScore = typeof eligibilityScores.$inferSelect;\nexport type InsertTransferEligibilityAssessment = z.infer<typeof insertTransferEligibilityAssessmentSchema>;\nexport type TransferEligibilityAssessment = typeof transferEligibilityAssessments.$inferSelect;\nexport type InsertTransferReport = z.infer<typeof insertTransferReportSchema>;\nexport type TransferReport = typeof transferReports.$inferSelect;\nexport type InsertComplianceOrder = z.infer<typeof insertComplianceOrderSchema>;\nexport type ComplianceOrder = typeof complianceOrders.$inferSelect;\nexport type InsertComplianceDocument = z.infer<typeof insertComplianceDocumentSchema>;\nexport type ComplianceDocument = typeof complianceDocuments.$inferSelect;\nexport type InsertEmbassyVerification = z.infer<typeof insertEmbassyVerificationSchema>;\nexport type EmbassyVerification = typeof embassyVerifications.$inferSelect;\nexport type InsertScoutingInquiry = z.infer<typeof insertScoutingInquirySchema>;\nexport type ScoutingInquiry = typeof scoutingInquiries.$inferSelect;\nexport type InsertPayment = z.infer<typeof insertPaymentSchema>;\nexport type Payment = typeof payments.$inferSelect;\nexport type InsertEmbassyProfile = z.infer<typeof insertEmbassyProfileSchema>;\nexport type EmbassyProfile = typeof embassyProfiles.$inferSelect;\nexport type InsertInvitationLetter = z.infer<typeof insertInvitationLetterSchema>;\nexport type InvitationLetter = typeof invitationLetters.$inferSelect;\nexport type InsertConsularReport = z.infer<typeof insertConsularReportSchema>;\nexport type ConsularReport = typeof consularReports.$inferSelect;\nexport type InsertConversation = z.infer<typeof insertConversationSchema>;\nexport type Conversation = typeof conversations.$inferSelect;\nexport type InsertConversationParticipant = z.infer<typeof insertConversationParticipantSchema>;\nexport type ConversationParticipant = typeof conversationParticipants.$inferSelect;\nexport type InsertMessage = z.infer<typeof insertMessageSchema>;\nexport type Message = typeof messages.$inferSelect;\nexport type InsertEmbassyDocumentAccess = z.infer<typeof insertEmbassyDocumentAccessSchema>;\nexport type EmbassyDocumentAccess = typeof embassyDocumentAccess.$inferSelect;\nexport type InsertSharedVideo = z.infer<typeof insertSharedVideoSchema>;\nexport type SharedVideo = typeof sharedVideos.$inferSelect;\nexport type InsertVideoTag = z.infer<typeof insertVideoTagSchema>;\nexport type VideoTag = typeof videoTags.$inferSelect;\nexport type InsertActionLog = z.infer<typeof insertActionLogSchema>;\nexport type ActionLog = typeof actionLogs.$inferSelect;\nexport type InsertTransferTarget = z.infer<typeof insertTransferTargetSchema>;\nexport type TransferTarget = typeof transferTargets.$inferSelect;\nexport type InsertVideoPlayerTag = z.infer<typeof insertVideoPlayerTagSchema>;\nexport type VideoPlayerTag = typeof videoPlayerTags.$inferSelect;\nexport type InsertPlayerInternationalRecord = z.infer<typeof insertPlayerInternationalRecordSchema>;\nexport type PlayerInternationalRecord = typeof playerInternationalRecords.$inferSelect;\nexport type InsertTeamSheet = z.infer<typeof insertTeamSheetSchema>;\nexport type TeamSheet = typeof teamSheets.$inferSelect;\nexport type InsertTeamSheetPlayer = z.infer<typeof insertTeamSheetPlayerSchema>;\nexport type TeamSheetPlayer = typeof teamSheetPlayers.$inferSelect;\nexport type InsertPlayerDocument = z.infer<typeof insertPlayerDocumentSchema>;\nexport type PlayerDocument = typeof playerDocuments.$inferSelect;\nexport type InsertFederationLetterRequest = z.infer<typeof insertFederationLetterRequestSchema>;\nexport type FederationLetterRequest = typeof federationLetterRequests.$inferSelect;\nexport type InsertFederationProfile = z.infer<typeof insertFederationProfileSchema>;\nexport type FederationProfile = typeof federationProfiles.$inferSelect;\nexport type InsertFederationFeeSchedule = z.infer<typeof insertFederationFeeScheduleSchema>;\nexport type FederationFeeSchedule = typeof federationFeeSchedules.$inferSelect;\nexport type InsertFederationRequestActivity = z.infer<typeof insertFederationRequestActivitySchema>;\nexport type FederationRequestActivity = typeof federationRequestActivities.$inferSelect;\nexport type InsertFederationRequestMessage = z.infer<typeof insertFederationRequestMessageSchema>;\nexport type FederationRequestMessage = typeof federationRequestMessages.$inferSelect;\nexport type InsertFederationIssuedDocument = z.infer<typeof insertFederationIssuedDocumentSchema>;\nexport type FederationIssuedDocument = typeof federationIssuedDocuments.$inferSelect;\nexport type InsertScoutShortlist = z.infer<typeof insertScoutShortlistSchema>;\nexport type ScoutShortlist = typeof scoutShortlists.$inferSelect;\n\n// Token System Tables\nexport const tokenBalances = pgTable(\"token_balances\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  userId: varchar(\"user_id\").notNull().unique(),\n  balance: integer(\"balance\").notNull().default(0),\n  lifetimePurchased: integer(\"lifetime_purchased\").notNull().default(0),\n  lifetimeSpent: integer(\"lifetime_spent\").notNull().default(0),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\nexport const tokenTransactions = pgTable(\"token_transactions\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  userId: varchar(\"user_id\").notNull(),\n  amount: integer(\"amount\").notNull(),\n  type: text(\"type\").notNull(), // 'credit' | 'debit'\n  action: text(\"action\").notNull(), // 'purchase', 'welcome_bonus', 'view_profile', 'shortlist', 'video_analysis', 'watch_video', 'contact_request', 'expired'\n  description: text(\"description\"),\n  playerId: varchar(\"player_id\"),\n  videoId: varchar(\"video_id\"),\n  packId: varchar(\"pack_id\"),\n  balanceAfter: integer(\"balance_after\").notNull(),\n  expiresAt: timestamp(\"expires_at\"),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\nexport const tokenPacks = pgTable(\"token_packs\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  name: text(\"name\").notNull(),\n  tokens: integer(\"tokens\").notNull(),\n  priceUsd: integer(\"price_usd\").notNull(), // stored in cents\n  description: text(\"description\"),\n  isActive: boolean(\"is_active\").default(true),\n  sortOrder: integer(\"sort_order\").default(0),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\nexport const tokenPurchases = pgTable(\"token_purchases\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  userId: varchar(\"user_id\").notNull(),\n  packId: varchar(\"pack_id\").notNull(),\n  tokens: integer(\"tokens\").notNull(),\n  amountPaid: integer(\"amount_paid\").notNull(), // in cents\n  currency: text(\"currency\").default(\"USD\"),\n  paymentMethod: text(\"payment_method\"),\n  paymentReference: text(\"payment_reference\"),\n  status: text(\"status\").notNull().default(\"pending\"), // 'pending', 'completed', 'failed', 'refunded'\n  expiresAt: timestamp(\"expires_at\").notNull(),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\nexport const insertTokenBalanceSchema = createInsertSchema(tokenBalances).omit({ id: true, createdAt: true, updatedAt: true });\nexport const insertTokenTransactionSchema = createInsertSchema(tokenTransactions).omit({ id: true, createdAt: true });\nexport const insertTokenPackSchema = createInsertSchema(tokenPacks).omit({ id: true, createdAt: true });\nexport const insertTokenPurchaseSchema = createInsertSchema(tokenPurchases).omit({ id: true, createdAt: true });\n\nexport type InsertTokenBalance = z.infer<typeof insertTokenBalanceSchema>;\nexport type TokenBalance = typeof tokenBalances.$inferSelect;\nexport type InsertTokenTransaction = z.infer<typeof insertTokenTransactionSchema>;\nexport type TokenTransaction = typeof tokenTransactions.$inferSelect;\nexport type InsertTokenPack = z.infer<typeof insertTokenPackSchema>;\nexport type TokenPack = typeof tokenPacks.$inferSelect;\nexport type InsertTokenPurchase = z.infer<typeof insertTokenPurchaseSchema>;\nexport type TokenPurchase = typeof tokenPurchases.$inferSelect;\n","path":null,"size_bytes":45249,"size_tokens":null},"client/src/components/VideoUpload.tsx":{"content":"import { useState, useCallback } from \"react\";\nimport { useDropzone } from \"react-dropzone\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Progress } from \"@/components/ui/progress\";\nimport { Upload, Video, X, Link2, Loader2 } from \"lucide-react\";\nimport type { Player } from \"@shared/schema\";\n\ninterface VideoUploadProps {\n  players: Player[];\n  onUpload?: (data: {\n    title: string;\n    matchDate?: string;\n    source: string;\n    playerId: string;\n    competition?: string;\n    opponent?: string;\n    duration?: string;\n    minutesPlayed?: number;\n    fileUrl?: string;\n  }) => void;\n  onIntegrationConnect?: (source: string) => void;\n  isUploading?: boolean;\n}\n\nexport default function VideoUpload({ players, onUpload, onIntegrationConnect, isUploading }: VideoUploadProps) {\n  const [uploadedFile, setUploadedFile] = useState<File | null>(null);\n  const [fileUrl, setFileUrl] = useState(\"\");\n  const [title, setTitle] = useState(\"\");\n  const [matchDate, setMatchDate] = useState(\"\");\n  const [source, setSource] = useState(\"manual\");\n  const [playerId, setPlayerId] = useState(\"\");\n  const [competition, setCompetition] = useState(\"\");\n  const [opponent, setOpponent] = useState(\"\");\n  const [duration, setDuration] = useState(\"\");\n  const [minutesPlayed, setMinutesPlayed] = useState(\"90\");\n  const [uploadProgress, setUploadProgress] = useState(0);\n  const [isFileUploading, setIsFileUploading] = useState(false);\n\n  const onDrop = useCallback((acceptedFiles: File[]) => {\n    if (acceptedFiles.length > 0) {\n      setUploadedFile(acceptedFiles[0]);\n      setTitle(acceptedFiles[0].name.replace(/\\.[^/.]+$/, \"\"));\n    }\n  }, []);\n\n  const { getRootProps, getInputProps, isDragActive } = useDropzone({\n    onDrop,\n    accept: { \"video/*\": [\".mp4\", \".mov\", \".avi\", \".mkv\", \".webm\"] },\n    maxFiles: 1,\n  });\n\n  const uploadFileToStorage = async (file: File): Promise<string> => {\n    setUploadProgress(10);\n    \n    const response = await fetch(\"/api/uploads/request-url\", {\n      method: \"POST\",\n      headers: { \"Content-Type\": \"application/json\" },\n      body: JSON.stringify({\n        name: file.name,\n        size: file.size,\n        contentType: file.type || \"video/mp4\",\n      }),\n    });\n\n    if (!response.ok) {\n      throw new Error(\"Failed to get upload URL\");\n    }\n\n    const { uploadURL, objectPath } = await response.json();\n    setUploadProgress(30);\n\n    const uploadResponse = await fetch(uploadURL, {\n      method: \"PUT\",\n      body: file,\n      headers: { \"Content-Type\": file.type || \"video/mp4\" },\n    });\n\n    if (!uploadResponse.ok) {\n      throw new Error(\"Failed to upload file\");\n    }\n\n    setUploadProgress(100);\n    return objectPath;\n  };\n\n  const handleSubmit = async () => {\n    if (!title || !playerId) return;\n\n    try {\n      setIsFileUploading(true);\n      let videoUrl = fileUrl || undefined;\n\n      if (uploadedFile) {\n        videoUrl = await uploadFileToStorage(uploadedFile);\n      }\n\n      onUpload?.({\n        title,\n        matchDate: matchDate || undefined,\n        source,\n        playerId,\n        competition: competition || undefined,\n        opponent: opponent || undefined,\n        duration: duration || undefined,\n        minutesPlayed: parseInt(minutesPlayed) || 90,\n        fileUrl: videoUrl,\n      });\n\n      setUploadedFile(null);\n      setFileUrl(\"\");\n      setTitle(\"\");\n      setMatchDate(\"\");\n      setPlayerId(\"\");\n      setCompetition(\"\");\n      setOpponent(\"\");\n      setDuration(\"\");\n      setMinutesPlayed(\"90\");\n      setUploadProgress(0);\n    } catch (error) {\n      console.error(\"Upload failed:\", error);\n    } finally {\n      setIsFileUploading(false);\n    }\n  };\n\n  const integrations = [\n    { id: \"wyscout\", name: \"Wyscout\" },\n    { id: \"transfermarkt\", name: \"Transfermarkt\" },\n    { id: \"veo\", name: \"Veo Cameras\" },\n  ];\n\n  const isSubmitting = isUploading || isFileUploading;\n\n  return (\n    <Card data-testid=\"card-video-upload\">\n      <CardHeader className=\"pb-4\">\n        <CardTitle className=\"text-lg flex items-center gap-2\">\n          <Video className=\"h-5 w-5\" />\n          Add Video\n        </CardTitle>\n      </CardHeader>\n      <CardContent className=\"space-y-4\">\n        <div\n          {...getRootProps()}\n          className={`border-2 border-dashed rounded-md p-6 text-center cursor-pointer transition-colors ${\n            isDragActive ? \"border-primary bg-primary/5\" : \"border-muted-foreground/25 hover:border-primary/50\"\n          }`}\n          data-testid=\"dropzone-video\"\n        >\n          <input {...getInputProps()} data-testid=\"input-video-file\" />\n          {uploadedFile ? (\n            <div className=\"flex items-center justify-center gap-2\">\n              <Video className=\"h-6 w-6 text-primary\" />\n              <span className=\"font-medium text-sm truncate max-w-[200px]\">{uploadedFile.name}</span>\n              <Button \n                size=\"icon\" \n                variant=\"ghost\" \n                onClick={(e) => { e.stopPropagation(); setUploadedFile(null); }}\n              >\n                <X className=\"h-4 w-4\" />\n              </Button>\n            </div>\n          ) : (\n            <div className=\"space-y-1\">\n              <Upload className=\"h-8 w-8 mx-auto text-muted-foreground\" />\n              <p className=\"text-sm text-muted-foreground\">\n                {isDragActive ? \"Drop video here\" : \"Drop video or click to browse\"}\n              </p>\n            </div>\n          )}\n        </div>\n\n        {isFileUploading && uploadProgress > 0 && (\n          <div className=\"space-y-2\">\n            <Progress value={uploadProgress} className=\"h-2\" />\n            <p className=\"text-xs text-center text-muted-foreground\">\n              Uploading video... {uploadProgress}%\n            </p>\n          </div>\n        )}\n\n        <div className=\"flex items-center gap-2 text-xs text-muted-foreground\">\n          <div className=\"flex-1 h-px bg-border\" />\n          <span>or paste video URL</span>\n          <div className=\"flex-1 h-px bg-border\" />\n        </div>\n\n        <div className=\"space-y-2\">\n          <Label htmlFor=\"video-url\">Video URL</Label>\n          <Input \n            id=\"video-url\" \n            value={fileUrl} \n            onChange={(e) => setFileUrl(e.target.value)}\n            placeholder=\"https://example.com/video.mp4\"\n            data-testid=\"input-video-url\"\n            disabled={!!uploadedFile}\n          />\n          <p className=\"text-xs text-muted-foreground\">\n            Paste a direct link to an MP4 video file\n          </p>\n        </div>\n\n        <div className=\"space-y-3\">\n          <div className=\"space-y-2\">\n            <Label htmlFor=\"video-title\">Title *</Label>\n            <Input \n              id=\"video-title\" \n              value={title} \n              onChange={(e) => setTitle(e.target.value)}\n              placeholder=\"Match title or description\"\n              data-testid=\"input-video-title\"\n            />\n          </div>\n\n          <div className=\"space-y-2\">\n            <Label htmlFor=\"player-select\">Primary Player *</Label>\n            <Select value={playerId} onValueChange={setPlayerId}>\n              <SelectTrigger id=\"player-select\" data-testid=\"select-primary-player\">\n                <SelectValue placeholder=\"Select player\" />\n              </SelectTrigger>\n              <SelectContent>\n                {players.map((player) => (\n                  <SelectItem key={player.id} value={player.id}>\n                    {player.firstName} {player.lastName} - {player.position}\n                  </SelectItem>\n                ))}\n              </SelectContent>\n            </Select>\n          </div>\n\n          <div className=\"grid grid-cols-2 gap-3\">\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"competition\">Competition</Label>\n              <Input \n                id=\"competition\" \n                value={competition} \n                onChange={(e) => setCompetition(e.target.value)}\n                placeholder=\"e.g. Premier League\"\n                data-testid=\"input-competition\"\n              />\n            </div>\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"opponent\">Opponent</Label>\n              <Input \n                id=\"opponent\" \n                value={opponent} \n                onChange={(e) => setOpponent(e.target.value)}\n                placeholder=\"e.g. Manchester United\"\n                data-testid=\"input-opponent\"\n              />\n            </div>\n          </div>\n\n          <div className=\"grid grid-cols-2 gap-3\">\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"match-date\">Match Date</Label>\n              <Input \n                id=\"match-date\" \n                type=\"date\" \n                value={matchDate} \n                onChange={(e) => setMatchDate(e.target.value)}\n                data-testid=\"input-match-date\"\n              />\n            </div>\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"duration\">Duration</Label>\n              <Input \n                id=\"duration\" \n                value={duration} \n                onChange={(e) => setDuration(e.target.value)}\n                placeholder=\"e.g. 90 min\"\n                data-testid=\"input-duration\"\n              />\n            </div>\n          </div>\n\n          <Button \n            className=\"w-full\" \n            onClick={handleSubmit} \n            disabled={!title || !playerId || isSubmitting}\n            data-testid=\"button-save-video\"\n          >\n            {isSubmitting ? (\n              <>\n                <Loader2 className=\"h-4 w-4 mr-2 animate-spin\" />\n                {isFileUploading ? \"Uploading Video...\" : \"Saving...\"}\n              </>\n            ) : (\n              <>\n                <Upload className=\"h-4 w-4 mr-2\" />\n                Upload & Save Video\n              </>\n            )}\n          </Button>\n        </div>\n\n        <div className=\"border-t pt-4\">\n          <p className=\"text-sm font-medium mb-3\">Import from Partners</p>\n          <div className=\"grid grid-cols-3 gap-2\">\n            {integrations.map((integration) => (\n              <Button\n                key={integration.id}\n                variant=\"outline\"\n                size=\"sm\"\n                onClick={() => onIntegrationConnect?.(integration.id)}\n                data-testid={`button-connect-${integration.id}`}\n              >\n                <Link2 className=\"h-3 w-3 mr-1\" />\n                {integration.name}\n              </Button>\n            ))}\n          </div>\n        </div>\n      </CardContent>\n    </Card>\n  );\n}\n","path":null,"size_bytes":10805,"size_tokens":null},"client/src/components/StatsCard.tsx":{"content":"import { Card, CardContent } from \"@/components/ui/card\";\nimport { TrendingUp, TrendingDown } from \"lucide-react\";\nimport type { LucideIcon } from \"lucide-react\";\n\ninterface StatsCardProps {\n  title: string;\n  value: number | string;\n  icon: LucideIcon;\n  trend?: number;\n  description?: string;\n}\n\nexport default function StatsCard({ title, value, icon: Icon, trend, description }: StatsCardProps) {\n  return (\n    <Card data-testid={`card-stat-${title.toLowerCase().replace(/\\s+/g, \"-\")}`}>\n      <CardContent className=\"p-6\">\n        <div className=\"flex items-center justify-between gap-4\">\n          <div className=\"flex-1 min-w-0\">\n            <p className=\"text-sm font-medium text-muted-foreground uppercase tracking-wide truncate\">\n              {title}\n            </p>\n            <p className=\"text-2xl font-semibold mt-1\">{value}</p>\n            {description && (\n              <p className=\"text-xs text-muted-foreground mt-1\">{description}</p>\n            )}\n          </div>\n          <div className=\"flex flex-col items-end gap-2\">\n            <div className=\"p-2 bg-muted rounded-md\">\n              <Icon className=\"h-5 w-5 text-muted-foreground\" />\n            </div>\n            {trend !== undefined && (\n              <div className={`flex items-center gap-1 text-xs ${trend >= 0 ? \"text-green-600 dark:text-green-400\" : \"text-red-600 dark:text-red-400\"}`}>\n                {trend >= 0 ? <TrendingUp className=\"h-3 w-3\" /> : <TrendingDown className=\"h-3 w-3\" />}\n                <span>{Math.abs(trend)}%</span>\n              </div>\n            )}\n          </div>\n        </div>\n      </CardContent>\n    </Card>\n  );\n}\n","path":null,"size_bytes":1640,"size_tokens":null},"client/src/components/examples/StatsCard.tsx":{"content":"import StatsCard from \"../StatsCard\";\nimport { Users, FileCheck, AlertTriangle, TrendingUp } from \"lucide-react\";\n\nexport default function StatsCardExample() {\n  return (\n    <div className=\"grid grid-cols-2 gap-4\">\n      <StatsCard title=\"Total Players\" value={48} icon={Users} trend={12} />\n      <StatsCard title=\"Reports\" value={34} icon={FileCheck} trend={-5} description=\"This month\" />\n      <StatsCard title=\"Pending\" value={5} icon={AlertTriangle} />\n      <StatsCard title=\"Inquiries\" value={12} icon={TrendingUp} trend={8} />\n    </div>\n  );\n}\n","path":null,"size_bytes":555,"size_tokens":null},"client/src/hooks/use-auth.ts":{"content":"import { useQuery } from \"@tanstack/react-query\";\nimport type { User } from \"@shared/models/auth\";\n\nasync function fetchUser(): Promise<User | null> {\n  const response = await fetch(\"/api/auth/user\", {\n    credentials: \"include\",\n  });\n\n  if (response.status === 401) {\n    return null;\n  }\n\n  if (!response.ok) {\n    throw new Error(`${response.status}: ${response.statusText}`);\n  }\n\n  return response.json();\n}\n\nexport function useAuth() {\n  const { data: user, isLoading } = useQuery<User | null>({\n    queryKey: [\"/api/auth/user\"],\n    queryFn: fetchUser,\n    retry: false,\n    staleTime: 1000 * 60 * 5, // 5 minutes\n  });\n\n  return {\n    user,\n    isLoading,\n    isAuthenticated: !!user,\n  };\n}\n","path":null,"size_bytes":701,"size_tokens":null},"client/src/components/examples/PlayerCard.tsx":{"content":"import PlayerCard from \"../PlayerCard\";\nimport { mockPlayers } from \"@/lib/mock-data\";\n\nexport default function PlayerCardExample() {\n  return (\n    <div className=\"max-w-sm\">\n      <PlayerCard \n        player={mockPlayers[0]} \n        onViewProfile={(id) => console.log(\"View player\", id)}\n        onGenerateReport={(id) => console.log(\"Generate report\", id)}\n      />\n    </div>\n  );\n}\n","path":null,"size_bytes":388,"size_tokens":null},"client/src/components/ui/switch.tsx":{"content":"import * as React from \"react\"\nimport * as SwitchPrimitives from \"@radix-ui/react-switch\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Switch = React.forwardRef<\n  React.ElementRef<typeof SwitchPrimitives.Root>,\n  React.ComponentPropsWithoutRef<typeof SwitchPrimitives.Root>\n>(({ className, ...props }, ref) => (\n  <SwitchPrimitives.Root\n    className={cn(\n      \"peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  >\n    <SwitchPrimitives.Thumb\n      className={cn(\n        \"pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0\"\n      )}\n    />\n  </SwitchPrimitives.Root>\n))\nSwitch.displayName = SwitchPrimitives.Root.displayName\n\nexport { Switch }\n","path":null,"size_bytes":1139,"size_tokens":null},"client/src/pages/embassy-dashboard.tsx":{"content":"import { useQuery } from \"@tanstack/react-query\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Button } from \"@/components/ui/button\";\nimport { ScrollArea } from \"@/components/ui/scroll-area\";\nimport { Separator } from \"@/components/ui/separator\";\nimport { Link } from \"wouter\";\nimport { FileText, User, Calendar, Shield, Eye, Download, Clock } from \"lucide-react\";\nimport { LoadingSpinner } from \"@/components/LoadingScreen\";\nimport type { ComplianceDocument, Player, EmbassyVerification } from \"@shared/schema\";\nimport logoImage from \"@assets/WhatsApp_Image_2025-12-17_at_12.49.33_1766008177672.jpeg\";\n\ninterface DocumentWithDetails extends ComplianceDocument {\n  player: Player;\n  verification: EmbassyVerification;\n}\n\nexport default function EmbassyDashboard() {\n  const { data: authData } = useQuery<{ user: any; embassyProfile: any }>({\n    queryKey: [\"/api/auth/me\"],\n  });\n\n  const { data: documents = [], isLoading } = useQuery<DocumentWithDetails[]>({\n    queryKey: [\"/api/embassy/documents\"],\n  });\n\n  const pendingDocs = documents.filter(d => d.verification?.status === \"pending\");\n  const verifiedDocs = documents.filter(d => d.verification?.status === \"verified\");\n\n  if (isLoading) {\n    return (\n      <div className=\"flex items-center justify-center h-full\">\n        <LoadingSpinner size=\"lg\" />\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"p-6 space-y-6\">\n      <div className=\"flex items-center gap-4\">\n        <img \n          src={logoImage} \n          alt=\"Sports Reels\" \n          className=\"h-12 w-12 object-contain rounded-md\"\n        />\n        <div>\n          <h1 className=\"text-2xl font-bold\" data-testid=\"text-page-title\">Embassy Document Portal</h1>\n          <p className=\"text-muted-foreground\">\n            View-only access to player compliance documents for {authData?.embassyProfile?.country || \"your jurisdiction\"}\n          </p>\n        </div>\n      </div>\n\n      <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\n        <Card>\n          <CardHeader className=\"pb-2\">\n            <CardTitle className=\"text-sm font-medium text-muted-foreground\">Total Documents</CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-3xl font-bold\">{documents.length}</div>\n          </CardContent>\n        </Card>\n        <Card>\n          <CardHeader className=\"pb-2\">\n            <CardTitle className=\"text-sm font-medium text-muted-foreground\">Pending Review</CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-3xl font-bold text-yellow-600\">{pendingDocs.length}</div>\n          </CardContent>\n        </Card>\n        <Card>\n          <CardHeader className=\"pb-2\">\n            <CardTitle className=\"text-sm font-medium text-muted-foreground\">Verified</CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-3xl font-bold text-green-600\">{verifiedDocs.length}</div>\n          </CardContent>\n        </Card>\n      </div>\n\n      <div className=\"space-y-4\">\n        <h2 className=\"text-lg font-semibold\">Documents for Verification</h2>\n        \n        {documents.length === 0 ? (\n          <Card>\n            <CardContent className=\"py-12 text-center\">\n              <FileText className=\"h-12 w-12 text-muted-foreground mx-auto mb-4\" />\n              <p className=\"text-muted-foreground\">No documents available for your jurisdiction.</p>\n            </CardContent>\n          </Card>\n        ) : (\n          <div className=\"grid gap-4\">\n            {documents.map((doc) => (\n              <Card key={doc.id} data-testid={`card-document-${doc.id}`}>\n                <CardHeader>\n                  <div className=\"flex items-start justify-between gap-4 flex-wrap\">\n                    <div className=\"flex items-center gap-3\">\n                      <div className=\"h-10 w-10 rounded-full bg-primary/10 flex items-center justify-center\">\n                        <User className=\"h-5 w-5 text-primary\" />\n                      </div>\n                      <div>\n                        <CardTitle className=\"text-base\">\n                          {doc.player?.firstName} {doc.player?.lastName}\n                        </CardTitle>\n                        <CardDescription>{doc.player?.nationality} - {doc.player?.position}</CardDescription>\n                      </div>\n                    </div>\n                    <Badge \n                      variant={doc.verification?.status === \"verified\" ? \"default\" : \"secondary\"}\n                      className={doc.verification?.status === \"verified\" \n                        ? \"bg-green-500/10 text-green-600 border-green-200\" \n                        : \"bg-yellow-500/10 text-yellow-600 border-yellow-200\"\n                      }\n                    >\n                      {doc.verification?.status === \"verified\" ? \"Verified\" : \"Pending Review\"}\n                    </Badge>\n                  </div>\n                </CardHeader>\n                <CardContent className=\"space-y-4\">\n                  <div className=\"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm\">\n                    <div>\n                      <p className=\"text-muted-foreground\">Document Type</p>\n                      <p className=\"font-medium\">{doc.documentType?.replace(/_/g, \" \").toUpperCase()}</p>\n                    </div>\n                    <div>\n                      <p className=\"text-muted-foreground\">Generated</p>\n                      <p className=\"font-medium\">\n                        {doc.generatedAt ? new Date(doc.generatedAt).toLocaleDateString() : \"N/A\"}\n                      </p>\n                    </div>\n                    <div>\n                      <p className=\"text-muted-foreground\">Data Range</p>\n                      <p className=\"font-medium\">\n                        {doc.dataRangeStart && doc.dataRangeEnd \n                          ? `${new Date(doc.dataRangeStart).toLocaleDateString()} - ${new Date(doc.dataRangeEnd).toLocaleDateString()}`\n                          : \"N/A\"\n                        }\n                      </p>\n                    </div>\n                    <div>\n                      <p className=\"text-muted-foreground\">Verification Code</p>\n                      <p className=\"font-medium font-mono\">{doc.verification?.verificationCode || \"Pending\"}</p>\n                    </div>\n                  </div>\n\n                  <Separator />\n\n                  <div className=\"flex items-center justify-between gap-2 flex-wrap\">\n                    <div className=\"flex items-center gap-2 text-sm text-muted-foreground\">\n                      <Shield className=\"h-4 w-4\" />\n                      <span>All access is logged and timestamped</span>\n                    </div>\n                    <Link href={`/embassy/document/${doc.id}`}>\n                      <Button variant=\"outline\" size=\"sm\" data-testid={`button-view-document-${doc.id}`}>\n                        <Eye className=\"mr-2 h-4 w-4\" />\n                        View Document\n                      </Button>\n                    </Link>\n                  </div>\n                </CardContent>\n              </Card>\n            ))}\n          </div>\n        )}\n      </div>\n    </div>\n  );\n}\n","path":null,"size_bytes":7286,"size_tokens":null},"client/src/App.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { Switch, Route, useLocation } from \"wouter\";\nimport { queryClient } from \"./lib/queryClient\";\nimport { QueryClientProvider } from \"@tanstack/react-query\";\nimport { Toaster } from \"@/components/ui/toaster\";\nimport { TooltipProvider } from \"@/components/ui/tooltip\";\nimport { SidebarProvider, SidebarTrigger } from \"@/components/ui/sidebar\";\nimport AppSidebar from \"@/components/AppSidebar\";\nimport ThemeToggle from \"@/components/ThemeToggle\";\nimport { Bell } from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\n\nimport Dashboard from \"@/pages/dashboard\";\nimport Players from \"@/pages/players\";\nimport PlayerProfile from \"@/pages/player-profile\";\nimport Videos from \"@/pages/videos\";\nimport Reports from \"@/pages/reports\";\nimport Scouting from \"@/pages/scouting\";\nimport Embassy from \"@/pages/embassy\";\nimport Access from \"@/pages/access\";\nimport NotFound from \"@/pages/not-found\";\nimport ScoutDashboard from \"@/pages/scout-dashboard\";\nimport EmbassyDashboard from \"@/pages/embassy-dashboard\";\nimport MessagesPage from \"@/pages/messages\";\nimport SettingsPage from \"@/pages/settings\";\nimport InvitationLettersPage from \"@/pages/invitation-letters\";\nimport EmbassyDocumentView from \"@/pages/embassy-document-view\";\nimport RolePicker from \"@/pages/role-picker\";\nimport TeamSheets from \"@/pages/team-sheets\";\nimport FederationLettersPage from \"@/pages/federation-letters\";\nimport FederationAdminPage from \"@/pages/federation-admin\";\nimport TokenBank from \"@/pages/token-bank\";\nimport TokenBalanceIndicator from \"@/components/TokenBalanceIndicator\";\n\nfunction TeamRouter() {\n  return (\n    <Switch>\n      <Route path=\"/\" component={Dashboard} />\n      <Route path=\"/players\" component={Players} />\n      <Route path=\"/players/:id\" component={PlayerProfile} />\n      <Route path=\"/videos\" component={Videos} />\n      <Route path=\"/reports\" component={Reports} />\n      <Route path=\"/scouting\" component={Scouting} />\n      <Route path=\"/embassy\" component={Embassy} />\n      <Route path=\"/access\" component={Access} />\n      <Route path=\"/messages\" component={MessagesPage} />\n      <Route path=\"/settings\" component={SettingsPage} />\n      <Route path=\"/invitation-letters\" component={InvitationLettersPage} />\n      <Route path=\"/team-sheets\" component={TeamSheets} />\n      <Route path=\"/federation-letters\" component={FederationLettersPage} />\n      <Route path=\"/federation-admin\" component={FederationAdminPage} />\n      <Route path=\"/token-bank\" component={TokenBank} />\n      <Route component={NotFound} />\n    </Switch>\n  );\n}\n\nfunction ScoutRouter() {\n  return (\n    <Switch>\n      <Route path=\"/\" component={ScoutDashboard} />\n      <Route path=\"/scout-dashboard\" component={ScoutDashboard} />\n      <Route path=\"/scout/player/:id\" component={PlayerProfile} />\n      <Route path=\"/messages\" component={MessagesPage} />\n      <Route path=\"/token-bank\" component={TokenBank} />\n      <Route component={NotFound} />\n    </Switch>\n  );\n}\n\nfunction EmbassyRouter() {\n  return (\n    <Switch>\n      <Route path=\"/\" component={EmbassyDashboard} />\n      <Route path=\"/embassy/document/:id\" component={EmbassyDocumentView} />\n      <Route component={NotFound} />\n    </Switch>\n  );\n}\n\nfunction FederationAdminRouter() {\n  return (\n    <Switch>\n      <Route path=\"/\" component={FederationAdminPage} />\n      <Route path=\"/federation-admin\" component={FederationAdminPage} />\n      <Route path=\"/settings\" component={SettingsPage} />\n      <Route component={NotFound} />\n    </Switch>\n  );\n}\n\nfunction Router({ userRole }: { userRole: string }) {\n  if (userRole === \"embassy\") {\n    return <EmbassyRouter />;\n  }\n  if (userRole === \"scout\" || userRole === \"agent\") {\n    return <ScoutRouter />;\n  }\n  if (userRole === \"federation_admin\") {\n    return <FederationAdminRouter />;\n  }\n  return <TeamRouter />;\n}\n\nfunction MainLayout({ userRole, onChangeRole }: { userRole: string; onChangeRole: () => void }) {\n  const sidebarStyle = {\n    \"--sidebar-width\": \"16rem\",\n    \"--sidebar-width-icon\": \"3rem\",\n  };\n\n  const roleDisplayName = userRole === \"sporting_director\" ? \"Sporting Director\" \n    : userRole === \"legal\" ? \"Legal Team\"\n    : userRole === \"scout\" ? \"Scout\"\n    : userRole === \"agent\" ? \"Agent\"\n    : userRole === \"coach\" ? \"Coach\"\n    : userRole === \"admin\" ? \"Administrator\"\n    : userRole === \"embassy\" ? \"Embassy Official\"\n    : userRole === \"federation_admin\" ? \"Federation Administrator\"\n    : \"User\";\n\n  const teamName = userRole === \"embassy\" ? \"Embassy Portal\" \n    : userRole === \"scout\" || userRole === \"agent\" ? \"Scout Network\"\n    : userRole === \"federation_admin\" ? \"Federation Admin Portal\"\n    : \"Demo Club FC\";\n\n  return (\n    <SidebarProvider style={sidebarStyle as React.CSSProperties}>\n      <div className=\"flex h-screen w-full\">\n        <AppSidebar userName=\"Demo User\" userRole={roleDisplayName} userRoleRaw={userRole} pendingVerifications={3} />\n        <div className=\"flex flex-col flex-1 overflow-hidden\">\n          <header className=\"flex items-center justify-between gap-4 p-3 border-b shrink-0\">\n            <div className=\"flex items-center gap-2\">\n              <SidebarTrigger data-testid=\"button-sidebar-toggle\" />\n              <span className=\"text-sm text-muted-foreground hidden md:inline\">\n                {teamName}\n              </span>\n            </div>\n            <div className=\"flex items-center gap-2\">\n              {(userRole === \"scout\" || userRole === \"agent\" || userRole === \"sporting_director\" || userRole === \"coach\") && (\n                <TokenBalanceIndicator />\n              )}\n              <Button \n                size=\"sm\" \n                variant=\"outline\" \n                onClick={onChangeRole}\n                data-testid=\"button-change-role\"\n              >\n                Switch Role\n              </Button>\n              <Button size=\"icon\" variant=\"ghost\" className=\"relative\" data-testid=\"button-notifications\">\n                <Bell className=\"h-4 w-4\" />\n                <Badge \n                  variant=\"secondary\" \n                  className=\"absolute -top-1 -right-1 h-4 w-4 p-0 flex items-center justify-center text-[10px] bg-red-500 text-white\"\n                >\n                  3\n                </Badge>\n              </Button>\n              <ThemeToggle />\n            </div>\n          </header>\n          <main className=\"flex-1 overflow-auto bg-muted/30\">\n            <Router userRole={userRole} />\n          </main>\n        </div>\n      </div>\n    </SidebarProvider>\n  );\n}\n\nfunction AppContent() {\n  const [, setLocation] = useLocation();\n  const [selectedRole, setSelectedRole] = useState<string | null>(() => {\n    return localStorage.getItem(\"sports-reels-role\");\n  });\n\n  const handleSelectRole = (role: string) => {\n    localStorage.setItem(\"sports-reels-role\", role);\n    setSelectedRole(role);\n    setLocation(\"/\");\n  };\n\n  const handleChangeRole = () => {\n    localStorage.removeItem(\"sports-reels-role\");\n    setSelectedRole(null);\n    setLocation(\"/\");\n  };\n\n  if (!selectedRole) {\n    return <RolePicker onSelectRole={handleSelectRole} />;\n  }\n\n  return <MainLayout userRole={selectedRole} onChangeRole={handleChangeRole} />;\n}\n\nfunction App() {\n  return (\n    <QueryClientProvider client={queryClient}>\n      <TooltipProvider>\n        <AppContent />\n        <Toaster />\n      </TooltipProvider>\n    </QueryClientProvider>\n  );\n}\n\nexport default App;\n","path":null,"size_bytes":7473,"size_tokens":null},"client/src/components/examples/EligibilityScoreCard.tsx":{"content":"import EligibilityScoreCard from \"../EligibilityScoreCard\";\n\nexport default function EligibilityScoreCardExample() {\n  return (\n    <div className=\"max-w-md\">\n      <EligibilityScoreCard \n        scores={{\n          schengen: 78,\n          ukGbe: 72,\n          usP1: 65,\n          usO1: 58,\n        }}\n      />\n    </div>\n  );\n}\n","path":null,"size_bytes":329,"size_tokens":null},"client/src/components/examples/EmbassyVerificationTable.tsx":{"content":"import EmbassyVerificationTable from \"../EmbassyVerificationTable\";\nimport { mockEmbassyVerifications } from \"@/lib/mock-data\";\n\nexport default function EmbassyVerificationTableExample() {\n  return (\n    <EmbassyVerificationTable \n      verifications={mockEmbassyVerifications}\n      onView={(id) => console.log(\"View\", id)}\n      onApprove={(id) => console.log(\"Approve\", id)}\n      onReject={(id) => console.log(\"Reject\", id)}\n    />\n  );\n}\n","path":null,"size_bytes":443,"size_tokens":null},"client/src/components/ui/card.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Card = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\n      \"shadcn-card rounded-xl border bg-card border-card-border text-card-foreground shadow-sm\",\n      className\n    )}\n    {...props}\n  />\n));\nCard.displayName = \"Card\"\n\nconst CardHeader = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"flex flex-col space-y-1.5 p-6\", className)}\n    {...props}\n  />\n));\nCardHeader.displayName = \"CardHeader\"\n\nconst CardTitle = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\n      \"text-2xl font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nCardTitle.displayName = \"CardTitle\"\n\nconst CardDescription = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n));\nCardDescription.displayName = \"CardDescription\"\n\nconst CardContent = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div ref={ref} className={cn(\"p-6 pt-0\", className)} {...props} />\n))\nCardContent.displayName = \"CardContent\"\n\nconst CardFooter = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"flex items-center p-6 pt-0\", className)}\n    {...props}\n  />\n))\nCardFooter.displayName = \"CardFooter\"\nexport {\n  Card,\n  CardHeader,\n  CardFooter,\n  CardTitle,\n  CardDescription,\n  CardContent,\n}\n","path":null,"size_bytes":1904,"size_tokens":null},"client/src/components/examples/PlayerProfileHeader.tsx":{"content":"import PlayerProfileHeader from \"../PlayerProfileHeader\";\nimport { mockPlayers } from \"@/lib/mock-data\";\n\nexport default function PlayerProfileHeaderExample() {\n  return (\n    <PlayerProfileHeader \n      player={mockPlayers[2]}\n      onGenerateReport={() => console.log(\"Generate report\")}\n      onShare={() => console.log(\"Share\")}\n    />\n  );\n}\n","path":null,"size_bytes":347,"size_tokens":null},"client/src/pages/signup.tsx":{"content":"import { useState } from \"react\";\nimport { useLocation } from \"wouter\";\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription, CardFooter } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Shield, UserPlus, Building2, ArrowRight } from \"lucide-react\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { useMutation } from \"@tanstack/react-query\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport type { UserRole, LeagueBand } from \"@/lib/types\";\nimport { LEAGUE_BANDS } from \"@/lib/types\";\n\ninterface SignupData {\n  username: string;\n  password: string;\n  email: string;\n  firstName: string;\n  lastName: string;\n  role: UserRole;\n  teamName: string;\n  clubName: string;\n  country: string;\n  leagueBand: LeagueBand;\n}\n\nexport default function Signup() {\n  const [, setLocation] = useLocation();\n  const { toast } = useToast();\n  const [step, setStep] = useState<1 | 2>(1);\n  const [formData, setFormData] = useState<SignupData>({\n    username: \"\",\n    password: \"\",\n    email: \"\",\n    firstName: \"\",\n    lastName: \"\",\n    role: \"scout\",\n    teamName: \"\",\n    clubName: \"\",\n    country: \"\",\n    leagueBand: 3,\n  });\n\n  const signupMutation = useMutation({\n    mutationFn: async (data: SignupData) => {\n      const response = await apiRequest(\"POST\", \"/api/auth/signup\", data);\n      return response.json();\n    },\n    onSuccess: (data: any) => {\n      // Invalidate auth query to trigger re-fetch of user data\n      queryClient.invalidateQueries({ queryKey: [\"/api/auth/me\"] });\n      \n      toast({\n        title: \"Account created\",\n        description: \"Welcome to Sports Reels!\",\n      });\n      \n      // Redirect based on role\n      const role = data.role || data.user?.role;\n      if (role === \"embassy\") {\n        setLocation(\"/embassy\");\n      } else if (role === \"scout\" || role === \"agent\") {\n        setLocation(\"/scout\");\n      } else {\n        setLocation(\"/\");\n      }\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Signup failed\",\n        description: error.message || \"Please try again\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const handleSubmit = (e: React.FormEvent) => {\n    e.preventDefault();\n    if (step === 1) {\n      if (!formData.username || !formData.password || !formData.email) {\n        toast({\n          title: \"Missing fields\",\n          description: \"Please fill in all required fields\",\n          variant: \"destructive\",\n        });\n        return;\n      }\n      setStep(2);\n    } else {\n      if (!formData.teamName || !formData.clubName) {\n        toast({\n          title: \"Missing fields\",\n          description: \"Please fill in team details\",\n          variant: \"destructive\",\n        });\n        return;\n      }\n      signupMutation.mutate(formData);\n    }\n  };\n\n  return (\n    <div className=\"min-h-screen bg-background flex items-center justify-center p-4\" data-testid=\"page-signup\">\n      <Card className=\"w-full max-w-md\">\n        <CardHeader className=\"text-center space-y-4\">\n          <div className=\"mx-auto p-3 bg-primary rounded-md w-fit\">\n            <Shield className=\"h-8 w-8 text-primary-foreground\" />\n          </div>\n          <div>\n            <CardTitle className=\"text-2xl\">Join Sports Reels</CardTitle>\n            <CardDescription>\n              {step === 1 ? \"Create your account\" : \"Set up your team\"}\n            </CardDescription>\n          </div>\n          <div className=\"flex justify-center gap-2\">\n            <div className={`h-2 w-16 rounded-full ${step >= 1 ? \"bg-primary\" : \"bg-muted\"}`} />\n            <div className={`h-2 w-16 rounded-full ${step >= 2 ? \"bg-primary\" : \"bg-muted\"}`} />\n          </div>\n        </CardHeader>\n        \n        <form onSubmit={handleSubmit}>\n          <CardContent className=\"space-y-4\">\n            {step === 1 ? (\n              <>\n                <div className=\"grid grid-cols-2 gap-4\">\n                  <div className=\"space-y-2\">\n                    <Label htmlFor=\"firstName\">First Name</Label>\n                    <Input\n                      id=\"firstName\"\n                      value={formData.firstName}\n                      onChange={(e) => setFormData({ ...formData, firstName: e.target.value })}\n                      placeholder=\"John\"\n                      data-testid=\"input-first-name\"\n                    />\n                  </div>\n                  <div className=\"space-y-2\">\n                    <Label htmlFor=\"lastName\">Last Name</Label>\n                    <Input\n                      id=\"lastName\"\n                      value={formData.lastName}\n                      onChange={(e) => setFormData({ ...formData, lastName: e.target.value })}\n                      placeholder=\"Smith\"\n                      data-testid=\"input-last-name\"\n                    />\n                  </div>\n                </div>\n                \n                <div className=\"space-y-2\">\n                  <Label htmlFor=\"email\">Email *</Label>\n                  <Input\n                    id=\"email\"\n                    type=\"email\"\n                    value={formData.email}\n                    onChange={(e) => setFormData({ ...formData, email: e.target.value })}\n                    placeholder=\"john@club.com\"\n                    required\n                    data-testid=\"input-email\"\n                  />\n                </div>\n                \n                <div className=\"space-y-2\">\n                  <Label htmlFor=\"username\">Username *</Label>\n                  <Input\n                    id=\"username\"\n                    value={formData.username}\n                    onChange={(e) => setFormData({ ...formData, username: e.target.value })}\n                    placeholder=\"johnsmith\"\n                    required\n                    data-testid=\"input-username\"\n                  />\n                </div>\n                \n                <div className=\"space-y-2\">\n                  <Label htmlFor=\"password\">Password *</Label>\n                  <Input\n                    id=\"password\"\n                    type=\"password\"\n                    value={formData.password}\n                    onChange={(e) => setFormData({ ...formData, password: e.target.value })}\n                    placeholder=\"Min 8 characters\"\n                    required\n                    data-testid=\"input-password\"\n                  />\n                </div>\n                \n                <div className=\"space-y-2\">\n                  <Label htmlFor=\"role\">Your Role</Label>\n                  <Select\n                    value={formData.role}\n                    onValueChange={(value) => setFormData({ ...formData, role: value as UserRole })}\n                  >\n                    <SelectTrigger data-testid=\"select-role\">\n                      <SelectValue placeholder=\"Select your role\" />\n                    </SelectTrigger>\n                    <SelectContent>\n                      <SelectItem value=\"sporting_director\">Sporting Director</SelectItem>\n                      <SelectItem value=\"legal\">Legal Team</SelectItem>\n                      <SelectItem value=\"scout\">Scout</SelectItem>\n                      <SelectItem value=\"coach\">Coach</SelectItem>\n                      <SelectItem value=\"admin\">Administrator</SelectItem>\n                    </SelectContent>\n                  </Select>\n                </div>\n              </>\n            ) : (\n              <>\n                <div className=\"flex items-center gap-2 p-3 bg-muted rounded-md mb-4\">\n                  <Building2 className=\"h-5 w-5 text-muted-foreground\" />\n                  <span className=\"text-sm\">Set up your team to start managing players</span>\n                </div>\n                \n                <div className=\"space-y-2\">\n                  <Label htmlFor=\"teamName\">Team Name *</Label>\n                  <Input\n                    id=\"teamName\"\n                    value={formData.teamName}\n                    onChange={(e) => setFormData({ ...formData, teamName: e.target.value })}\n                    placeholder=\"e.g., Recruitment Team\"\n                    required\n                    data-testid=\"input-team-name\"\n                  />\n                </div>\n                \n                <div className=\"space-y-2\">\n                  <Label htmlFor=\"clubName\">Club Name *</Label>\n                  <Input\n                    id=\"clubName\"\n                    value={formData.clubName}\n                    onChange={(e) => setFormData({ ...formData, clubName: e.target.value })}\n                    placeholder=\"e.g., FC Example\"\n                    required\n                    data-testid=\"input-club-name\"\n                  />\n                </div>\n                \n                <div className=\"space-y-2\">\n                  <Label htmlFor=\"country\">Country</Label>\n                  <Input\n                    id=\"country\"\n                    value={formData.country}\n                    onChange={(e) => setFormData({ ...formData, country: e.target.value })}\n                    placeholder=\"e.g., United Kingdom\"\n                    data-testid=\"input-country\"\n                  />\n                </div>\n                \n                <div className=\"space-y-2\">\n                  <Label htmlFor=\"leagueBand\">League Band</Label>\n                  <Select\n                    value={formData.leagueBand.toString()}\n                    onValueChange={(value) => setFormData({ ...formData, leagueBand: parseInt(value) as LeagueBand })}\n                  >\n                    <SelectTrigger data-testid=\"select-league-band\">\n                      <SelectValue placeholder=\"Select league band\" />\n                    </SelectTrigger>\n                    <SelectContent>\n                      {LEAGUE_BANDS.map((band) => (\n                        <SelectItem key={band.band} value={band.band.toString()}>\n                          Band {band.band}: {band.description}\n                        </SelectItem>\n                      ))}\n                    </SelectContent>\n                  </Select>\n                  <p className=\"text-xs text-muted-foreground\">\n                    {LEAGUE_BANDS.find(b => b.band === formData.leagueBand)?.examples}\n                  </p>\n                </div>\n              </>\n            )}\n          </CardContent>\n          \n          <CardFooter className=\"flex flex-col gap-4\">\n            <div className=\"flex gap-2 w-full\">\n              {step === 2 && (\n                <Button\n                  type=\"button\"\n                  variant=\"outline\"\n                  onClick={() => setStep(1)}\n                  className=\"flex-1\"\n                  data-testid=\"button-back\"\n                >\n                  Back\n                </Button>\n              )}\n              <Button\n                type=\"submit\"\n                className=\"flex-1\"\n                disabled={signupMutation.isPending}\n                data-testid=\"button-continue\"\n              >\n                {step === 1 ? (\n                  <>\n                    Continue\n                    <ArrowRight className=\"h-4 w-4 ml-2\" />\n                  </>\n                ) : signupMutation.isPending ? (\n                  \"Creating...\"\n                ) : (\n                  <>\n                    <UserPlus className=\"h-4 w-4 mr-2\" />\n                    Create Account\n                  </>\n                )}\n              </Button>\n            </div>\n            \n            <p className=\"text-sm text-center text-muted-foreground\">\n              Already have an account?{\" \"}\n              <a href=\"/login\" className=\"text-primary hover:underline\" data-testid=\"link-login\">\n                Sign in\n              </a>\n            </p>\n          </CardFooter>\n        </form>\n      </Card>\n    </div>\n  );\n}\n","path":null,"size_bytes":11956,"size_tokens":null},"client/src/components/examples/RoleAccessControl.tsx":{"content":"import { useState } from \"react\";\nimport RoleAccessControl from \"../RoleAccessControl\";\nimport type { UserRole } from \"@/lib/types\";\n\nexport default function RoleAccessControlExample() {\n  const [permissions, setPermissions] = useState([\n    { role: \"sporting_director\" as UserRole, label: \"Sporting Director\", hasAccess: true, icon: null as any },\n    { role: \"legal\" as UserRole, label: \"Legal Team\", hasAccess: true, icon: null as any },\n    { role: \"scout\" as UserRole, label: \"Scouts\", hasAccess: false, icon: null as any },\n    { role: \"coach\" as UserRole, label: \"Coaches\", hasAccess: false, icon: null as any },\n  ]);\n\n  const handleToggle = (role: UserRole, enabled: boolean) => {\n    setPermissions(prev => prev.map(p => \n      p.role === role ? { ...p, hasAccess: enabled } : p\n    ));\n  };\n\n  return (\n    <div className=\"max-w-sm\">\n      <RoleAccessControl permissions={permissions} onToggle={handleToggle} />\n    </div>\n  );\n}\n","path":null,"size_bytes":941,"size_tokens":null},"client/src/components/ui/command.tsx":{"content":"import * as React from \"react\"\nimport { type DialogProps } from \"@radix-ui/react-dialog\"\nimport { Command as CommandPrimitive } from \"cmdk\"\nimport { Search } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Dialog, DialogContent } from \"@/components/ui/dialog\"\n\nconst Command = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive\n    ref={ref}\n    className={cn(\n      \"flex h-full w-full flex-col overflow-hidden rounded-md bg-popover text-popover-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nCommand.displayName = CommandPrimitive.displayName\n\nconst CommandDialog = ({ children, ...props }: DialogProps) => {\n  return (\n    <Dialog {...props}>\n      <DialogContent className=\"overflow-hidden p-0 shadow-lg\">\n        <Command className=\"[&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground [&_[cmdk-group]:not([hidden])_~[cmdk-group]]:pt-0 [&_[cmdk-group]]:px-2 [&_[cmdk-input-wrapper]_svg]:h-5 [&_[cmdk-input-wrapper]_svg]:w-5 [&_[cmdk-input]]:h-12 [&_[cmdk-item]]:px-2 [&_[cmdk-item]]:py-3 [&_[cmdk-item]_svg]:h-5 [&_[cmdk-item]_svg]:w-5\">\n          {children}\n        </Command>\n      </DialogContent>\n    </Dialog>\n  )\n}\n\nconst CommandInput = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Input>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Input>\n>(({ className, ...props }, ref) => (\n  <div className=\"flex items-center border-b px-3\" cmdk-input-wrapper=\"\">\n    <Search className=\"mr-2 h-4 w-4 shrink-0 opacity-50\" />\n    <CommandPrimitive.Input\n      ref={ref}\n      className={cn(\n        \"flex h-11 w-full rounded-md bg-transparent py-3 text-sm outline-none placeholder:text-muted-foreground disabled:cursor-not-allowed disabled:opacity-50\",\n        className\n      )}\n      {...props}\n    />\n  </div>\n))\n\nCommandInput.displayName = CommandPrimitive.Input.displayName\n\nconst CommandList = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.List\n    ref={ref}\n    className={cn(\"max-h-[300px] overflow-y-auto overflow-x-hidden\", className)}\n    {...props}\n  />\n))\n\nCommandList.displayName = CommandPrimitive.List.displayName\n\nconst CommandEmpty = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Empty>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Empty>\n>((props, ref) => (\n  <CommandPrimitive.Empty\n    ref={ref}\n    className=\"py-6 text-center text-sm\"\n    {...props}\n  />\n))\n\nCommandEmpty.displayName = CommandPrimitive.Empty.displayName\n\nconst CommandGroup = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Group>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Group>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Group\n    ref={ref}\n    className={cn(\n      \"overflow-hidden p-1 text-foreground [&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:py-1.5 [&_[cmdk-group-heading]]:text-xs [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\n\nCommandGroup.displayName = CommandPrimitive.Group.displayName\n\nconst CommandSeparator = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 h-px bg-border\", className)}\n    {...props}\n  />\n))\nCommandSeparator.displayName = CommandPrimitive.Separator.displayName\n\nconst CommandItem = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Item>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default gap-2 select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none data-[disabled=true]:pointer-events-none data-[selected='true']:bg-accent data-[selected=true]:text-accent-foreground data-[disabled=true]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      className\n    )}\n    {...props}\n  />\n))\n\nCommandItem.displayName = CommandPrimitive.Item.displayName\n\nconst CommandShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nCommandShortcut.displayName = \"CommandShortcut\"\n\nexport {\n  Command,\n  CommandDialog,\n  CommandInput,\n  CommandList,\n  CommandEmpty,\n  CommandGroup,\n  CommandItem,\n  CommandShortcut,\n  CommandSeparator,\n}\n","path":null,"size_bytes":4885,"size_tokens":null},"client/src/components/ui/form.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as LabelPrimitive from \"@radix-ui/react-label\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport {\n  Controller,\n  FormProvider,\n  useFormContext,\n  type ControllerProps,\n  type FieldPath,\n  type FieldValues,\n} from \"react-hook-form\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Label } from \"@/components/ui/label\"\n\nconst Form = FormProvider\n\ntype FormFieldContextValue<\n  TFieldValues extends FieldValues = FieldValues,\n  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>\n> = {\n  name: TName\n}\n\nconst FormFieldContext = React.createContext<FormFieldContextValue>(\n  {} as FormFieldContextValue\n)\n\nconst FormField = <\n  TFieldValues extends FieldValues = FieldValues,\n  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>\n>({\n  ...props\n}: ControllerProps<TFieldValues, TName>) => {\n  return (\n    <FormFieldContext.Provider value={{ name: props.name }}>\n      <Controller {...props} />\n    </FormFieldContext.Provider>\n  )\n}\n\nconst useFormField = () => {\n  const fieldContext = React.useContext(FormFieldContext)\n  const itemContext = React.useContext(FormItemContext)\n  const { getFieldState, formState } = useFormContext()\n\n  const fieldState = getFieldState(fieldContext.name, formState)\n\n  if (!fieldContext) {\n    throw new Error(\"useFormField should be used within <FormField>\")\n  }\n\n  const { id } = itemContext\n\n  return {\n    id,\n    name: fieldContext.name,\n    formItemId: `${id}-form-item`,\n    formDescriptionId: `${id}-form-item-description`,\n    formMessageId: `${id}-form-item-message`,\n    ...fieldState,\n  }\n}\n\ntype FormItemContextValue = {\n  id: string\n}\n\nconst FormItemContext = React.createContext<FormItemContextValue>(\n  {} as FormItemContextValue\n)\n\nconst FormItem = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const id = React.useId()\n\n  return (\n    <FormItemContext.Provider value={{ id }}>\n      <div ref={ref} className={cn(\"space-y-2\", className)} {...props} />\n    </FormItemContext.Provider>\n  )\n})\nFormItem.displayName = \"FormItem\"\n\nconst FormLabel = React.forwardRef<\n  React.ElementRef<typeof LabelPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root>\n>(({ className, ...props }, ref) => {\n  const { error, formItemId } = useFormField()\n\n  return (\n    <Label\n      ref={ref}\n      className={cn(error && \"text-destructive\", className)}\n      htmlFor={formItemId}\n      {...props}\n    />\n  )\n})\nFormLabel.displayName = \"FormLabel\"\n\nconst FormControl = React.forwardRef<\n  React.ElementRef<typeof Slot>,\n  React.ComponentPropsWithoutRef<typeof Slot>\n>(({ ...props }, ref) => {\n  const { error, formItemId, formDescriptionId, formMessageId } = useFormField()\n\n  return (\n    <Slot\n      ref={ref}\n      id={formItemId}\n      aria-describedby={\n        !error\n          ? `${formDescriptionId}`\n          : `${formDescriptionId} ${formMessageId}`\n      }\n      aria-invalid={!!error}\n      {...props}\n    />\n  )\n})\nFormControl.displayName = \"FormControl\"\n\nconst FormDescription = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, ...props }, ref) => {\n  const { formDescriptionId } = useFormField()\n\n  return (\n    <p\n      ref={ref}\n      id={formDescriptionId}\n      className={cn(\"text-sm text-muted-foreground\", className)}\n      {...props}\n    />\n  )\n})\nFormDescription.displayName = \"FormDescription\"\n\nconst FormMessage = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, children, ...props }, ref) => {\n  const { error, formMessageId } = useFormField()\n  const body = error ? String(error?.message ?? \"\") : children\n\n  if (!body) {\n    return null\n  }\n\n  return (\n    <p\n      ref={ref}\n      id={formMessageId}\n      className={cn(\"text-sm font-medium text-destructive\", className)}\n      {...props}\n    >\n      {body}\n    </p>\n  )\n})\nFormMessage.displayName = \"FormMessage\"\n\nexport {\n  useFormField,\n  Form,\n  FormItem,\n  FormLabel,\n  FormControl,\n  FormDescription,\n  FormMessage,\n  FormField,\n}\n","path":null,"size_bytes":4120,"size_tokens":null},"design_guidelines.md":{"content":"# Design Guidelines: Player Compliance & Visa Eligibility Platform\n\n## Design Approach: Material Design System\n\n**Rationale:** This enterprise compliance platform requires information-dense layouts, clear data hierarchy, and professional credibility. Material Design provides robust patterns for dashboards, data tables, forms, and status indicators essential for legal/immigration documentation.\n\n## Core Design Principles\n\n1. **Data Clarity First:** All compliance scores, player statistics, and eligibility metrics must be immediately scannable\n2. **Trust & Professionalism:** Clean, authoritative design befitting legal documentation and embassy verification\n3. **Role-Based Clarity:** Visual differentiation between Sporting Director, Legal, Scout, and Coach views\n4. **Status-Driven Design:** Color-coded system (Green/Yellow/Red) as primary visual language\n\n---\n\n## Typography System\n\n**Primary Font:** Roboto (via Google Fonts CDN)\n**Secondary Font:** Roboto Condensed (for data tables/compact areas)\n\n**Hierarchy:**\n- Page Titles: text-3xl font-medium (Sporting Director Dashboard, Player Profile)\n- Section Headers: text-xl font-medium (Visa Eligibility Score, Performance Data)\n- Card Titles: text-lg font-medium\n- Body Text: text-base font-normal\n- Data Labels: text-sm font-medium uppercase tracking-wide text-gray-600\n- Data Values: text-lg font-semibold\n- Table Headers: text-xs font-bold uppercase tracking-wider\n- Table Cells: text-sm font-normal\n- Meta Information: text-xs text-gray-500\n\n---\n\n## Layout System\n\n**Spacing Units:** Consistent use of Tailwind units: **2, 4, 6, 8, 12, 16**\n- Component padding: p-4, p-6, p-8\n- Section margins: mb-6, mb-8, mb-12\n- Grid gaps: gap-4, gap-6\n- Card spacing: p-6\n\n**Container Strategy:**\n- Dashboard Shell: Full viewport with fixed sidebar (w-64) + main content area\n- Content Max-Width: max-w-7xl mx-auto px-6\n- Card Containers: Contained width with consistent padding\n- Data Tables: Full-width within content area, horizontally scrollable on mobile\n\n**Grid Patterns:**\n- Player Cards Grid: grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\n- Dashboard Stats: grid-cols-2 md:grid-cols-4 gap-4\n- Form Layouts: grid-cols-1 md:grid-cols-2 gap-6\n- Video Gallery: grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\n\n---\n\n## Component Library\n\n### Navigation & Shell\n- **Sidebar Navigation:** Fixed left sidebar (w-64) with role-based menu items, user profile at top, nested sub-navigation for complex sections\n- **Top Bar:** Contains breadcrumbs, global search, notification bell (embassy alerts), user dropdown\n- **Tab Navigation:** For multi-view sections (Player Overview, Performance Data, Videos, Compliance Reports)\n\n### Data Display\n- **Stat Cards:** Elevated cards with large numeric values, labels, trend indicators ()\n- **Data Tables:** Sortable columns, row hover states, action buttons in rightmost column, sticky headers for long tables\n- **Status Badges:** Rounded-full px-3 py-1 text-xs font-semibold (Green: bg-green-100 text-green-800, Yellow: bg-yellow-100 text-yellow-800, Red: bg-red-100 text-red-800)\n- **Progress Indicators:** Linear bars for visa eligibility scores with color zones\n- **Timeline:** Vertical timeline for player history, international caps, transfer events\n\n### Forms & Input\n- **Form Fields:** Material-style with floating labels, border-b-2 underline style, focus states with color shift\n- **File Upload Zones:** Dashed border areas for video uploads, drag-and-drop visual feedback\n- **Multi-Select:** Checkbox groups for team sheets, data partner selection\n- **Date Pickers:** Calendar overlay for match dates, report date ranges\n- **Search Filters:** Collapsible filter panel with checkboxes, range sliders\n\n### Player Management\n- **Player Profile Header:** Large card with player photo (left), name/position/nationality, eligibility score badge (prominent), quick actions (Generate Report, Share)\n- **Performance Dashboard:** Grid of metric cards (Minutes Played, National Caps, Continental Games, GPS Data Points)\n- **Eligibility Scorecard:** Visual breakdown showing Schengen/UK GBE/US P-1/O-1 scores with explanatory tooltips\n\n### Scouting Dashboard\n- **Player Comparison Table:** Side-by-side view of multiple players with inline eligibility indicators\n- **Due Diligence Checklist:** Interactive checklist with completion percentage\n- **Club Connection Interface:** Chat-style messaging panel for club-to-club discussions\n\n### Video Management\n- **Video Grid:** Thumbnail previews with play overlay, match date, team sheet badge\n- **Video Player Modal:** Full-screen overlay with match metadata sidebar, annotation tools\n- **Integration Status:** Connected data partner badges (Wyscout, Transfermarkt, Veo)\n\n### Report Generation\n- **Report Builder:** Step-by-step wizard (Select Player  Choose Data Range  Configure Sections  Generate)\n- **Report Preview:** PDF-style preview with print layout\n- **Timestamp Display:** Clear timestamp with timezone on all generated reports\n\n### Embassy Verification\n- **Notification Center:** List view of pending verifications with priority flags\n- **Verification Detail:** Full consular summary view with approval/rejection workflow\n- **Audit Trail:** Timestamped log of all embassy interactions\n\n### Role-Based Access\n- **Permission Toggles:** Visual toggles for sharing data with Legal/Scout/Coach roles\n- **Access History:** Table showing who accessed player data and when\n\n---\n\n## Interactions & Micro-animations\n\n**Minimal Animation Policy:**\n- Card hover: subtle elevation increase (shadow transition)\n- Button clicks: slight scale feedback (scale-95 on active)\n- Notification badge: gentle pulse on new embassy alerts\n- Loading states: spinner for data fetches, skeleton screens for tables\n- NO scroll animations, NO page transitions, NO decorative motion\n\n---\n\n## Visual Hierarchy Patterns\n\n1. **Primary Actions:** Solid buttons (Generate Report, Upload Video, Share Profile)\n2. **Secondary Actions:** Outlined buttons (Cancel, View Details)\n3. **Tertiary Actions:** Text links with underline on hover\n4. **Destructive Actions:** Red outlined buttons (Delete, Revoke Access)\n\n**Information Density:**\n- Dashboard view: High density with multiple cards/stats visible\n- Player profile: Medium density with breathing room around key data\n- Forms: Lower density with clear field spacing\n\n---\n\n## Accessibility Standards\n\n- WCAG AA contrast ratios for all text and status indicators\n- Keyboard navigation for all interactive elements\n- Focus visible states (ring-2 ring-blue-500)\n- Screen reader labels for all icon-only buttons\n- Form validation with clear error messages below fields\n\n---\n\n## Icons\n\n**Library:** Material Icons (via Google Fonts CDN)\n**Usage:**\n- Navigation items: Paired with text labels\n- Status indicators: Checkmark (approved), warning triangle (yellow), X (red)\n- Actions: Upload, download, share, edit, delete icons\n- Data types: Trophy (caps), clock (minutes), medical cross, GPS marker\n\n---\n\n## Special Considerations\n\n**Color-Coded Compliance System:**\n- Use green/yellow/red consistently across all compliance indicators\n- Never rely on color alone - pair with text labels and icons\n- Provide tooltips explaining score thresholds\n\n**Multi-Language Support:**\n- Design with expandable text containers (player names, club names vary widely)\n- Date formats should accommodate different regional standards\n\n**Data Privacy:**\n- Visual indicators when viewing sensitive medical/biometric data\n- Watermarks on generated consular reports with \"CONFIDENTIAL\" badge","path":null,"size_bytes":7540,"size_tokens":null},"client/src/components/ui/radio-group.tsx":{"content":"import * as React from \"react\"\nimport * as RadioGroupPrimitive from \"@radix-ui/react-radio-group\"\nimport { Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst RadioGroup = React.forwardRef<\n  React.ElementRef<typeof RadioGroupPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof RadioGroupPrimitive.Root>\n>(({ className, ...props }, ref) => {\n  return (\n    <RadioGroupPrimitive.Root\n      className={cn(\"grid gap-2\", className)}\n      {...props}\n      ref={ref}\n    />\n  )\n})\nRadioGroup.displayName = RadioGroupPrimitive.Root.displayName\n\nconst RadioGroupItem = React.forwardRef<\n  React.ElementRef<typeof RadioGroupPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof RadioGroupPrimitive.Item>\n>(({ className, ...props }, ref) => {\n  return (\n    <RadioGroupPrimitive.Item\n      ref={ref}\n      className={cn(\n        \"aspect-square h-4 w-4 rounded-full border border-primary text-primary ring-offset-background focus:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50\",\n        className\n      )}\n      {...props}\n    >\n      <RadioGroupPrimitive.Indicator className=\"flex items-center justify-center\">\n        <Circle className=\"h-2.5 w-2.5 fill-current text-current\" />\n      </RadioGroupPrimitive.Indicator>\n    </RadioGroupPrimitive.Item>\n  )\n})\nRadioGroupItem.displayName = RadioGroupPrimitive.Item.displayName\n\nexport { RadioGroup, RadioGroupItem }\n","path":null,"size_bytes":1467,"size_tokens":null},"client/src/components/ui/textarea.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Textarea = React.forwardRef<\n  HTMLTextAreaElement,\n  React.ComponentProps<\"textarea\">\n>(({ className, ...props }, ref) => {\n  return (\n    <textarea\n      className={cn(\n        \"flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm\",\n        className\n      )}\n      ref={ref}\n      {...props}\n    />\n  )\n})\nTextarea.displayName = \"Textarea\"\n\nexport { Textarea }\n","path":null,"size_bytes":689,"size_tokens":null},"client/src/components/ui/checkbox.tsx":{"content":"import * as React from \"react\"\nimport * as CheckboxPrimitive from \"@radix-ui/react-checkbox\"\nimport { Check } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Checkbox = React.forwardRef<\n  React.ElementRef<typeof CheckboxPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof CheckboxPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <CheckboxPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground\",\n      className\n    )}\n    {...props}\n  >\n    <CheckboxPrimitive.Indicator\n      className={cn(\"flex items-center justify-center text-current\")}\n    >\n      <Check className=\"h-4 w-4\" />\n    </CheckboxPrimitive.Indicator>\n  </CheckboxPrimitive.Root>\n))\nCheckbox.displayName = CheckboxPrimitive.Root.displayName\n\nexport { Checkbox }\n","path":null,"size_bytes":1056,"size_tokens":null},"client/src/components/RoleAccessControl.tsx":{"content":"import { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Switch } from \"@/components/ui/switch\";\nimport { Label } from \"@/components/ui/label\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Users, Shield, Eye, BarChart3 } from \"lucide-react\";\nimport type { UserRole } from \"@/lib/types\";\n\ninterface RolePermission {\n  role: UserRole;\n  label: string;\n  icon: typeof Users;\n  hasAccess: boolean;\n}\n\ninterface RoleAccessControlProps {\n  permissions: RolePermission[];\n  onToggle?: (role: UserRole, enabled: boolean) => void;\n}\n\nexport default function RoleAccessControl({ permissions, onToggle }: RoleAccessControlProps) {\n  const roleIcons: Record<UserRole, typeof Users> = {\n    sporting_director: Shield,\n    legal: Eye,\n    scout: BarChart3,\n    coach: Users,\n  };\n\n  return (\n    <Card data-testid=\"card-role-access\">\n      <CardHeader className=\"pb-4\">\n        <CardTitle className=\"text-lg flex items-center gap-2\">\n          <Shield className=\"h-5 w-5\" />\n          Access Control\n        </CardTitle>\n      </CardHeader>\n      <CardContent className=\"space-y-4\">\n        {permissions.map((permission) => {\n          const Icon = roleIcons[permission.role];\n          return (\n            <div \n              key={permission.role} \n              className=\"flex items-center justify-between gap-4 p-3 bg-muted/50 rounded-md\"\n            >\n              <div className=\"flex items-center gap-3\">\n                <div className=\"p-2 bg-background rounded-md\">\n                  <Icon className=\"h-4 w-4 text-muted-foreground\" />\n                </div>\n                <div>\n                  <Label className=\"font-medium\">{permission.label}</Label>\n                  <Badge \n                    variant=\"secondary\" \n                    className={`text-xs mt-1 ${permission.hasAccess \n                      ? \"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400\" \n                      : \"bg-gray-100 text-gray-600 dark:bg-gray-800 dark:text-gray-400\"\n                    }`}\n                  >\n                    {permission.hasAccess ? \"Has Access\" : \"No Access\"}\n                  </Badge>\n                </div>\n              </div>\n              <Switch\n                checked={permission.hasAccess}\n                onCheckedChange={(checked) => onToggle?.(permission.role, checked)}\n                data-testid={`switch-access-${permission.role}`}\n              />\n            </div>\n          );\n        })}\n      </CardContent>\n    </Card>\n  );\n}\n","path":null,"size_bytes":2523,"size_tokens":null},"client/src/components/ConsularSummaryGenerator.tsx":{"content":"import { useState } from \"react\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Label } from \"@/components/ui/label\";\nimport { Input } from \"@/components/ui/input\";\nimport { Checkbox } from \"@/components/ui/checkbox\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { FileText, Calendar, Download, Send } from \"lucide-react\";\n\ninterface ConsularSummaryGeneratorProps {\n  playerName: string;\n  onGenerate?: (config: GeneratorConfig) => void;\n  onSubmitToEmbassy?: (config: GeneratorConfig) => void;\n}\n\ninterface GeneratorConfig {\n  startDate: string;\n  endDate: string;\n  visaType: string;\n  includePerformance: boolean;\n  includeMedical: boolean;\n  includeVideos: boolean;\n  targetCountry: string;\n}\n\nexport default function ConsularSummaryGenerator({ \n  playerName, \n  onGenerate, \n  onSubmitToEmbassy \n}: ConsularSummaryGeneratorProps) {\n  const [config, setConfig] = useState<GeneratorConfig>({\n    startDate: new Date(Date.now() - 180 * 24 * 60 * 60 * 1000).toISOString().split(\"T\")[0],\n    endDate: new Date().toISOString().split(\"T\")[0],\n    visaType: \"schengen\",\n    includePerformance: true,\n    includeMedical: true,\n    includeVideos: false,\n    targetCountry: \"\",\n  });\n\n  const visaTypes = [\n    { value: \"schengen\", label: \"Schengen Sports Visa\" },\n    { value: \"uk_gbe\", label: \"UK GBE\" },\n    { value: \"us_p1\", label: \"US P-1 Visa\" },\n    { value: \"us_o1\", label: \"US O-1 Visa\" },\n  ];\n\n  const countries = [\n    \"Germany\", \"France\", \"Spain\", \"Italy\", \"Netherlands\",\n    \"United Kingdom\", \"United States\",\n  ];\n\n  return (\n    <Card data-testid=\"card-consular-generator\">\n      <CardHeader className=\"pb-4\">\n        <CardTitle className=\"text-lg flex items-center gap-2\">\n          <FileText className=\"h-5 w-5\" />\n          Generate Consular Summary\n        </CardTitle>\n      </CardHeader>\n      <CardContent className=\"space-y-4\">\n        <p className=\"text-sm text-muted-foreground\">\n          Creating compliance report for <span className=\"font-medium text-foreground\">{playerName}</span>\n        </p>\n\n        <div className=\"grid grid-cols-2 gap-4\">\n          <div className=\"space-y-2\">\n            <Label htmlFor=\"start-date\">Data Start Date</Label>\n            <Input\n              id=\"start-date\"\n              type=\"date\"\n              value={config.startDate}\n              onChange={(e) => setConfig({ ...config, startDate: e.target.value })}\n              data-testid=\"input-start-date\"\n            />\n          </div>\n          <div className=\"space-y-2\">\n            <Label htmlFor=\"end-date\">Data End Date</Label>\n            <Input\n              id=\"end-date\"\n              type=\"date\"\n              value={config.endDate}\n              onChange={(e) => setConfig({ ...config, endDate: e.target.value })}\n              data-testid=\"input-end-date\"\n            />\n          </div>\n        </div>\n\n        <div className=\"grid grid-cols-2 gap-4\">\n          <div className=\"space-y-2\">\n            <Label htmlFor=\"visa-type\">Visa Type</Label>\n            <Select \n              value={config.visaType} \n              onValueChange={(value) => setConfig({ ...config, visaType: value })}\n            >\n              <SelectTrigger data-testid=\"select-visa-type\">\n                <SelectValue placeholder=\"Select visa type\" />\n              </SelectTrigger>\n              <SelectContent>\n                {visaTypes.map((type) => (\n                  <SelectItem key={type.value} value={type.value}>\n                    {type.label}\n                  </SelectItem>\n                ))}\n              </SelectContent>\n            </Select>\n          </div>\n          <div className=\"space-y-2\">\n            <Label htmlFor=\"target-country\">Target Country</Label>\n            <Select \n              value={config.targetCountry} \n              onValueChange={(value) => setConfig({ ...config, targetCountry: value })}\n            >\n              <SelectTrigger data-testid=\"select-target-country\">\n                <SelectValue placeholder=\"Select country\" />\n              </SelectTrigger>\n              <SelectContent>\n                {countries.map((country) => (\n                  <SelectItem key={country} value={country}>\n                    {country}\n                  </SelectItem>\n                ))}\n              </SelectContent>\n            </Select>\n          </div>\n        </div>\n\n        <div className=\"space-y-3\">\n          <Label>Include in Report</Label>\n          <div className=\"space-y-2\">\n            <div className=\"flex items-center gap-2\">\n              <Checkbox\n                id=\"include-performance\"\n                checked={config.includePerformance}\n                onCheckedChange={(checked) => \n                  setConfig({ ...config, includePerformance: checked as boolean })\n                }\n                data-testid=\"checkbox-performance\"\n              />\n              <Label htmlFor=\"include-performance\" className=\"font-normal\">\n                Performance Data (minutes, caps, competitions)\n              </Label>\n            </div>\n            <div className=\"flex items-center gap-2\">\n              <Checkbox\n                id=\"include-medical\"\n                checked={config.includeMedical}\n                onCheckedChange={(checked) => \n                  setConfig({ ...config, includeMedical: checked as boolean })\n                }\n                data-testid=\"checkbox-medical\"\n              />\n              <Label htmlFor=\"include-medical\" className=\"font-normal\">\n                Medical & GPS Data (biometric proof)\n              </Label>\n            </div>\n            <div className=\"flex items-center gap-2\">\n              <Checkbox\n                id=\"include-videos\"\n                checked={config.includeVideos}\n                onCheckedChange={(checked) => \n                  setConfig({ ...config, includeVideos: checked as boolean })\n                }\n                data-testid=\"checkbox-videos\"\n              />\n              <Label htmlFor=\"include-videos\" className=\"font-normal\">\n                Video References (match footage links)\n              </Label>\n            </div>\n          </div>\n        </div>\n\n        <div className=\"flex gap-2 pt-2\">\n          <Button \n            variant=\"outline\" \n            className=\"flex-1\"\n            onClick={() => onGenerate?.(config)}\n            data-testid=\"button-generate-pdf\"\n          >\n            <Download className=\"h-4 w-4 mr-2\" />\n            Generate PDF\n          </Button>\n          <Button \n            className=\"flex-1\"\n            onClick={() => onSubmitToEmbassy?.(config)}\n            data-testid=\"button-submit-embassy\"\n          >\n            <Send className=\"h-4 w-4 mr-2\" />\n            Submit to Embassy\n          </Button>\n        </div>\n      </CardContent>\n    </Card>\n  );\n}\n","path":null,"size_bytes":6906,"size_tokens":null},"client/src/components/ui/dropdown-menu.tsx":{"content":"import * as React from \"react\"\nimport * as DropdownMenuPrimitive from \"@radix-ui/react-dropdown-menu\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst DropdownMenu = DropdownMenuPrimitive.Root\n\nconst DropdownMenuTrigger = DropdownMenuPrimitive.Trigger\n\nconst DropdownMenuGroup = DropdownMenuPrimitive.Group\n\nconst DropdownMenuPortal = DropdownMenuPrimitive.Portal\n\nconst DropdownMenuSub = DropdownMenuPrimitive.Sub\n\nconst DropdownMenuRadioGroup = DropdownMenuPrimitive.RadioGroup\n\nconst DropdownMenuSubTrigger = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <DropdownMenuPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto\" />\n  </DropdownMenuPrimitive.SubTrigger>\n))\nDropdownMenuSubTrigger.displayName =\n  DropdownMenuPrimitive.SubTrigger.displayName\n\nconst DropdownMenuSubContent = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <DropdownMenuPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuSubContent.displayName =\n  DropdownMenuPrimitive.SubContent.displayName\n\nconst DropdownMenuContent = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Content>\n>(({ className, sideOffset = 4, ...props }, ref) => (\n  <DropdownMenuPrimitive.Portal>\n    <DropdownMenuPrimitive.Content\n      ref={ref}\n      sideOffset={sideOffset}\n      className={cn(\n        \"z-50 max-h-[var(--radix-dropdown-menu-content-available-height)] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </DropdownMenuPrimitive.Portal>\n))\nDropdownMenuContent.displayName = DropdownMenuPrimitive.Content.displayName\n\nconst DropdownMenuItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <DropdownMenuPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuItem.displayName = DropdownMenuPrimitive.Item.displayName\n\nconst DropdownMenuCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <DropdownMenuPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <DropdownMenuPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </DropdownMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </DropdownMenuPrimitive.CheckboxItem>\n))\nDropdownMenuCheckboxItem.displayName =\n  DropdownMenuPrimitive.CheckboxItem.displayName\n\nconst DropdownMenuRadioItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <DropdownMenuPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <DropdownMenuPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </DropdownMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </DropdownMenuPrimitive.RadioItem>\n))\nDropdownMenuRadioItem.displayName = DropdownMenuPrimitive.RadioItem.displayName\n\nconst DropdownMenuLabel = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <DropdownMenuPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuLabel.displayName = DropdownMenuPrimitive.Label.displayName\n\nconst DropdownMenuSeparator = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <DropdownMenuPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nDropdownMenuSeparator.displayName = DropdownMenuPrimitive.Separator.displayName\n\nconst DropdownMenuShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\"ml-auto text-xs tracking-widest opacity-60\", className)}\n      {...props}\n    />\n  )\n}\nDropdownMenuShortcut.displayName = \"DropdownMenuShortcut\"\n\nexport {\n  DropdownMenu,\n  DropdownMenuTrigger,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuCheckboxItem,\n  DropdownMenuRadioItem,\n  DropdownMenuLabel,\n  DropdownMenuSeparator,\n  DropdownMenuShortcut,\n  DropdownMenuGroup,\n  DropdownMenuPortal,\n  DropdownMenuSub,\n  DropdownMenuSubContent,\n  DropdownMenuSubTrigger,\n  DropdownMenuRadioGroup,\n}\n","path":null,"size_bytes":7609,"size_tokens":null},"client/src/components/ui/tabs.tsx":{"content":"import * as React from \"react\"\nimport * as TabsPrimitive from \"@radix-ui/react-tabs\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Tabs = TabsPrimitive.Root\n\nconst TabsList = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.List\n    ref={ref}\n    className={cn(\n      \"inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsList.displayName = TabsPrimitive.List.displayName\n\nconst TabsTrigger = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Trigger>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsTrigger.displayName = TabsPrimitive.Trigger.displayName\n\nconst TabsContent = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.Content\n    ref={ref}\n    className={cn(\n      \"mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsContent.displayName = TabsPrimitive.Content.displayName\n\nexport { Tabs, TabsList, TabsTrigger, TabsContent }\n","path":null,"size_bytes":1883,"size_tokens":null},"client/src/pages/scouting.tsx":{"content":"import { useState } from \"react\";\nimport { useLocation } from \"wouter\";\nimport ScoutingInquiryCard from \"@/components/ScoutingInquiryCard\";\nimport PlayerCard from \"@/components/PlayerCard\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle } from \"@/components/ui/dialog\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Label } from \"@/components/ui/label\";\nimport { Search, Plus, MessageSquare, Send, Users } from \"lucide-react\";\nimport { mockScoutingInquiries, mockPlayers } from \"@/lib/mock-data\";\n\nexport default function Scouting() {\n  const [, setLocation] = useLocation();\n  const [searchQuery, setSearchQuery] = useState(\"\");\n  const [messageDialogOpen, setMessageDialogOpen] = useState(false);\n  const [selectedInquiry, setSelectedInquiry] = useState<string | null>(null);\n  const [message, setMessage] = useState(\"\");\n\n  // todo: remove mock functionality\n  const inquiries = mockScoutingInquiries;\n  const players = mockPlayers;\n\n  const filteredInquiries = inquiries.filter((i) => {\n    const player = players.find((p) => p.id === i.playerId);\n    return (\n      player?.firstName.toLowerCase().includes(searchQuery.toLowerCase()) ||\n      player?.lastName.toLowerCase().includes(searchQuery.toLowerCase()) ||\n      i.buyingClub.toLowerCase().includes(searchQuery.toLowerCase()) ||\n      i.sellingClub.toLowerCase().includes(searchQuery.toLowerCase())\n    );\n  });\n\n  const handleMessage = (id: string) => {\n    setSelectedInquiry(id);\n    setMessageDialogOpen(true);\n  };\n\n  const handleSendMessage = () => {\n    console.log(\"Send message to inquiry\", selectedInquiry, message);\n    setMessage(\"\");\n    setMessageDialogOpen(false);\n  };\n\n  return (\n    <div className=\"p-6 space-y-6\" data-testid=\"page-scouting\">\n      <div className=\"flex flex-wrap items-center justify-between gap-4\">\n        <div>\n          <h1 className=\"text-2xl font-semibold\">Scouting Dashboard</h1>\n          <p className=\"text-muted-foreground\">Connect with buying clubs and manage transfer inquiries</p>\n        </div>\n        <Button data-testid=\"button-new-inquiry\">\n          <Plus className=\"h-4 w-4 mr-2\" />\n          New Inquiry\n        </Button>\n      </div>\n\n      <div className=\"relative max-w-md\">\n        <Search className=\"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground\" />\n        <Input\n          placeholder=\"Search inquiries...\"\n          value={searchQuery}\n          onChange={(e) => setSearchQuery(e.target.value)}\n          className=\"pl-9\"\n          data-testid=\"input-search-scouting\"\n        />\n      </div>\n\n      <Tabs defaultValue=\"inquiries\" className=\"w-full\">\n        <TabsList>\n          <TabsTrigger value=\"inquiries\" data-testid=\"tab-inquiries\">\n            <MessageSquare className=\"h-4 w-4 mr-2\" />\n            Inquiries ({inquiries.length})\n          </TabsTrigger>\n          <TabsTrigger value=\"players\" data-testid=\"tab-available-players\">\n            <Users className=\"h-4 w-4 mr-2\" />\n            Available Players\n          </TabsTrigger>\n        </TabsList>\n\n        <TabsContent value=\"inquiries\" className=\"mt-6\">\n          <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\">\n            {filteredInquiries.map((inquiry) => {\n              const player = players.find((p) => p.id === inquiry.playerId);\n              return (\n                <ScoutingInquiryCard\n                  key={inquiry.id}\n                  inquiry={inquiry}\n                  playerName={player ? `${player.firstName} ${player.lastName}` : \"Unknown\"}\n                  onViewDetails={(id) => console.log(\"View details\", id)}\n                  onMessage={handleMessage}\n                />\n              );\n            })}\n            {filteredInquiries.length === 0 && (\n              <div className=\"col-span-full text-center py-12 text-muted-foreground\">\n                No inquiries found matching your search\n              </div>\n            )}\n          </div>\n        </TabsContent>\n\n        <TabsContent value=\"players\" className=\"mt-6\">\n          <Card>\n            <CardHeader className=\"pb-4\">\n              <CardTitle className=\"text-lg\">Players Available for Transfer</CardTitle>\n            </CardHeader>\n            <CardContent>\n              <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\">\n                {players.map((player) => (\n                  <PlayerCard\n                    key={player.id}\n                    player={player}\n                    onViewProfile={(id) => setLocation(`/players/${id}`)}\n                    onGenerateReport={(id) => console.log(\"Generate report\", id)}\n                  />\n                ))}\n              </div>\n            </CardContent>\n          </Card>\n        </TabsContent>\n      </Tabs>\n\n      <Dialog open={messageDialogOpen} onOpenChange={setMessageDialogOpen}>\n        <DialogContent data-testid=\"dialog-message\">\n          <DialogHeader>\n            <DialogTitle>Send Message</DialogTitle>\n          </DialogHeader>\n          <div className=\"space-y-4\">\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"message\">Message</Label>\n              <Textarea\n                id=\"message\"\n                value={message}\n                onChange={(e) => setMessage(e.target.value)}\n                placeholder=\"Type your message to the buying club...\"\n                rows={4}\n                data-testid=\"textarea-message\"\n              />\n            </div>\n            <div className=\"flex justify-end gap-2\">\n              <Button variant=\"outline\" onClick={() => setMessageDialogOpen(false)}>\n                Cancel\n              </Button>\n              <Button onClick={handleSendMessage} data-testid=\"button-send-message\">\n                <Send className=\"h-4 w-4 mr-2\" />\n                Send\n              </Button>\n            </div>\n          </div>\n        </DialogContent>\n      </Dialog>\n    </div>\n  );\n}\n","path":null,"size_bytes":6157,"size_tokens":null},"client/src/components/StatusBadge.tsx":{"content":"import { Badge } from \"@/components/ui/badge\";\nimport type { VisaStatus } from \"@/lib/types\";\n\ninterface StatusBadgeProps {\n  score: number;\n  size?: \"sm\" | \"default\";\n}\n\nexport function getVisaStatus(score: number): VisaStatus {\n  if (score >= 60) return \"green\";\n  if (score >= 35) return \"yellow\";\n  return \"red\";\n}\n\nexport function getStatusLabel(status: VisaStatus): string {\n  switch (status) {\n    case \"green\": return \"Eligible\";\n    case \"yellow\": return \"Conditional\";\n    case \"red\": return \"Ineligible\";\n  }\n}\n\nexport default function StatusBadge({ score, size = \"default\" }: StatusBadgeProps) {\n  const status = getVisaStatus(score);\n  \n  const colorClasses = {\n    green: \"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400\",\n    yellow: \"bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-400\",\n    red: \"bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-400\",\n  };\n\n  return (\n    <Badge \n      variant=\"secondary\"\n      className={`${colorClasses[status]} ${size === \"sm\" ? \"text-xs\" : \"\"}`}\n      data-testid={`badge-status-${status}`}\n    >\n      {score}% - {getStatusLabel(status)}\n    </Badge>\n  );\n}\n","path":null,"size_bytes":1165,"size_tokens":null},"client/src/components/ui/pagination.tsx":{"content":"import * as React from \"react\"\nimport { ChevronLeft, ChevronRight, MoreHorizontal } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { ButtonProps, buttonVariants } from \"@/components/ui/button\"\n\nconst Pagination = ({ className, ...props }: React.ComponentProps<\"nav\">) => (\n  <nav\n    role=\"navigation\"\n    aria-label=\"pagination\"\n    className={cn(\"mx-auto flex w-full justify-center\", className)}\n    {...props}\n  />\n)\nPagination.displayName = \"Pagination\"\n\nconst PaginationContent = React.forwardRef<\n  HTMLUListElement,\n  React.ComponentProps<\"ul\">\n>(({ className, ...props }, ref) => (\n  <ul\n    ref={ref}\n    className={cn(\"flex flex-row items-center gap-1\", className)}\n    {...props}\n  />\n))\nPaginationContent.displayName = \"PaginationContent\"\n\nconst PaginationItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentProps<\"li\">\n>(({ className, ...props }, ref) => (\n  <li ref={ref} className={cn(\"\", className)} {...props} />\n))\nPaginationItem.displayName = \"PaginationItem\"\n\ntype PaginationLinkProps = {\n  isActive?: boolean\n} & Pick<ButtonProps, \"size\"> &\n  React.ComponentProps<\"a\">\n\nconst PaginationLink = ({\n  className,\n  isActive,\n  size = \"icon\",\n  ...props\n}: PaginationLinkProps) => (\n  <a\n    aria-current={isActive ? \"page\" : undefined}\n    className={cn(\n      buttonVariants({\n        variant: isActive ? \"outline\" : \"ghost\",\n        size,\n      }),\n      className\n    )}\n    {...props}\n  />\n)\nPaginationLink.displayName = \"PaginationLink\"\n\nconst PaginationPrevious = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof PaginationLink>) => (\n  <PaginationLink\n    aria-label=\"Go to previous page\"\n    size=\"default\"\n    className={cn(\"gap-1 pl-2.5\", className)}\n    {...props}\n  >\n    <ChevronLeft className=\"h-4 w-4\" />\n    <span>Previous</span>\n  </PaginationLink>\n)\nPaginationPrevious.displayName = \"PaginationPrevious\"\n\nconst PaginationNext = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof PaginationLink>) => (\n  <PaginationLink\n    aria-label=\"Go to next page\"\n    size=\"default\"\n    className={cn(\"gap-1 pr-2.5\", className)}\n    {...props}\n  >\n    <span>Next</span>\n    <ChevronRight className=\"h-4 w-4\" />\n  </PaginationLink>\n)\nPaginationNext.displayName = \"PaginationNext\"\n\nconst PaginationEllipsis = ({\n  className,\n  ...props\n}: React.ComponentProps<\"span\">) => (\n  <span\n    aria-hidden\n    className={cn(\"flex h-9 w-9 items-center justify-center\", className)}\n    {...props}\n  >\n    <MoreHorizontal className=\"h-4 w-4\" />\n    <span className=\"sr-only\">More pages</span>\n  </span>\n)\nPaginationEllipsis.displayName = \"PaginationEllipsis\"\n\nexport {\n  Pagination,\n  PaginationContent,\n  PaginationEllipsis,\n  PaginationItem,\n  PaginationLink,\n  PaginationNext,\n  PaginationPrevious,\n}\n","path":null,"size_bytes":2751,"size_tokens":null},"client/src/components/ui/hover-card.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as HoverCardPrimitive from \"@radix-ui/react-hover-card\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst HoverCard = HoverCardPrimitive.Root\n\nconst HoverCardTrigger = HoverCardPrimitive.Trigger\n\nconst HoverCardContent = React.forwardRef<\n  React.ElementRef<typeof HoverCardPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof HoverCardPrimitive.Content>\n>(({ className, align = \"center\", sideOffset = 4, ...props }, ref) => (\n  <HoverCardPrimitive.Content\n    ref={ref}\n    align={align}\n    sideOffset={sideOffset}\n    className={cn(\n      \"z-50 w-64 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-hover-card-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nHoverCardContent.displayName = HoverCardPrimitive.Content.displayName\n\nexport { HoverCard, HoverCardTrigger, HoverCardContent }\n","path":null,"size_bytes":1251,"size_tokens":null},"client/src/hooks/use-toast.ts":{"content":"import * as React from \"react\"\n\nimport type {\n  ToastActionElement,\n  ToastProps,\n} from \"@/components/ui/toast\"\n\nconst TOAST_LIMIT = 1\nconst TOAST_REMOVE_DELAY = 1000000\n\ntype ToasterToast = ToastProps & {\n  id: string\n  title?: React.ReactNode\n  description?: React.ReactNode\n  action?: ToastActionElement\n}\n\nconst actionTypes = {\n  ADD_TOAST: \"ADD_TOAST\",\n  UPDATE_TOAST: \"UPDATE_TOAST\",\n  DISMISS_TOAST: \"DISMISS_TOAST\",\n  REMOVE_TOAST: \"REMOVE_TOAST\",\n} as const\n\nlet count = 0\n\nfunction genId() {\n  count = (count + 1) % Number.MAX_SAFE_INTEGER\n  return count.toString()\n}\n\ntype ActionType = typeof actionTypes\n\ntype Action =\n  | {\n      type: ActionType[\"ADD_TOAST\"]\n      toast: ToasterToast\n    }\n  | {\n      type: ActionType[\"UPDATE_TOAST\"]\n      toast: Partial<ToasterToast>\n    }\n  | {\n      type: ActionType[\"DISMISS_TOAST\"]\n      toastId?: ToasterToast[\"id\"]\n    }\n  | {\n      type: ActionType[\"REMOVE_TOAST\"]\n      toastId?: ToasterToast[\"id\"]\n    }\n\ninterface State {\n  toasts: ToasterToast[]\n}\n\nconst toastTimeouts = new Map<string, ReturnType<typeof setTimeout>>()\n\nconst addToRemoveQueue = (toastId: string) => {\n  if (toastTimeouts.has(toastId)) {\n    return\n  }\n\n  const timeout = setTimeout(() => {\n    toastTimeouts.delete(toastId)\n    dispatch({\n      type: \"REMOVE_TOAST\",\n      toastId: toastId,\n    })\n  }, TOAST_REMOVE_DELAY)\n\n  toastTimeouts.set(toastId, timeout)\n}\n\nexport const reducer = (state: State, action: Action): State => {\n  switch (action.type) {\n    case \"ADD_TOAST\":\n      return {\n        ...state,\n        toasts: [action.toast, ...state.toasts].slice(0, TOAST_LIMIT),\n      }\n\n    case \"UPDATE_TOAST\":\n      return {\n        ...state,\n        toasts: state.toasts.map((t) =>\n          t.id === action.toast.id ? { ...t, ...action.toast } : t\n        ),\n      }\n\n    case \"DISMISS_TOAST\": {\n      const { toastId } = action\n\n      // ! Side effects ! - This could be extracted into a dismissToast() action,\n      // but I'll keep it here for simplicity\n      if (toastId) {\n        addToRemoveQueue(toastId)\n      } else {\n        state.toasts.forEach((toast) => {\n          addToRemoveQueue(toast.id)\n        })\n      }\n\n      return {\n        ...state,\n        toasts: state.toasts.map((t) =>\n          t.id === toastId || toastId === undefined\n            ? {\n                ...t,\n                open: false,\n              }\n            : t\n        ),\n      }\n    }\n    case \"REMOVE_TOAST\":\n      if (action.toastId === undefined) {\n        return {\n          ...state,\n          toasts: [],\n        }\n      }\n      return {\n        ...state,\n        toasts: state.toasts.filter((t) => t.id !== action.toastId),\n      }\n  }\n}\n\nconst listeners: Array<(state: State) => void> = []\n\nlet memoryState: State = { toasts: [] }\n\nfunction dispatch(action: Action) {\n  memoryState = reducer(memoryState, action)\n  listeners.forEach((listener) => {\n    listener(memoryState)\n  })\n}\n\ntype Toast = Omit<ToasterToast, \"id\">\n\nfunction toast({ ...props }: Toast) {\n  const id = genId()\n\n  const update = (props: ToasterToast) =>\n    dispatch({\n      type: \"UPDATE_TOAST\",\n      toast: { ...props, id },\n    })\n  const dismiss = () => dispatch({ type: \"DISMISS_TOAST\", toastId: id })\n\n  dispatch({\n    type: \"ADD_TOAST\",\n    toast: {\n      ...props,\n      id,\n      open: true,\n      onOpenChange: (open) => {\n        if (!open) dismiss()\n      },\n    },\n  })\n\n  return {\n    id: id,\n    dismiss,\n    update,\n  }\n}\n\nfunction useToast() {\n  const [state, setState] = React.useState<State>(memoryState)\n\n  React.useEffect(() => {\n    listeners.push(setState)\n    return () => {\n      const index = listeners.indexOf(setState)\n      if (index > -1) {\n        listeners.splice(index, 1)\n      }\n    }\n  }, [state])\n\n  return {\n    ...state,\n    toast,\n    dismiss: (toastId?: string) => dispatch({ type: \"DISMISS_TOAST\", toastId }),\n  }\n}\n\nexport { useToast, toast }\n","path":null,"size_bytes":3895,"size_tokens":null},"tailwind.config.ts":{"content":"import type { Config } from \"tailwindcss\";\n\nexport default {\n  darkMode: [\"class\"],\n  content: [\"./client/index.html\", \"./client/src/**/*.{js,jsx,ts,tsx}\"],\n  theme: {\n    extend: {\n      borderRadius: {\n        lg: \".5625rem\", /* 9px */\n        md: \".375rem\", /* 6px */\n        sm: \".1875rem\", /* 3px */\n      },\n      colors: {\n        // Flat / base colors (regular buttons)\n        background: \"hsl(var(--background) / <alpha-value>)\",\n        foreground: \"hsl(var(--foreground) / <alpha-value>)\",\n        border: \"hsl(var(--border) / <alpha-value>)\",\n        input: \"hsl(var(--input) / <alpha-value>)\",\n        card: {\n          DEFAULT: \"hsl(var(--card) / <alpha-value>)\",\n          foreground: \"hsl(var(--card-foreground) / <alpha-value>)\",\n          border: \"hsl(var(--card-border) / <alpha-value>)\",\n        },\n        popover: {\n          DEFAULT: \"hsl(var(--popover) / <alpha-value>)\",\n          foreground: \"hsl(var(--popover-foreground) / <alpha-value>)\",\n          border: \"hsl(var(--popover-border) / <alpha-value>)\",\n        },\n        primary: {\n          DEFAULT: \"hsl(var(--primary) / <alpha-value>)\",\n          foreground: \"hsl(var(--primary-foreground) / <alpha-value>)\",\n          border: \"var(--primary-border)\",\n        },\n        secondary: {\n          DEFAULT: \"hsl(var(--secondary) / <alpha-value>)\",\n          foreground: \"hsl(var(--secondary-foreground) / <alpha-value>)\",\n          border: \"var(--secondary-border)\",\n        },\n        muted: {\n          DEFAULT: \"hsl(var(--muted) / <alpha-value>)\",\n          foreground: \"hsl(var(--muted-foreground) / <alpha-value>)\",\n          border: \"var(--muted-border)\",\n        },\n        accent: {\n          DEFAULT: \"hsl(var(--accent) / <alpha-value>)\",\n          foreground: \"hsl(var(--accent-foreground) / <alpha-value>)\",\n          border: \"var(--accent-border)\",\n        },\n        destructive: {\n          DEFAULT: \"hsl(var(--destructive) / <alpha-value>)\",\n          foreground: \"hsl(var(--destructive-foreground) / <alpha-value>)\",\n          border: \"var(--destructive-border)\",\n        },\n        ring: \"hsl(var(--ring) / <alpha-value>)\",\n        chart: {\n          \"1\": \"hsl(var(--chart-1) / <alpha-value>)\",\n          \"2\": \"hsl(var(--chart-2) / <alpha-value>)\",\n          \"3\": \"hsl(var(--chart-3) / <alpha-value>)\",\n          \"4\": \"hsl(var(--chart-4) / <alpha-value>)\",\n          \"5\": \"hsl(var(--chart-5) / <alpha-value>)\",\n        },\n        sidebar: {\n          ring: \"hsl(var(--sidebar-ring) / <alpha-value>)\",\n          DEFAULT: \"hsl(var(--sidebar) / <alpha-value>)\",\n          foreground: \"hsl(var(--sidebar-foreground) / <alpha-value>)\",\n          border: \"hsl(var(--sidebar-border) / <alpha-value>)\",\n        },\n        \"sidebar-primary\": {\n          DEFAULT: \"hsl(var(--sidebar-primary) / <alpha-value>)\",\n          foreground: \"hsl(var(--sidebar-primary-foreground) / <alpha-value>)\",\n          border: \"var(--sidebar-primary-border)\",\n        },\n        \"sidebar-accent\": {\n          DEFAULT: \"hsl(var(--sidebar-accent) / <alpha-value>)\",\n          foreground: \"hsl(var(--sidebar-accent-foreground) / <alpha-value>)\",\n          border: \"var(--sidebar-accent-border)\"\n        },\n        status: {\n          online: \"rgb(34 197 94)\",\n          away: \"rgb(245 158 11)\",\n          busy: \"rgb(239 68 68)\",\n          offline: \"rgb(156 163 175)\",\n        },\n      },\n      fontFamily: {\n        sans: [\"var(--font-sans)\"],\n        serif: [\"var(--font-serif)\"],\n        mono: [\"var(--font-mono)\"],\n      },\n      keyframes: {\n        \"accordion-down\": {\n          from: { height: \"0\" },\n          to: { height: \"var(--radix-accordion-content-height)\" },\n        },\n        \"accordion-up\": {\n          from: { height: \"var(--radix-accordion-content-height)\" },\n          to: { height: \"0\" },\n        },\n      },\n      animation: {\n        \"accordion-down\": \"accordion-down 0.2s ease-out\",\n        \"accordion-up\": \"accordion-up 0.2s ease-out\",\n      },\n    },\n  },\n  plugins: [require(\"tailwindcss-animate\"), require(\"@tailwindcss/typography\")],\n} satisfies Config;\n","path":null,"size_bytes":4050,"size_tokens":null},"client/src/components/ui/sidebar.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { cva, VariantProps } from \"class-variance-authority\"\nimport { PanelLeftIcon } from \"lucide-react\"\n\nimport { useIsMobile } from \"@/hooks/use-mobile\"\nimport { cn } from \"@/lib/utils\"\nimport { Button } from \"@/components/ui/button\"\nimport { Input } from \"@/components/ui/input\"\nimport { Separator } from \"@/components/ui/separator\"\nimport {\n  Sheet,\n  SheetContent,\n  SheetDescription,\n  SheetHeader,\n  SheetTitle,\n} from \"@/components/ui/sheet\"\nimport { Skeleton } from \"@/components/ui/skeleton\"\nimport {\n  Tooltip,\n  TooltipContent,\n  TooltipProvider,\n  TooltipTrigger,\n} from \"@/components/ui/tooltip\"\n\nconst SIDEBAR_COOKIE_NAME = \"sidebar_state\"\nconst SIDEBAR_COOKIE_MAX_AGE = 60 * 60 * 24 * 7\nconst SIDEBAR_WIDTH = \"16rem\"\nconst SIDEBAR_WIDTH_MOBILE = \"18rem\"\nconst SIDEBAR_WIDTH_ICON = \"3rem\"\nconst SIDEBAR_KEYBOARD_SHORTCUT = \"b\"\n\ntype SidebarContextProps = {\n  state: \"expanded\" | \"collapsed\"\n  open: boolean\n  setOpen: (open: boolean) => void\n  openMobile: boolean\n  setOpenMobile: (open: boolean) => void\n  isMobile: boolean\n  toggleSidebar: () => void\n}\n\nconst SidebarContext = React.createContext<SidebarContextProps | null>(null)\n\nfunction useSidebar() {\n  const context = React.useContext(SidebarContext)\n  if (!context) {\n    throw new Error(\"useSidebar must be used within a SidebarProvider.\")\n  }\n\n  return context\n}\n\nfunction SidebarProvider({\n  defaultOpen = true,\n  open: openProp,\n  onOpenChange: setOpenProp,\n  className,\n  style,\n  children,\n  ...props\n}: React.ComponentProps<\"div\"> & {\n  defaultOpen?: boolean\n  open?: boolean\n  onOpenChange?: (open: boolean) => void\n}) {\n  const isMobile = useIsMobile()\n  const [openMobile, setOpenMobile] = React.useState(false)\n\n  // This is the internal state of the sidebar.\n  // We use openProp and setOpenProp for control from outside the component.\n  const [_open, _setOpen] = React.useState(defaultOpen)\n  const open = openProp ?? _open\n  const setOpen = React.useCallback(\n    (value: boolean | ((value: boolean) => boolean)) => {\n      const openState = typeof value === \"function\" ? value(open) : value\n      if (setOpenProp) {\n        setOpenProp(openState)\n      } else {\n        _setOpen(openState)\n      }\n\n      // This sets the cookie to keep the sidebar state.\n      document.cookie = `${SIDEBAR_COOKIE_NAME}=${openState}; path=/; max-age=${SIDEBAR_COOKIE_MAX_AGE}`\n    },\n    [setOpenProp, open]\n  )\n\n  // Helper to toggle the sidebar.\n  const toggleSidebar = React.useCallback(() => {\n    return isMobile ? setOpenMobile((open) => !open) : setOpen((open) => !open)\n  }, [isMobile, setOpen, setOpenMobile])\n\n  // Adds a keyboard shortcut to toggle the sidebar.\n  React.useEffect(() => {\n    const handleKeyDown = (event: KeyboardEvent) => {\n      if (\n        event.key === SIDEBAR_KEYBOARD_SHORTCUT &&\n        (event.metaKey || event.ctrlKey)\n      ) {\n        event.preventDefault()\n        toggleSidebar()\n      }\n    }\n\n    window.addEventListener(\"keydown\", handleKeyDown)\n    return () => window.removeEventListener(\"keydown\", handleKeyDown)\n  }, [toggleSidebar])\n\n  // We add a state so that we can do data-state=\"expanded\" or \"collapsed\".\n  // This makes it easier to style the sidebar with Tailwind classes.\n  const state = open ? \"expanded\" : \"collapsed\"\n\n  const contextValue = React.useMemo<SidebarContextProps>(\n    () => ({\n      state,\n      open,\n      setOpen,\n      isMobile,\n      openMobile,\n      setOpenMobile,\n      toggleSidebar,\n    }),\n    [state, open, setOpen, isMobile, openMobile, setOpenMobile, toggleSidebar]\n  )\n\n  return (\n    <SidebarContext.Provider value={contextValue}>\n      <TooltipProvider delayDuration={0}>\n        <div\n          data-slot=\"sidebar-wrapper\"\n          style={\n            {\n              \"--sidebar-width\": SIDEBAR_WIDTH,\n              \"--sidebar-width-icon\": SIDEBAR_WIDTH_ICON,\n              ...style,\n            } as React.CSSProperties\n          }\n          className={cn(\n            \"group/sidebar-wrapper has-data-[variant=inset]:bg-sidebar flex min-h-svh w-full\",\n            className\n          )}\n          {...props}\n        >\n          {children}\n        </div>\n      </TooltipProvider>\n    </SidebarContext.Provider>\n  )\n}\n\nfunction Sidebar({\n  side = \"left\",\n  variant = \"sidebar\",\n  collapsible = \"offcanvas\",\n  className,\n  children,\n  ...props\n}: React.ComponentProps<\"div\"> & {\n  side?: \"left\" | \"right\"\n  variant?: \"sidebar\" | \"floating\" | \"inset\"\n  collapsible?: \"offcanvas\" | \"icon\" | \"none\"\n}) {\n  const { isMobile, state, openMobile, setOpenMobile } = useSidebar()\n\n  if (collapsible === \"none\") {\n    return (\n      <div\n        data-slot=\"sidebar\"\n        className={cn(\n          \"bg-sidebar text-sidebar-foreground flex h-full w-[var(--sidebar-width)] flex-col\",\n          className\n        )}\n        {...props}\n      >\n        {children}\n      </div>\n    )\n  }\n\n  if (isMobile) {\n    return (\n      <Sheet open={openMobile} onOpenChange={setOpenMobile} {...props}>\n        <SheetContent\n          data-sidebar=\"sidebar\"\n          data-slot=\"sidebar\"\n          data-mobile=\"true\"\n          className=\"bg-sidebar text-sidebar-foreground w-[var(--sidebar-width)] p-0 [&>button]:hidden\"\n          style={\n            {\n              \"--sidebar-width\": SIDEBAR_WIDTH_MOBILE,\n            } as React.CSSProperties\n          }\n          side={side}\n        >\n          <SheetHeader className=\"sr-only\">\n            <SheetTitle>Sidebar</SheetTitle>\n            <SheetDescription>Displays the mobile sidebar.</SheetDescription>\n          </SheetHeader>\n          <div className=\"flex h-full w-full flex-col\">{children}</div>\n        </SheetContent>\n      </Sheet>\n    )\n  }\n\n  return (\n    <div\n      className=\"group peer text-sidebar-foreground hidden md:block\"\n      data-state={state}\n      data-collapsible={state === \"collapsed\" ? collapsible : \"\"}\n      data-variant={variant}\n      data-side={side}\n      data-slot=\"sidebar\"\n    >\n      {/* This is what handles the sidebar gap on desktop */}\n      <div\n        data-slot=\"sidebar-gap\"\n        className={cn(\n          \"relative w-[var(--sidebar-width)] bg-transparent transition-[width] duration-200 ease-linear\",\n          \"group-data-[collapsible=offcanvas]:w-0\",\n          \"group-data-[side=right]:rotate-180\",\n          variant === \"floating\" || variant === \"inset\"\n            ? \"group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)+var(--spacing-4))]\"\n            : \"group-data-[collapsible=icon]:w-[var(--sidebar-width-icon)]\"\n        )}\n      />\n      <div\n        data-slot=\"sidebar-container\"\n        className={cn(\n          \"fixed inset-y-0 z-10 hidden h-svh w-[var(--sidebar-width)] transition-[left,right,width] duration-200 ease-linear md:flex\",\n          side === \"left\"\n            ? \"left-0 group-data-[collapsible=offcanvas]:left-[calc(var(--sidebar-width)*-1)]\"\n            : \"right-0 group-data-[collapsible=offcanvas]:right-[calc(var(--sidebar-width)*-1)]\",\n          // Adjust the padding for floating and inset variants.\n          variant === \"floating\" || variant === \"inset\"\n            ? \"p-2 group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)+var(--spacing-4)+2px)]\"\n            : \"group-data-[collapsible=icon]:w-[var(--sidebar-width-icon)] group-data-[side=left]:border-r group-data-[side=right]:border-l\",\n          className\n        )}\n        {...props}\n      >\n        <div\n          data-sidebar=\"sidebar\"\n          data-slot=\"sidebar-inner\"\n          className=\"bg-sidebar group-data-[variant=floating]:border-sidebar-border flex h-full w-full flex-col group-data-[variant=floating]:rounded-lg group-data-[variant=floating]:border group-data-[variant=floating]:shadow-sm\"\n        >\n          {children}\n        </div>\n      </div>\n    </div>\n  )\n}\n\nfunction SidebarTrigger({\n  className,\n  onClick,\n  ...props\n}: React.ComponentProps<typeof Button>) {\n  const { toggleSidebar } = useSidebar()\n\n  return (\n    <Button\n      data-sidebar=\"trigger\"\n      data-slot=\"sidebar-trigger\"\n      variant=\"ghost\"\n      size=\"icon\"\n      className={cn(\"h-7 w-7\", className)}\n      onClick={(event) => {\n        onClick?.(event)\n        toggleSidebar()\n      }}\n      {...props}\n    >\n      <PanelLeftIcon />\n      <span className=\"sr-only\">Toggle Sidebar</span>\n    </Button>\n  )\n}\n\nfunction SidebarRail({ className, ...props }: React.ComponentProps<\"button\">) {\n  const { toggleSidebar } = useSidebar()\n\n  // Note: Tailwind v3.4 doesn't support \"in-\" selectors. So the rail won't work perfectly.\n  return (\n    <button\n      data-sidebar=\"rail\"\n      data-slot=\"sidebar-rail\"\n      aria-label=\"Toggle Sidebar\"\n      tabIndex={-1}\n      onClick={toggleSidebar}\n      title=\"Toggle Sidebar\"\n      className={cn(\n        \"hover:after:bg-sidebar-border absolute inset-y-0 z-20 hidden w-4 -translate-x-1/2 transition-all ease-linear group-data-[side=left]:-right-4 group-data-[side=right]:left-0 after:absolute after:inset-y-0 after:left-1/2 after:w-[2px] sm:flex\",\n        \"in-data-[side=left]:cursor-w-resize in-data-[side=right]:cursor-e-resize\",\n        \"[[data-side=left][data-state=collapsed]_&]:cursor-e-resize [[data-side=right][data-state=collapsed]_&]:cursor-w-resize\",\n        \"hover:group-data-[collapsible=offcanvas]:bg-sidebar group-data-[collapsible=offcanvas]:translate-x-0 group-data-[collapsible=offcanvas]:after:left-full\",\n        \"[[data-side=left][data-collapsible=offcanvas]_&]:-right-2\",\n        \"[[data-side=right][data-collapsible=offcanvas]_&]:-left-2\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarInset({ className, ...props }: React.ComponentProps<\"main\">) {\n  return (\n    <main\n      data-slot=\"sidebar-inset\"\n      className={cn(\n        \"bg-background relative flex w-full flex-1 flex-col\",\n        \"md:peer-data-[variant=inset]:m-2 md:peer-data-[variant=inset]:ml-0 md:peer-data-[variant=inset]:rounded-xl md:peer-data-[variant=inset]:shadow-sm md:peer-data-[variant=inset]:peer-data-[state=collapsed]:ml-2\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarInput({\n  className,\n  ...props\n}: React.ComponentProps<typeof Input>) {\n  return (\n    <Input\n      data-slot=\"sidebar-input\"\n      data-sidebar=\"input\"\n      className={cn(\"bg-background h-8 w-full shadow-none\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarHeader({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-header\"\n      data-sidebar=\"header\"\n      className={cn(\"flex flex-col gap-2 p-2\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarFooter({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-footer\"\n      data-sidebar=\"footer\"\n      className={cn(\"flex flex-col gap-2 p-2\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarSeparator({\n  className,\n  ...props\n}: React.ComponentProps<typeof Separator>) {\n  return (\n    <Separator\n      data-slot=\"sidebar-separator\"\n      data-sidebar=\"separator\"\n      className={cn(\"bg-sidebar-border mx-2 w-auto\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarContent({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-content\"\n      data-sidebar=\"content\"\n      className={cn(\n        \"flex min-h-0 flex-1 flex-col gap-2 overflow-auto group-data-[collapsible=icon]:overflow-hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarGroup({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-group\"\n      data-sidebar=\"group\"\n      className={cn(\"relative flex w-full min-w-0 flex-col p-2\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarGroupLabel({\n  className,\n  asChild = false,\n  ...props\n}: React.ComponentProps<\"div\"> & { asChild?: boolean }) {\n  const Comp = asChild ? Slot : \"div\"\n\n  return (\n    <Comp\n      data-slot=\"sidebar-group-label\"\n      data-sidebar=\"group-label\"\n      className={cn(\n        \"text-sidebar-foreground/70 ring-sidebar-ring flex h-8 shrink-0 items-center rounded-md px-2 text-xs font-medium outline-hidden transition-[margin,opacity] duration-200 ease-linear focus-visible:ring-2 [&>svg]:h-4 [&>svg]:w-4 [&>svg]:shrink-0\",\n        \"group-data-[collapsible=icon]:-mt-8 group-data-[collapsible=icon]:opacity-0\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarGroupAction({\n  className,\n  asChild = false,\n  ...props\n}: React.ComponentProps<\"button\"> & { asChild?: boolean }) {\n  const Comp = asChild ? Slot : \"button\"\n\n  return (\n    <Comp\n      data-slot=\"sidebar-group-action\"\n      data-sidebar=\"group-action\"\n      className={cn(\n        \"text-sidebar-foreground ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground absolute top-3.5 right-3 flex aspect-square w-5 items-center justify-center rounded-md p-0 outline-hidden transition-transform focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0\",\n        // Increases the hit area of the button on mobile.\n        \"after:absolute after:-inset-2 md:after:hidden\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarGroupContent({\n  className,\n  ...props\n}: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-group-content\"\n      data-sidebar=\"group-content\"\n      className={cn(\"w-full text-sm\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenu({ className, ...props }: React.ComponentProps<\"ul\">) {\n  return (\n    <ul\n      data-slot=\"sidebar-menu\"\n      data-sidebar=\"menu\"\n      className={cn(\"flex w-full min-w-0 flex-col gap-1\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuItem({ className, ...props }: React.ComponentProps<\"li\">) {\n  return (\n    <li\n      data-slot=\"sidebar-menu-item\"\n      data-sidebar=\"menu-item\"\n      className={cn(\"group/menu-item relative\", className)}\n      {...props}\n    />\n  )\n}\n\nconst sidebarMenuButtonVariants = cva(\n  \"peer/menu-button flex w-full items-center gap-2 overflow-hidden rounded-md p-2 text-left text-sm outline-hidden ring-sidebar-ring transition-[width,height,padding] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 group-has-data-[sidebar=menu-action]/menu-item:pr-8 aria-disabled:pointer-events-none aria-disabled:opacity-50 data-[active=true]:bg-sidebar-accent data-[active=true]:font-medium data-[active=true]:text-sidebar-accent-foreground data-[state=open]:hover:bg-sidebar-accent data-[state=open]:hover:text-sidebar-accent-foreground group-data-[collapsible=icon]:w-8! group-data-[collapsible=icon]:h-8! group-data-[collapsible=icon]:p-2! [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0\",\n  {\n    variants: {\n      variant: {\n        default: \"hover:bg-sidebar-accent hover:text-sidebar-accent-foreground\",\n        outline:\n          \"bg-background shadow-[0_0_0_1px_hsl(var(--sidebar-border))] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground hover:shadow-[0_0_0_1px_hsl(var(--sidebar-accent))]\",\n      },\n      size: {\n        default: \"h-8 text-sm\",\n        sm: \"h-7 text-xs\",\n        lg: \"h-12 text-sm group-data-[collapsible=icon]:p-0!\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nfunction SidebarMenuButton({\n  asChild = false,\n  isActive = false,\n  variant = \"default\",\n  size = \"default\",\n  tooltip,\n  className,\n  ...props\n}: React.ComponentProps<\"button\"> & {\n  asChild?: boolean\n  isActive?: boolean\n  tooltip?: string | React.ComponentProps<typeof TooltipContent>\n} & VariantProps<typeof sidebarMenuButtonVariants>) {\n  const Comp = asChild ? Slot : \"button\"\n  const { isMobile, state } = useSidebar()\n\n  const button = (\n    <Comp\n      data-slot=\"sidebar-menu-button\"\n      data-sidebar=\"menu-button\"\n      data-size={size}\n      data-active={isActive}\n      className={cn(sidebarMenuButtonVariants({ variant, size }), className)}\n      {...props}\n    />\n  )\n\n  if (!tooltip) {\n    return button\n  }\n\n  if (typeof tooltip === \"string\") {\n    tooltip = {\n      children: tooltip,\n    }\n  }\n\n  return (\n    <Tooltip>\n      <TooltipTrigger asChild>{button}</TooltipTrigger>\n      <TooltipContent\n        side=\"right\"\n        align=\"center\"\n        hidden={state !== \"collapsed\" || isMobile}\n        {...tooltip}\n      />\n    </Tooltip>\n  )\n}\n\nfunction SidebarMenuAction({\n  className,\n  asChild = false,\n  showOnHover = false,\n  ...props\n}: React.ComponentProps<\"button\"> & {\n  asChild?: boolean\n  showOnHover?: boolean\n}) {\n  const Comp = asChild ? Slot : \"button\"\n\n  return (\n    <Comp\n      data-slot=\"sidebar-menu-action\"\n      data-sidebar=\"menu-action\"\n      className={cn(\n        \"text-sidebar-foreground ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground peer-hover/menu-button:text-sidebar-accent-foreground absolute top-1.5 right-1 flex aspect-square w-5 items-center justify-center rounded-md p-0 outline-hidden transition-transform focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0\",\n        // Increases the hit area of the button on mobile.\n        \"after:absolute after:-inset-2 md:after:hidden\",\n        \"peer-data-[size=sm]/menu-button:top-1\",\n        \"peer-data-[size=default]/menu-button:top-1.5\",\n        \"peer-data-[size=lg]/menu-button:top-2.5\",\n        \"group-data-[collapsible=icon]:hidden\",\n        showOnHover &&\n          \"peer-data-[active=true]/menu-button:text-sidebar-accent-foreground group-focus-within/menu-item:opacity-100 group-hover/menu-item:opacity-100 data-[state=open]:opacity-100 md:opacity-0\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuBadge({\n  className,\n  ...props\n}: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-menu-badge\"\n      data-sidebar=\"menu-badge\"\n      className={cn(\n        \"text-sidebar-foreground pointer-events-none absolute right-1 flex h-5 min-w-5 items-center justify-center rounded-md px-1 text-xs font-medium tabular-nums select-none\",\n        \"peer-hover/menu-button:text-sidebar-accent-foreground peer-data-[active=true]/menu-button:text-sidebar-accent-foreground\",\n        \"peer-data-[size=sm]/menu-button:top-1\",\n        \"peer-data-[size=default]/menu-button:top-1.5\",\n        \"peer-data-[size=lg]/menu-button:top-2.5\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuSkeleton({\n  className,\n  showIcon = false,\n  ...props\n}: React.ComponentProps<\"div\"> & {\n  showIcon?: boolean\n}) {\n  // Random width between 50 to 90%.\n  const width = React.useMemo(() => {\n    return `${Math.floor(Math.random() * 40) + 50}%`\n  }, [])\n\n  return (\n    <div\n      data-slot=\"sidebar-menu-skeleton\"\n      data-sidebar=\"menu-skeleton\"\n      className={cn(\"flex h-8 items-center gap-2 rounded-md px-2\", className)}\n      {...props}\n    >\n      {showIcon && (\n        <Skeleton\n          className=\"size-4 rounded-md\"\n          data-sidebar=\"menu-skeleton-icon\"\n        />\n      )}\n      <Skeleton\n        className=\"h-4 max-w-[var(--skeleton-width)] flex-1\"\n        data-sidebar=\"menu-skeleton-text\"\n        style={\n          {\n            \"--skeleton-width\": width,\n          } as React.CSSProperties\n        }\n      />\n    </div>\n  )\n}\n\nfunction SidebarMenuSub({ className, ...props }: React.ComponentProps<\"ul\">) {\n  return (\n    <ul\n      data-slot=\"sidebar-menu-sub\"\n      data-sidebar=\"menu-sub\"\n      className={cn(\n        \"border-sidebar-border mx-3.5 flex min-w-0 translate-x-px flex-col gap-1 border-l px-2.5 py-0.5\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuSubItem({\n  className,\n  ...props\n}: React.ComponentProps<\"li\">) {\n  return (\n    <li\n      data-slot=\"sidebar-menu-sub-item\"\n      data-sidebar=\"menu-sub-item\"\n      className={cn(\"group/menu-sub-item relative\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuSubButton({\n  asChild = false,\n  size = \"md\",\n  isActive = false,\n  className,\n  ...props\n}: React.ComponentProps<\"a\"> & {\n  asChild?: boolean\n  size?: \"sm\" | \"md\"\n  isActive?: boolean\n}) {\n  const Comp = asChild ? Slot : \"a\"\n\n  return (\n    <Comp\n      data-slot=\"sidebar-menu-sub-button\"\n      data-sidebar=\"menu-sub-button\"\n      data-size={size}\n      data-active={isActive}\n      className={cn(\n        \"text-sidebar-foreground ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground active:bg-sidebar-accent active:text-sidebar-accent-foreground [&>svg]:text-sidebar-accent-foreground flex h-7 min-w-0 -translate-x-px items-center gap-2 overflow-hidden rounded-md px-2 outline outline-2 outline-transparent outline-offset-2 focus-visible:ring-2 disabled:pointer-events-none disabled:opacity-50 aria-disabled:pointer-events-none aria-disabled:opacity-50 [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0\",\n        \"data-[active=true]:bg-sidebar-accent data-[active=true]:text-sidebar-accent-foreground\",\n        size === \"sm\" && \"text-xs\",\n        size === \"md\" && \"text-sm\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nexport {\n  Sidebar,\n  SidebarContent,\n  SidebarFooter,\n  SidebarGroup,\n  SidebarGroupAction,\n  SidebarGroupContent,\n  SidebarGroupLabel,\n  SidebarHeader,\n  SidebarInput,\n  SidebarInset,\n  SidebarMenu,\n  SidebarMenuAction,\n  SidebarMenuBadge,\n  SidebarMenuButton,\n  SidebarMenuItem,\n  SidebarMenuSkeleton,\n  SidebarMenuSub,\n  SidebarMenuSubButton,\n  SidebarMenuSubItem,\n  SidebarProvider,\n  SidebarRail,\n  SidebarSeparator,\n  SidebarTrigger,\n  useSidebar,\n}\n","path":null,"size_bytes":21846,"size_tokens":null},"script/build.ts":{"content":"import { build as esbuild } from \"esbuild\";\nimport { build as viteBuild } from \"vite\";\nimport { rm, readFile } from \"fs/promises\";\n\n// server deps to bundle to reduce openat(2) syscalls\n// which helps cold start times\nconst allowlist = [\n  \"@google/generative-ai\",\n  \"axios\",\n  \"connect-pg-simple\",\n  \"cors\",\n  \"date-fns\",\n  \"drizzle-orm\",\n  \"drizzle-zod\",\n  \"express\",\n  \"express-rate-limit\",\n  \"express-session\",\n  \"jsonwebtoken\",\n  \"memorystore\",\n  \"multer\",\n  \"nanoid\",\n  \"nodemailer\",\n  \"openai\",\n  \"passport\",\n  \"passport-local\",\n  \"pg\",\n  \"stripe\",\n  \"uuid\",\n  \"ws\",\n  \"xlsx\",\n  \"zod\",\n  \"zod-validation-error\",\n];\n\nasync function buildAll() {\n  await rm(\"dist\", { recursive: true, force: true });\n\n  console.log(\"building client...\");\n  await viteBuild();\n\n  console.log(\"building server...\");\n  const pkg = JSON.parse(await readFile(\"package.json\", \"utf-8\"));\n  const allDeps = [\n    ...Object.keys(pkg.dependencies || {}),\n    ...Object.keys(pkg.devDependencies || {}),\n  ];\n  const externals = allDeps.filter((dep) => !allowlist.includes(dep));\n\n  await esbuild({\n    entryPoints: [\"server/index.ts\"],\n    platform: \"node\",\n    bundle: true,\n    format: \"cjs\",\n    outfile: \"dist/index.cjs\",\n    define: {\n      \"process.env.NODE_ENV\": '\"production\"',\n    },\n    minify: true,\n    external: externals,\n    logLevel: \"info\",\n  });\n}\n\nbuildAll().catch((err) => {\n  console.error(err);\n  process.exit(1);\n});\n","path":null,"size_bytes":1417,"size_tokens":null},"client/src/components/ui/toast.tsx":{"content":"import * as React from \"react\"\nimport * as ToastPrimitives from \"@radix-ui/react-toast\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ToastProvider = ToastPrimitives.Provider\n\nconst ToastViewport = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Viewport>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Viewport>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Viewport\n    ref={ref}\n    className={cn(\n      \"fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]\",\n      className\n    )}\n    {...props}\n  />\n))\nToastViewport.displayName = ToastPrimitives.Viewport.displayName\n\nconst toastVariants = cva(\n  \"group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-6 pr-8 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full\",\n  {\n    variants: {\n      variant: {\n        default: \"border bg-background text-foreground\",\n        destructive:\n          \"destructive group border-destructive bg-destructive text-destructive-foreground\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nconst Toast = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Root>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Root> &\n    VariantProps<typeof toastVariants>\n>(({ className, variant, ...props }, ref) => {\n  return (\n    <ToastPrimitives.Root\n      ref={ref}\n      className={cn(toastVariants({ variant }), className)}\n      {...props}\n    />\n  )\n})\nToast.displayName = ToastPrimitives.Root.displayName\n\nconst ToastAction = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Action>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Action>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Action\n    ref={ref}\n    className={cn(\n      \"inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors hover:bg-secondary focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 group-[.destructive]:border-muted/40 group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground group-[.destructive]:focus:ring-destructive\",\n      className\n    )}\n    {...props}\n  />\n))\nToastAction.displayName = ToastPrimitives.Action.displayName\n\nconst ToastClose = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Close>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Close>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Close\n    ref={ref}\n    className={cn(\n      \"absolute right-2 top-2 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity hover:text-foreground focus:opacity-100 focus:outline-none focus:ring-2 group-hover:opacity-100 group-[.destructive]:text-red-300 group-[.destructive]:hover:text-red-50 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600\",\n      className\n    )}\n    toast-close=\"\"\n    {...props}\n  >\n    <X className=\"h-4 w-4\" />\n  </ToastPrimitives.Close>\n))\nToastClose.displayName = ToastPrimitives.Close.displayName\n\nconst ToastTitle = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Title>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Title>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Title\n    ref={ref}\n    className={cn(\"text-sm font-semibold\", className)}\n    {...props}\n  />\n))\nToastTitle.displayName = ToastPrimitives.Title.displayName\n\nconst ToastDescription = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Description>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Description>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Description\n    ref={ref}\n    className={cn(\"text-sm opacity-90\", className)}\n    {...props}\n  />\n))\nToastDescription.displayName = ToastPrimitives.Description.displayName\n\ntype ToastProps = React.ComponentPropsWithoutRef<typeof Toast>\n\ntype ToastActionElement = React.ReactElement<typeof ToastAction>\n\nexport {\n  type ToastProps,\n  type ToastActionElement,\n  ToastProvider,\n  ToastViewport,\n  Toast,\n  ToastTitle,\n  ToastDescription,\n  ToastClose,\n  ToastAction,\n}\n","path":null,"size_bytes":4845,"size_tokens":null},"client/src/components/ui/resizable.tsx":{"content":"\"use client\"\n\nimport { GripVertical } from \"lucide-react\"\nimport * as ResizablePrimitive from \"react-resizable-panels\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ResizablePanelGroup = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof ResizablePrimitive.PanelGroup>) => (\n  <ResizablePrimitive.PanelGroup\n    className={cn(\n      \"flex h-full w-full data-[panel-group-direction=vertical]:flex-col\",\n      className\n    )}\n    {...props}\n  />\n)\n\nconst ResizablePanel = ResizablePrimitive.Panel\n\nconst ResizableHandle = ({\n  withHandle,\n  className,\n  ...props\n}: React.ComponentProps<typeof ResizablePrimitive.PanelResizeHandle> & {\n  withHandle?: boolean\n}) => (\n  <ResizablePrimitive.PanelResizeHandle\n    className={cn(\n      \"relative flex w-px items-center justify-center bg-border after:absolute after:inset-y-0 after:left-1/2 after:w-1 after:-translate-x-1/2 focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring focus-visible:ring-offset-1 data-[panel-group-direction=vertical]:h-px data-[panel-group-direction=vertical]:w-full data-[panel-group-direction=vertical]:after:left-0 data-[panel-group-direction=vertical]:after:h-1 data-[panel-group-direction=vertical]:after:w-full data-[panel-group-direction=vertical]:after:-translate-y-1/2 data-[panel-group-direction=vertical]:after:translate-x-0 [&[data-panel-group-direction=vertical]>div]:rotate-90\",\n      className\n    )}\n    {...props}\n  >\n    {withHandle && (\n      <div className=\"z-10 flex h-4 w-3 items-center justify-center rounded-sm border bg-border\">\n        <GripVertical className=\"h-2.5 w-2.5\" />\n      </div>\n    )}\n  </ResizablePrimitive.PanelResizeHandle>\n)\n\nexport { ResizablePanelGroup, ResizablePanel, ResizableHandle }\n","path":null,"size_bytes":1723,"size_tokens":null},"client/src/components/ui/navigation-menu.tsx":{"content":"import * as React from \"react\"\nimport * as NavigationMenuPrimitive from \"@radix-ui/react-navigation-menu\"\nimport { cva } from \"class-variance-authority\"\nimport { ChevronDown } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst NavigationMenu = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Root>\n>(({ className, children, ...props }, ref) => (\n  <NavigationMenuPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative z-10 flex max-w-max flex-1 items-center justify-center\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <NavigationMenuViewport />\n  </NavigationMenuPrimitive.Root>\n))\nNavigationMenu.displayName = NavigationMenuPrimitive.Root.displayName\n\nconst NavigationMenuList = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.List\n    ref={ref}\n    className={cn(\n      \"group flex flex-1 list-none items-center justify-center space-x-1\",\n      className\n    )}\n    {...props}\n  />\n))\nNavigationMenuList.displayName = NavigationMenuPrimitive.List.displayName\n\nconst NavigationMenuItem = NavigationMenuPrimitive.Item\n\nconst navigationMenuTriggerStyle = cva(\n  \"group inline-flex h-10 w-max items-center justify-center rounded-md bg-background px-4 py-2 text-sm font-medium transition-colors hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground focus:outline-none disabled:pointer-events-none disabled:opacity-50 data-[state=open]:text-accent-foreground data-[state=open]:bg-accent/50 data-[state=open]:hover:bg-accent data-[state=open]:focus:bg-accent\"\n)\n\nconst NavigationMenuTrigger = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <NavigationMenuPrimitive.Trigger\n    ref={ref}\n    className={cn(navigationMenuTriggerStyle(), \"group\", className)}\n    {...props}\n  >\n    {children}{\" \"}\n    <ChevronDown\n      className=\"relative top-[1px] ml-1 h-3 w-3 transition duration-200 group-data-[state=open]:rotate-180\"\n      aria-hidden=\"true\"\n    />\n  </NavigationMenuPrimitive.Trigger>\n))\nNavigationMenuTrigger.displayName = NavigationMenuPrimitive.Trigger.displayName\n\nconst NavigationMenuContent = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.Content\n    ref={ref}\n    className={cn(\n      \"left-0 top-0 w-full data-[motion^=from-]:animate-in data-[motion^=to-]:animate-out data-[motion^=from-]:fade-in data-[motion^=to-]:fade-out data-[motion=from-end]:slide-in-from-right-52 data-[motion=from-start]:slide-in-from-left-52 data-[motion=to-end]:slide-out-to-right-52 data-[motion=to-start]:slide-out-to-left-52 md:absolute md:w-auto \",\n      className\n    )}\n    {...props}\n  />\n))\nNavigationMenuContent.displayName = NavigationMenuPrimitive.Content.displayName\n\nconst NavigationMenuLink = NavigationMenuPrimitive.Link\n\nconst NavigationMenuViewport = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Viewport>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Viewport>\n>(({ className, ...props }, ref) => (\n  <div className={cn(\"absolute left-0 top-full flex justify-center\")}>\n    <NavigationMenuPrimitive.Viewport\n      className={cn(\n        \"origin-top-center relative mt-1.5 h-[var(--radix-navigation-menu-viewport-height)] w-full overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-90 md:w-[var(--radix-navigation-menu-viewport-width)]\",\n        className\n      )}\n      ref={ref}\n      {...props}\n    />\n  </div>\n))\nNavigationMenuViewport.displayName =\n  NavigationMenuPrimitive.Viewport.displayName\n\nconst NavigationMenuIndicator = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Indicator>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Indicator>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.Indicator\n    ref={ref}\n    className={cn(\n      \"top-full z-[1] flex h-1.5 items-end justify-center overflow-hidden data-[state=visible]:animate-in data-[state=hidden]:animate-out data-[state=hidden]:fade-out data-[state=visible]:fade-in\",\n      className\n    )}\n    {...props}\n  >\n    <div className=\"relative top-[60%] h-2 w-2 rotate-45 rounded-tl-sm bg-border shadow-md\" />\n  </NavigationMenuPrimitive.Indicator>\n))\nNavigationMenuIndicator.displayName =\n  NavigationMenuPrimitive.Indicator.displayName\n\nexport {\n  navigationMenuTriggerStyle,\n  NavigationMenu,\n  NavigationMenuList,\n  NavigationMenuItem,\n  NavigationMenuContent,\n  NavigationMenuTrigger,\n  NavigationMenuLink,\n  NavigationMenuIndicator,\n  NavigationMenuViewport,\n}\n","path":null,"size_bytes":5128,"size_tokens":null},"client/src/components/ui/button.tsx":{"content":"import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst buttonVariants = cva(\n  \"inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\" +\n  \" hover-elevate active-elevate-2\",\n  {\n    variants: {\n      variant: {\n        default:\n          \"bg-primary text-primary-foreground border border-primary-border\",\n        destructive:\n          \"bg-destructive text-destructive-foreground border border-destructive-border\",\n        outline:\n          // Shows the background color of whatever card / sidebar / accent background it is inside of.\n          // Inherits the current text color.\n          \" border [border-color:var(--button-outline)]  shadow-xs active:shadow-none \",\n        secondary: \"border bg-secondary text-secondary-foreground border border-secondary-border \",\n        // Add a transparent border so that when someone toggles a border on later, it doesn't shift layout/size.\n        ghost: \"border border-transparent\",\n      },\n      // Heights are set as \"min\" heights, because sometimes Ai will place large amount of content\n      // inside buttons. With a min-height they will look appropriate with small amounts of content,\n      // but will expand to fit large amounts of content.\n      size: {\n        default: \"min-h-9 px-4 py-2\",\n        sm: \"min-h-8 rounded-md px-3 text-xs\",\n        lg: \"min-h-10 rounded-md px-8\",\n        icon: \"h-9 w-9\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  },\n)\n\nexport interface ButtonProps\n  extends React.ButtonHTMLAttributes<HTMLButtonElement>,\n    VariantProps<typeof buttonVariants> {\n  asChild?: boolean\n}\n\nconst Button = React.forwardRef<HTMLButtonElement, ButtonProps>(\n  ({ className, variant, size, asChild = false, ...props }, ref) => {\n    const Comp = asChild ? Slot : \"button\"\n    return (\n      <Comp\n        className={cn(buttonVariants({ variant, size, className }))}\n        ref={ref}\n        {...props}\n      />\n    )\n  },\n)\nButton.displayName = \"Button\"\n\nexport { Button, buttonVariants }\n","path":null,"size_bytes":2359,"size_tokens":null},"client/src/pages/reports.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from \"@/components/ui/table\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogDescription, DialogFooter } from \"@/components/ui/dialog\";\nimport { Search, FileText, Download, Eye, Clock, Calendar, Send, Plus, Loader2, Trash2, X, CheckCircle2, AlertCircle } from \"lucide-react\";\nimport { queryClient, apiRequest } from \"@/lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport StatusBadge from \"@/components/StatusBadge\";\nimport jsPDF from \"jspdf\";\nimport type { TransferReport, Player } from \"@shared/schema\";\n\ninterface EnrichedReport extends TransferReport {\n  playerName: string;\n  playerPosition?: string;\n}\n\nexport default function Reports() {\n  const [searchQuery, setSearchQuery] = useState(\"\");\n  const [statusFilter, setStatusFilter] = useState(\"all\");\n  const [showGenerateDialog, setShowGenerateDialog] = useState(false);\n  const [selectedPlayer, setSelectedPlayer] = useState<string>(\"\");\n  const [viewReportId, setViewReportId] = useState<string | null>(null);\n  const { toast } = useToast();\n\n  const { data: reports = [], isLoading: reportsLoading } = useQuery<EnrichedReport[]>({\n    queryKey: [\"/api/reports\"],\n  });\n\n  const { data: players = [] } = useQuery<Player[]>({\n    queryKey: [\"/api/players\"],\n  });\n\n  const { data: viewedReport, isLoading: viewLoading } = useQuery<EnrichedReport>({\n    queryKey: [\"/api/reports\", viewReportId],\n    enabled: !!viewReportId,\n  });\n\n  const generateMutation = useMutation({\n    mutationFn: async (playerId: string) => {\n      const res = await apiRequest(\"POST\", \"/api/reports/generate\", { playerId, reportType: \"comprehensive\" });\n      const data = await res.json();\n      if (!res.ok) {\n        throw new Error(data.needsTokens ? `Insufficient tokens. ${data.error}` : data.error);\n      }\n      return data;\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/reports\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/tokens/balance\"] });\n      setShowGenerateDialog(false);\n      setSelectedPlayer(\"\");\n      toast({ title: \"Report Generated\", description: \"Transfer report has been created successfully. 5 tokens spent.\" });\n    },\n    onError: (error: Error) => {\n      toast({ title: \"Error\", description: error.message, variant: \"destructive\" });\n    },\n  });\n\n  const deleteMutation = useMutation({\n    mutationFn: async (id: string) => {\n      await apiRequest(\"DELETE\", `/api/reports/${id}`);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/reports\"] });\n      toast({ title: \"Report Deleted\", description: \"The report has been removed.\" });\n    },\n  });\n\n  const notifyEmbassyMutation = useMutation({\n    mutationFn: async (id: string) => {\n      const res = await apiRequest(\"POST\", `/api/reports/${id}/notify-embassy`);\n      return res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/reports\"] });\n      toast({ title: \"Embassy Notified\", description: \"The embassy has been notified about this report.\" });\n    },\n  });\n\n  const filteredReports = reports.filter((r) => {\n    const matchesSearch = r.playerName?.toLowerCase().includes(searchQuery.toLowerCase());\n    const matchesStatus = statusFilter === \"all\" || r.status === statusFilter;\n    return matchesSearch && matchesStatus;\n  });\n\n  const getStatusBadge = (status: string) => {\n    const config: Record<string, { className: string; label: string }> = {\n      pending: { className: \"bg-gray-100 text-gray-800 dark:bg-gray-800 dark:text-gray-300\", label: \"Pending\" },\n      completed: { className: \"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400\", label: \"Completed\" },\n      expired: { className: \"bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-400\", label: \"Expired\" },\n    };\n    return config[status] || config.pending;\n  };\n\n  const getEligibilityBadge = (status: string | null) => {\n    if (!status) return { className: \"bg-gray-100 text-gray-800\", label: \"N/A\" };\n    const config: Record<string, { className: string; label: string }> = {\n      green: { className: \"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400\", label: \"Eligible\" },\n      yellow: { className: \"bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-400\", label: \"Conditional\" },\n      red: { className: \"bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-400\", label: \"Ineligible\" },\n    };\n    return config[status] || config.red;\n  };\n\n  const downloadPDF = (report: EnrichedReport) => {\n    const doc = new jsPDF();\n    const profile = report.playerProfile as Record<string, any> || {};\n    const eligibility = report.eligibilityScores as Record<string, any> || {};\n    const videos = (report.videosIncluded as any[] || []);\n    const documents = (report.documentsIncluded as any[] || []);\n    const invitations = (report.invitationLetters as any[] || []);\n    const verifications = (report.embassyVerifications as any[] || []);\n    const recommendations = (report.recommendations as string[] || []);\n    const performance = (report.performanceStats as any[] || []);\n    const international = (report.internationalCareer as any[] || []);\n\n    let y = 20;\n    const lineHeight = 7;\n    const margin = 20;\n    const pageWidth = 210;\n\n    const addText = (text: string, size = 10, bold = false) => {\n      if (y > 270) {\n        doc.addPage();\n        y = 20;\n      }\n      doc.setFontSize(size);\n      doc.setFont(\"helvetica\", bold ? \"bold\" : \"normal\");\n      doc.text(text, margin, y);\n      y += lineHeight;\n    };\n\n    const addSection = (title: string) => {\n      y += 5;\n      addText(title, 14, true);\n      y += 2;\n    };\n\n    doc.setFillColor(30, 58, 138);\n    doc.rect(0, 0, pageWidth, 40, \"F\");\n    doc.setTextColor(255, 255, 255);\n    doc.setFontSize(22);\n    doc.setFont(\"helvetica\", \"bold\");\n    doc.text(\"TRANSFER ELIGIBILITY REPORT\", margin, 25);\n    doc.setFontSize(10);\n    doc.setFont(\"helvetica\", \"normal\");\n    doc.text(`Verification Code: ${report.verificationCode || \"N/A\"}`, margin, 35);\n    y = 50;\n    doc.setTextColor(0, 0, 0);\n\n    addSection(\"Player Profile\");\n    addText(`Name: ${profile.name || report.playerName}`);\n    addText(`Position: ${profile.position || \"N/A\"}`);\n    addText(`Nationality: ${profile.nationality || \"N/A\"}${profile.secondNationality ? ` / ${profile.secondNationality}` : \"\"}`);\n    addText(`Date of Birth: ${profile.dateOfBirth || \"N/A\"} (Age: ${profile.age || \"N/A\"})`);\n    addText(`Height: ${profile.height || \"N/A\"} ${profile.heightUnit || \"\"}`);\n    addText(`Weight: ${profile.weight || \"N/A\"} ${profile.weightUnit || \"\"}`);\n    addText(`Preferred Foot: ${profile.preferredFoot || \"N/A\"}`);\n    addText(`Current Club: ${profile.currentClub || \"N/A\"}`);\n    addText(`Market Value: ${profile.marketValue || \"N/A\"}`);\n\n    addSection(\"Transfer Eligibility Summary\");\n    const eligibilityStatus = report.overallEligibilityStatus || \"N/A\";\n    addText(`Overall Status: ${eligibilityStatus.toUpperCase()}`);\n    addText(`Total Minutes Verified: ${report.totalMinutesVerified || 0}`);\n    if (eligibility?.visaScores) {\n      const visas = eligibility.visaScores;\n      addText(`Schengen: ${visas.schengen?.score || 0}% (${visas.schengen?.status || \"N/A\"})`);\n      addText(`O-1 (USA): ${visas.o1?.score || 0}% (${visas.o1?.status || \"N/A\"})`);\n      addText(`P-1 (USA): ${visas.p1?.score || 0}% (${visas.p1?.status || \"N/A\"})`);\n      addText(`UK GBE: ${visas.ukGbe?.score || 0}% (${visas.ukGbe?.status || \"N/A\"})`);\n      addText(`ESC: ${visas.esc?.score || 0}% (${visas.esc?.status || \"N/A\"})`);\n    }\n\n    if (recommendations.length > 0) {\n      addSection(\"Recommendations\");\n      recommendations.forEach((rec, i) => addText(`${i + 1}. ${rec}`));\n    }\n\n    if (performance.length > 0) {\n      addSection(\"Performance Statistics\");\n      performance.forEach(p => {\n        addText(`Season ${p.season}: ${p.gamesPlayed || 0} games, ${p.goals || 0} goals, ${p.assists || 0} assists`);\n      });\n    }\n\n    if (international.length > 0) {\n      addSection(\"International Career\");\n      international.forEach(i => {\n        addText(`${i.nationalTeam} (${i.teamLevel}): ${i.caps || 0} caps, ${i.goals || 0} goals`);\n      });\n    }\n\n    if (videos.length > 0) {\n      addSection(\"Video Evidence\");\n      addText(`Total Videos: ${videos.length}`);\n      videos.slice(0, 5).forEach(v => {\n        addText(`- ${v.title} (${v.source || \"Unknown\"}, ${v.minutesPlayed || 0} mins)`);\n      });\n      if (videos.length > 5) addText(`... and ${videos.length - 5} more videos`);\n    }\n\n    if (documents.length > 0) {\n      addSection(\"Consular Documents\");\n      documents.forEach(d => {\n        addText(`- Code: ${d.verificationCode}, Valid until: ${d.validUntil ? new Date(d.validUntil).toLocaleDateString() : \"N/A\"}`);\n      });\n    }\n\n    if (invitations.length > 0) {\n      addSection(\"Invitation Letters\");\n      invitations.forEach(i => {\n        addText(`- ${i.targetClubName} (${i.targetCountry}): ${i.offerType} - ${i.status}`);\n      });\n    }\n\n    if (verifications.length > 0) {\n      addSection(\"Embassy Verifications\");\n      verifications.forEach(v => {\n        addText(`- ${v.embassyCountry}: ${v.status} (${v.verificationCode || \"N/A\"})`);\n      });\n    }\n\n    y += 10;\n    doc.setFontSize(8);\n    doc.setTextColor(100, 100, 100);\n    doc.text(`Generated: ${new Date(report.generatedAt || Date.now()).toLocaleString()}`, margin, y);\n    y += 5;\n    doc.text(`Valid Until: ${report.validUntil ? new Date(report.validUntil).toLocaleDateString() : \"N/A\"}`, margin, y);\n    y += 5;\n    doc.text(`Report ID: ${report.id}`, margin, y);\n\n    doc.save(`Transfer-Report-${report.playerName?.replace(/\\s+/g, \"-\")}-${report.verificationCode || report.id}.pdf`);\n    toast({ title: \"PDF Downloaded\", description: \"The report has been downloaded successfully.\" });\n  };\n\n  return (\n    <div className=\"p-6 space-y-6\" data-testid=\"page-reports\">\n      <div className=\"flex flex-wrap items-center justify-between gap-4\">\n        <div>\n          <h1 className=\"text-2xl font-semibold\">Transfer Reports</h1>\n          <p className=\"text-muted-foreground\">Generate and manage comprehensive player transfer reports</p>\n        </div>\n        <Button onClick={() => setShowGenerateDialog(true)} data-testid=\"button-new-report\">\n          <Plus className=\"h-4 w-4 mr-2\" />\n          New Report\n        </Button>\n      </div>\n\n      <Card>\n        <CardHeader className=\"pb-4\">\n          <div className=\"flex flex-wrap items-center justify-between gap-4\">\n            <CardTitle className=\"text-lg\">Report History</CardTitle>\n            <div className=\"flex flex-wrap items-center gap-4\">\n              <div className=\"relative\">\n                <Search className=\"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground\" />\n                <Input\n                  placeholder=\"Search by player...\"\n                  value={searchQuery}\n                  onChange={(e) => setSearchQuery(e.target.value)}\n                  className=\"pl-9 w-56\"\n                  data-testid=\"input-search-reports\"\n                />\n              </div>\n              <Select value={statusFilter} onValueChange={setStatusFilter}>\n                <SelectTrigger className=\"w-40\" data-testid=\"select-report-status\">\n                  <SelectValue placeholder=\"Status\" />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"all\">All Statuses</SelectItem>\n                  <SelectItem value=\"pending\">Pending</SelectItem>\n                  <SelectItem value=\"completed\">Completed</SelectItem>\n                  <SelectItem value=\"expired\">Expired</SelectItem>\n                </SelectContent>\n              </Select>\n            </div>\n          </div>\n        </CardHeader>\n        <CardContent>\n          {reportsLoading ? (\n            <div className=\"flex items-center justify-center py-12\">\n              <Loader2 className=\"h-8 w-8 animate-spin text-muted-foreground\" />\n            </div>\n          ) : filteredReports.length === 0 ? (\n            <div className=\"text-center py-12 text-muted-foreground\">\n              <FileText className=\"h-12 w-12 mx-auto mb-4 opacity-50\" />\n              <p>No reports found</p>\n              <p className=\"text-sm mt-2\">Generate a report by selecting a player</p>\n            </div>\n          ) : (\n            <div className=\"border rounded-md overflow-hidden\">\n              <Table>\n                <TableHeader>\n                  <TableRow>\n                    <TableHead className=\"font-bold text-xs uppercase\">Player</TableHead>\n                    <TableHead className=\"font-bold text-xs uppercase\">Generated</TableHead>\n                    <TableHead className=\"font-bold text-xs uppercase\">Data Range</TableHead>\n                    <TableHead className=\"font-bold text-xs uppercase\">Eligibility</TableHead>\n                    <TableHead className=\"font-bold text-xs uppercase\">Status</TableHead>\n                    <TableHead className=\"font-bold text-xs uppercase\">Embassy</TableHead>\n                    <TableHead className=\"font-bold text-xs uppercase text-right\">Actions</TableHead>\n                  </TableRow>\n                </TableHeader>\n                <TableBody>\n                  {filteredReports.map((report) => {\n                    const statusConfig = getStatusBadge(report.status || \"pending\");\n                    const eligConfig = getEligibilityBadge(report.overallEligibilityStatus);\n                    return (\n                      <TableRow key={report.id} data-testid={`row-report-${report.id}`}>\n                        <TableCell className=\"font-medium\">\n                          <div>{report.playerName}</div>\n                          <div className=\"text-xs text-muted-foreground\">{report.playerPosition}</div>\n                        </TableCell>\n                        <TableCell>\n                          <div className=\"flex items-center gap-2 text-sm\">\n                            <Clock className=\"h-3 w-3 text-muted-foreground\" />\n                            {report.generatedAt ? new Date(report.generatedAt).toLocaleDateString() : \"N/A\"}\n                          </div>\n                          <p className=\"text-xs text-muted-foreground\">by {report.generatedByName || \"System\"}</p>\n                        </TableCell>\n                        <TableCell>\n                          <div className=\"flex items-center gap-2 text-sm\">\n                            <Calendar className=\"h-3 w-3 text-muted-foreground\" />\n                            <span>\n                              {report.dataRangeStart ? new Date(report.dataRangeStart).toLocaleDateString() : \"N/A\"} - {report.dataRangeEnd ? new Date(report.dataRangeEnd).toLocaleDateString() : \"N/A\"}\n                            </span>\n                          </div>\n                        </TableCell>\n                        <TableCell>\n                          <Badge variant=\"secondary\" className={eligConfig.className}>\n                            {eligConfig.label}\n                          </Badge>\n                        </TableCell>\n                        <TableCell>\n                          <Badge variant=\"secondary\" className={statusConfig.className}>\n                            {statusConfig.label}\n                          </Badge>\n                        </TableCell>\n                        <TableCell>\n                          {report.embassyNotified ? (\n                            <Badge variant=\"secondary\" className=\"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400\">\n                              <CheckCircle2 className=\"h-3 w-3 mr-1\" />\n                              Notified\n                            </Badge>\n                          ) : (\n                            <Button\n                              size=\"sm\"\n                              variant=\"outline\"\n                              onClick={() => notifyEmbassyMutation.mutate(report.id)}\n                              disabled={notifyEmbassyMutation.isPending}\n                              data-testid={`button-notify-embassy-${report.id}`}\n                            >\n                              <Send className=\"h-3 w-3 mr-1\" />\n                              Notify\n                            </Button>\n                          )}\n                        </TableCell>\n                        <TableCell>\n                          <div className=\"flex items-center justify-end gap-1\">\n                            <Button\n                              size=\"icon\"\n                              variant=\"ghost\"\n                              onClick={() => setViewReportId(report.id)}\n                              data-testid={`button-view-report-${report.id}`}\n                            >\n                              <Eye className=\"h-4 w-4\" />\n                            </Button>\n                            <Button\n                              size=\"icon\"\n                              variant=\"ghost\"\n                              onClick={() => downloadPDF(report)}\n                              data-testid={`button-download-report-${report.id}`}\n                            >\n                              <Download className=\"h-4 w-4\" />\n                            </Button>\n                            <Button\n                              size=\"icon\"\n                              variant=\"ghost\"\n                              onClick={() => deleteMutation.mutate(report.id)}\n                              disabled={deleteMutation.isPending}\n                              data-testid={`button-delete-report-${report.id}`}\n                            >\n                              <Trash2 className=\"h-4 w-4\" />\n                            </Button>\n                          </div>\n                        </TableCell>\n                      </TableRow>\n                    );\n                  })}\n                </TableBody>\n              </Table>\n            </div>\n          )}\n        </CardContent>\n      </Card>\n\n      <Dialog open={showGenerateDialog} onOpenChange={setShowGenerateDialog}>\n        <DialogContent>\n          <DialogHeader>\n            <DialogTitle>Generate Transfer Report</DialogTitle>\n            <DialogDescription>\n              Select a player to generate a comprehensive transfer eligibility report including profile, stats, documents, and visa eligibility.\n            </DialogDescription>\n          </DialogHeader>\n          <div className=\"py-4\">\n            <Select value={selectedPlayer} onValueChange={setSelectedPlayer}>\n              <SelectTrigger data-testid=\"select-player-for-report\">\n                <SelectValue placeholder=\"Select a player\" />\n              </SelectTrigger>\n              <SelectContent>\n                {players.map((player) => (\n                  <SelectItem key={player.id} value={player.id}>\n                    {player.firstName} {player.lastName} - {player.position}\n                  </SelectItem>\n                ))}\n              </SelectContent>\n            </Select>\n          </div>\n          <DialogFooter>\n            <Button variant=\"outline\" onClick={() => setShowGenerateDialog(false)}>\n              Cancel\n            </Button>\n            <Button\n              onClick={() => generateMutation.mutate(selectedPlayer)}\n              disabled={!selectedPlayer || generateMutation.isPending}\n              data-testid=\"button-confirm-generate\"\n            >\n              {generateMutation.isPending && <Loader2 className=\"h-4 w-4 mr-2 animate-spin\" />}\n              Generate Report\n            </Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n\n      <Dialog open={!!viewReportId} onOpenChange={(open) => !open && setViewReportId(null)}>\n        <DialogContent className=\"max-w-3xl max-h-[80vh] overflow-y-auto\">\n          <DialogHeader>\n            <DialogTitle>Transfer Report Details</DialogTitle>\n            <DialogDescription>\n              Verification Code: {viewedReport?.verificationCode || \"Loading...\"}\n            </DialogDescription>\n          </DialogHeader>\n          {viewLoading ? (\n            <div className=\"flex items-center justify-center py-12\">\n              <Loader2 className=\"h-8 w-8 animate-spin\" />\n            </div>\n          ) : viewedReport ? (\n            <div className=\"space-y-6\">\n              <div className=\"grid grid-cols-2 gap-4\">\n                <div>\n                  <h3 className=\"font-semibold mb-2\">Player Information</h3>\n                  <div className=\"space-y-1 text-sm\">\n                    <p><span className=\"text-muted-foreground\">Name:</span> {viewedReport.playerName}</p>\n                    <p><span className=\"text-muted-foreground\">Position:</span> {(viewedReport.playerProfile as any)?.position || \"N/A\"}</p>\n                    <p><span className=\"text-muted-foreground\">Nationality:</span> {(viewedReport.playerProfile as any)?.nationality || \"N/A\"}</p>\n                    <p><span className=\"text-muted-foreground\">Club:</span> {(viewedReport.playerProfile as any)?.currentClub || \"N/A\"}</p>\n                  </div>\n                </div>\n                <div>\n                  <h3 className=\"font-semibold mb-2\">Eligibility Summary</h3>\n                  <div className=\"space-y-2\">\n                    <div className=\"flex items-center gap-2\">\n                      <span className=\"text-muted-foreground text-sm\">Overall:</span>\n                      <Badge className={getEligibilityBadge(viewedReport.overallEligibilityStatus).className}>\n                        {viewedReport.overallEligibilityStatus?.toUpperCase()}\n                      </Badge>\n                    </div>\n                    <p className=\"text-sm\"><span className=\"text-muted-foreground\">Minutes Verified:</span> {viewedReport.totalMinutesVerified}</p>\n                  </div>\n                </div>\n              </div>\n\n              {(viewedReport.recommendations as string[])?.length > 0 && (\n                <div>\n                  <h3 className=\"font-semibold mb-2\">Recommendations</h3>\n                  <ul className=\"list-disc pl-5 space-y-1 text-sm\">\n                    {(viewedReport.recommendations as string[]).map((rec, i) => (\n                      <li key={i}>{rec}</li>\n                    ))}\n                  </ul>\n                </div>\n              )}\n\n              <div className=\"flex items-center justify-between pt-4 border-t\">\n                <div className=\"text-sm text-muted-foreground\">\n                  <p>Generated: {viewedReport.generatedAt ? new Date(viewedReport.generatedAt).toLocaleString() : \"N/A\"}</p>\n                  <p>Valid Until: {viewedReport.validUntil ? new Date(viewedReport.validUntil).toLocaleDateString() : \"N/A\"}</p>\n                </div>\n                <Button onClick={() => downloadPDF(viewedReport)}>\n                  <Download className=\"h-4 w-4 mr-2\" />\n                  Download PDF\n                </Button>\n              </div>\n            </div>\n          ) : null}\n        </DialogContent>\n      </Dialog>\n    </div>\n  );\n}\n","path":null,"size_bytes":23591,"size_tokens":null},"replit.md":{"content":"# VisaReady - Player Compliance & Visa Eligibility Platform\n\n## Overview\n\nVisaReady is an enterprise compliance platform designed for football clubs to manage player visa eligibility and international transfer compliance. The platform enables sporting directors, legal teams, scouts, and coaches to track player performance data, calculate visa eligibility scores across multiple jurisdictions (Schengen, UK GBE, US P-1/O-1, Middle East, Asia), generate consular documentation, and coordinate with embassies for verification.\n\nThe system serves three primary user types:\n- **Team Users** (Sporting Directors, Legal, Coaches): Manage squad players, generate compliance reports, track visa eligibility\n- **Scouts/Agents**: Discover players, initiate transfer inquiries, view eligibility data\n- **Embassy Officials**: View-only access to verify player documentation for visa processing\n\n## User Preferences\n\nPreferred communication style: Simple, everyday language.\n\n## System Architecture\n\n### Frontend Architecture\n- **Framework**: React 18 with TypeScript\n- **Routing**: Wouter (lightweight React router)\n- **State Management**: TanStack Query for server state, React hooks for local state\n- **UI Components**: shadcn/ui component library built on Radix UI primitives\n- **Styling**: Tailwind CSS with custom design tokens, CSS variables for theming\n- **Build Tool**: Vite with React plugin\n\nThe frontend follows a pages-based architecture with reusable components. Role-based routing directs users to appropriate dashboards (TeamRouter, ScoutDashboard, EmbassyDashboard).\n\n### Backend Architecture\n- **Framework**: Express.js with TypeScript\n- **API Pattern**: RESTful API with session-based authentication\n- **Session Management**: express-session with PostgreSQL store (connect-pg-simple)\n- **Authentication**: Dual system supporting Replit Auth (OpenID Connect) and custom username/password auth\n- **Middleware**: Role-based access control (requireAuth, requireTeamRole, requireScoutRole, requireEmbassyRole)\n\n### Data Storage\n- **Database**: PostgreSQL\n- **ORM**: Drizzle ORM with drizzle-zod for schema validation\n- **Schema Location**: `shared/schema.ts` contains all table definitions\n- **Migrations**: Managed via drizzle-kit (`db:push` command)\n\nKey entities: users, teams, clubs, players, playerMetrics, videos, videoInsights, eligibilityScores, complianceOrders, complianceDocuments, embassyVerifications, scoutingInquiries, conversations, messages\n\n### Authentication & Authorization\n- Session-based auth with PostgreSQL session store\n- Role hierarchy: admin > sporting_director > legal/scout/coach\n- Embassy users have separate isolated access to document verification\n- Replit Auth integration for SSO capability\n\n### Design System\n- Material Design-inspired with custom color palette (mauve/pink accent colors)\n- Status-driven visual language: Green (eligible 60%+), Yellow (conditional 35-59%), Red (ineligible <35%)\n- Dark mode support via CSS class toggle\n- Roboto font family via Google Fonts\n\n## External Dependencies\n\n### AI/ML Services\n- **OpenAI API**: Video analysis and performance insights generation (`/api/videos/:id/analyze`)\n\n### Database\n- **PostgreSQL**: Primary data store (requires DATABASE_URL environment variable)\n\n### Authentication\n- **Replit Auth**: OpenID Connect integration for Replit-hosted deployments\n- **Passport.js**: Authentication middleware with local and OIDC strategies\n\n### Third-Party Integrations (Planned/Mock)\n- Video platform integrations: Wyscout, Transfermarkt, Veo Cameras\n- PDF generation for compliance reports (jspdf)\n- Excel export capabilities (xlsx)\n\n### Environment Variables Required\n- `DATABASE_URL`: PostgreSQL connection string\n- `SESSION_SECRET`: Session encryption key\n- `OPENAI_API_KEY`: OpenAI API access\n- `ISSUER_URL`: Replit OIDC issuer (defaults to https://replit.com/oidc)\n- `REPL_ID`: Replit deployment identifier","path":null,"size_bytes":3896,"size_tokens":null},"client/src/pages/dashboard.tsx":{"content":"import { useState } from \"react\";\nimport { useLocation } from \"wouter\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport StatsCard from \"@/components/StatsCard\";\nimport PlayerCard from \"@/components/PlayerCard\";\nimport EmbassyVerificationTable from \"@/components/EmbassyVerificationTable\";\nimport ScoutingInquiryCard from \"@/components/ScoutingInquiryCard\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Input } from \"@/components/ui/input\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { Users, FileCheck, AlertTriangle, TrendingUp, Search, Plus, Bell } from \"lucide-react\";\nimport { mockPlayers, mockDashboardStats, mockEmbassyVerifications, mockScoutingInquiries } from \"@/lib/mock-data\";\nimport type { DashboardStats } from \"@/lib/types\";\n\nexport default function Dashboard() {\n  const [, setLocation] = useLocation();\n  const [searchQuery, setSearchQuery] = useState(\"\");\n\n  const { data: statsData, isLoading: statsLoading } = useQuery<DashboardStats>({\n    queryKey: [\"/api/dashboard/stats\"],\n  });\n\n  const { data: verificationsData } = useQuery<any[]>({\n    queryKey: [\"/api/embassy/verifications\"],\n  });\n\n  const { data: inquiriesData } = useQuery<any[]>({\n    queryKey: [\"/api/scouting/inquiries\"],\n  });\n\n  const stats = statsData || mockDashboardStats;\n  const recentPlayers = mockPlayers.slice(0, 4);\n  const recentVerifications = verificationsData?.slice(0, 3) || mockEmbassyVerifications.slice(0, 3);\n  const recentInquiries = inquiriesData?.slice(0, 2) || mockScoutingInquiries.slice(0, 2);\n\n  const filteredPlayers = recentPlayers.filter(\n    (p) =>\n      p.firstName.toLowerCase().includes(searchQuery.toLowerCase()) ||\n      p.lastName.toLowerCase().includes(searchQuery.toLowerCase())\n  );\n\n  return (\n    <div className=\"p-6 space-y-6\" data-testid=\"page-dashboard\">\n      <div className=\"flex flex-wrap items-center justify-between gap-4\">\n        <div>\n          <h1 className=\"text-2xl font-semibold\">Dashboard</h1>\n          <p className=\"text-muted-foreground\">Player compliance and visa eligibility overview</p>\n        </div>\n        <div className=\"flex flex-wrap items-center gap-2\">\n          <div className=\"relative\">\n            <Search className=\"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground\" />\n            <Input\n              placeholder=\"Search players...\"\n              value={searchQuery}\n              onChange={(e) => setSearchQuery(e.target.value)}\n              className=\"pl-9 w-64\"\n              data-testid=\"input-search-dashboard\"\n            />\n          </div>\n          <Button onClick={() => setLocation(\"/players\")} data-testid=\"button-add-player\">\n            <Plus className=\"h-4 w-4 mr-2\" />\n            Add Player\n          </Button>\n        </div>\n      </div>\n\n      <div className=\"grid grid-cols-2 md:grid-cols-4 gap-4\">\n        {statsLoading ? (\n          <>\n            <Skeleton className=\"h-28\" />\n            <Skeleton className=\"h-28\" />\n            <Skeleton className=\"h-28\" />\n            <Skeleton className=\"h-28\" />\n          </>\n        ) : (\n          <>\n            <StatsCard \n              title=\"Total Players\" \n              value={stats.totalPlayers} \n              icon={Users} \n              trend={12}\n              description=\"In your database\"\n            />\n            <StatsCard \n              title=\"Green Status\" \n              value={stats.greenStatus} \n              icon={FileCheck} \n              trend={5}\n              description=\"Visa eligible\"\n            />\n            <StatsCard \n              title=\"Pending Verifications\" \n              value={stats.pendingVerifications} \n              icon={AlertTriangle}\n              description=\"Awaiting embassy\"\n            />\n            <StatsCard \n              title=\"Active Inquiries\" \n              value={stats.activeInquiries} \n              icon={TrendingUp} \n              trend={8}\n              description=\"Transfer discussions\"\n            />\n          </>\n        )}\n      </div>\n\n      <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-6\">\n        <div className=\"lg:col-span-2 space-y-6\">\n          <Card>\n            <CardHeader className=\"flex flex-row items-center justify-between gap-4 pb-4\">\n              <CardTitle className=\"text-lg\">Recent Players</CardTitle>\n              <Button variant=\"ghost\" size=\"sm\" onClick={() => setLocation(\"/players\")} data-testid=\"button-view-all-players\">\n                View All\n              </Button>\n            </CardHeader>\n            <CardContent>\n              {filteredPlayers.length === 0 ? (\n                <div className=\"text-center py-8 text-muted-foreground\">\n                  <Users className=\"h-12 w-12 mx-auto mb-4 opacity-50\" />\n                  <p>No players found</p>\n                  <p className=\"text-sm\">Add players to see them here</p>\n                </div>\n              ) : (\n                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                  {filteredPlayers.map((player) => (\n                    <PlayerCard\n                      key={player.id}\n                      player={player}\n                      onViewProfile={(id) => setLocation(`/players/${id}`)}\n                      onGenerateReport={(id) => setLocation(`/reports?player=${id}`)}\n                    />\n                  ))}\n                </div>\n              )}\n            </CardContent>\n          </Card>\n\n          <Card>\n            <CardHeader className=\"flex flex-row items-center justify-between gap-4 pb-4\">\n              <CardTitle className=\"text-lg flex items-center gap-2\">\n                <Bell className=\"h-5 w-5\" />\n                Embassy Verifications\n              </CardTitle>\n              <Button variant=\"ghost\" size=\"sm\" onClick={() => setLocation(\"/embassy\")} data-testid=\"button-view-all-verifications\">\n                View All\n              </Button>\n            </CardHeader>\n            <CardContent>\n              {recentVerifications.length === 0 ? (\n                <div className=\"text-center py-8 text-muted-foreground\">\n                  <FileCheck className=\"h-12 w-12 mx-auto mb-4 opacity-50\" />\n                  <p>No pending verifications</p>\n                </div>\n              ) : (\n                <EmbassyVerificationTable\n                  verifications={recentVerifications}\n                  onView={(id) => setLocation(`/embassy?id=${id}`)}\n                  onApprove={(id) => console.log(\"Approve\", id)}\n                  onReject={(id) => console.log(\"Reject\", id)}\n                />\n              )}\n            </CardContent>\n          </Card>\n        </div>\n\n        <div className=\"space-y-6\">\n          <Card>\n            <CardHeader className=\"pb-4\">\n              <CardTitle className=\"text-lg\">Eligibility Distribution</CardTitle>\n            </CardHeader>\n            <CardContent>\n              <div className=\"space-y-3\">\n                <div className=\"flex items-center justify-between\">\n                  <div className=\"flex items-center gap-2\">\n                    <div className=\"w-3 h-3 rounded-full bg-green-500\" />\n                    <span className=\"text-sm\">Green (60%+)</span>\n                  </div>\n                  <span className=\"font-semibold\">{stats.greenStatus}</span>\n                </div>\n                <div className=\"flex items-center justify-between\">\n                  <div className=\"flex items-center gap-2\">\n                    <div className=\"w-3 h-3 rounded-full bg-yellow-500\" />\n                    <span className=\"text-sm\">Yellow (35-59%)</span>\n                  </div>\n                  <span className=\"font-semibold\">{stats.yellowStatus}</span>\n                </div>\n                <div className=\"flex items-center justify-between\">\n                  <div className=\"flex items-center gap-2\">\n                    <div className=\"w-3 h-3 rounded-full bg-red-500\" />\n                    <span className=\"text-sm\">Red (&lt;35%)</span>\n                  </div>\n                  <span className=\"font-semibold\">{stats.redStatus}</span>\n                </div>\n              </div>\n              <div className=\"mt-4 h-4 rounded-full overflow-hidden bg-muted flex\">\n                {stats.totalPlayers > 0 && (\n                  <>\n                    <div \n                      className=\"bg-green-500\" \n                      style={{ width: `${(stats.greenStatus / stats.totalPlayers) * 100}%` }}\n                    />\n                    <div \n                      className=\"bg-yellow-500\" \n                      style={{ width: `${(stats.yellowStatus / stats.totalPlayers) * 100}%` }}\n                    />\n                    <div \n                      className=\"bg-red-500\" \n                      style={{ width: `${(stats.redStatus / stats.totalPlayers) * 100}%` }}\n                    />\n                  </>\n                )}\n              </div>\n            </CardContent>\n          </Card>\n\n          <Card>\n            <CardHeader className=\"flex flex-row items-center justify-between gap-4 pb-4\">\n              <CardTitle className=\"text-lg\">Scouting Inquiries</CardTitle>\n              <Button variant=\"ghost\" size=\"sm\" onClick={() => setLocation(\"/scouting\")} data-testid=\"button-view-all-inquiries\">\n                View All\n              </Button>\n            </CardHeader>\n            <CardContent className=\"space-y-4\">\n              {recentInquiries.length === 0 ? (\n                <div className=\"text-center py-8 text-muted-foreground\">\n                  <TrendingUp className=\"h-12 w-12 mx-auto mb-4 opacity-50\" />\n                  <p>No active inquiries</p>\n                </div>\n              ) : (\n                recentInquiries.map((inquiry) => {\n                  const player = mockPlayers.find((p) => p.id === inquiry.playerId);\n                  return (\n                    <ScoutingInquiryCard\n                      key={inquiry.id}\n                      inquiry={inquiry}\n                      playerName={player ? `${player.firstName} ${player.lastName}` : \"Unknown\"}\n                      onViewDetails={(id) => setLocation(`/scouting?id=${id}`)}\n                      onMessage={(id) => console.log(\"Message\", id)}\n                    />\n                  );\n                })\n              )}\n            </CardContent>\n          </Card>\n        </div>\n      </div>\n    </div>\n  );\n}\n","path":null,"size_bytes":10421,"size_tokens":null},"client/src/components/EligibilityScoreCard.tsx":{"content":"import { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Tooltip, TooltipContent, TooltipTrigger } from \"@/components/ui/tooltip\";\nimport { Info, Globe, Shield, Flag, Plane, Building, Sun, Award } from \"lucide-react\";\nimport { getVisaStatus } from \"./StatusBadge\";\n\ninterface VisaScore {\n  name: string;\n  code: string;\n  score: number;\n  description: string;\n  requirements: string;\n  icon: typeof Globe;\n  region: string;\n}\n\ninterface EligibilityScoreCardProps {\n  scores: {\n    schengen: number;\n    ukGbe: number;\n    usP1: number;\n    usO1: number;\n    middleEast?: number;\n    asia?: number;\n    fifa?: number;\n  };\n  compact?: boolean;\n}\n\nexport default function EligibilityScoreCard({ scores, compact = false }: EligibilityScoreCardProps) {\n  const visaTypes: VisaScore[] = [\n    { \n      name: \"FIFA Transfer Rules\", \n      code: \"FIFA\",\n      score: scores.fifa ?? 0, \n      description: \"FIFA International Transfer Regulations\",\n      requirements: \"ITC eligibility, training compensation, solidarity mechanism, contract status\",\n      icon: Award,\n      region: \"Global\"\n    },\n    { \n      name: \"Schengen Sports\", \n      code: \"SCH\",\n      score: scores.schengen, \n      description: \"EU sports person visa\",\n      requirements: \"Requires professional contract, club invitation, and minimum playing time\",\n      icon: Globe,\n      region: \"EU\"\n    },\n    { \n      name: \"UK GBE Points\", \n      code: \"GBE\",\n      score: scores.ukGbe, \n      description: \"UK Governing Body Endorsement\",\n      requirements: \"Points-based on international caps, club level, and domestic league position\",\n      icon: Shield,\n      region: \"UK\"\n    },\n    { \n      name: \"US P-1 Athlete\", \n      code: \"P-1\",\n      score: scores.usP1, \n      description: \"US athlete visa for events\",\n      requirements: \"Internationally recognized athlete or team member\",\n      icon: Flag,\n      region: \"USA\"\n    },\n    { \n      name: \"US O-1 Extraordinary\", \n      code: \"O-1\",\n      score: scores.usO1, \n      description: \"US extraordinary ability visa\",\n      requirements: \"Sustained national or international acclaim\",\n      icon: Plane,\n      region: \"USA\"\n    },\n    { \n      name: \"Middle East Sports\", \n      code: \"MEA\",\n      score: scores.middleEast ?? 0, \n      description: \"UAE/Saudi/Qatar Sports Visa\",\n      requirements: \"Professional status, club contract, medical clearance, age eligibility\",\n      icon: Building,\n      region: \"UAE/Saudi\"\n    },\n    { \n      name: \"Asia Sports\", \n      code: \"ASIA\",\n      score: scores.asia ?? 0, \n      description: \"Asian League Sports Visa\",\n      requirements: \"Professional contract, skills assessment, club sponsorship\",\n      icon: Sun,\n      region: \"Asia\"\n    },\n  ];\n\n  const getProgressColor = (score: number) => {\n    const status = getVisaStatus(score);\n    switch (status) {\n      case \"green\": return \"bg-green-500\";\n      case \"yellow\": return \"bg-yellow-500\";\n      case \"red\": return \"bg-red-500\";\n    }\n  };\n\n  const getStatusLabel = (score: number) => {\n    const status = getVisaStatus(score);\n    switch (status) {\n      case \"green\": return \"Eligible\";\n      case \"yellow\": return \"Conditional\";\n      case \"red\": return \"At Risk\";\n    }\n  };\n\n  const getStatusTextColor = (score: number) => {\n    const status = getVisaStatus(score);\n    switch (status) {\n      case \"green\": return \"text-green-600 dark:text-green-400\";\n      case \"yellow\": return \"text-yellow-600 dark:text-yellow-400\";\n      case \"red\": return \"text-red-600 dark:text-red-400\";\n    }\n  };\n\n  if (compact) {\n    return (\n      <Card data-testid=\"card-eligibility-scores-compact\">\n        <CardHeader className=\"pb-2\">\n          <CardTitle className=\"text-base\">Visa Eligibility</CardTitle>\n        </CardHeader>\n        <CardContent>\n          <div className=\"flex flex-wrap gap-2\">\n            {visaTypes.map((visa) => (\n              <Tooltip key={visa.code}>\n                <TooltipTrigger asChild>\n                  <div \n                    className={`px-2 py-1 rounded-md text-xs font-medium cursor-help ${\n                      getVisaStatus(visa.score) === \"green\" \n                        ? \"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400\"\n                        : getVisaStatus(visa.score) === \"yellow\"\n                        ? \"bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-400\"\n                        : \"bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-400\"\n                    }`}\n                    data-testid={`visa-badge-${visa.code.toLowerCase()}`}\n                  >\n                    {visa.code}: {visa.score}%\n                  </div>\n                </TooltipTrigger>\n                <TooltipContent>\n                  <p className=\"font-medium\">{visa.name}</p>\n                  <p className=\"text-xs\">{visa.description}</p>\n                </TooltipContent>\n              </Tooltip>\n            ))}\n          </div>\n        </CardContent>\n      </Card>\n    );\n  }\n\n  return (\n    <Card data-testid=\"card-eligibility-scores\">\n      <CardHeader className=\"pb-4\">\n        <CardTitle className=\"text-lg flex items-center gap-2\">\n          <Award className=\"h-5 w-5\" />\n          Visa Eligibility Scores\n        </CardTitle>\n      </CardHeader>\n      <CardContent className=\"space-y-4\">\n        {visaTypes.map((visa) => {\n          const IconComponent = visa.icon;\n          return (\n            <div key={visa.code} className=\"space-y-2\" data-testid={`visa-score-${visa.code.toLowerCase()}`}>\n              <div className=\"flex items-center justify-between gap-2\">\n                <div className=\"flex items-center gap-2 flex-1 min-w-0\">\n                  <IconComponent className=\"h-4 w-4 text-muted-foreground shrink-0\" />\n                  <span className=\"text-sm font-medium truncate\">{visa.name}</span>\n                  <span className=\"text-xs text-muted-foreground shrink-0\">({visa.region})</span>\n                  <Tooltip>\n                    <TooltipTrigger asChild>\n                      <Info className=\"h-3.5 w-3.5 text-muted-foreground cursor-help shrink-0\" />\n                    </TooltipTrigger>\n                    <TooltipContent className=\"max-w-xs\">\n                      <p className=\"font-medium\">{visa.description}</p>\n                      <p className=\"text-xs mt-1\">{visa.requirements}</p>\n                    </TooltipContent>\n                  </Tooltip>\n                </div>\n                <div className=\"flex items-center gap-2 shrink-0\">\n                  <span className={`text-xs font-medium ${getStatusTextColor(visa.score)}`}>\n                    {getStatusLabel(visa.score)}\n                  </span>\n                  <span className=\"text-sm font-semibold w-12 text-right\">{visa.score}%</span>\n                </div>\n              </div>\n              <div className=\"relative h-2 w-full overflow-hidden rounded-full bg-muted\">\n                <div \n                  className={`h-full transition-all ${getProgressColor(visa.score)}`}\n                  style={{ width: `${visa.score}%` }}\n                />\n              </div>\n            </div>\n          );\n        })}\n        \n        <div className=\"pt-4 border-t mt-4\">\n          <div className=\"flex items-center justify-between text-sm\">\n            <span className=\"text-muted-foreground\">Legend:</span>\n            <div className=\"flex items-center gap-4\">\n              <span className=\"flex items-center gap-1\">\n                <div className=\"h-2 w-2 rounded-full bg-green-500\" />\n                <span className=\"text-xs\">60%+ Eligible</span>\n              </span>\n              <span className=\"flex items-center gap-1\">\n                <div className=\"h-2 w-2 rounded-full bg-yellow-500\" />\n                <span className=\"text-xs\">35-59% Conditional</span>\n              </span>\n              <span className=\"flex items-center gap-1\">\n                <div className=\"h-2 w-2 rounded-full bg-red-500\" />\n                <span className=\"text-xs\">&lt;35% At Risk</span>\n              </span>\n            </div>\n          </div>\n        </div>\n      </CardContent>\n    </Card>\n  );\n}\n","path":null,"size_bytes":8147,"size_tokens":null},"client/src/components/ui/separator.tsx":{"content":"import * as React from \"react\"\nimport * as SeparatorPrimitive from \"@radix-ui/react-separator\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Separator = React.forwardRef<\n  React.ElementRef<typeof SeparatorPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof SeparatorPrimitive.Root>\n>(\n  (\n    { className, orientation = \"horizontal\", decorative = true, ...props },\n    ref\n  ) => (\n    <SeparatorPrimitive.Root\n      ref={ref}\n      decorative={decorative}\n      orientation={orientation}\n      className={cn(\n        \"shrink-0 bg-border\",\n        orientation === \"horizontal\" ? \"h-[1px] w-full\" : \"h-full w-[1px]\",\n        className\n      )}\n      {...props}\n    />\n  )\n)\nSeparator.displayName = SeparatorPrimitive.Root.displayName\n\nexport { Separator }\n","path":null,"size_bytes":756,"size_tokens":null},"shared/models/auth.ts":{"content":"import { sql } from \"drizzle-orm\";\nimport { index, jsonb, pgTable, timestamp, varchar } from \"drizzle-orm/pg-core\";\n\n// Session storage table.\n// (IMPORTANT) This table is mandatory for Replit Auth, don't drop it.\nexport const sessions = pgTable(\n  \"sessions\",\n  {\n    sid: varchar(\"sid\").primaryKey(),\n    sess: jsonb(\"sess\").notNull(),\n    expire: timestamp(\"expire\").notNull(),\n  },\n  (table) => [index(\"IDX_session_expire\").on(table.expire)]\n);\n\n// User storage table.\n// (IMPORTANT) This table is mandatory for Replit Auth, don't drop it.\nexport const users = pgTable(\"users\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  email: varchar(\"email\").unique(),\n  firstName: varchar(\"first_name\"),\n  lastName: varchar(\"last_name\"),\n  profileImageUrl: varchar(\"profile_image_url\"),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\nexport type UpsertUser = typeof users.$inferInsert;\nexport type User = typeof users.$inferSelect;\n","path":null,"size_bytes":1010,"size_tokens":null},"server/vite.ts":{"content":"import { type Express } from \"express\";\nimport { createServer as createViteServer, createLogger } from \"vite\";\nimport { type Server } from \"http\";\nimport viteConfig from \"../vite.config\";\nimport fs from \"fs\";\nimport path from \"path\";\nimport { nanoid } from \"nanoid\";\n\nconst viteLogger = createLogger();\n\nexport async function setupVite(server: Server, app: Express) {\n  const serverOptions = {\n    middlewareMode: true,\n    hmr: { server, path: \"/vite-hmr\" },\n    allowedHosts: true as const,\n  };\n\n  const vite = await createViteServer({\n    ...viteConfig,\n    configFile: false,\n    customLogger: {\n      ...viteLogger,\n      error: (msg, options) => {\n        viteLogger.error(msg, options);\n        process.exit(1);\n      },\n    },\n    server: serverOptions,\n    appType: \"custom\",\n  });\n\n  app.use(vite.middlewares);\n\n  app.use(\"*\", async (req, res, next) => {\n    const url = req.originalUrl;\n\n    try {\n      const clientTemplate = path.resolve(\n        import.meta.dirname,\n        \"..\",\n        \"client\",\n        \"index.html\",\n      );\n\n      // always reload the index.html file from disk incase it changes\n      let template = await fs.promises.readFile(clientTemplate, \"utf-8\");\n      template = template.replace(\n        `src=\"/src/main.tsx\"`,\n        `src=\"/src/main.tsx?v=${nanoid()}\"`,\n      );\n      const page = await vite.transformIndexHtml(url, template);\n      res.status(200).set({ \"Content-Type\": \"text/html\" }).end(page);\n    } catch (e) {\n      vite.ssrFixStacktrace(e as Error);\n      next(e);\n    }\n  });\n}\n","path":null,"size_bytes":1534,"size_tokens":null},"client/src/components/ui/label.tsx":{"content":"import * as React from \"react\"\nimport * as LabelPrimitive from \"@radix-ui/react-label\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst labelVariants = cva(\n  \"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70\"\n)\n\nconst Label = React.forwardRef<\n  React.ElementRef<typeof LabelPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root> &\n    VariantProps<typeof labelVariants>\n>(({ className, ...props }, ref) => (\n  <LabelPrimitive.Root\n    ref={ref}\n    className={cn(labelVariants(), className)}\n    {...props}\n  />\n))\nLabel.displayName = LabelPrimitive.Root.displayName\n\nexport { Label }\n","path":null,"size_bytes":710,"size_tokens":null},"client/src/pages/embassy.tsx":{"content":"import { useState } from \"react\";\nimport EmbassyVerificationTable from \"@/components/EmbassyVerificationTable\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Input } from \"@/components/ui/input\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Search, Filter, Bell, CheckCircle, Clock, XCircle } from \"lucide-react\";\nimport { mockEmbassyVerifications } from \"@/lib/mock-data\";\nimport StatsCard from \"@/components/StatsCard\";\n\nexport default function Embassy() {\n  const [searchQuery, setSearchQuery] = useState(\"\");\n  const [statusFilter, setStatusFilter] = useState(\"all\");\n\n  // todo: remove mock functionality\n  const verifications = mockEmbassyVerifications;\n\n  const filteredVerifications = verifications.filter((v) => {\n    const matchesSearch =\n      v.playerName.toLowerCase().includes(searchQuery.toLowerCase()) ||\n      v.clubName.toLowerCase().includes(searchQuery.toLowerCase());\n    const matchesStatus = statusFilter === \"all\" || v.status === statusFilter;\n    return matchesSearch && matchesStatus;\n  });\n\n  const stats = {\n    pending: verifications.filter((v) => v.status === \"pending\").length,\n    underReview: verifications.filter((v) => v.status === \"under_review\").length,\n    approved: verifications.filter((v) => v.status === \"approved\").length,\n    rejected: verifications.filter((v) => v.status === \"rejected\").length,\n  };\n\n  return (\n    <div className=\"p-6 space-y-6\" data-testid=\"page-embassy\">\n      <div className=\"flex flex-wrap items-center justify-between gap-4\">\n        <div>\n          <h1 className=\"text-2xl font-semibold\">Embassy Verification</h1>\n          <p className=\"text-muted-foreground\">Monitor and manage consular data submissions</p>\n        </div>\n        <Badge variant=\"secondary\" className=\"bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-400\">\n          <Bell className=\"h-3 w-3 mr-1\" />\n          {stats.pending + stats.underReview} Pending Action\n        </Badge>\n      </div>\n\n      <div className=\"grid grid-cols-2 md:grid-cols-4 gap-4\">\n        <StatsCard\n          title=\"Pending\"\n          value={stats.pending}\n          icon={Clock}\n          description=\"Awaiting review\"\n        />\n        <StatsCard\n          title=\"Under Review\"\n          value={stats.underReview}\n          icon={Search}\n          description=\"Being processed\"\n        />\n        <StatsCard\n          title=\"Approved\"\n          value={stats.approved}\n          icon={CheckCircle}\n          description=\"Verification complete\"\n        />\n        <StatsCard\n          title=\"Rejected\"\n          value={stats.rejected}\n          icon={XCircle}\n          description=\"Requires attention\"\n        />\n      </div>\n\n      <Card>\n        <CardHeader className=\"pb-4\">\n          <div className=\"flex flex-wrap items-center justify-between gap-4\">\n            <CardTitle className=\"text-lg\">Verification Requests</CardTitle>\n            <div className=\"flex flex-wrap items-center gap-4\">\n              <div className=\"relative\">\n                <Search className=\"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground\" />\n                <Input\n                  placeholder=\"Search...\"\n                  value={searchQuery}\n                  onChange={(e) => setSearchQuery(e.target.value)}\n                  className=\"pl-9 w-56\"\n                  data-testid=\"input-search-embassy\"\n                />\n              </div>\n              <Select value={statusFilter} onValueChange={setStatusFilter}>\n                <SelectTrigger className=\"w-48\" data-testid=\"select-embassy-status\">\n                  <Filter className=\"h-4 w-4 mr-2\" />\n                  <SelectValue placeholder=\"Filter status\" />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"all\">All Statuses</SelectItem>\n                  <SelectItem value=\"pending\">Pending</SelectItem>\n                  <SelectItem value=\"under_review\">Under Review</SelectItem>\n                  <SelectItem value=\"approved\">Approved</SelectItem>\n                  <SelectItem value=\"rejected\">Rejected</SelectItem>\n                </SelectContent>\n              </Select>\n            </div>\n          </div>\n        </CardHeader>\n        <CardContent>\n          <EmbassyVerificationTable\n            verifications={filteredVerifications}\n            onView={(id) => console.log(\"View\", id)}\n            onApprove={(id) => console.log(\"Approve\", id)}\n            onReject={(id) => console.log(\"Reject\", id)}\n          />\n          {filteredVerifications.length === 0 && (\n            <p className=\"text-center py-8 text-muted-foreground\">\n              No verification requests found\n            </p>\n          )}\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","path":null,"size_bytes":4879,"size_tokens":null},"client/src/components/ui/alert-dialog.tsx":{"content":"import * as React from \"react\"\nimport * as AlertDialogPrimitive from \"@radix-ui/react-alert-dialog\"\n\nimport { cn } from \"@/lib/utils\"\nimport { buttonVariants } from \"@/components/ui/button\"\n\nconst AlertDialog = AlertDialogPrimitive.Root\n\nconst AlertDialogTrigger = AlertDialogPrimitive.Trigger\n\nconst AlertDialogPortal = AlertDialogPrimitive.Portal\n\nconst AlertDialogOverlay = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Overlay\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  />\n))\nAlertDialogOverlay.displayName = AlertDialogPrimitive.Overlay.displayName\n\nconst AlertDialogContent = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPortal>\n    <AlertDialogOverlay />\n    <AlertDialogPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg\",\n        className\n      )}\n      {...props}\n    />\n  </AlertDialogPortal>\n))\nAlertDialogContent.displayName = AlertDialogPrimitive.Content.displayName\n\nconst AlertDialogHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-2 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nAlertDialogHeader.displayName = \"AlertDialogHeader\"\n\nconst AlertDialogFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nAlertDialogFooter.displayName = \"AlertDialogFooter\"\n\nconst AlertDialogTitle = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Title\n    ref={ref}\n    className={cn(\"text-lg font-semibold\", className)}\n    {...props}\n  />\n))\nAlertDialogTitle.displayName = AlertDialogPrimitive.Title.displayName\n\nconst AlertDialogDescription = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nAlertDialogDescription.displayName =\n  AlertDialogPrimitive.Description.displayName\n\nconst AlertDialogAction = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Action>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Action>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Action\n    ref={ref}\n    className={cn(buttonVariants(), className)}\n    {...props}\n  />\n))\nAlertDialogAction.displayName = AlertDialogPrimitive.Action.displayName\n\nconst AlertDialogCancel = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Cancel>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Cancel>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Cancel\n    ref={ref}\n    className={cn(\n      buttonVariants({ variant: \"outline\" }),\n      \"mt-2 sm:mt-0\",\n      className\n    )}\n    {...props}\n  />\n))\nAlertDialogCancel.displayName = AlertDialogPrimitive.Cancel.displayName\n\nexport {\n  AlertDialog,\n  AlertDialogPortal,\n  AlertDialogOverlay,\n  AlertDialogTrigger,\n  AlertDialogContent,\n  AlertDialogHeader,\n  AlertDialogFooter,\n  AlertDialogTitle,\n  AlertDialogDescription,\n  AlertDialogAction,\n  AlertDialogCancel,\n}\n","path":null,"size_bytes":4420,"size_tokens":null},"client/src/components/ui/alert.tsx":{"content":"import * as React from \"react\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst alertVariants = cva(\n  \"relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-background text-foreground\",\n        destructive:\n          \"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nconst Alert = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement> & VariantProps<typeof alertVariants>\n>(({ className, variant, ...props }, ref) => (\n  <div\n    ref={ref}\n    role=\"alert\"\n    className={cn(alertVariants({ variant }), className)}\n    {...props}\n  />\n))\nAlert.displayName = \"Alert\"\n\nconst AlertTitle = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLHeadingElement>\n>(({ className, ...props }, ref) => (\n  <h5\n    ref={ref}\n    className={cn(\"mb-1 font-medium leading-none tracking-tight\", className)}\n    {...props}\n  />\n))\nAlertTitle.displayName = \"AlertTitle\"\n\nconst AlertDescription = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"text-sm [&_p]:leading-relaxed\", className)}\n    {...props}\n  />\n))\nAlertDescription.displayName = \"AlertDescription\"\n\nexport { Alert, AlertTitle, AlertDescription }\n","path":null,"size_bytes":1584,"size_tokens":null},"client/src/components/ui/skeleton.tsx":{"content":"import { cn } from \"@/lib/utils\"\n\nfunction Skeleton({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) {\n  return (\n    <div\n      className={cn(\"animate-pulse rounded-md bg-muted\", className)}\n      {...props}\n    />\n  )\n}\n\nexport { Skeleton }\n","path":null,"size_bytes":261,"size_tokens":null},"drizzle.config.ts":{"content":"import { defineConfig } from \"drizzle-kit\";\n\nif (!process.env.DATABASE_URL) {\n  throw new Error(\"DATABASE_URL, ensure the database is provisioned\");\n}\n\nexport default defineConfig({\n  out: \"./migrations\",\n  schema: \"./shared/schema.ts\",\n  dialect: \"postgresql\",\n  dbCredentials: {\n    url: process.env.DATABASE_URL,\n  },\n});\n","path":null,"size_bytes":325,"size_tokens":null},"client/src/lib/queryClient.ts":{"content":"import { QueryClient, QueryFunction } from \"@tanstack/react-query\";\n\nasync function throwIfResNotOk(res: Response) {\n  if (!res.ok) {\n    const text = (await res.text()) || res.statusText;\n    throw new Error(`${res.status}: ${text}`);\n  }\n}\n\nexport async function apiRequest(\n  method: string,\n  url: string,\n  data?: unknown | undefined,\n): Promise<Response> {\n  const res = await fetch(url, {\n    method,\n    headers: data ? { \"Content-Type\": \"application/json\" } : {},\n    body: data ? JSON.stringify(data) : undefined,\n    credentials: \"include\",\n  });\n\n  await throwIfResNotOk(res);\n  return res;\n}\n\ntype UnauthorizedBehavior = \"returnNull\" | \"throw\";\nexport const getQueryFn: <T>(options: {\n  on401: UnauthorizedBehavior;\n}) => QueryFunction<T> =\n  ({ on401: unauthorizedBehavior }) =>\n  async ({ queryKey }) => {\n    const res = await fetch(queryKey.join(\"/\") as string, {\n      credentials: \"include\",\n    });\n\n    if (unauthorizedBehavior === \"returnNull\" && res.status === 401) {\n      return null;\n    }\n\n    await throwIfResNotOk(res);\n    return await res.json();\n  };\n\nexport const queryClient = new QueryClient({\n  defaultOptions: {\n    queries: {\n      queryFn: getQueryFn({ on401: \"throw\" }),\n      refetchInterval: false,\n      refetchOnWindowFocus: false,\n      staleTime: Infinity,\n      retry: false,\n    },\n    mutations: {\n      retry: false,\n    },\n  },\n});\n","path":null,"size_bytes":1383,"size_tokens":null},"client/src/components/ui/input.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Input = React.forwardRef<HTMLInputElement, React.ComponentProps<\"input\">>(\n  ({ className, type, ...props }, ref) => {\n    // h-9 to match icon buttons and default buttons.\n    return (\n      <input\n        type={type}\n        className={cn(\n          \"flex h-9 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm\",\n          className\n        )}\n        ref={ref}\n        {...props}\n      />\n    )\n  }\n)\nInput.displayName = \"Input\"\n\nexport { Input }\n","path":null,"size_bytes":844,"size_tokens":null},"client/src/pages/settings.tsx":{"content":"import { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Switch } from \"@/components/ui/switch\";\nimport { Separator } from \"@/components/ui/separator\";\nimport { Settings, User, Bell, Shield, Globe } from \"lucide-react\";\n\nexport default function SettingsPage() {\n  return (\n    <div className=\"p-6 space-y-6 max-w-4xl mx-auto\">\n      <div>\n        <h1 className=\"text-2xl font-bold\" data-testid=\"text-page-title\">Settings</h1>\n        <p className=\"text-muted-foreground\">Manage your account and platform preferences</p>\n      </div>\n\n      <Card>\n        <CardHeader>\n          <div className=\"flex items-center gap-3\">\n            <User className=\"h-5 w-5 text-muted-foreground\" />\n            <div>\n              <CardTitle className=\"text-lg\">Profile Settings</CardTitle>\n              <CardDescription>Update your personal information</CardDescription>\n            </div>\n          </div>\n        </CardHeader>\n        <CardContent className=\"space-y-4\">\n          <div className=\"grid grid-cols-2 gap-4\">\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"firstName\">First Name</Label>\n              <Input id=\"firstName\" placeholder=\"First name\" data-testid=\"input-first-name\" />\n            </div>\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"lastName\">Last Name</Label>\n              <Input id=\"lastName\" placeholder=\"Last name\" data-testid=\"input-last-name\" />\n            </div>\n          </div>\n          <div className=\"space-y-2\">\n            <Label htmlFor=\"email\">Email</Label>\n            <Input id=\"email\" type=\"email\" placeholder=\"Email address\" data-testid=\"input-email\" />\n          </div>\n          <Button data-testid=\"button-save-profile\">Save Changes</Button>\n        </CardContent>\n      </Card>\n\n      <Card>\n        <CardHeader>\n          <div className=\"flex items-center gap-3\">\n            <Bell className=\"h-5 w-5 text-muted-foreground\" />\n            <div>\n              <CardTitle className=\"text-lg\">Notifications</CardTitle>\n              <CardDescription>Configure how you receive alerts</CardDescription>\n            </div>\n          </div>\n        </CardHeader>\n        <CardContent className=\"space-y-4\">\n          <div className=\"flex items-center justify-between\">\n            <div>\n              <p className=\"font-medium\">Email Notifications</p>\n              <p className=\"text-sm text-muted-foreground\">Receive updates via email</p>\n            </div>\n            <Switch data-testid=\"switch-email-notifications\" />\n          </div>\n          <Separator />\n          <div className=\"flex items-center justify-between\">\n            <div>\n              <p className=\"font-medium\">Document Alerts</p>\n              <p className=\"text-sm text-muted-foreground\">Get notified when documents are generated</p>\n            </div>\n            <Switch defaultChecked data-testid=\"switch-document-alerts\" />\n          </div>\n          <Separator />\n          <div className=\"flex items-center justify-between\">\n            <div>\n              <p className=\"font-medium\">Eligibility Updates</p>\n              <p className=\"text-sm text-muted-foreground\">Alerts when player eligibility scores change</p>\n            </div>\n            <Switch defaultChecked data-testid=\"switch-eligibility-updates\" />\n          </div>\n        </CardContent>\n      </Card>\n\n      <Card>\n        <CardHeader>\n          <div className=\"flex items-center gap-3\">\n            <Globe className=\"h-5 w-5 text-muted-foreground\" />\n            <div>\n              <CardTitle className=\"text-lg\">Platform Preferences</CardTitle>\n              <CardDescription>Customize your experience</CardDescription>\n            </div>\n          </div>\n        </CardHeader>\n        <CardContent className=\"space-y-4\">\n          <div className=\"flex items-center justify-between\">\n            <div>\n              <p className=\"font-medium\">Default Visa Standards</p>\n              <p className=\"text-sm text-muted-foreground\">Automatically calculate against preferred standards</p>\n            </div>\n            <Button variant=\"outline\" size=\"sm\" data-testid=\"button-configure-standards\">\n              Configure\n            </Button>\n          </div>\n          <Separator />\n          <div className=\"flex items-center justify-between\">\n            <div>\n              <p className=\"font-medium\">Data Export Format</p>\n              <p className=\"text-sm text-muted-foreground\">Choose your preferred export format</p>\n            </div>\n            <Button variant=\"outline\" size=\"sm\" data-testid=\"button-export-settings\">\n              PDF\n            </Button>\n          </div>\n        </CardContent>\n      </Card>\n\n      <Card>\n        <CardHeader>\n          <div className=\"flex items-center gap-3\">\n            <Shield className=\"h-5 w-5 text-muted-foreground\" />\n            <div>\n              <CardTitle className=\"text-lg\">Security</CardTitle>\n              <CardDescription>Manage your account security</CardDescription>\n            </div>\n          </div>\n        </CardHeader>\n        <CardContent className=\"space-y-4\">\n          <div className=\"flex items-center justify-between\">\n            <div>\n              <p className=\"font-medium\">Change Password</p>\n              <p className=\"text-sm text-muted-foreground\">Update your account password</p>\n            </div>\n            <Button variant=\"outline\" size=\"sm\" data-testid=\"button-change-password\">\n              Change\n            </Button>\n          </div>\n          <Separator />\n          <div className=\"flex items-center justify-between\">\n            <div>\n              <p className=\"font-medium\">Two-Factor Authentication</p>\n              <p className=\"text-sm text-muted-foreground\">Add an extra layer of security</p>\n            </div>\n            <Button variant=\"outline\" size=\"sm\" data-testid=\"button-enable-2fa\">\n              Enable\n            </Button>\n          </div>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","path":null,"size_bytes":6148,"size_tokens":null},"postcss.config.js":{"content":"export default {\n  plugins: {\n    tailwindcss: {},\n    autoprefixer: {},\n  },\n}\n","path":null,"size_bytes":80,"size_tokens":null},"client/src/components/PlayerCard.tsx":{"content":"import { Card, CardContent, CardHeader } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Avatar, AvatarFallback } from \"@/components/ui/avatar\";\nimport StatusBadge from \"./StatusBadge\";\nimport { FileText, Eye, Clock, Trophy, MapPin } from \"lucide-react\";\nimport type { Player } from \"@/lib/types\";\n\ninterface PlayerCardProps {\n  player: Player;\n  onViewProfile?: (id: string) => void;\n  onGenerateReport?: (id: string) => void;\n}\n\nexport default function PlayerCard({ player, onViewProfile, onGenerateReport }: PlayerCardProps) {\n  const initials = `${player.firstName[0]}${player.lastName[0]}`;\n\n  return (\n    <Card className=\"hover-elevate\" data-testid={`card-player-${player.id}`}>\n      <CardHeader className=\"flex flex-row items-start justify-between gap-4 pb-2\">\n        <div className=\"flex items-center gap-3 min-w-0\">\n          <Avatar className=\"h-12 w-12\">\n            <AvatarFallback className=\"bg-primary text-primary-foreground text-sm font-medium\">\n              {initials}\n            </AvatarFallback>\n          </Avatar>\n          <div className=\"min-w-0\">\n            <h3 className=\"font-semibold truncate\">{player.firstName} {player.lastName}</h3>\n            <p className=\"text-sm text-muted-foreground truncate\">{player.position}</p>\n          </div>\n        </div>\n        <StatusBadge score={player.overallEligibilityScore} size=\"sm\" />\n      </CardHeader>\n      <CardContent className=\"space-y-4\">\n        <div className=\"grid grid-cols-2 gap-3 text-sm\">\n          <div className=\"flex items-center gap-2\">\n            <MapPin className=\"h-4 w-4 text-muted-foreground\" />\n            <span className=\"truncate\">{player.nationality}</span>\n          </div>\n          <div className=\"flex items-center gap-2\">\n            <Trophy className=\"h-4 w-4 text-muted-foreground\" />\n            <span>{player.nationalTeamCaps} caps</span>\n          </div>\n          <div className=\"flex items-center gap-2\">\n            <Clock className=\"h-4 w-4 text-muted-foreground\" />\n            <span>{player.currentSeasonMinutes} min</span>\n          </div>\n          <div className=\"text-muted-foreground truncate\">\n            {player.currentClub}\n          </div>\n        </div>\n        \n        <div className=\"flex gap-2\">\n          <Button \n            variant=\"outline\" \n            size=\"sm\" \n            className=\"flex-1\"\n            onClick={() => onViewProfile?.(player.id)}\n            data-testid={`button-view-player-${player.id}`}\n          >\n            <Eye className=\"h-4 w-4 mr-1\" />\n            View\n          </Button>\n          <Button \n            size=\"sm\" \n            className=\"flex-1\"\n            onClick={() => onGenerateReport?.(player.id)}\n            data-testid={`button-report-player-${player.id}`}\n          >\n            <FileText className=\"h-4 w-4 mr-1\" />\n            Report\n          </Button>\n        </div>\n      </CardContent>\n    </Card>\n  );\n}\n","path":null,"size_bytes":2935,"size_tokens":null},"server/routes.ts":{"content":"import type { Express, Request, Response, NextFunction } from \"express\";\nimport { createServer, type Server } from \"http\";\nimport { storage } from \"./storage\";\nimport { insertUserSchema, insertTeamSchema, insertPlayerSchema, insertVideoSchema, insertComplianceOrderSchema, insertPlayerInternationalRecordSchema, insertTeamSheetSchema, insertTeamSheetPlayerSchema, insertPlayerDocumentSchema, insertFederationLetterRequestSchema } from \"@shared/schema\";\nimport session from \"express-session\";\nimport { z } from \"zod\";\nimport { GoogleGenAI } from \"@google/genai\";\nimport { registerObjectStorageRoutes, ObjectStorageService } from \"./replit_integrations/object_storage\";\nimport { jsPDF } from \"jspdf\";\n\nconst MAX_PLAYERS_PER_VIDEO = 15;\nconst SIGNUP_BONUS_TOKENS = 50;\nconst SIGNUP_TOKEN_EXPIRY_MONTHS = 6;\n\nasync function grantSignupBonus(userId: string, userRole: string): Promise<void> {\n  if (userRole === \"embassy\") return;\n  \n  try {\n    const expiresAt = new Date();\n    expiresAt.setMonth(expiresAt.getMonth() + SIGNUP_TOKEN_EXPIRY_MONTHS);\n    \n    await storage.createTokenBalance({\n      userId,\n      balance: SIGNUP_BONUS_TOKENS,\n      lifetimePurchased: 0,\n      lifetimeSpent: 0,\n    });\n    \n    await storage.createTokenTransaction({\n      userId,\n      amount: SIGNUP_BONUS_TOKENS,\n      type: \"credit\",\n      action: \"signup_bonus\",\n      description: \"Welcome bonus - 50 tokens\",\n      balanceAfter: SIGNUP_BONUS_TOKENS,\n      expiresAt,\n    });\n  } catch (error) {\n    console.error(\"Failed to grant signup bonus:\", error);\n  }\n}\n\nconst gemini = new GoogleGenAI({\n  apiKey: process.env.AI_INTEGRATIONS_GEMINI_API_KEY,\n  httpOptions: { baseUrl: process.env.AI_INTEGRATIONS_GEMINI_BASE_URL },\n});\n\ndeclare module \"express-session\" {\n  interface SessionData {\n    userId?: string;\n    teamId?: string;\n    userRole?: string;\n    embassyCountry?: string;\n  }\n}\n\n// Demo mode - no authentication required, just pass through\nconst requireAuth = (req: Request, res: Response, next: NextFunction) => {\n  // In demo mode, we allow all access\n  // Set default demo values if not present\n  if (!req.session.userId) {\n    req.session.userId = \"demo-user\";\n    req.session.teamId = \"demo-team\";\n    req.session.userRole = req.headers[\"x-user-role\"] as string || \"sporting_director\";\n  }\n  next();\n};\n\nconst requireTeamRole = (req: Request, res: Response, next: NextFunction) => {\n  if (!req.session.userId) {\n    req.session.userId = \"demo-user\";\n    req.session.teamId = \"demo-team\";\n    req.session.userRole = \"sporting_director\";\n  }\n  next();\n};\n\nconst requireScoutRole = (req: Request, res: Response, next: NextFunction) => {\n  if (!req.session.userId) {\n    req.session.userId = \"demo-scout\";\n    req.session.userRole = \"scout\";\n  }\n  next();\n};\n\nconst requireEmbassyRole = (req: Request, res: Response, next: NextFunction) => {\n  if (!req.session.userId) {\n    req.session.userId = \"demo-embassy\";\n    req.session.userRole = \"embassy\";\n    req.session.embassyCountry = \"United Kingdom\";\n  }\n  next();\n};\n\nfunction getPositionalMetricsPrompt(position: string): string {\n  const positionLower = position.toLowerCase();\n  \n  if (positionLower.includes(\"goalkeeper\") || positionLower === \"gk\") {\n    return `Focus on GOALKEEPER-specific metrics:\n- Saves made and save percentage\n- Goals conceded\n- Clean sheet performance\n- Distribution accuracy (short and long passes)\n- Crosses claimed vs punched\n- One-on-one situations faced\n- Positioning and command of area\n- Communication with defense`;\n  }\n  \n  if (positionLower.includes(\"defender\") || positionLower.includes(\"back\") || positionLower === \"cb\" || positionLower === \"rb\" || positionLower === \"lb\") {\n    return `Focus on DEFENDER-specific metrics:\n- Tackles won and tackle success rate\n- Aerial duels won and percentage\n- Interceptions and blocks\n- Clearances\n- Progressive carries and passes\n- Ball recoveries\n- Fouls committed\n- Ground duels success rate\n- Defensive positioning`;\n  }\n  \n  if (positionLower.includes(\"midfielder\") || positionLower === \"cm\" || positionLower === \"dm\" || positionLower === \"am\" || positionLower === \"cdm\") {\n    return `Focus on MIDFIELDER-specific metrics:\n- Pass completion rate (short, medium, long)\n- Key passes and through balls\n- Progressive passes and carries\n- Ball recoveries and interceptions\n- Ground duels won\n- Shot creating actions\n- Defensive contributions\n- Distance covered and high-intensity runs\n- Possession retention`;\n  }\n  \n  if (positionLower.includes(\"winger\") || positionLower.includes(\"wing\") || positionLower === \"lw\" || positionLower === \"rw\" || positionLower === \"lm\" || positionLower === \"rm\") {\n    return `Focus on WINGER-specific metrics:\n- Successful dribbles and take-ons\n- Crosses attempted and completed\n- Key passes and assists\n- Shot creating actions and goal involvement\n- Final third entries\n- Progressive carries\n- 1v1 success rate\n- Defensive tracking back\n- Sprint speed and acceleration`;\n  }\n  \n  if (positionLower.includes(\"striker\") || positionLower.includes(\"forward\") || positionLower === \"st\" || positionLower === \"cf\" || positionLower === \"fw\") {\n    return `Focus on STRIKER/FORWARD-specific metrics:\n- Goals scored and xG (expected goals)\n- Shots on target and shot accuracy\n- Conversion rate\n- Aerial duels won\n- Hold-up play and link-up passes\n- Pressing actions and ball recoveries in final third\n- Movement and runs behind defense\n- xA (expected assists) if applicable\n- Penalty area touches`;\n  }\n  \n  return `Analyze general football performance metrics for this position: ${position}`;\n}\n\nasync function updatePlayerStatsFromVideos(playerId: string): Promise<void> {\n  try {\n    const player = await storage.getPlayer(playerId);\n    if (!player) return;\n\n    const videos = await storage.getVideos(playerId);\n    const playerTags = await storage.getVideoPlayerTagsForPlayer(playerId);\n    \n    let totalMinutesFromVideos = 0;\n    const currentYear = new Date().getFullYear();\n    const oneYearAgo = new Date();\n    oneYearAgo.setFullYear(oneYearAgo.getFullYear() - 1);\n    let last12MonthsMinutes = 0;\n    let currentSeasonMinutes = 0;\n    \n    for (const video of videos) {\n      if (video.minutesPlayed && video.minutesPlayed > 0) {\n        totalMinutesFromVideos += video.minutesPlayed;\n        \n        const videoDate = video.matchDate ? new Date(video.matchDate) : video.uploadDate;\n        if (videoDate && videoDate >= oneYearAgo) {\n          last12MonthsMinutes += video.minutesPlayed;\n        }\n        \n        if (videoDate && videoDate.getFullYear() === currentYear) {\n          currentSeasonMinutes += video.minutesPlayed;\n        }\n      }\n    }\n    \n    for (const tag of playerTags) {\n      if (tag.minutesPlayed && tag.minutesPlayed > 0) {\n        totalMinutesFromVideos += tag.minutesPlayed;\n        \n        const videoDate = tag.video?.matchDate ? new Date(tag.video.matchDate) : (tag.video?.uploadDate || tag.createdAt);\n        if (videoDate && videoDate >= oneYearAgo) {\n          last12MonthsMinutes += tag.minutesPlayed;\n        }\n        \n        if (videoDate && videoDate.getFullYear() === currentYear) {\n          currentSeasonMinutes += tag.minutesPlayed;\n        }\n      }\n    }\n    \n    const updates: Record<string, number> = {};\n    \n    if (totalMinutesFromVideos > 0) {\n      updates.totalCareerMinutes = Math.max(player.totalCareerMinutes || 0, totalMinutesFromVideos);\n    }\n    if (last12MonthsMinutes > 0) {\n      updates.clubMinutesLast12Months = Math.max(player.clubMinutesLast12Months || 0, last12MonthsMinutes);\n    }\n    if (currentSeasonMinutes > 0) {\n      updates.clubMinutesCurrentSeason = Math.max(player.clubMinutesCurrentSeason || 0, currentSeasonMinutes);\n    }\n    \n    if (Object.keys(updates).length > 0) {\n      await storage.updatePlayer(playerId, updates);\n    }\n  } catch (error) {\n    console.error(\"Error updating player stats from videos:\", error);\n  }\n}\n\nexport async function registerRoutes(\n  httpServer: Server,\n  app: Express\n): Promise<Server> {\n  \n  registerObjectStorageRoutes(app);\n  const objectStorageService = new ObjectStorageService();\n  \n  // Auth routes - Team signup\n  app.post(\"/api/auth/signup\", async (req, res) => {\n    try {\n      const signupSchema = z.object({\n        username: z.string().min(3),\n        password: z.string().min(8),\n        email: z.string().email(),\n        firstName: z.string().optional(),\n        lastName: z.string().optional(),\n        role: z.enum([\"sporting_director\", \"legal\", \"scout\", \"coach\", \"admin\", \"agent\", \"embassy\"]).optional().default(\"scout\"),\n        teamName: z.string().optional(),\n        clubName: z.string().optional(),\n        country: z.string().optional(),\n        leagueBand: z.coerce.number().min(1).max(5).optional().default(3),\n        embassyCountry: z.string().optional(),\n        jurisdiction: z.string().optional(),\n      }).transform(data => ({\n        ...data,\n        role: data.role || \"scout\",\n        leagueBand: data.leagueBand || 3,\n      }));\n\n      const data = signupSchema.parse(req.body);\n      \n      const existingUser = await storage.getUserByUsername(data.username);\n      if (existingUser) {\n        return res.status(400).json({ error: \"Username already exists\" });\n      }\n\n      let teamId: string | undefined;\n\n      if (data.role === \"embassy\") {\n        const user = await storage.createUser({\n          username: data.username,\n          password: data.password,\n          email: data.email,\n          firstName: data.firstName,\n          lastName: data.lastName,\n          role: \"embassy\",\n        });\n\n        const embassyProfile = await storage.createEmbassyProfile({\n          country: data.embassyCountry || data.country || \"Unknown\",\n          jurisdiction: data.jurisdiction,\n          contactEmail: data.email,\n          userId: user.id,\n        });\n\n        // Auto-login after signup\n        req.session.userId = user.id;\n        req.session.userRole = \"embassy\";\n        req.session.embassyCountry = embassyProfile.country;\n        \n        return new Promise((resolve, reject) => {\n          req.session.save((err) => {\n            if (err) {\n              console.error(\"Session save error:\", err);\n              return res.status(500).json({ error: \"Session error\" });\n            }\n            res.json({ success: true, userId: user.id, role: \"embassy\", user: { id: user.id, username: user.username, role: \"embassy\", embassyCountry: embassyProfile.country } });\n            resolve(undefined);\n          });\n        });\n      }\n\n      if (data.role === \"scout\" || data.role === \"agent\") {\n        const user = await storage.createUser({\n          username: data.username,\n          password: data.password,\n          email: data.email,\n          firstName: data.firstName,\n          lastName: data.lastName,\n          role: data.role,\n        });\n        \n        await grantSignupBonus(user.id, data.role);\n\n        // Auto-login after signup\n        req.session.userId = user.id;\n        req.session.userRole = data.role;\n        \n        return new Promise((resolve, reject) => {\n          req.session.save((err) => {\n            if (err) {\n              console.error(\"Session save error:\", err);\n              return res.status(500).json({ error: \"Session error\" });\n            }\n            res.json({ success: true, userId: user.id, role: data.role, user: { id: user.id, username: user.username, role: data.role } });\n            resolve(undefined);\n          });\n        });\n      }\n\n      if (data.teamName && data.clubName) {\n        const team = await storage.createTeam({\n          name: data.teamName,\n          clubName: data.clubName,\n          country: data.country,\n          leagueBand: data.leagueBand,\n        });\n        teamId = team.id;\n      }\n\n      const user = await storage.createUser({\n        username: data.username,\n        password: data.password,\n        email: data.email,\n        firstName: data.firstName,\n        lastName: data.lastName,\n        role: data.role,\n        teamId,\n      });\n      \n      await grantSignupBonus(user.id, data.role);\n\n      // Auto-login after signup\n      req.session.userId = user.id;\n      req.session.teamId = teamId;\n      req.session.userRole = data.role;\n      \n      return new Promise((resolve, reject) => {\n        req.session.save((err) => {\n          if (err) {\n            console.error(\"Session save error:\", err);\n            return res.status(500).json({ error: \"Session error\" });\n          }\n          res.json({ success: true, userId: user.id, teamId, role: data.role, user: { id: user.id, username: user.username, role: data.role, teamId } });\n          resolve(undefined);\n        });\n      });\n    } catch (error: any) {\n      console.error(\"Signup error:\", error);\n      res.status(400).json({ error: error.message });\n    }\n  });\n\n  app.post(\"/api/auth/login\", async (req, res) => {\n    try {\n      const { username, password } = req.body;\n      \n      console.log(\"Login attempt for:\", username);\n      \n      const user = await storage.getUserByUsername(username);\n      if (!user) {\n        console.log(\"User not found:\", username);\n        return res.status(401).json({ error: \"Invalid credentials\" });\n      }\n      \n      // Simple password comparison (for development)\n      if (user.password !== password) {\n        console.log(\"Password mismatch for:\", username);\n        return res.status(401).json({ error: \"Invalid credentials\" });\n      }\n\n      req.session.userId = user.id;\n      req.session.teamId = user.teamId || undefined;\n      req.session.userRole = user.role;\n\n      let embassyProfile = null;\n      if (user.role === \"embassy\") {\n        embassyProfile = await storage.getEmbassyProfileByUserId(user.id);\n        if (embassyProfile) {\n          req.session.embassyCountry = embassyProfile.country;\n        }\n      }\n\n      // Save session explicitly\n      return new Promise((resolve, reject) => {\n        req.session.save(async (err) => {\n          if (err) {\n            console.error(\"Session save error:\", err);\n            return res.status(500).json({ error: \"Session error\" });\n          }\n          \n          try {\n            await storage.logAction({\n              userId: user.id,\n              userRole: user.role,\n              action: \"login\",\n              entityType: \"user\",\n              entityId: user.id,\n              details: { timestamp: new Date().toISOString() },\n            });\n          } catch (e) {\n            console.error(\"Log action error:\", e);\n          }\n          \n          res.json({ \n            success: true, \n            user: { \n              id: user.id, \n              username: user.username, \n              role: user.role,\n              teamId: user.teamId,\n              embassyCountry: embassyProfile?.country,\n            } \n          });\n          resolve(undefined);\n        });\n      });\n    } catch (error: any) {\n      console.error(\"Login error:\", error);\n      res.status(400).json({ error: error.message });\n    }\n  });\n\n  app.get(\"/api/auth/me\", async (req, res) => {\n    if (!req.session.userId) {\n      return res.status(401).json({ error: \"Not authenticated\" });\n    }\n    \n    const user = await storage.getUser(req.session.userId);\n    if (!user) {\n      return res.status(401).json({ error: \"User not found\" });\n    }\n\n    const team = user.teamId ? await storage.getTeam(user.teamId) : null;\n    let embassyProfile = null;\n    if (user.role === \"embassy\") {\n      embassyProfile = await storage.getEmbassyProfileByUserId(user.id);\n    }\n    \n    res.json({ \n      user: { \n        id: user.id, \n        username: user.username, \n        email: user.email,\n        firstName: user.firstName,\n        lastName: user.lastName,\n        role: user.role,\n        teamId: user.teamId,\n        embassyCountry: embassyProfile?.country,\n      },\n      team,\n      embassyProfile\n    });\n  });\n\n  app.post(\"/api/auth/logout\", (req, res) => {\n    req.session.destroy((err) => {\n      if (err) {\n        return res.status(500).json({ error: \"Logout failed\" });\n      }\n      res.json({ success: true });\n    });\n  });\n\n  // Players routes\n  app.get(\"/api/players\", requireAuth, async (req, res) => {\n    try {\n      // In demo mode, return all players\n      const players = await storage.getPlayers();\n      res.json(players);\n    } catch (error: any) {\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  // Team-specific players route for team staff\n  app.get(\"/api/team/players\", requireAuth, async (req, res) => {\n    try {\n      const players = await storage.getPlayers();\n      res.json(players);\n    } catch (error: any) {\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  app.get(\"/api/players/:id\", requireAuth, async (req, res) => {\n    try {\n      const player = await storage.getPlayer(req.params.id);\n      if (!player) {\n        return res.status(404).json({ error: \"Player not found\" });\n      }\n      \n      const metrics = await storage.getPlayerMetrics(player.id);\n      const eligibilityScores = await storage.getEligibilityScores(player.id);\n      const medicalRecords = await storage.getMedicalRecords(player.id);\n      const biometricData = await storage.getBiometricData(player.id);\n      const videos = await storage.getVideos(player.id);\n      \n      res.json({ \n        player, \n        metrics, \n        eligibilityScores, \n        medicalRecords, \n        biometricData,\n        videos \n      });\n    } catch (error: any) {\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  app.post(\"/api/players\", requireAuth, async (req, res) => {\n    try {\n      const playerData = insertPlayerSchema.parse({\n        ...req.body,\n        teamId: req.body.teamId || \"demo-team\",\n      });\n      const player = await storage.createPlayer(playerData);\n      res.json(player);\n    } catch (error: any) {\n      res.status(400).json({ error: error.message });\n    }\n  });\n\n  app.put(\"/api/players/:id\", requireAuth, async (req, res) => {\n    try {\n      const player = await storage.updatePlayer(req.params.id, req.body);\n      if (!player) {\n        return res.status(404).json({ error: \"Player not found\" });\n      }\n      res.json(player);\n    } catch (error: any) {\n      res.status(400).json({ error: error.message });\n    }\n  });\n\n  // Player metrics routes\n  app.post(\"/api/players/:id/metrics\", requireAuth, async (req, res) => {\n    try {\n      const metrics = await storage.createPlayerMetrics({\n        playerId: req.params.id,\n        ...req.body,\n      });\n      res.json(metrics);\n    } catch (error: any) {\n      res.status(400).json({ error: error.message });\n    }\n  });\n\n  // Player international records routes\n  app.get(\"/api/players/:playerId/international-records\", requireAuth, async (req, res) => {\n    try {\n      const records = await storage.getPlayerInternationalRecords(req.params.playerId);\n      res.json(records);\n    } catch (error: any) {\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  app.post(\"/api/players/:playerId/international-records\", requireAuth, async (req, res) => {\n    try {\n      const recordData = insertPlayerInternationalRecordSchema.parse({\n        ...req.body,\n        playerId: req.params.playerId,\n      });\n      const record = await storage.createPlayerInternationalRecord(recordData);\n      res.json(record);\n    } catch (error: any) {\n      res.status(400).json({ error: error.message });\n    }\n  });\n\n  app.put(\"/api/players/:playerId/international-records/:recordId\", requireAuth, async (req, res) => {\n    try {\n      const record = await storage.updatePlayerInternationalRecord(req.params.recordId, req.body);\n      if (!record) {\n        return res.status(404).json({ error: \"International record not found\" });\n      }\n      res.json(record);\n    } catch (error: any) {\n      res.status(400).json({ error: error.message });\n    }\n  });\n\n  app.delete(\"/api/players/:playerId/international-records/:recordId\", requireAuth, async (req, res) => {\n    try {\n      await storage.deletePlayerInternationalRecord(req.params.recordId);\n      res.json({ success: true });\n    } catch (error: any) {\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  // Player documents routes (passport, national ID, birth certificate)\n  app.get(\"/api/players/:playerId/documents\", requireTeamRole, async (req, res) => {\n    try {\n      const documents = await storage.getPlayerDocuments(req.params.playerId);\n      res.json(documents);\n    } catch (error: any) {\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  app.post(\"/api/players/:playerId/documents\", requireTeamRole, async (req, res) => {\n    try {\n      const { documentType, originalName, mimeType, fileSize, storageKey, objectPath, documentNumber, issuingCountry, expiryDate, notes } = req.body;\n      \n      if (!documentType || !originalName || !storageKey) {\n        return res.status(400).json({ error: \"Missing required fields: documentType, originalName, storageKey\" });\n      }\n      \n      const validTypes = [\"passport\", \"national_id\", \"birth_certificate\"];\n      if (!validTypes.includes(documentType)) {\n        return res.status(400).json({ error: `Invalid document type. Must be one of: ${validTypes.join(\", \")}` });\n      }\n      \n      const document = await storage.createPlayerDocument({\n        playerId: req.params.playerId,\n        teamId: req.session.teamId || \"demo-team\",\n        documentType,\n        originalName,\n        mimeType,\n        fileSize,\n        storageKey,\n        objectPath,\n        documentNumber,\n        issuingCountry,\n        expiryDate,\n        notes,\n        uploadedBy: req.session.userId,\n      });\n      \n      await storage.logAction({\n        userId: req.session.userId,\n        userRole: req.session.userRole,\n        action: \"upload_document\",\n        entityType: \"player_document\",\n        entityId: document.id,\n        details: { playerId: req.params.playerId, documentType },\n      });\n      \n      res.json(document);\n    } catch (error: any) {\n      res.status(400).json({ error: error.message });\n    }\n  });\n\n  app.put(\"/api/players/:playerId/documents/:docId\", requireTeamRole, async (req, res) => {\n    try {\n      const document = await storage.updatePlayerDocument(req.params.docId, req.body);\n      if (!document) {\n        return res.status(404).json({ error: \"Document not found\" });\n      }\n      res.json(document);\n    } catch (error: any) {\n      res.status(400).json({ error: error.message });\n    }\n  });\n\n  app.delete(\"/api/players/:playerId/documents/:docId\", requireTeamRole, async (req, res) => {\n    try {\n      const document = await storage.getPlayerDocument(req.params.docId);\n      if (!document) {\n        return res.status(404).json({ error: \"Document not found\" });\n      }\n      \n      await storage.deletePlayerDocument(req.params.docId);\n      \n      await storage.logAction({\n        userId: req.session.userId,\n        userRole: req.session.userRole,\n        action: \"delete_document\",\n        entityType: \"player_document\",\n        entityId: req.params.docId,\n        details: { playerId: req.params.playerId, documentType: document.documentType },\n      });\n      \n      res.json({ success: true });\n    } catch (error: any) {\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  app.post(\"/api/players/:playerId/documents/:docId/verify\", requireTeamRole, async (req, res) => {\n    try {\n      const document = await storage.updatePlayerDocument(req.params.docId, {\n        verificationStatus: \"verified\",\n        verifiedBy: req.session.userId,\n        verifiedAt: new Date(),\n      });\n      if (!document) {\n        return res.status(404).json({ error: \"Document not found\" });\n      }\n      \n      await storage.logAction({\n        userId: req.session.userId,\n        userRole: req.session.userRole,\n        action: \"verify_document\",\n        entityType: \"player_document\",\n        entityId: req.params.docId,\n        details: { playerId: req.params.playerId, documentType: document.documentType },\n      });\n      \n      res.json(document);\n    } catch (error: any) {\n      res.status(400).json({ error: error.message });\n    }\n  });\n\n  // Federation Letter Request routes\n  \n  // Team summary stats endpoint\n  app.get(\"/api/federation-letter-requests/summary\", requireTeamRole, async (req, res) => {\n    try {\n      const teamId = req.session.teamId || \"demo-team\";\n      const requests = await storage.getFederationLetterRequests(teamId);\n      \n      const summary = {\n        total: requests.length,\n        pending: requests.filter(r => r.status === \"pending\").length,\n        submitted: requests.filter(r => r.status === \"submitted\").length,\n        processing: requests.filter(r => r.status === \"processing\").length,\n        issued: requests.filter(r => r.status === \"issued\").length,\n        rejected: requests.filter(r => r.status === \"rejected\").length,\n      };\n      \n      res.json(summary);\n    } catch (error: any) {\n      res.status(500).json({ error: error.message });\n    }\n  });\n  \n  app.get(\"/api/federation-letter-requests\", requireTeamRole, async (req, res) => {\n    try {\n      const { teamId, playerId, status } = req.query;\n      let requests;\n      if (playerId) {\n        requests = await storage.getFederationLetterRequestsByPlayer(playerId as string);\n      } else if (status) {\n        requests = await storage.getFederationLetterRequestsByStatus(status as string);\n      } else {\n        requests = await storage.getFederationLetterRequests(teamId as string || req.session.teamId);\n      }\n      res.json(requests);\n    } catch (error: any) {\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  app.get(\"/api/federation-letter-requests/:id\", requireTeamRole, async (req, res) => {\n    try {\n      const request = await storage.getFederationLetterRequest(req.params.id);\n      if (!request) {\n        return res.status(404).json({ error: \"Request not found\" });\n      }\n      res.json(request);\n    } catch (error: any) {\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  app.post(\"/api/federation-letter-requests\", requireTeamRole, async (req, res) => {\n    try {\n      const year = new Date().getFullYear();\n      const timestamp = Date.now().toString(36).toUpperCase();\n      const requestNumber = `FLR-${year}-${timestamp}`;\n      \n      // Ensure teamId is set from session before validation\n      const teamId = req.session.teamId || req.body.teamId || \"demo-team\";\n      \n      const requestData = insertFederationLetterRequestSchema.parse({\n        ...req.body,\n        requestNumber,\n        teamId,\n        status: \"pending\",\n        paymentStatus: \"unpaid\",\n        submittedBy: req.session.userId,\n        feeAmount: 150,\n        serviceCharge: 25,\n        totalAmount: 175,\n      });\n      \n      const newRequest = await storage.createFederationLetterRequest(requestData);\n      \n      await storage.logAction({\n        userId: req.session.userId,\n        userRole: req.session.userRole,\n        action: \"create_federation_letter_request\",\n        entityType: \"federation_letter_request\",\n        entityId: newRequest.id,\n        details: { requestNumber, playerId: req.body.playerId },\n      });\n      \n      res.json(newRequest);\n    } catch (error: any) {\n      res.status(400).json({ error: error.message });\n    }\n  });\n\n  app.put(\"/api/federation-letter-requests/:id\", requireTeamRole, async (req, res) => {\n    try {\n      const request = await storage.getFederationLetterRequest(req.params.id);\n      if (!request) {\n        return res.status(404).json({ error: \"Request not found\" });\n      }\n      \n      const updatedRequest = await storage.updateFederationLetterRequest(req.params.id, req.body);\n      \n      await storage.logAction({\n        userId: req.session.userId,\n        userRole: req.session.userRole,\n        action: \"update_federation_letter_request\",\n        entityType: \"federation_letter_request\",\n        entityId: req.params.id,\n        details: { updates: Object.keys(req.body) },\n      });\n      \n      res.json(updatedRequest);\n    } catch (error: any) {\n      res.status(400).json({ error: error.message });\n    }\n  });\n\n  app.post(\"/api/federation-letter-requests/:id/submit\", requireTeamRole, async (req, res) => {\n    try {\n      const request = await storage.getFederationLetterRequest(req.params.id);\n      if (!request) {\n        return res.status(404).json({ error: \"Request not found\" });\n      }\n      \n      if (request.paymentStatus !== \"paid\") {\n        return res.status(400).json({ error: \"Payment required before submission\" });\n      }\n      \n      const updatedRequest = await storage.updateFederationLetterRequest(req.params.id, {\n        status: \"submitted\",\n        submittedAt: new Date(),\n      });\n      \n      await storage.logAction({\n        userId: req.session.userId,\n        userRole: req.session.userRole,\n        action: \"submit_federation_letter_request\",\n        entityType: \"federation_letter_request\",\n        entityId: req.params.id,\n        details: { requestNumber: request.requestNumber },\n      });\n      \n      res.json(updatedRequest);\n    } catch (error: any) {\n      res.status(400).json({ error: error.message });\n    }\n  });\n\n  app.post(\"/api/federation-letter-requests/:id/process\", requireTeamRole, async (req, res) => {\n    try {\n      const request = await storage.getFederationLetterRequest(req.params.id);\n      if (!request) {\n        return res.status(404).json({ error: \"Request not found\" });\n      }\n      \n      const updatedRequest = await storage.updateFederationLetterRequest(req.params.id, {\n        status: \"processing\",\n        processedBy: req.session.userId,\n        processedAt: new Date(),\n      });\n      \n      await storage.logAction({\n        userId: req.session.userId,\n        userRole: req.session.userRole,\n        action: \"process_federation_letter_request\",\n        entityType: \"federation_letter_request\",\n        entityId: req.params.id,\n        details: { requestNumber: request.requestNumber },\n      });\n      \n      res.json(updatedRequest);\n    } catch (error: any) {\n      res.status(400).json({ error: error.message });\n    }\n  });\n\n  app.post(\"/api/federation-letter-requests/:id/issue\", requireTeamRole, async (req, res) => {\n    try {\n      const request = await storage.getFederationLetterRequest(req.params.id);\n      if (!request) {\n        return res.status(404).json({ error: \"Request not found\" });\n      }\n      \n      const { issuedDocumentStorageKey, issuedDocumentObjectPath, issuedDocumentOriginalName } = req.body;\n      \n      const updatedRequest = await storage.updateFederationLetterRequest(req.params.id, {\n        status: \"issued\",\n        issuedAt: new Date(),\n        issuedBy: req.session.userId,\n        issuedDocumentStorageKey,\n        issuedDocumentObjectPath,\n        issuedDocumentOriginalName,\n      });\n      \n      await storage.logAction({\n        userId: req.session.userId,\n        userRole: req.session.userRole,\n        action: \"issue_federation_letter_request\",\n        entityType: \"federation_letter_request\",\n        entityId: req.params.id,\n        details: { requestNumber: request.requestNumber },\n      });\n      \n      res.json(updatedRequest);\n    } catch (error: any) {\n      res.status(400).json({ error: error.message });\n    }\n  });\n\n  app.post(\"/api/federation-letter-requests/:id/reject\", requireTeamRole, async (req, res) => {\n    try {\n      const request = await storage.getFederationLetterRequest(req.params.id);\n      if (!request) {\n        return res.status(404).json({ error: \"Request not found\" });\n      }\n      \n      const { rejectionReason } = req.body;\n      \n      const updatedRequest = await storage.updateFederationLetterRequest(req.params.id, {\n        status: \"rejected\",\n        rejectionReason,\n      });\n      \n      await storage.logAction({\n        userId: req.session.userId,\n        userRole: req.session.userRole,\n        action: \"reject_federation_letter_request\",\n        entityType: \"federation_letter_request\",\n        entityId: req.params.id,\n        details: { requestNumber: request.requestNumber, rejectionReason },\n      });\n      \n      res.json(updatedRequest);\n    } catch (error: any) {\n      res.status(400).json({ error: error.message });\n    }\n  });\n\n  app.post(\"/api/federation-letter-requests/:id/confirm-payment\", requireTeamRole, async (req, res) => {\n    try {\n      const request = await storage.getFederationLetterRequest(req.params.id);\n      if (!request) {\n        return res.status(404).json({ error: \"Request not found\" });\n      }\n      \n      const { paymentId } = req.body;\n      \n      const updatedRequest = await storage.updateFederationLetterRequest(req.params.id, {\n        paymentStatus: \"paid\",\n        paymentId,\n        paymentConfirmedAt: new Date(),\n      });\n      \n      await storage.logAction({\n        userId: req.session.userId,\n        userRole: req.session.userRole,\n        action: \"confirm_payment_federation_letter_request\",\n        entityType: \"federation_letter_request\",\n        entityId: req.params.id,\n        details: { requestNumber: request.requestNumber, paymentId },\n      });\n      \n      res.json(updatedRequest);\n    } catch (error: any) {\n      res.status(400).json({ error: error.message });\n    }\n  });\n\n  app.delete(\"/api/federation-letter-requests/:id\", requireTeamRole, async (req, res) => {\n    try {\n      const request = await storage.getFederationLetterRequest(req.params.id);\n      if (!request) {\n        return res.status(404).json({ error: \"Request not found\" });\n      }\n      \n      if (request.status !== \"pending\") {\n        return res.status(400).json({ error: \"Can only delete pending requests\" });\n      }\n      \n      await storage.deleteFederationLetterRequest(req.params.id);\n      \n      await storage.logAction({\n        userId: req.session.userId,\n        userRole: req.session.userRole,\n        action: \"delete_federation_letter_request\",\n        entityType: \"federation_letter_request\",\n        entityId: req.params.id,\n        details: { requestNumber: request.requestNumber },\n      });\n      \n      res.json({ success: true });\n    } catch (error: any) {\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  // Federation Admin Routes\n  const requireFederationAdmin = (req: Request, res: Response, next: NextFunction) => {\n    // In demo mode, allow access to federation admin routes for any user\n    // This simulates having federation admin privileges for demo purposes\n    if (!req.session.userId) {\n      req.session.userId = \"demo-federation-admin\";\n      req.session.userRole = \"federation_admin\";\n    }\n    // In demo mode, grant federation admin access to all users accessing these routes\n    // In production, this would check for actual federation_admin role\n    next();\n  };\n\n  app.get(\"/api/federation-admin/dashboard-stats\", requireFederationAdmin, async (req, res) => {\n    try {\n      const stats = await storage.getFederationDashboardStats();\n      res.json(stats);\n    } catch (error: any) {\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  app.get(\"/api/federation-admin/requests\", requireFederationAdmin, async (req, res) => {\n    try {\n      const { status } = req.query;\n      let requests;\n      if (status && status !== \"all\") {\n        requests = await storage.getFederationLetterRequestsByStatus(status as string);\n      } else {\n        requests = await storage.getFederationLetterRequests();\n      }\n      res.json(requests);\n    } catch (error: any) {\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  app.post(\"/api/federation-admin/requests/:id/accept\", requireFederationAdmin, async (req, res) => {\n    try {\n      const request = await storage.getFederationLetterRequest(req.params.id);\n      if (!request) {\n        return res.status(404).json({ error: \"Request not found\" });\n      }\n      if (request.status !== \"submitted\") {\n        return res.status(400).json({ error: \"Can only accept submitted requests\" });\n      }\n      \n      const updatedRequest = await storage.updateFederationLetterRequest(req.params.id, {\n        status: \"processing\",\n        processedBy: req.session.userId,\n        processedAt: new Date(),\n      });\n\n      await storage.createFederationRequestActivity({\n        requestId: req.params.id,\n        actorId: req.session.userId,\n        actorRole: \"federation_admin\",\n        activityType: \"accepted\",\n        description: \"Request accepted for processing\",\n        previousStatus: \"submitted\",\n        newStatus: \"processing\",\n      });\n      \n      res.json(updatedRequest);\n    } catch (error: any) {\n      res.status(400).json({ error: error.message });\n    }\n  });\n\n  app.post(\"/api/federation-admin/requests/:id/issue\", requireFederationAdmin, async (req, res) => {\n    try {\n      const request = await storage.getFederationLetterRequest(req.params.id);\n      if (!request) {\n        return res.status(404).json({ error: \"Request not found\" });\n      }\n      if (request.status !== \"processing\") {\n        return res.status(400).json({ error: \"Can only issue processing requests\" });\n      }\n      \n      const { issuedDocumentStorageKey, issuedDocumentObjectPath, issuedDocumentOriginalName, mimeType, fileSize } = req.body;\n      \n      const updatedRequest = await storage.updateFederationLetterRequest(req.params.id, {\n        status: \"issued\",\n        issuedAt: new Date(),\n        issuedBy: req.session.userId,\n        issuedDocumentStorageKey,\n        issuedDocumentObjectPath,\n        issuedDocumentOriginalName,\n      });\n\n      // Create issued document record for download tracking\n      await storage.createFederationIssuedDocument({\n        requestId: req.params.id,\n        documentType: \"Federation Letter\",\n        documentNumber: request.requestNumber,\n        storageKey: issuedDocumentStorageKey || `issued-${req.params.id}`,\n        objectPath: issuedDocumentObjectPath,\n        originalName: issuedDocumentOriginalName || `Federation_Letter_${request.requestNumber}.pdf`,\n        mimeType: mimeType || \"application/pdf\",\n        fileSize: fileSize || 0,\n        issuedBy: req.session.userId || \"federation-admin\",\n        issuedByName: \"Federation Administrator\",\n      });\n\n      await storage.createFederationRequestActivity({\n        requestId: req.params.id,\n        actorId: req.session.userId,\n        actorRole: \"federation_admin\",\n        activityType: \"issued\",\n        description: \"Federation letter issued\",\n        previousStatus: \"processing\",\n        newStatus: \"issued\",\n        metadata: { documentName: issuedDocumentOriginalName },\n      });\n      \n      res.json(updatedRequest);\n    } catch (error: any) {\n      res.status(400).json({ error: error.message });\n    }\n  });\n\n  app.post(\"/api/federation-admin/requests/:id/reject\", requireFederationAdmin, async (req, res) => {\n    try {\n      const request = await storage.getFederationLetterRequest(req.params.id);\n      if (!request) {\n        return res.status(404).json({ error: \"Request not found\" });\n      }\n      \n      const { rejectionReason } = req.body;\n      \n      const updatedRequest = await storage.updateFederationLetterRequest(req.params.id, {\n        status: \"rejected\",\n        rejectionReason,\n      });\n\n      await storage.createFederationRequestActivity({\n        requestId: req.params.id,\n        actorId: req.session.userId,\n        actorRole: \"federation_admin\",\n        activityType: \"rejected\",\n        description: \"Request rejected\",\n        previousStatus: request.status,\n        newStatus: \"rejected\",\n        metadata: { rejectionReason },\n      });\n      \n      res.json(updatedRequest);\n    } catch (error: any) {\n      res.status(400).json({ error: error.message });\n    }\n  });\n\n  app.get(\"/api/federation-admin/requests/:id/activities\", requireFederationAdmin, async (req, res) => {\n    try {\n      const activities = await storage.getFederationRequestActivities(req.params.id);\n      res.json(activities);\n    } catch (error: any) {\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  app.get(\"/api/federation-admin/fee-schedules\", requireFederationAdmin, async (req, res) => {\n    try {\n      const { federationId } = req.query;\n      const schedules = federationId \n        ? await storage.getFederationFeeSchedules(federationId as string)\n        : await storage.getAllFederationFeeSchedules();\n      res.json(schedules);\n    } catch (error: any) {\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  app.post(\"/api/federation-admin/fee-schedules\", requireFederationAdmin, async (req, res) => {\n    try {\n      const schedule = await storage.createFederationFeeSchedule({\n        ...req.body,\n        platformServiceCharge: 25,\n      });\n      res.json(schedule);\n    } catch (error: any) {\n      res.status(400).json({ error: error.message });\n    }\n  });\n\n  app.put(\"/api/federation-admin/fee-schedules/:id\", requireFederationAdmin, async (req, res) => {\n    try {\n      const schedule = await storage.updateFederationFeeSchedule(req.params.id, req.body);\n      res.json(schedule);\n    } catch (error: any) {\n      res.status(400).json({ error: error.message });\n    }\n  });\n\n  app.delete(\"/api/federation-admin/fee-schedules/:id\", requireFederationAdmin, async (req, res) => {\n    try {\n      await storage.deleteFederationFeeSchedule(req.params.id);\n      res.json({ success: true });\n    } catch (error: any) {\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  app.get(\"/api/federation-admin/profiles\", requireFederationAdmin, async (req, res) => {\n    try {\n      const profiles = await storage.getFederationProfiles();\n      res.json(profiles);\n    } catch (error: any) {\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  app.post(\"/api/federation-admin/profiles\", requireFederationAdmin, async (req, res) => {\n    try {\n      const profile = await storage.createFederationProfile(req.body);\n      res.json(profile);\n    } catch (error: any) {\n      res.status(400).json({ error: error.message });\n    }\n  });\n\n  app.put(\"/api/federation-admin/profiles/:id\", requireFederationAdmin, async (req, res) => {\n    try {\n      const profile = await storage.updateFederationProfile(req.params.id, req.body);\n      res.json(profile);\n    } catch (error: any) {\n      res.status(400).json({ error: error.message });\n    }\n  });\n\n  // Federation Request Messages Routes (accessible by both team and federation admin)\n  app.get(\"/api/federation-requests/:id/messages\", requireAuth, async (req, res) => {\n    try {\n      const messages = await storage.getFederationRequestMessages(req.params.id);\n      res.json(messages);\n    } catch (error: any) {\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  app.post(\"/api/federation-requests/:id/messages\", requireAuth, async (req, res) => {\n    try {\n      const { content, subject, recipientPortal } = req.body;\n      const userRole = req.session.userRole || 'team';\n      const senderPortal = userRole === 'federation_admin' ? 'federation' : 'team';\n      \n      const message = await storage.createFederationRequestMessage({\n        requestId: req.params.id,\n        senderId: req.session.userId || 'anonymous',\n        senderName: req.body.senderName || req.session.userId || 'Unknown',\n        senderRole: userRole,\n        senderPortal,\n        recipientPortal: recipientPortal || (senderPortal === 'team' ? 'federation' : 'team'),\n        subject,\n        content,\n      });\n\n      await storage.logFederationActivity(\n        req.params.id,\n        'message_sent',\n        `Message sent from ${senderPortal} portal`,\n        req.session.userId,\n        req.body.senderName || req.session.userId,\n        userRole,\n        undefined,\n        undefined,\n        { messageId: message.id, subject }\n      );\n\n      res.json(message);\n    } catch (error: any) {\n      res.status(400).json({ error: error.message });\n    }\n  });\n\n  app.put(\"/api/federation-requests/messages/:id/read\", requireAuth, async (req, res) => {\n    try {\n      const message = await storage.markMessageAsRead(req.params.id);\n      res.json(message);\n    } catch (error: any) {\n      res.status(400).json({ error: error.message });\n    }\n  });\n\n  // Federation Request Activity Log Routes\n  app.get(\"/api/federation-requests/:id/activities\", requireAuth, async (req, res) => {\n    try {\n      const activities = await storage.getFederationRequestActivities(req.params.id);\n      res.json(activities);\n    } catch (error: any) {\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  // Federation Request Full History (request + activities + messages + documents)\n  app.get(\"/api/federation-requests/:id/history\", requireAuth, async (req, res) => {\n    try {\n      const history = await storage.getRequestWithFullHistory(req.params.id);\n      res.json(history);\n    } catch (error: any) {\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  // Federation Issued Documents Routes\n  app.get(\"/api/federation-requests/:id/issued-documents\", requireAuth, async (req, res) => {\n    try {\n      const documents = await storage.getFederationIssuedDocuments(req.params.id);\n      res.json(documents);\n    } catch (error: any) {\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  app.post(\"/api/federation-requests/:id/issued-documents/:docId/download\", requireAuth, async (req, res) => {\n    try {\n      await storage.incrementDocumentDownloadCount(req.params.docId);\n      \n      await storage.logFederationActivity(\n        req.params.id,\n        'document_downloaded',\n        `Document downloaded`,\n        req.session.userId,\n        req.session.userId,\n        req.session.userRole,\n        undefined,\n        undefined,\n        { documentId: req.params.docId }\n      );\n      \n      res.json({ success: true });\n    } catch (error: any) {\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  // Download an issued document directly - generates PDF with platform timestamp\n  app.get(\"/api/federation-requests/:id/issued-documents/:docId/download-file\", requireAuth, async (req, res) => {\n    try {\n      const documents = await storage.getFederationIssuedDocuments(req.params.id);\n      const doc = documents.find(d => d.id === req.params.docId);\n      \n      if (!doc) {\n        return res.status(404).json({ error: \"Document not found\" });\n      }\n      \n      // Get the request details for the certificate\n      const request = await storage.getFederationLetterRequest(req.params.id);\n      if (!request) {\n        return res.status(404).json({ error: \"Request not found\" });\n      }\n      \n      await storage.incrementDocumentDownloadCount(req.params.docId);\n      \n      // Generate a PDF certificate with platform timestamp\n      const pdf = new jsPDF();\n      const issuedDate = doc.issuedAt ? new Date(doc.issuedAt) : new Date();\n      const downloadDate = new Date();\n      \n      // Header\n      pdf.setFontSize(20);\n      pdf.setFont(\"helvetica\", \"bold\");\n      pdf.text(\"FEDERATION LETTER CERTIFICATE\", 105, 30, { align: \"center\" });\n      \n      // Platform branding\n      pdf.setFontSize(12);\n      pdf.setFont(\"helvetica\", \"normal\");\n      pdf.text(\"Sports Reels Compliance Platform\", 105, 40, { align: \"center\" });\n      \n      // Horizontal line\n      pdf.setLineWidth(0.5);\n      pdf.line(20, 50, 190, 50);\n      \n      // Document details\n      pdf.setFontSize(11);\n      let yPos = 65;\n      \n      pdf.setFont(\"helvetica\", \"bold\");\n      pdf.text(\"Document Information\", 20, yPos);\n      yPos += 10;\n      \n      pdf.setFont(\"helvetica\", \"normal\");\n      pdf.text(`Request Number: ${request.requestNumber}`, 20, yPos);\n      yPos += 8;\n      pdf.text(`Document Type: ${doc.documentType}`, 20, yPos);\n      yPos += 8;\n      pdf.text(`Original File: ${doc.originalName}`, 20, yPos);\n      yPos += 15;\n      \n      pdf.setFont(\"helvetica\", \"bold\");\n      pdf.text(\"Athlete Information\", 20, yPos);\n      yPos += 10;\n      \n      pdf.setFont(\"helvetica\", \"normal\");\n      pdf.text(`Full Name: ${request.athleteFullName}`, 20, yPos);\n      yPos += 8;\n      pdf.text(`Nationality: ${request.athleteNationality}`, 20, yPos);\n      yPos += 8;\n      pdf.text(`Position: ${request.athletePosition}`, 20, yPos);\n      yPos += 8;\n      pdf.text(`Date of Birth: ${request.athleteDateOfBirth}`, 20, yPos);\n      yPos += 15;\n      \n      pdf.setFont(\"helvetica\", \"bold\");\n      pdf.text(\"Transfer Details\", 20, yPos);\n      yPos += 10;\n      \n      pdf.setFont(\"helvetica\", \"normal\");\n      pdf.text(`Target Club: ${request.targetClubName}`, 20, yPos);\n      yPos += 8;\n      pdf.text(`Target Country: ${request.targetClubCountry}`, 20, yPos);\n      yPos += 8;\n      pdf.text(`Transfer Type: ${request.transferType?.replace(/_/g, ' ').toUpperCase()}`, 20, yPos);\n      yPos += 8;\n      if (request.federationName) {\n        pdf.text(`Federation: ${request.federationName} (${request.federationCountry})`, 20, yPos);\n        yPos += 8;\n      }\n      yPos += 10;\n      \n      // Horizontal line\n      pdf.line(20, yPos, 190, yPos);\n      yPos += 15;\n      \n      // Platform timestamp section\n      pdf.setFont(\"helvetica\", \"bold\");\n      pdf.text(\"Platform Verification\", 20, yPos);\n      yPos += 10;\n      \n      pdf.setFont(\"helvetica\", \"normal\");\n      pdf.text(`Issued Date: ${issuedDate.toLocaleString('en-US', { \n        dateStyle: 'full', \n        timeStyle: 'long',\n        timeZone: 'UTC'\n      })} UTC`, 20, yPos);\n      yPos += 8;\n      pdf.text(`Download Date: ${downloadDate.toLocaleString('en-US', { \n        dateStyle: 'full', \n        timeStyle: 'long',\n        timeZone: 'UTC'\n      })} UTC`, 20, yPos);\n      yPos += 8;\n      pdf.text(`Issued By: ${doc.issuedByName || 'Federation Administrator'}`, 20, yPos);\n      yPos += 8;\n      pdf.text(`Download Count: ${(doc.downloadCount || 0) + 1}`, 20, yPos);\n      yPos += 15;\n      \n      // Verification notice\n      pdf.setFontSize(9);\n      pdf.setFont(\"helvetica\", \"italic\");\n      pdf.text(\"This document was issued through the Sports Reels Compliance Platform.\", 105, yPos, { align: \"center\" });\n      yPos += 5;\n      pdf.text(\"The timestamp above represents the official platform issuance time.\", 105, yPos, { align: \"center\" });\n      yPos += 5;\n      pdf.text(`Document ID: ${doc.id}`, 105, yPos, { align: \"center\" });\n      \n      // Footer\n      pdf.setFontSize(8);\n      pdf.text(\"Sports Reels - Player Compliance & Visa Eligibility Platform\", 105, 285, { align: \"center\" });\n      \n      // Generate PDF buffer and send\n      const pdfBuffer = Buffer.from(pdf.output('arraybuffer'));\n      const fileName = `Federation_Letter_${request.requestNumber}_${downloadDate.toISOString().split('T')[0]}.pdf`;\n      \n      res.setHeader(\"Content-Type\", \"application/pdf\");\n      res.setHeader(\"Content-Disposition\", `attachment; filename=\"${fileName}\"`);\n      res.send(pdfBuffer);\n    } catch (error: any) {\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  // Download the original uploaded document\n  app.get(\"/api/federation-requests/:id/issued-documents/:docId/download-original\", requireAuth, async (req, res) => {\n    try {\n      const documents = await storage.getFederationIssuedDocuments(req.params.id);\n      const doc = documents.find(d => d.id === req.params.docId);\n      \n      if (!doc) {\n        return res.status(404).json({ error: \"Document not found\" });\n      }\n      \n      await storage.incrementDocumentDownloadCount(req.params.docId);\n      \n      // If objectPath exists, stream the original file directly\n      if (doc.objectPath) {\n        try {\n          const objectStorage = new ObjectStorageService();\n          // Use getObjectEntityFile which handles /objects/uploads/uuid paths\n          const objectFile = await objectStorage.getObjectEntityFile(doc.objectPath);\n          res.setHeader(\"Content-Disposition\", `attachment; filename=\"${doc.originalName}\"`);\n          return objectStorage.downloadObject(objectFile, res);\n        } catch (e: any) {\n          console.error(\"Error downloading original:\", e);\n        }\n      }\n      \n      // Return error if file not found\n      res.status(404).json({ error: \"Original document file not found in storage\" });\n    } catch (error: any) {\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  // Unread messages count for team portal\n  app.get(\"/api/federation-requests/unread-count\", requireAuth, async (req, res) => {\n    try {\n      const messages = await storage.getUnreadMessagesForPortal('team');\n      res.json({ count: messages.length });\n    } catch (error: any) {\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  // Videos routes\n  app.get(\"/api/videos\", requireAuth, async (req, res) => {\n    try {\n      const { playerId } = req.query;\n      const videos = await storage.getVideos(playerId as string | undefined);\n      res.json(videos);\n    } catch (error: any) {\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  app.post(\"/api/videos\", requireAuth, async (req, res) => {\n    try {\n      const videoData = insertVideoSchema.parse({\n        ...req.body,\n        teamId: req.session.teamId,\n      });\n      const video = await storage.createVideo(videoData);\n      \n      if (video.playerId && video.minutesPlayed && video.minutesPlayed > 0) {\n        await updatePlayerStatsFromVideos(video.playerId);\n      }\n      \n      res.json(video);\n    } catch (error: any) {\n      res.status(400).json({ error: error.message });\n    }\n  });\n\n  app.put(\"/api/videos/:id\", requireAuth, async (req, res) => {\n    try {\n      const video = await storage.getVideo(req.params.id);\n      if (!video) {\n        return res.status(404).json({ error: \"Video not found\" });\n      }\n      const updatedVideo = await storage.updateVideo(req.params.id, req.body);\n      \n      if (updatedVideo && updatedVideo.playerId) {\n        await updatePlayerStatsFromVideos(updatedVideo.playerId);\n      }\n      \n      res.json(updatedVideo);\n    } catch (error: any) {\n      res.status(400).json({ error: error.message });\n    }\n  });\n\n  app.post(\"/api/videos/:id/analyze\", requireAuth, async (req, res) => {\n    try {\n      const video = await storage.getVideo(req.params.id);\n      if (!video) {\n        return res.status(404).json({ error: \"Video not found\" });\n      }\n\n      const player = await storage.getPlayer(video.playerId);\n      if (!player) {\n        return res.status(404).json({ error: \"Player not found\" });\n      }\n      \n      const userId = req.session.userId!;\n      const userRole = req.session.userRole || \"sporting_director\";\n      const tokenResult = await spendTokensForAction(userId, userRole, \"video_analysis\", video.playerId, video.id);\n      if (!tokenResult.success) {\n        return res.status(402).json({ error: tokenResult.error, needsTokens: true });\n      }\n\n      const analysisPrompt = `Analyze this football match video data for player performance metrics:\nPlayer: ${player.firstName} ${player.lastName}\nPosition: ${player.position}\nMatch: ${video.title}\nDuration: ${video.duration}\nCompetition: ${video.competition || \"Unknown\"}\n\nBased on typical match analysis, provide estimated metrics in JSON format:\n{\n  \"minutesPlayed\": number,\n  \"distanceCovered\": number (km),\n  \"sprintCount\": number,\n  \"passesAttempted\": number,\n  \"passesCompleted\": number,\n  \"shotsOnTarget\": number,\n  \"tackles\": number,\n  \"interceptions\": number,\n  \"duelsWon\": number,\n  \"performanceRating\": number (1-10),\n  \"summary\": \"brief performance summary\"\n}`;\n\n      const response = await gemini.models.generateContent({\n        model: \"gemini-2.5-flash\",\n        contents: analysisPrompt,\n        config: {\n          responseMimeType: \"application/json\",\n        },\n      });\n\n      const analysis = JSON.parse(response.text || \"{}\");\n      \n      const insights = await storage.createVideoInsights({\n        videoId: video.id,\n        playerId: video.playerId,\n        minutesPlayed: analysis.minutesPlayed || 0,\n        distanceCovered: analysis.distanceCovered,\n        sprintCount: analysis.sprintCount || 0,\n        passesAttempted: analysis.passesAttempted || 0,\n        passesCompleted: analysis.passesCompleted || 0,\n        shotsOnTarget: analysis.shotsOnTarget || 0,\n        tackles: analysis.tackles || 0,\n        interceptions: analysis.interceptions || 0,\n        duelsWon: analysis.duelsWon || 0,\n        aiAnalysis: analysis.summary,\n      });\n\n      res.json({ insights, analysis });\n    } catch (error: any) {\n      console.error(\"Video analysis error:\", error);\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  // Video Player Tags routes - for tagging multiple players to a video\n  app.get(\"/api/videos/:id/player-tags\", requireAuth, async (req, res) => {\n    try {\n      const tags = await storage.getVideoPlayerTags(req.params.id);\n      res.json(tags);\n    } catch (error: any) {\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  app.post(\"/api/videos/:id/player-tags\", requireAuth, async (req, res) => {\n    try {\n      const existingTags = await storage.getVideoPlayerTags(req.params.id);\n      if (existingTags.length >= MAX_PLAYERS_PER_VIDEO) {\n        return res.status(400).json({ \n          error: `Maximum ${MAX_PLAYERS_PER_VIDEO} players can be tagged per video` \n        });\n      }\n\n      const { playerId, minutesPlayed, position } = req.body;\n      \n      const alreadyTagged = existingTags.find(t => t.playerId === playerId);\n      if (alreadyTagged) {\n        return res.status(400).json({ error: \"This player is already tagged to this video\" });\n      }\n\n      const tag = await storage.createVideoPlayerTag({\n        videoId: req.params.id,\n        playerId,\n        minutesPlayed: minutesPlayed || 0,\n        position,\n      });\n      \n      if (playerId && minutesPlayed && minutesPlayed > 0) {\n        await updatePlayerStatsFromVideos(playerId);\n      }\n      \n      res.json(tag);\n    } catch (error: any) {\n      res.status(400).json({ error: error.message });\n    }\n  });\n\n  app.put(\"/api/video-player-tags/:id\", requireAuth, async (req, res) => {\n    try {\n      const existingTag = await storage.getVideoPlayerTag(req.params.id);\n      if (!existingTag) {\n        return res.status(404).json({ error: \"Tag not found\" });\n      }\n      \n      const tag = await storage.updateVideoPlayerTag(req.params.id, req.body);\n      \n      if (existingTag.playerId) {\n        await updatePlayerStatsFromVideos(existingTag.playerId);\n      }\n      \n      res.json(tag);\n    } catch (error: any) {\n      res.status(400).json({ error: error.message });\n    }\n  });\n\n  app.delete(\"/api/video-player-tags/:id\", requireAuth, async (req, res) => {\n    try {\n      await storage.deleteVideoPlayerTag(req.params.id);\n      res.json({ success: true });\n    } catch (error: any) {\n      res.status(400).json({ error: error.message });\n    }\n  });\n\n  // Analyze a specific tagged player in a video using positional metrics\n  app.post(\"/api/video-player-tags/:id/analyze\", requireAuth, async (req, res) => {\n    try {\n      const tag = await storage.getVideoPlayerTag(req.params.id);\n      if (!tag) {\n        return res.status(404).json({ error: \"Player tag not found\" });\n      }\n\n      const video = await storage.getVideo(tag.videoId);\n      if (!video) {\n        return res.status(404).json({ error: \"Video not found\" });\n      }\n\n      const player = await storage.getPlayer(tag.playerId);\n      if (!player) {\n        return res.status(404).json({ error: \"Player not found\" });\n      }\n\n      const position = tag.position || player.position || \"Unknown\";\n      \n      const positionalMetricsPrompt = getPositionalMetricsPrompt(position);\n      \n      const analysisPrompt = `Analyze this football match video for a specific player's performance based on their position.\n\nPlayer: ${player.firstName} ${player.lastName}\nPosition Played in This Match: ${position}\nMatch: ${video.title}\nCompetition: ${video.competition || \"Unknown\"}\nOpponent: ${video.opponent || \"Unknown\"}\nMinutes Played: ${tag.minutesPlayed || video.minutesPlayed || \"Full match\"}\n\n${positionalMetricsPrompt}\n\nProvide a comprehensive analysis in JSON format:\n{\n  \"performanceRating\": number (1-10),\n  \"goals\": number,\n  \"assists\": number,\n  \"passesCompleted\": number,\n  \"passesAttempted\": number,\n  \"tackles\": number,\n  \"interceptions\": number,\n  \"saves\": number (if goalkeeper),\n  \"shotsOnTarget\": number,\n  \"distanceCovered\": number (km),\n  \"sprintCount\": number,\n  \"duelsWon\": number,\n  \"duelsLost\": number,\n  \"positionalMetrics\": {\n    // Position-specific metrics based on role\n  },\n  \"keyMoments\": [\n    {\n      \"minute\": number,\n      \"type\": \"goal\" | \"assist\" | \"save\" | \"tackle\" | \"key_pass\" | \"chance_created\" | \"defensive_action\",\n      \"description\": \"brief description of the key moment\"\n    }\n  ],\n  \"summary\": \"detailed performance summary focusing on position-specific contributions\",\n  \"strengths\": [\"list of standout performances\"],\n  \"areasToImprove\": [\"list of areas needing improvement\"]\n}`;\n\n      const response = await gemini.models.generateContent({\n        model: \"gemini-2.5-flash\",\n        contents: analysisPrompt,\n        config: {\n          responseMimeType: \"application/json\",\n        },\n      });\n\n      const analysis = JSON.parse(response.text || \"{}\");\n      \n      const updatedTag = await storage.updateVideoPlayerTag(tag.id, {\n        performanceRating: analysis.performanceRating,\n        goals: analysis.goals || 0,\n        assists: analysis.assists || 0,\n        passesCompleted: analysis.passesCompleted || 0,\n        passesAttempted: analysis.passesAttempted || 0,\n        tackles: analysis.tackles || 0,\n        interceptions: analysis.interceptions || 0,\n        saves: analysis.saves || 0,\n        shotsOnTarget: analysis.shotsOnTarget || 0,\n        distanceCovered: analysis.distanceCovered,\n        sprintCount: analysis.sprintCount || 0,\n        duelsWon: analysis.duelsWon || 0,\n        duelsLost: analysis.duelsLost || 0,\n        aiAnalysis: analysis.summary,\n        positionalMetrics: analysis.positionalMetrics || {},\n        keyMoments: analysis.keyMoments || [],\n        strengths: analysis.strengths || [],\n        areasToImprove: analysis.areasToImprove || [],\n        analyzed: true,\n      });\n\n      res.json({ tag: updatedTag, analysis });\n    } catch (error: any) {\n      console.error(\"Player tag analysis error:\", error);\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  // Get total video minutes for a player\n  app.get(\"/api/players/:id/video-minutes\", requireAuth, async (req, res) => {\n    try {\n      const totalMinutes = await storage.getPlayerVideoMinutes(req.params.id);\n      res.json({ playerId: req.params.id, totalMinutes });\n    } catch (error: any) {\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  // Eligibility routes\n  app.get(\"/api/eligibility/:playerId\", requireAuth, async (req, res) => {\n    try {\n      const scores = await storage.getEligibilityScores(req.params.playerId);\n      res.json(scores);\n    } catch (error: any) {\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  app.post(\"/api/eligibility/:playerId/calculate\", requireAuth, async (req, res) => {\n    try {\n      const player = await storage.getPlayer(req.params.playerId);\n      if (!player) {\n        return res.status(404).json({ error: \"Player not found\" });\n      }\n\n      const metrics = await storage.getPlayerMetrics(player.id);\n      const latestMetrics = metrics[0];\n\n      const eligibilityPrompt = `Calculate visa eligibility scores for this football player across multiple visa types.\n\nPlayer Profile:\n- Name: ${player.firstName} ${player.lastName}\n- Nationality: ${player.nationality}\n- Position: ${player.position}\n- National Team Caps: ${player.nationalTeamCaps || 0}\n- International Caps: ${player.internationalCaps || 0}\n- Continental Games: ${player.continentalGames || 0}\n- Current Season Minutes: ${latestMetrics?.currentSeasonMinutes || 0}\n- Total Career Minutes: ${latestMetrics?.totalCareerMinutes || 0}\n- Games Played: ${latestMetrics?.gamesPlayed || 0}\n- Goals: ${latestMetrics?.goals || 0}\n- Assists: ${latestMetrics?.assists || 0}\n- Club League Position: ${latestMetrics?.clubLeaguePosition || \"Unknown\"}\n\nCalculate eligibility scores (0-100) for each visa type with detailed breakdown:\n\n1. SCHENGEN_SPORTS - Schengen Sports Visa (EU)\n   Criteria: Professional contract, match invitations, sports federation endorsement\n\n2. UK_GBE - UK Governing Body Endorsement\n   Criteria: Points system based on international appearances, league band, club continental participation\n\n3. US_P1 - US P-1 Athlete Visa\n   Criteria: International recognition, sustained national/international acclaim\n\n4. US_O1 - US O-1 Extraordinary Ability\n   Criteria: Extraordinary ability in athletics, awards, high salary, critical role\n\n5. FIFA_TRANSFER - FIFA Transfer Rules\n   Criteria: Valid registration, training compensation, solidarity mechanism compliance\n\n6. MIDDLE_EAST - Middle East Sports Visa (UAE/Saudi)\n   Criteria: Professional contract, club sponsorship, sports council approval\n\n7. ASIA_SPORTS - Asia Sports Visa\n   Criteria: Work permit, club contract, federation registration\n\nRespond in JSON format:\n{\n  \"scores\": [\n    {\n      \"visaType\": \"schengen_sports\",\n      \"score\": number,\n      \"status\": \"green\" | \"yellow\" | \"red\",\n      \"breakdown\": [\n        {\"criteria\": \"string\", \"points\": number, \"maxPoints\": number, \"description\": \"string\"}\n      ],\n      \"recommendation\": \"string\"\n    }\n  ]\n}`;\n\n      const response = await gemini.models.generateContent({\n        model: \"gemini-2.5-flash\",\n        contents: eligibilityPrompt,\n        config: {\n          responseMimeType: \"application/json\",\n        },\n      });\n\n      const result = JSON.parse(response.text || \"{}\");\n      \n      const savedScores = [];\n      for (const scoreData of result.scores || []) {\n        const saved = await storage.createEligibilityScore({\n          playerId: player.id,\n          visaType: scoreData.visaType,\n          score: scoreData.score,\n          status: scoreData.status,\n          breakdown: scoreData.breakdown,\n          leagueBandApplied: 3,\n        });\n        savedScores.push({ ...saved, recommendation: scoreData.recommendation });\n      }\n\n      res.json({ eligibilityScores: savedScores });\n    } catch (error: any) {\n      console.error(\"Eligibility calculation error:\", error);\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  // Compliance orders routes\n  app.get(\"/api/compliance/orders\", requireAuth, async (req, res) => {\n    try {\n      const orders = await storage.getComplianceOrders(req.session.teamId!);\n      res.json(orders);\n    } catch (error: any) {\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  app.post(\"/api/compliance/orders\", requireAuth, async (req, res) => {\n    try {\n      const orderData = insertComplianceOrderSchema.parse({\n        ...req.body,\n        teamId: req.session.teamId,\n        requestedBy: req.session.userId,\n        amount: 49.99,\n        status: \"pending_payment\",\n      });\n      const order = await storage.createComplianceOrder(orderData);\n      res.json(order);\n    } catch (error: any) {\n      res.status(400).json({ error: error.message });\n    }\n  });\n\n  app.post(\"/api/compliance/orders/:id/pay\", requireAuth, async (req, res) => {\n    try {\n      const order = await storage.getComplianceOrder(req.params.id);\n      if (!order) {\n        return res.status(404).json({ error: \"Order not found\" });\n      }\n\n      // Simulate payment (in production, use Stripe)\n      const payment = await storage.createPayment({\n        orderId: order.id,\n        amount: order.amount,\n        currency: order.currency || \"USD\",\n        status: \"succeeded\",\n      });\n\n      await storage.updateComplianceOrder(order.id, {\n        status: \"paid\",\n        paidAt: new Date(),\n      } as any);\n\n      res.json({ success: true, payment });\n    } catch (error: any) {\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  app.post(\"/api/compliance/orders/:id/generate\", requireAuth, async (req, res) => {\n    try {\n      const order = await storage.getComplianceOrder(req.params.id);\n      if (!order) {\n        return res.status(404).json({ error: \"Order not found\" });\n      }\n\n      if (order.status !== \"paid\") {\n        return res.status(400).json({ error: \"Order must be paid before generating document\" });\n      }\n\n      const player = await storage.getPlayer(order.playerId);\n      if (!player) {\n        return res.status(404).json({ error: \"Player not found\" });\n      }\n\n      const metrics = await storage.getPlayerMetrics(player.id);\n      const eligibilityScores = await storage.getEligibilityScores(player.id);\n      const medicalRecords = await storage.getMedicalRecords(player.id);\n      const biometricData = await storage.getBiometricData(player.id);\n      const latestMetrics = metrics[0];\n\n      const documentPrompt = `Generate a comprehensive compliance document summary for embassy submission.\n\nPlayer: ${player.firstName} ${player.lastName}\nNationality: ${player.nationality}\nPosition: ${player.position}\nDate of Birth: ${player.dateOfBirth || \"Not provided\"}\nHeight: ${player.height ? player.height + \"cm\" : \"Not provided\"}\nWeight: ${player.weight ? player.weight + \"kg\" : \"Not provided\"}\n\nPerformance Data:\n- Current Season Minutes: ${latestMetrics?.currentSeasonMinutes || 0}\n- Total Career Minutes: ${latestMetrics?.totalCareerMinutes || 0}\n- Games Played: ${latestMetrics?.gamesPlayed || 0}\n- Goals: ${latestMetrics?.goals || 0}\n- Assists: ${latestMetrics?.assists || 0}\n- National Team Caps: ${player.nationalTeamCaps || 0}\n- International Caps: ${player.internationalCaps || 0}\n- Continental Games: ${player.continentalGames || 0}\n- Club League Position: ${latestMetrics?.clubLeaguePosition || \"Unknown\"}\n\nMedical Data Available: ${medicalRecords.length > 0 ? \"Yes\" : \"No\"}\nBiometric Data Available: ${biometricData.length > 0 ? \"Yes\" : \"No\"}\n\nTarget Visa: ${order.visaType}\nTarget Country: ${order.targetCountry || \"Not specified\"}\n\nGenerate a professional summary suitable for embassy submission that highlights:\n1. Player's professional status and achievements\n2. Performance statistics and playing time\n3. International representation\n4. Physical and medical fitness (if available)\n5. Recommendation for visa eligibility\n\nProvide the summary as a formal document text.`;\n\n      const response = await gemini.models.generateContent({\n        model: \"gemini-2.5-flash\",\n        contents: documentPrompt,\n      });\n\n      const aiSummary = response.text || \"\";\n\n      const document = await storage.createComplianceDocument({\n        orderId: order.id,\n        playerId: player.id,\n        documentType: \"pre_transfer_verification\",\n        generatedBy: req.session.userId,\n        dataRangeStart: new Date(Date.now() - 365 * 24 * 60 * 60 * 1000).toISOString(),\n        dataRangeEnd: new Date().toISOString(),\n        aiSummary,\n        playerProfile: {\n          fullName: `${player.firstName} ${player.lastName}`,\n          nationality: player.nationality,\n          dateOfBirth: player.dateOfBirth,\n          position: player.position,\n          currentClub: player.currentClubId,\n          height: player.height,\n          weight: player.weight,\n        },\n        physicalData: biometricData[0] || {},\n        performanceStats: latestMetrics || {},\n        eligibilityData: eligibilityScores,\n        status: \"completed\",\n      });\n\n      await storage.updateComplianceOrder(order.id, { status: \"completed\" } as any);\n\n      res.json({ document, aiSummary });\n    } catch (error: any) {\n      console.error(\"Document generation error:\", error);\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  // Embassy verifications routes\n  app.get(\"/api/embassy/verifications\", requireAuth, async (req, res) => {\n    try {\n      const verifications = await storage.getEmbassyVerifications();\n      res.json(verifications);\n    } catch (error: any) {\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  // Scouting inquiries routes\n  app.get(\"/api/scouting/inquiries\", requireAuth, async (req, res) => {\n    try {\n      const inquiries = await storage.getScoutingInquiries();\n      res.json(inquiries);\n    } catch (error: any) {\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  app.post(\"/api/scouting/inquiries\", requireAuth, async (req, res) => {\n    try {\n      const { playerId, buyingClubName, sellingClubName, message } = req.body;\n      const inquiry = await storage.createScoutingInquiry({\n        playerId,\n        buyingClubName,\n        sellingClubName,\n        message,\n        status: \"inquiry\",\n      });\n\n      await storage.logAction({\n        userId: req.session.userId,\n        userRole: req.session.userRole,\n        action: \"create_scouting_inquiry\",\n        entityType: \"scouting_inquiry\",\n        entityId: inquiry.id,\n        details: { playerId, buyingClubName },\n      });\n\n      res.json(inquiry);\n    } catch (error: any) {\n      res.status(400).json({ error: error.message });\n    }\n  });\n\n  // Embassy verification submission\n  app.post(\"/api/embassy/verifications\", requireAuth, async (req, res) => {\n    try {\n      const { documentId, playerId, embassyCountry, verificationCode } = req.body;\n      \n      const verification = await storage.createEmbassyVerification({\n        documentId,\n        playerId,\n        embassyCountry,\n        verificationCode,\n        status: \"pending\",\n      });\n\n      await storage.logAction({\n        userId: req.session.userId,\n        userRole: req.session.userRole,\n        action: \"submit_for_verification\",\n        entityType: \"embassy_verification\",\n        entityId: verification.id,\n        details: { documentId, embassyCountry },\n      });\n\n      res.json(verification);\n    } catch (error: any) {\n      res.status(400).json({ error: error.message });\n    }\n  });\n\n  app.put(\"/api/embassy/verifications/:id\", requireEmbassyRole, async (req, res) => {\n    try {\n      const { status, notes } = req.body;\n      const verification = await storage.updateEmbassyVerification(req.params.id, {\n        status,\n        notes,\n        verifiedAt: status === \"verified\" ? new Date() : undefined,\n      } as any);\n\n      if (!verification) {\n        return res.status(404).json({ error: \"Verification not found\" });\n      }\n\n      await storage.logAction({\n        userId: req.session.userId,\n        userRole: \"embassy\",\n        action: \"update_verification\",\n        entityType: \"embassy_verification\",\n        entityId: verification.id,\n        details: { status, notes },\n      });\n\n      res.json(verification);\n    } catch (error: any) {\n      res.status(400).json({ error: error.message });\n    }\n  });\n\n  // Dashboard stats\n  app.get(\"/api/dashboard/stats\", requireAuth, async (req, res) => {\n    try {\n      const players = await storage.getPlayers();\n      const verifications = await storage.getEmbassyVerifications();\n      const inquiries = await storage.getScoutingInquiries();\n      \n      let greenCount = 0, yellowCount = 0, redCount = 0;\n      \n      for (const player of players) {\n        const scores = await storage.getEligibilityScores(player.id);\n        if (scores.length > 0) {\n          const avgScore = scores.reduce((sum, s) => sum + s.score, 0) / scores.length;\n          if (avgScore >= 60) greenCount++;\n          else if (avgScore >= 35) yellowCount++;\n          else redCount++;\n        }\n      }\n\n      res.json({\n        totalPlayers: players.length,\n        greenStatus: greenCount,\n        yellowStatus: yellowCount,\n        redStatus: redCount,\n        pendingVerifications: verifications.filter(v => v.status === \"pending\").length,\n        activeInquiries: inquiries.filter(i => i.status !== \"closed\").length,\n        reportsGenerated: 0,\n      });\n    } catch (error: any) {\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  // Messaging routes\n  app.get(\"/api/conversations\", requireAuth, async (req, res) => {\n    try {\n      const conversations = await storage.getConversations(req.session.userId!);\n      res.json(conversations);\n    } catch (error: any) {\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  app.post(\"/api/conversations\", requireAuth, async (req, res) => {\n    try {\n      const { title, playerId, type } = req.body;\n      const conversation = await storage.createConversation({\n        title,\n        playerId,\n        type: type || \"general\",\n        status: \"active\",\n      });\n      \n      await storage.addConversationParticipant({\n        conversationId: conversation.id,\n        userId: req.session.userId!,\n        role: req.session.userRole || \"unknown\",\n      });\n\n      await storage.logAction({\n        userId: req.session.userId,\n        userRole: req.session.userRole,\n        action: \"create_conversation\",\n        entityType: \"conversation\",\n        entityId: conversation.id,\n        details: { title, playerId, type },\n      });\n\n      res.json(conversation);\n    } catch (error: any) {\n      res.status(400).json({ error: error.message });\n    }\n  });\n\n  app.get(\"/api/conversations/:id\", requireAuth, async (req, res) => {\n    try {\n      const conversation = await storage.getConversation(req.params.id);\n      if (!conversation) {\n        return res.status(404).json({ error: \"Conversation not found\" });\n      }\n      const participants = await storage.getConversationParticipants(conversation.id);\n      const messages = await storage.getMessages(conversation.id);\n      res.json({ conversation, participants, messages });\n    } catch (error: any) {\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  app.post(\"/api/conversations/:id/messages\", requireAuth, async (req, res) => {\n    try {\n      const { content, attachmentUrl, attachmentType } = req.body;\n      const userId = req.session.userId!;\n      const userRole = req.session.userRole || \"unknown\";\n      \n      if (userRole !== \"scout\") {\n        const conversation = await storage.getConversation(req.params.id);\n        if (conversation && conversation.type === \"scouting\") {\n          const tokenResult = await spendTokensForAction(userId, userRole, \"scouting_messaging\");\n          if (!tokenResult.success) {\n            return res.status(402).json({ error: tokenResult.error, needsTokens: true });\n          }\n        }\n      }\n      \n      const message = await storage.createMessage({\n        conversationId: req.params.id,\n        senderId: userId,\n        senderRole: userRole,\n        content,\n        attachmentUrl,\n        attachmentType,\n      });\n      res.json(message);\n    } catch (error: any) {\n      res.status(400).json({ error: error.message });\n    }\n  });\n\n  app.post(\"/api/conversations/:id/invite\", requireAuth, async (req, res) => {\n    try {\n      const { userId, role } = req.body;\n      const participant = await storage.addConversationParticipant({\n        conversationId: req.params.id,\n        userId,\n        role,\n      });\n      res.json(participant);\n    } catch (error: any) {\n      res.status(400).json({ error: error.message });\n    }\n  });\n\n  // Invitation letter routes\n  app.get(\"/api/invitation-letters/:playerId\", requireAuth, async (req, res) => {\n    try {\n      const letters = await storage.getInvitationLetters(req.params.playerId);\n      res.json(letters);\n    } catch (error: any) {\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  app.post(\"/api/invitation-letters\", requireAuth, async (req, res) => {\n    try {\n      const { playerId, targetClubName, targetLeague, targetLeagueBand, targetCountry, scoutAgentName, scoutAgentId, fileUrl } = req.body;\n      \n      const letter = await storage.createInvitationLetter({\n        playerId,\n        fromTeamId: req.session.teamId || \"\",\n        targetClubName,\n        targetLeague,\n        targetLeagueBand,\n        targetCountry,\n        scoutAgentName,\n        scoutAgentId,\n        fileUrl,\n        uploadedBy: req.session.userId,\n        status: \"pending\",\n      });\n\n      await storage.logAction({\n        userId: req.session.userId,\n        userRole: req.session.userRole,\n        action: \"upload_invitation_letter\",\n        entityType: \"invitation_letter\",\n        entityId: letter.id,\n        details: { playerId, targetClubName, targetCountry },\n      });\n\n      res.json(letter);\n    } catch (error: any) {\n      res.status(400).json({ error: error.message });\n    }\n  });\n\n  app.get(\"/api/invitation-letters\", requireAuth, async (req, res) => {\n    try {\n      const letters = await storage.getAllInvitationLetters(req.session.teamId);\n      const lettersWithPlayers = await Promise.all(\n        letters.map(async (letter) => {\n          const player = await storage.getPlayer(letter.playerId);\n          return { ...letter, player };\n        })\n      );\n      res.json(lettersWithPlayers);\n    } catch (error: any) {\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  app.get(\"/api/invitation-letters/single/:id\", requireAuth, async (req, res) => {\n    try {\n      const letter = await storage.getInvitationLetter(req.params.id);\n      if (!letter) {\n        return res.status(404).json({ error: \"Invitation letter not found\" });\n      }\n      const player = await storage.getPlayer(letter.playerId);\n      res.json({ ...letter, player });\n    } catch (error: any) {\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  app.patch(\"/api/invitation-letters/:id\", requireAuth, async (req, res) => {\n    try {\n      const letter = await storage.updateInvitationLetter(req.params.id, req.body);\n      if (!letter) {\n        return res.status(404).json({ error: \"Invitation letter not found\" });\n      }\n      res.json(letter);\n    } catch (error: any) {\n      res.status(400).json({ error: error.message });\n    }\n  });\n\n  app.delete(\"/api/invitation-letters/:id\", requireAuth, async (req, res) => {\n    try {\n      await storage.deleteInvitationLetter(req.params.id);\n      res.json({ success: true });\n    } catch (error: any) {\n      res.status(400).json({ error: error.message });\n    }\n  });\n\n  app.post(\"/api/invitation-letters/:id/generate-consular-report\", requireAuth, async (req, res) => {\n    try {\n      const letter = await storage.getInvitationLetter(req.params.id);\n      if (!letter) {\n        return res.status(404).json({ error: \"Invitation letter not found\" });\n      }\n\n      const player = await storage.getPlayer(letter.playerId);\n      if (!player) {\n        return res.status(404).json({ error: \"Player not found\" });\n      }\n\n      const eligibilityScores = await storage.getEligibilityScores(letter.playerId);\n      const playerVideos = await storage.getVideos(letter.playerId);\n      const metrics = await storage.getPlayerMetrics(letter.playerId);\n      \n      const verificationCode = `VR-${Date.now().toString(36).toUpperCase()}-${Math.random().toString(36).substring(2, 8).toUpperCase()}`;\n      \n      const videoQrCodes = playerVideos.slice(0, 5).map(video => ({\n        videoId: video.id,\n        title: video.title,\n        qrUrl: `/api/verify/video/${video.id}?code=${verificationCode}`,\n        competition: video.competition,\n        matchDate: video.matchDate,\n      }));\n\n      const consularReport = await storage.createConsularReport({\n        invitationLetterId: letter.id,\n        playerId: letter.playerId,\n        playerProfile: {\n          firstName: player.firstName,\n          lastName: player.lastName,\n          nationality: player.nationality,\n          dateOfBirth: player.dateOfBirth,\n          position: player.position,\n          currentClub: player.currentClubName,\n          nationalTeamCaps: player.nationalTeamCaps,\n          internationalCaps: player.internationalCaps,\n        },\n        playerStats: metrics.length > 0 ? {\n          gamesPlayed: metrics[0].gamesPlayed,\n          goals: metrics[0].goals,\n          assists: metrics[0].assists,\n          currentSeasonMinutes: metrics[0].currentSeasonMinutes,\n        } : null,\n        eligibilityScores: eligibilityScores.map(score => ({\n          visaType: score.visaType,\n          score: score.score,\n          status: score.status,\n          leagueBandApplied: score.leagueBandApplied,\n        })),\n        videoQrCodes,\n        proofOfPlaySummary: `${player.firstName} ${player.lastName} has ${playerVideos.length} verified match videos demonstrating professional-level performance.`,\n        targetClubDetails: {\n          clubName: letter.targetClubName,\n          clubAddress: letter.targetClubAddress,\n          league: letter.targetLeague,\n          leagueBand: letter.targetLeagueBand,\n          country: letter.targetCountry,\n        },\n        verificationCode,\n        validUntil: new Date(Date.now() + 90 * 24 * 60 * 60 * 1000),\n      });\n\n      await storage.updateInvitationLetter(letter.id, {\n        consularReportGenerated: true,\n        consularReportUrl: `/api/consular-reports/${consularReport.id}`,\n        qrCodeData: verificationCode,\n        embassyAccessible: true,\n      });\n\n      await storage.logAction({\n        userId: req.session.userId,\n        userRole: req.session.userRole,\n        action: \"generate_consular_report\",\n        entityType: \"consular_report\",\n        entityId: consularReport.id,\n        details: { playerId: letter.playerId, verificationCode },\n      });\n\n      res.json(consularReport);\n    } catch (error: any) {\n      res.status(400).json({ error: error.message });\n    }\n  });\n\n  app.get(\"/api/consular-reports/:id\", requireAuth, async (req, res) => {\n    try {\n      const report = await storage.getConsularReport(req.params.id);\n      if (!report) {\n        return res.status(404).json({ error: \"Consular report not found\" });\n      }\n      res.json(report);\n    } catch (error: any) {\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  app.get(\"/api/consular-reports/player/:playerId\", requireAuth, async (req, res) => {\n    try {\n      const reports = await storage.getConsularReports(req.params.playerId);\n      res.json(reports);\n    } catch (error: any) {\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  app.get(\"/api/verify/consular-report/:code\", async (req, res) => {\n    try {\n      const report = await storage.getConsularReportByVerificationCode(req.params.code);\n      if (!report) {\n        return res.status(404).json({ error: \"Invalid verification code\", valid: false });\n      }\n      \n      if (report.validUntil && new Date(report.validUntil) < new Date()) {\n        return res.json({ valid: false, error: \"Report has expired\" });\n      }\n\n      await storage.updateConsularReport(report.id, {\n        accessedByEmbassy: true,\n        embassyAccessLogs: [\n          ...(Array.isArray(report.embassyAccessLogs) ? report.embassyAccessLogs : []),\n          { accessedAt: new Date().toISOString(), ip: req.ip }\n        ],\n      });\n\n      res.json({ \n        valid: true, \n        playerProfile: report.playerProfile,\n        eligibilityScores: report.eligibilityScores,\n        targetClubDetails: report.targetClubDetails,\n        proofOfPlaySummary: report.proofOfPlaySummary,\n        generatedAt: report.generatedAt,\n        validUntil: report.validUntil,\n      });\n    } catch (error: any) {\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  // Transfer Eligibility Assessment - Calculate and return multi-visa eligibility scoring\n  app.get(\"/api/players/:id/transfer-eligibility\", requireTeamRole, async (req, res) => {\n    try {\n      const playerId = req.params.id;\n      const player = await storage.getPlayer(playerId);\n      if (!player) {\n        return res.status(404).json({ error: \"Player not found\" });\n      }\n\n      const { calculateTransferEligibility } = await import(\"./eligibilityScoring\");\n\n      const metrics = await storage.getPlayerMetrics(playerId);\n      const videos = await storage.getVideos(playerId);\n      const internationalRecords = await storage.getPlayerInternationalRecords(playerId);\n      const invitationLetters = await storage.getInvitationLetters(playerId);\n      \n      const videoInsightsPromises = videos.map(v => storage.getVideoInsights(v.id));\n      const videoInsightsResults = await Promise.all(videoInsightsPromises);\n      const videoInsights = videoInsightsResults.filter((i): i is NonNullable<typeof i> => i !== undefined);\n\n      const latestInvitation = invitationLetters[0];\n      const leagueBand = latestInvitation?.targetLeagueBand || 3;\n\n      const eligibilityResult = calculateTransferEligibility({\n        player,\n        metrics,\n        videos,\n        videoInsights,\n        internationalRecords,\n        invitationLetters,\n        leagueBand,\n      });\n\n      const existingAssessment = await storage.getTransferEligibilityAssessment(playerId);\n      \n      const assessmentData = {\n        playerId,\n        totalMinutesVerified: eligibilityResult.totalMinutesVerified,\n        clubMinutes: eligibilityResult.clubMinutes,\n        internationalMinutes: eligibilityResult.internationalMinutes,\n        videoMinutes: eligibilityResult.videoMinutes,\n        totalCaps: eligibilityResult.totalCaps,\n        seniorCaps: eligibilityResult.seniorCaps,\n        continentalAppearances: eligibilityResult.continentalAppearances,\n        overallStatus: eligibilityResult.overallStatus,\n        schengenScore: eligibilityResult.schengen.score,\n        schengenStatus: eligibilityResult.schengen.status,\n        o1Score: eligibilityResult.o1.score,\n        o1Status: eligibilityResult.o1.status,\n        p1Score: eligibilityResult.p1.score,\n        p1Status: eligibilityResult.p1.status,\n        ukGbeScore: eligibilityResult.ukGbe.score,\n        ukGbeStatus: eligibilityResult.ukGbe.status,\n        escScore: eligibilityResult.esc.score,\n        escStatus: eligibilityResult.esc.status,\n        escEligible: eligibilityResult.escEligible,\n        minutesNeeded: eligibilityResult.minutesNeeded,\n        capsNeeded: eligibilityResult.capsNeeded,\n        recommendations: eligibilityResult.recommendations,\n        visaBreakdown: {\n          schengen: eligibilityResult.schengen,\n          o1: eligibilityResult.o1,\n          p1: eligibilityResult.p1,\n          ukGbe: eligibilityResult.ukGbe,\n          esc: eligibilityResult.esc,\n        },\n        validUntil: new Date(Date.now() + 30 * 24 * 60 * 60 * 1000),\n      };\n\n      let assessment;\n      if (existingAssessment) {\n        assessment = await storage.updateTransferEligibilityAssessment(existingAssessment.id, assessmentData);\n      } else {\n        assessment = await storage.createTransferEligibilityAssessment(assessmentData);\n      }\n\n      res.json({\n        assessment,\n        player: {\n          id: player.id,\n          name: `${player.firstName} ${player.lastName}`,\n          position: player.position,\n          nationality: player.nationality,\n          currentClub: player.currentClubName,\n          marketValue: player.marketValue,\n        },\n        minutesBreakdown: {\n          club: eligibilityResult.clubMinutes,\n          international: eligibilityResult.internationalMinutes,\n          video: eligibilityResult.videoMinutes,\n          total: eligibilityResult.totalMinutesVerified,\n          minimum: 800,\n          needed: eligibilityResult.minutesNeeded,\n        },\n        visaScores: {\n          schengen: eligibilityResult.schengen,\n          o1: eligibilityResult.o1,\n          p1: eligibilityResult.p1,\n          ukGbe: eligibilityResult.ukGbe,\n          esc: eligibilityResult.esc,\n        },\n        overallStatus: eligibilityResult.overallStatus,\n        recommendations: eligibilityResult.recommendations,\n        capsNeeded: eligibilityResult.capsNeeded,\n        leagueBandApplied: leagueBand,\n      });\n    } catch (error: any) {\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  // Recalculate Transfer Eligibility Assessment\n  app.post(\"/api/players/:id/transfer-eligibility/recalculate\", requireTeamRole, async (req, res) => {\n    try {\n      const playerId = req.params.id;\n      const { leagueBand: overrideLeagueBand } = req.body;\n      \n      const player = await storage.getPlayer(playerId);\n      if (!player) {\n        return res.status(404).json({ error: \"Player not found\" });\n      }\n\n      const { calculateTransferEligibility } = await import(\"./eligibilityScoring\");\n\n      const metrics = await storage.getPlayerMetrics(playerId);\n      const videos = await storage.getVideos(playerId);\n      const internationalRecords = await storage.getPlayerInternationalRecords(playerId);\n      const invitationLetters = await storage.getInvitationLetters(playerId);\n      \n      const videoInsightsPromises = videos.map(v => storage.getVideoInsights(v.id));\n      const videoInsightsResults = await Promise.all(videoInsightsPromises);\n      const videoInsights = videoInsightsResults.filter((i): i is NonNullable<typeof i> => i !== undefined);\n\n      const latestInvitation = invitationLetters[0];\n      const leagueBand = overrideLeagueBand || latestInvitation?.targetLeagueBand || 3;\n\n      const eligibilityResult = calculateTransferEligibility({\n        player,\n        metrics,\n        videos,\n        videoInsights,\n        internationalRecords,\n        invitationLetters,\n        leagueBand,\n      });\n\n      const existingAssessment = await storage.getTransferEligibilityAssessment(playerId);\n      \n      const assessmentData = {\n        playerId,\n        totalMinutesVerified: eligibilityResult.totalMinutesVerified,\n        clubMinutes: eligibilityResult.clubMinutes,\n        internationalMinutes: eligibilityResult.internationalMinutes,\n        videoMinutes: eligibilityResult.videoMinutes,\n        totalCaps: eligibilityResult.totalCaps,\n        seniorCaps: eligibilityResult.seniorCaps,\n        continentalAppearances: eligibilityResult.continentalAppearances,\n        overallStatus: eligibilityResult.overallStatus,\n        schengenScore: eligibilityResult.schengen.score,\n        schengenStatus: eligibilityResult.schengen.status,\n        o1Score: eligibilityResult.o1.score,\n        o1Status: eligibilityResult.o1.status,\n        p1Score: eligibilityResult.p1.score,\n        p1Status: eligibilityResult.p1.status,\n        ukGbeScore: eligibilityResult.ukGbe.score,\n        ukGbeStatus: eligibilityResult.ukGbe.status,\n        escScore: eligibilityResult.esc.score,\n        escStatus: eligibilityResult.esc.status,\n        escEligible: eligibilityResult.escEligible,\n        minutesNeeded: eligibilityResult.minutesNeeded,\n        capsNeeded: eligibilityResult.capsNeeded,\n        recommendations: eligibilityResult.recommendations,\n        visaBreakdown: {\n          schengen: eligibilityResult.schengen,\n          o1: eligibilityResult.o1,\n          p1: eligibilityResult.p1,\n          ukGbe: eligibilityResult.ukGbe,\n          esc: eligibilityResult.esc,\n        },\n        validUntil: new Date(Date.now() + 30 * 24 * 60 * 60 * 1000),\n      };\n\n      let assessment;\n      if (existingAssessment) {\n        assessment = await storage.updateTransferEligibilityAssessment(existingAssessment.id, assessmentData);\n      } else {\n        assessment = await storage.createTransferEligibilityAssessment(assessmentData);\n      }\n\n      res.json({\n        success: true,\n        assessment,\n        overallStatus: eligibilityResult.overallStatus,\n        recommendations: eligibilityResult.recommendations,\n      });\n    } catch (error: any) {\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  // Transfer Reports - Generate comprehensive downloadable reports\n  app.get(\"/api/reports\", requireTeamRole, async (req, res) => {\n    try {\n      const teamId = req.session.teamId || \"demo-team\";\n      const reports = await storage.getTransferReports(teamId);\n      \n      const enrichedReports = await Promise.all(reports.map(async (report) => {\n        const player = await storage.getPlayer(report.playerId);\n        return {\n          ...report,\n          playerName: player ? `${player.firstName} ${player.lastName}` : \"Unknown\",\n          playerPosition: player?.position || \"Unknown\",\n        };\n      }));\n      \n      res.json(enrichedReports);\n    } catch (error: any) {\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  app.get(\"/api/reports/:id\", requireTeamRole, async (req, res) => {\n    try {\n      const report = await storage.getTransferReport(req.params.id);\n      if (!report) {\n        return res.status(404).json({ error: \"Report not found\" });\n      }\n      \n      const player = await storage.getPlayer(report.playerId);\n      res.json({\n        ...report,\n        playerName: player ? `${player.firstName} ${player.lastName}` : \"Unknown\",\n      });\n    } catch (error: any) {\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  app.post(\"/api/reports/generate\", requireTeamRole, async (req, res) => {\n    try {\n      const { playerId, reportType = \"comprehensive\" } = req.body;\n      \n      if (!playerId) {\n        return res.status(400).json({ error: \"Player ID is required\" });\n      }\n      \n      const player = await storage.getPlayer(playerId);\n      if (!player) {\n        return res.status(404).json({ error: \"Player not found\" });\n      }\n      \n      const teamId = req.session.teamId || \"demo-team\";\n      const userId = req.session.userId!;\n      const userRole = req.session.userRole || \"sporting_director\";\n      const userName = req.session.userId || \"System\";\n      \n      const tokenResult = await spendTokensForAction(userId, userRole, \"transfer_report\", playerId);\n      if (!tokenResult.success) {\n        return res.status(402).json({ error: tokenResult.error, needsTokens: true });\n      }\n      \n      const sixMonthsAgo = new Date();\n      sixMonthsAgo.setMonth(sixMonthsAgo.getMonth() - 6);\n      \n      const metrics = await storage.getPlayerMetrics(playerId);\n      const eligibilityScores = await storage.getEligibilityScores(playerId);\n      const transferAssessment = await storage.getTransferEligibilityAssessment(playerId);\n      const videos = await storage.getVideos(playerId);\n      const invitationLettersData = await storage.getInvitationLetters(playerId);\n      const consularReportsData = await storage.getConsularReports(playerId);\n      const internationalRecords = await storage.getPlayerInternationalRecords(playerId);\n      const embassyVerifications = await storage.getEmbassyVerifications();\n      const playerVerifications = embassyVerifications.filter(v => v.playerId === playerId);\n      \n      const recentVideos = videos.filter(v => {\n        if (!v.uploadDate) return true;\n        return new Date(v.uploadDate) >= sixMonthsAgo;\n      });\n      \n      const verificationCode = `TR-${Date.now().toString(36).toUpperCase()}-${playerId.substring(0, 4).toUpperCase()}`;\n      \n      const playerProfile = {\n        id: player.id,\n        name: `${player.firstName} ${player.lastName}`,\n        dateOfBirth: player.dateOfBirth,\n        age: player.dateOfBirth ? Math.floor((Date.now() - new Date(player.dateOfBirth).getTime()) / (365.25 * 24 * 60 * 60 * 1000)) : null,\n        nationality: player.nationality,\n        secondNationality: player.secondNationality,\n        position: player.position,\n        secondaryPosition: player.secondaryPosition,\n        jerseyNumber: player.jerseyNumber,\n        height: player.height,\n        heightUnit: player.heightUnit,\n        weight: player.weight,\n        weightUnit: player.weightUnit,\n        preferredFoot: player.preferredFoot,\n        currentClub: player.currentClubName,\n        marketValue: player.marketValue,\n        agentName: player.agentName,\n        agentContact: player.agentContact,\n        nationalTeamCaps: player.nationalTeamCaps,\n        nationalTeamGoals: player.nationalTeamGoals,\n      };\n      \n      const internationalCareer = internationalRecords.map(r => ({\n        nationalTeam: r.nationalTeam,\n        teamLevel: r.teamLevel,\n        caps: r.caps,\n        goals: r.goals,\n        assists: r.assists,\n        debutDate: r.debutDate,\n        lastAppearance: r.lastAppearance,\n      }));\n      \n      const performanceStats = metrics.map(m => ({\n        season: m.season,\n        gamesPlayed: m.gamesPlayed,\n        goals: m.goals,\n        assists: m.assists,\n        minutesPlayed: m.currentSeasonMinutes,\n        passAccuracy: m.passAccuracy,\n        tacklesWon: m.tacklesWon,\n        aerialDuelsWon: m.aerialDuelsWon,\n      }));\n      \n      const eligibilityData = transferAssessment ? {\n        overallStatus: transferAssessment.overallStatus,\n        totalMinutes: transferAssessment.totalMinutesVerified,\n        minutesNeeded: transferAssessment.minutesNeeded,\n        capsNeeded: transferAssessment.capsNeeded,\n        visaScores: {\n          schengen: { score: transferAssessment.schengenScore, status: transferAssessment.schengenStatus },\n          o1: { score: transferAssessment.o1Score, status: transferAssessment.o1Status },\n          p1: { score: transferAssessment.p1Score, status: transferAssessment.p1Status },\n          ukGbe: { score: transferAssessment.ukGbeScore, status: transferAssessment.ukGbeStatus },\n          esc: { score: transferAssessment.escScore, status: transferAssessment.escStatus },\n        },\n        recommendations: transferAssessment.recommendations,\n      } : null;\n      \n      const videosIncluded = recentVideos.map(v => ({\n        id: v.id,\n        title: v.title,\n        source: v.source,\n        matchDate: v.matchDate,\n        competition: v.competition,\n        opponent: v.opponent,\n        minutesPlayed: v.minutesPlayed,\n        uploadDate: v.uploadDate,\n      }));\n      \n      const documentsIncluded = consularReportsData.map(r => ({\n        id: r.id,\n        verificationCode: r.verificationCode,\n        generatedAt: r.generatedAt,\n        validUntil: r.validUntil,\n        accessedByEmbassy: r.accessedByEmbassy,\n      }));\n      \n      const invitationLettersIncluded = invitationLettersData.map(l => ({\n        id: l.id,\n        targetClubName: l.targetClubName,\n        targetCountry: l.targetCountry,\n        targetLeague: l.targetLeague,\n        targetLeagueBand: l.targetLeagueBand,\n        offerType: l.offerType,\n        status: l.status,\n        trialStartDate: l.trialStartDate,\n        trialEndDate: l.trialEndDate,\n      }));\n      \n      const verificationsIncluded = playerVerifications.map(v => ({\n        id: v.id,\n        embassyCountry: v.embassyCountry,\n        status: v.status,\n        verificationCode: v.verificationCode,\n        submittedAt: v.submittedAt,\n        verifiedAt: v.verifiedAt,\n      }));\n      \n      const totalMinutesVerified = (player.clubMinutesCurrentSeason || 0) + \n        (player.internationalMinutesCurrentSeason || 0) + \n        recentVideos.reduce((sum, v) => sum + (v.minutesPlayed || 0), 0);\n      \n      const recommendations = transferAssessment?.recommendations || [];\n      \n      const report = await storage.createTransferReport({\n        playerId,\n        teamId,\n        generatedBy: userId,\n        generatedByName: userName,\n        reportType,\n        status: \"completed\",\n        dataRangeStart: sixMonthsAgo,\n        dataRangeEnd: new Date(),\n        playerProfile,\n        internationalCareer,\n        performanceStats,\n        eligibilityScores: eligibilityData,\n        videosIncluded,\n        documentsIncluded,\n        invitationLetters: invitationLettersIncluded,\n        embassyVerifications: verificationsIncluded,\n        totalMinutesVerified,\n        overallEligibilityStatus: transferAssessment?.overallStatus || \"red\",\n        recommendations,\n        verificationCode,\n        validUntil: new Date(Date.now() + 90 * 24 * 60 * 60 * 1000),\n      });\n      \n      await storage.logAction({\n        userId,\n        userRole: req.session.userRole,\n        action: \"generate_transfer_report\",\n        entityType: \"transfer_report\",\n        entityId: report.id,\n        details: { playerId, reportType },\n      });\n      \n      res.json({\n        success: true,\n        report: {\n          ...report,\n          playerName: `${player.firstName} ${player.lastName}`,\n        },\n      });\n    } catch (error: any) {\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  app.delete(\"/api/reports/:id\", requireTeamRole, async (req, res) => {\n    try {\n      await storage.deleteTransferReport(req.params.id);\n      res.json({ success: true });\n    } catch (error: any) {\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  app.post(\"/api/reports/:id/notify-embassy\", requireTeamRole, async (req, res) => {\n    try {\n      const report = await storage.getTransferReport(req.params.id);\n      if (!report) {\n        return res.status(404).json({ error: \"Report not found\" });\n      }\n      \n      const updatedReport = await storage.updateTransferReport(report.id, {\n        embassyNotified: true,\n        embassyNotifiedAt: new Date(),\n      });\n      \n      await storage.logAction({\n        userId: req.session.userId,\n        userRole: req.session.userRole,\n        action: \"notify_embassy\",\n        entityType: \"transfer_report\",\n        entityId: report.id,\n        details: { playerId: report.playerId },\n      });\n      \n      res.json({ success: true, report: updatedReport });\n    } catch (error: any) {\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  // 6-Month Player Activity Audit Report\n  app.get(\"/api/players/:id/audit-report\", requireTeamRole, async (req, res) => {\n    try {\n      const playerId = req.params.id;\n      const player = await storage.getPlayer(playerId);\n      if (!player) {\n        return res.status(404).json({ error: \"Player not found\" });\n      }\n\n      const sixMonthsAgo = new Date();\n      sixMonthsAgo.setMonth(sixMonthsAgo.getMonth() - 6);\n\n      // Gather all player data\n      const metrics = await storage.getPlayerMetrics(playerId);\n      const eligibilityScores = await storage.getEligibilityScores(playerId);\n      const videos = await storage.getVideos(playerId);\n      const invitationLettersData = await storage.getInvitationLetters(playerId);\n      const consularReportsData = await storage.getConsularReports(playerId);\n      const internationalRecords = await storage.getPlayerInternationalRecords(playerId);\n\n      // Filter data from last 6 months - include items without dates (assume recent)\n      const recentVideos = videos.filter(v => {\n        if (!v.uploadDate) return true;\n        return new Date(v.uploadDate) >= sixMonthsAgo;\n      });\n      const recentMetrics = metrics.filter(m => {\n        if (!m.updatedAt) return true;\n        return new Date(m.updatedAt) >= sixMonthsAgo;\n      });\n      const recentInvitations = invitationLettersData.filter(l => {\n        if (!l.uploadedAt) return true;\n        return new Date(l.uploadedAt) >= sixMonthsAgo;\n      });\n      const recentConsularReports = consularReportsData.filter(r => {\n        if (!r.generatedAt) return true;\n        return new Date(r.generatedAt) >= sixMonthsAgo;\n      });\n\n      // Get the most recent consular report (already sorted by generatedAt desc from storage)\n      const latestConsularReport = consularReportsData.length > 0 ? consularReportsData[0] : null;\n\n      // Build comprehensive audit data\n      const auditReport = {\n        generatedAt: new Date().toISOString(),\n        reportPeriod: {\n          startDate: sixMonthsAgo.toISOString(),\n          endDate: new Date().toISOString(),\n        },\n        player: {\n          id: player.id,\n          name: `${player.firstName} ${player.lastName}`,\n          dateOfBirth: player.dateOfBirth,\n          nationality: player.nationality,\n          secondaryNationality: player.secondNationality,\n          position: player.position,\n          jerseyNumber: player.jerseyNumber,\n          height: player.height,\n          weight: player.weight,\n          preferredFoot: player.preferredFoot,\n          currentClub: player.currentClubName,\n          marketValue: player.marketValue,\n        },\n        consularVerification: latestConsularReport ? {\n          verificationCode: latestConsularReport.verificationCode,\n          generatedAt: latestConsularReport.generatedAt,\n          validUntil: latestConsularReport.validUntil,\n          accessedByEmbassy: latestConsularReport.accessedByEmbassy,\n        } : null,\n        activitySummary: {\n          totalVideosTagged: recentVideos.length,\n          totalMetricsRecorded: recentMetrics.length,\n          totalInvitationLetters: recentInvitations.length,\n          totalInternationalCaps: internationalRecords.reduce((sum, r) => sum + (r.caps || 0), 0),\n        },\n        eligibilityScores: eligibilityScores.map(score => ({\n          visaType: score.visaType,\n          score: score.score,\n          status: score.status,\n          leagueBandApplied: score.leagueBandApplied,\n          calculatedAt: score.calculatedAt,\n        })),\n        videoAnalysis: recentVideos.map(video => ({\n          id: video.id,\n          title: video.title,\n          uploadedAt: video.uploadDate,\n          source: video.source,\n          duration: video.duration,\n        })),\n        performanceMetrics: recentMetrics.map(m => ({\n          season: m.season,\n          goals: m.goals,\n          assists: m.assists,\n          gamesPlayed: m.gamesPlayed,\n          currentSeasonMinutes: m.currentSeasonMinutes,\n          passAccuracy: m.passAccuracy,\n          tacklesWon: m.tacklesWon,\n          aerialDuelsWon: m.aerialDuelsWon,\n          updatedAt: m.updatedAt,\n        })),\n        internationalRecords: internationalRecords.map(r => ({\n          nationalTeam: r.nationalTeam,\n          teamLevel: r.teamLevel,\n          caps: r.caps,\n          goals: r.goals,\n          assists: r.assists,\n          debutDate: r.debutDate,\n        })),\n        invitationLetters: recentInvitations.map(l => ({\n          targetClubName: l.targetClubName,\n          targetCountry: l.targetCountry,\n          targetLeague: l.targetLeague,\n          targetLeagueBand: l.targetLeagueBand,\n          offerType: l.offerType,\n          trialStartDate: l.trialStartDate,\n          trialEndDate: l.trialEndDate,\n          status: l.status,\n          consularReportGenerated: l.consularReportGenerated,\n        })),\n      };\n\n      await storage.logAction({\n        userId: req.session.userId,\n        userRole: req.session.userRole,\n        action: \"generate_audit_report\",\n        entityType: \"player\",\n        entityId: playerId,\n        details: { reportPeriod: \"6_months\" },\n      });\n\n      res.json(auditReport);\n    } catch (error: any) {\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  // Embassy document access routes\n  app.get(\"/api/embassy/documents\", requireEmbassyRole, async (req, res) => {\n    try {\n      const embassyProfile = await storage.getEmbassyProfileByUserId(req.session.userId!);\n      if (!embassyProfile) {\n        return res.status(404).json({ error: \"Embassy profile not found\" });\n      }\n\n      const verifications = await storage.getEmbassyVerifications();\n      const countryVerifications = verifications.filter(v => v.embassyCountry === embassyProfile.country);\n      \n      const documents = [];\n      for (const verification of countryVerifications) {\n        const doc = await storage.getComplianceDocument(verification.documentId);\n        if (doc) {\n          const player = await storage.getPlayer(doc.playerId);\n          documents.push({\n            ...doc,\n            player,\n            verification,\n          });\n        }\n      }\n\n      res.json(documents);\n    } catch (error: any) {\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  app.get(\"/api/embassy/documents/:id\", requireEmbassyRole, async (req, res) => {\n    try {\n      const embassyProfile = await storage.getEmbassyProfileByUserId(req.session.userId!);\n      if (!embassyProfile) {\n        return res.status(404).json({ error: \"Embassy profile not found\" });\n      }\n\n      const doc = await storage.getComplianceDocument(req.params.id);\n      if (!doc) {\n        return res.status(404).json({ error: \"Document not found\" });\n      }\n\n      await storage.logEmbassyDocumentAccess({\n        documentId: doc.id,\n        embassyProfileId: embassyProfile.id,\n        accessedBy: req.session.userId,\n        accessType: \"view\",\n      });\n\n      await storage.logAction({\n        userId: req.session.userId,\n        userRole: \"embassy\",\n        action: \"view_document\",\n        entityType: \"compliance_document\",\n        entityId: doc.id,\n        details: { embassyCountry: embassyProfile.country },\n      });\n\n      const player = await storage.getPlayer(doc.playerId);\n      const accessLogs = await storage.getEmbassyDocumentAccessLogs(doc.id);\n\n      res.json({ document: doc, player, accessLogs });\n    } catch (error: any) {\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  // Scout/Agent player access routes\n  app.get(\"/api/scout/players\", requireScoutRole, async (req, res) => {\n    try {\n      const allPlayers = await storage.getPlayers();\n      \n      const playersWithScores = [];\n      for (const player of allPlayers) {\n        const scores = await storage.getEligibilityScores(player.id);\n        playersWithScores.push({\n          ...player,\n          eligibilityScores: scores,\n          hasEligibilityData: scores.length > 0,\n        });\n      }\n\n      res.json(playersWithScores);\n    } catch (error: any) {\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  app.get(\"/api/scout/players/:id\", requireScoutRole, async (req, res) => {\n    try {\n      const player = await storage.getPlayer(req.params.id);\n      if (!player) {\n        return res.status(404).json({ error: \"Player not found\" });\n      }\n\n      const eligibilityScores = await storage.getEligibilityScores(player.id);\n      const videos = await storage.getVideos(player.id);\n      const sharedVideos = await storage.getSharedVideos(req.session.userId!);\n      const playerSharedVideos = sharedVideos.filter(sv => sv.playerId === player.id);\n\n      await storage.logAction({\n        userId: req.session.userId,\n        userRole: req.session.userRole,\n        action: \"view_player_profile\",\n        entityType: \"player\",\n        entityId: player.id,\n        details: { scoutId: req.session.userId },\n      });\n\n      res.json({\n        player,\n        eligibilityScores,\n        videos,\n        sharedVideos: playerSharedVideos,\n      });\n    } catch (error: any) {\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  // Scout shortlist routes\n  app.get(\"/api/scout/shortlist\", requireScoutRole, async (req, res) => {\n    try {\n      const shortlist = await storage.getScoutShortlistWithPlayers(req.session.userId!);\n      res.json(shortlist);\n    } catch (error: any) {\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  app.post(\"/api/scout/shortlist\", requireScoutRole, async (req, res) => {\n    try {\n      const { playerId, priority = \"green\", notes } = req.body;\n      \n      const validPriorities = [\"amber\", \"green\", \"red\"];\n      if (!validPriorities.includes(priority)) {\n        return res.status(400).json({ error: \"Invalid priority. Must be amber, green, or red.\" });\n      }\n      \n      const existing = await storage.getShortlistEntry(req.session.userId!, playerId);\n      if (existing) {\n        return res.status(400).json({ error: \"Player already in shortlist\" });\n      }\n      \n      const entry = await storage.addToShortlist({\n        scoutId: req.session.userId!,\n        playerId,\n        priority,\n        notes,\n      });\n      \n      res.json(entry);\n    } catch (error: any) {\n      res.status(400).json({ error: error.message });\n    }\n  });\n\n  app.patch(\"/api/scout/shortlist/:id\", requireScoutRole, async (req, res) => {\n    try {\n      const { priority, notes } = req.body;\n      \n      const validPriorities = [\"amber\", \"green\", \"red\"];\n      if (!validPriorities.includes(priority)) {\n        return res.status(400).json({ error: \"Invalid priority. Must be amber, green, or red.\" });\n      }\n      \n      const shortlist = await storage.getScoutShortlist(req.session.userId!);\n      const entry = shortlist.find(s => s.id === req.params.id);\n      if (!entry) {\n        return res.status(404).json({ error: \"Shortlist entry not found\" });\n      }\n      \n      const updated = await storage.updateShortlistPriority(req.params.id, priority, notes);\n      res.json(updated);\n    } catch (error: any) {\n      res.status(400).json({ error: error.message });\n    }\n  });\n\n  app.delete(\"/api/scout/shortlist/:id\", requireScoutRole, async (req, res) => {\n    try {\n      const shortlist = await storage.getScoutShortlist(req.session.userId!);\n      const entry = shortlist.find(s => s.id === req.params.id);\n      if (!entry) {\n        return res.status(404).json({ error: \"Shortlist entry not found\" });\n      }\n      \n      await storage.removeFromShortlist(req.params.id);\n      res.json({ success: true });\n    } catch (error: any) {\n      res.status(400).json({ error: error.message });\n    }\n  });\n\n  // Token costs configuration - role-specific\n  const SCOUT_TOKEN_COSTS = {\n    view_profile: 2,\n    shortlist: 1,\n    video_analysis: 8,\n    watch_video: 1,\n    contact_request: 2,\n  };\n  \n  const TEAM_TOKEN_COSTS = {\n    video_analysis: 8,\n    scouting_messaging: 3,\n    transfer_report: 5,\n  };\n  \n  const WELCOME_BONUS = 50;\n  const TOKEN_EXPIRY_MONTHS = 6;\n  \n  function getTokenCostsForRole(role: string): Record<string, number> {\n    if (role === \"scout\") {\n      return SCOUT_TOKEN_COSTS;\n    }\n    return TEAM_TOKEN_COSTS;\n  }\n  \n  async function spendTokensForAction(\n    userId: string,\n    userRole: string,\n    action: string,\n    playerId?: string,\n    videoId?: string\n  ): Promise<{ success: boolean; error?: string; newBalance?: number; cost?: number }> {\n    const roleCosts = getTokenCostsForRole(userRole);\n    const cost = roleCosts[action];\n    \n    if (!cost) {\n      return { success: false, error: `Invalid action \"${action}\" for role \"${userRole}\"` };\n    }\n    \n    let balance = await storage.getTokenBalance(userId);\n    if (!balance) {\n      return { success: false, error: \"No token balance found\" };\n    }\n    \n    if (balance.balance < cost) {\n      return { success: false, error: `Insufficient tokens. Need ${cost}, have ${balance.balance}` };\n    }\n    \n    const newBalance = balance.balance - cost;\n    const newLifetimeSpent = balance.lifetimeSpent + cost;\n    \n    await storage.updateTokenBalance(userId, newBalance, undefined, newLifetimeSpent);\n    \n    const actionDescriptions: Record<string, string> = {\n      view_profile: \"Viewed player profile\",\n      shortlist: \"Added player to shortlist\",\n      video_analysis: \"Analyzed player video\",\n      watch_video: \"Watched player video\",\n      contact_request: \"Requested player contact\",\n      scouting_messaging: \"Sent scouting message\",\n      transfer_report: \"Generated transfer report\",\n    };\n    \n    await storage.createTokenTransaction({\n      userId,\n      amount: cost,\n      type: \"debit\",\n      action,\n      description: actionDescriptions[action] || `Action: ${action}`,\n      playerId,\n      videoId,\n      balanceAfter: newBalance,\n    });\n    \n    return { success: true, newBalance, cost };\n  }\n\n  // Get or initialize token balance\n  app.get(\"/api/tokens/balance\", async (req, res) => {\n    try {\n      const userId = req.session.userId!;\n      let balance = await storage.getTokenBalance(userId);\n      \n      if (!balance) {\n        const expiresAt = new Date();\n        expiresAt.setMonth(expiresAt.getMonth() + TOKEN_EXPIRY_MONTHS);\n        \n        balance = await storage.createTokenBalance({\n          userId,\n          balance: WELCOME_BONUS,\n          lifetimePurchased: WELCOME_BONUS,\n          lifetimeSpent: 0,\n        });\n        \n        await storage.createTokenTransaction({\n          userId,\n          amount: WELCOME_BONUS,\n          type: \"credit\",\n          action: \"welcome_bonus\",\n          description: \"Welcome bonus for new users\",\n          balanceAfter: WELCOME_BONUS,\n          expiresAt,\n        });\n      }\n      \n      res.json(balance);\n    } catch (error: any) {\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  // Get token transactions\n  app.get(\"/api/tokens/transactions\", async (req, res) => {\n    try {\n      const userId = req.session.userId!;\n      const limit = req.query.limit ? parseInt(req.query.limit as string) : undefined;\n      const transactions = await storage.getTokenTransactions(userId, limit);\n      res.json(transactions);\n    } catch (error: any) {\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  // Get token costs config - role-specific\n  app.get(\"/api/tokens/costs\", (req, res) => {\n    const userRole = req.session.userRole || \"sporting_director\";\n    const costs = getTokenCostsForRole(userRole);\n    res.json(costs);\n  });\n\n  // Get available token packs\n  app.get(\"/api/tokens/packs\", async (req, res) => {\n    try {\n      let packs = await storage.getTokenPacks();\n      \n      if (packs.length === 0) {\n        const defaultPacks = [\n          { name: \"Starter Pack\", tokens: 50, priceUsd: 999, description: \"50 tokens - Perfect for getting started\", sortOrder: 1 },\n          { name: \"Standard Pack\", tokens: 100, priceUsd: 1799, description: \"100 tokens - Best value for regular users\", sortOrder: 2 },\n          { name: \"Pro Pack\", tokens: 150, priceUsd: 2499, description: \"150 tokens - For power users\", sortOrder: 3 },\n          { name: \"Enterprise Pack\", tokens: 200, priceUsd: 2999, description: \"200 tokens - Maximum value\", sortOrder: 4 },\n        ];\n        for (const pack of defaultPacks) {\n          await storage.createTokenPack(pack);\n        }\n        packs = await storage.getTokenPacks();\n      }\n      \n      res.json(packs);\n    } catch (error: any) {\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  // Spend tokens for an action - role-specific costs\n  app.post(\"/api/tokens/spend\", async (req, res) => {\n    try {\n      const userId = req.session.userId!;\n      const userRole = req.session.userRole || \"sporting_director\";\n      const { action, playerId, videoId } = req.body;\n      \n      const roleCosts = getTokenCostsForRole(userRole);\n      const cost = roleCosts[action];\n      if (!cost) {\n        return res.status(400).json({ error: `Invalid action \"${action}\" for role \"${userRole}\"` });\n      }\n      \n      let balance = await storage.getTokenBalance(userId);\n      if (!balance) {\n        return res.status(400).json({ error: \"No token balance found\", needsPurchase: true });\n      }\n      \n      if (balance.balance < cost) {\n        return res.status(400).json({ \n          error: \"Insufficient tokens\", \n          needsPurchase: true,\n          currentBalance: balance.balance,\n          required: cost \n        });\n      }\n      \n      const newBalance = balance.balance - cost;\n      const newLifetimeSpent = balance.lifetimeSpent + cost;\n      \n      await storage.updateTokenBalance(userId, newBalance, undefined, newLifetimeSpent);\n      \n      const actionDescriptions: Record<string, string> = {\n        view_profile: \"Viewed player profile\",\n        shortlist: \"Added player to shortlist\",\n        video_analysis: \"Analyzed player video\",\n        watch_video: \"Watched player video\",\n        contact_request: \"Requested player contact\",\n        scouting_messaging: \"Sent scouting message\",\n        transfer_report: \"Generated transfer report\",\n      };\n      \n      await storage.createTokenTransaction({\n        userId,\n        amount: cost,\n        type: \"debit\",\n        action,\n        description: actionDescriptions[action] || `Action: ${action}`,\n        playerId,\n        videoId,\n        balanceAfter: newBalance,\n      });\n      \n      res.json({ success: true, newBalance, cost, action });\n    } catch (error: any) {\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  // Purchase token pack (simulated - Stripe integration needed for real payments)\n  app.post(\"/api/tokens/purchase\", async (req, res) => {\n    try {\n      const userId = req.session.userId!;\n      const { packId } = req.body;\n      \n      const pack = await storage.getTokenPack(packId);\n      if (!pack) {\n        return res.status(404).json({ error: \"Token pack not found\" });\n      }\n      \n      const expiresAt = new Date();\n      expiresAt.setMonth(expiresAt.getMonth() + TOKEN_EXPIRY_MONTHS);\n      \n      const purchase = await storage.createTokenPurchase({\n        userId,\n        packId,\n        tokens: pack.tokens,\n        amountPaid: pack.priceUsd,\n        currency: \"USD\",\n        paymentMethod: \"pending\",\n        status: \"pending\",\n        expiresAt,\n      });\n      \n      res.json({ \n        purchase,\n        message: \"Payment integration required. Connect Stripe to enable real payments.\",\n        simulatedCheckout: true \n      });\n    } catch (error: any) {\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  // Confirm purchase (simulated - call after Stripe payment success)\n  app.post(\"/api/tokens/purchase/:id/confirm\", async (req, res) => {\n    try {\n      const userId = req.session.userId!;\n      const purchaseId = req.params.id;\n      \n      const purchases = await storage.getTokenPurchases(userId);\n      const purchase = purchases.find(p => p.id === purchaseId);\n      \n      if (!purchase || purchase.userId !== userId) {\n        return res.status(404).json({ error: \"Purchase not found\" });\n      }\n      \n      if (purchase.status === \"completed\") {\n        return res.status(400).json({ error: \"Purchase already completed\" });\n      }\n      \n      await storage.updateTokenPurchase(purchaseId, { \n        status: \"completed\",\n        paymentMethod: \"simulated\",\n        paymentReference: `SIM-${Date.now()}`\n      });\n      \n      let balance = await storage.getTokenBalance(userId);\n      const newBalance = (balance?.balance || 0) + purchase.tokens;\n      const newLifetimePurchased = (balance?.lifetimePurchased || 0) + purchase.tokens;\n      \n      if (balance) {\n        await storage.updateTokenBalance(userId, newBalance, newLifetimePurchased);\n      } else {\n        await storage.createTokenBalance({\n          userId,\n          balance: newBalance,\n          lifetimePurchased: newLifetimePurchased,\n          lifetimeSpent: 0,\n        });\n      }\n      \n      await storage.createTokenTransaction({\n        userId,\n        amount: purchase.tokens,\n        type: \"credit\",\n        action: \"purchase\",\n        description: `Purchased ${purchase.tokens} tokens`,\n        packId: purchase.packId,\n        balanceAfter: newBalance,\n        expiresAt: purchase.expiresAt,\n      });\n      \n      res.json({ success: true, newBalance, tokensAdded: purchase.tokens });\n    } catch (error: any) {\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  // Get purchase history\n  app.get(\"/api/tokens/purchases\", async (req, res) => {\n    try {\n      const userId = req.session.userId!;\n      const purchases = await storage.getTokenPurchases(userId);\n      res.json(purchases);\n    } catch (error: any) {\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  // Share video with scout\n  app.post(\"/api/videos/:id/share\", requireTeamRole, async (req, res) => {\n    try {\n      const video = await storage.getVideo(req.params.id);\n      if (!video) {\n        return res.status(404).json({ error: \"Video not found\" });\n      }\n\n      const { sharedWithUserId, sharedWithRole, expiresAt } = req.body;\n\n      const sharedVideo = await storage.shareVideo({\n        videoId: video.id,\n        sharedWithUserId,\n        sharedWithRole,\n        sharedByUserId: req.session.userId!,\n        playerId: video.playerId,\n        accessLevel: \"view\",\n        expiresAt: expiresAt ? new Date(expiresAt) : undefined,\n      });\n\n      await storage.logAction({\n        userId: req.session.userId,\n        userRole: req.session.userRole,\n        action: \"share_video\",\n        entityType: \"video\",\n        entityId: video.id,\n        details: { sharedWithUserId, sharedWithRole },\n      });\n\n      res.json(sharedVideo);\n    } catch (error: any) {\n      res.status(400).json({ error: error.message });\n    }\n  });\n\n  // Transfer targets\n  app.post(\"/api/transfer-targets\", requireTeamRole, async (req, res) => {\n    try {\n      const { complianceOrderId, playerId, targetClubName, targetLeague, targetCountry, targetLeagueBand, invitationLetterId, scoutAgentId, proposedTransferFee } = req.body;\n      \n      const target = await storage.createTransferTarget({\n        complianceOrderId,\n        playerId,\n        targetClubName,\n        targetLeague,\n        targetCountry,\n        targetLeagueBand,\n        invitationLetterId,\n        scoutAgentId,\n        proposedTransferFee,\n        status: \"pending\",\n      });\n\n      await storage.logAction({\n        userId: req.session.userId,\n        userRole: req.session.userRole,\n        action: \"create_transfer_target\",\n        entityType: \"transfer_target\",\n        entityId: target.id,\n        details: { playerId, targetClubName, targetCountry },\n      });\n\n      res.json(target);\n    } catch (error: any) {\n      res.status(400).json({ error: error.message });\n    }\n  });\n\n  app.get(\"/api/transfer-targets/:playerId\", requireAuth, async (req, res) => {\n    try {\n      const targets = await storage.getTransferTargets(req.params.playerId);\n      res.json(targets);\n    } catch (error: any) {\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  // Action logs\n  app.get(\"/api/action-logs/:entityType/:entityId\", requireAuth, async (req, res) => {\n    try {\n      const logs = await storage.getActionLogs(req.params.entityType, req.params.entityId);\n      res.json(logs);\n    } catch (error: any) {\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  // Team Sheets routes\n  app.get(\"/api/team-sheets\", requireAuth, async (req, res) => {\n    try {\n      const teamId = req.session.teamId || \"demo-team\";\n      const sheets = await storage.getTeamSheets(teamId);\n      res.json(sheets);\n    } catch (error: any) {\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  app.get(\"/api/team-sheets/:id\", requireAuth, async (req, res) => {\n    try {\n      const sheet = await storage.getTeamSheet(req.params.id);\n      if (!sheet) {\n        return res.status(404).json({ error: \"Team sheet not found\" });\n      }\n      const players = await storage.getTeamSheetPlayers(sheet.id);\n      res.json({ ...sheet, players });\n    } catch (error: any) {\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  app.post(\"/api/team-sheets\", requireAuth, async (req, res) => {\n    try {\n      const teamId = req.session.teamId || \"demo-team\";\n      const sheetData = insertTeamSheetSchema.parse({\n        ...req.body,\n        teamId,\n      });\n      const sheet = await storage.createTeamSheet(sheetData);\n      \n      await storage.logAction({\n        userId: req.session.userId,\n        userRole: req.session.userRole,\n        action: \"create_team_sheet\",\n        entityType: \"team_sheet\",\n        entityId: sheet.id,\n        details: { title: sheet.title, matchDate: sheet.matchDate, competition: sheet.competition },\n      });\n      \n      res.json(sheet);\n    } catch (error: any) {\n      res.status(400).json({ error: error.message });\n    }\n  });\n\n  app.put(\"/api/team-sheets/:id\", requireAuth, async (req, res) => {\n    try {\n      const sheet = await storage.getTeamSheet(req.params.id);\n      if (!sheet) {\n        return res.status(404).json({ error: \"Team sheet not found\" });\n      }\n      const updatedSheet = await storage.updateTeamSheet(req.params.id, req.body);\n      res.json(updatedSheet);\n    } catch (error: any) {\n      res.status(400).json({ error: error.message });\n    }\n  });\n\n  app.delete(\"/api/team-sheets/:id\", requireAuth, async (req, res) => {\n    try {\n      const sheet = await storage.getTeamSheet(req.params.id);\n      if (!sheet) {\n        return res.status(404).json({ error: \"Team sheet not found\" });\n      }\n      await storage.deleteTeamSheet(req.params.id);\n      res.json({ success: true });\n    } catch (error: any) {\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  // Team Sheet Players routes\n  app.get(\"/api/team-sheets/:id/players\", requireAuth, async (req, res) => {\n    try {\n      const players = await storage.getTeamSheetPlayers(req.params.id);\n      res.json(players);\n    } catch (error: any) {\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  app.post(\"/api/team-sheets/:id/players\", requireAuth, async (req, res) => {\n    try {\n      const sheet = await storage.getTeamSheet(req.params.id);\n      if (!sheet) {\n        return res.status(404).json({ error: \"Team sheet not found\" });\n      }\n\n      const existingPlayers = await storage.getTeamSheetPlayers(req.params.id);\n      const starters = existingPlayers.filter(p => p.role === \"starting\");\n      const { role } = req.body;\n\n      if (role === \"starting\" && starters.length >= 11) {\n        return res.status(400).json({ error: \"Maximum 11 starting players allowed\" });\n      }\n\n      const alreadyAdded = existingPlayers.find(p => p.playerId === req.body.playerId);\n      if (alreadyAdded) {\n        return res.status(400).json({ error: \"Player already added to this team sheet\" });\n      }\n\n      const playerData = insertTeamSheetPlayerSchema.parse({\n        ...req.body,\n        teamSheetId: req.params.id,\n      });\n      const player = await storage.createTeamSheetPlayer(playerData);\n      res.json(player);\n    } catch (error: any) {\n      res.status(400).json({ error: error.message });\n    }\n  });\n\n  app.put(\"/api/team-sheet-players/:id\", requireAuth, async (req, res) => {\n    try {\n      const player = await storage.updateTeamSheetPlayer(req.params.id, req.body);\n      if (!player) {\n        return res.status(404).json({ error: \"Team sheet player not found\" });\n      }\n      res.json(player);\n    } catch (error: any) {\n      res.status(400).json({ error: error.message });\n    }\n  });\n\n  app.delete(\"/api/team-sheet-players/:id\", requireAuth, async (req, res) => {\n    try {\n      await storage.deleteTeamSheetPlayer(req.params.id);\n      res.json({ success: true });\n    } catch (error: any) {\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  // Competitions by country - auto-populate feature\n  app.get(\"/api/competitions\", requireAuth, async (req, res) => {\n    try {\n      const { country } = req.query;\n      const competitions = getCompetitionsByCountry(country as string);\n      res.json(competitions);\n    } catch (error: any) {\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  return httpServer;\n}\n\nfunction getCompetitionsByCountry(country?: string): { name: string; type: string }[] {\n  const internationalCompetitions = [\n    { name: \"FIFA World Cup\", type: \"international\" },\n    { name: \"FIFA World Cup Qualifiers\", type: \"international\" },\n    { name: \"UEFA European Championship\", type: \"international\" },\n    { name: \"UEFA Nations League\", type: \"international\" },\n    { name: \"Copa America\", type: \"international\" },\n    { name: \"Africa Cup of Nations\", type: \"international\" },\n    { name: \"AFC Asian Cup\", type: \"international\" },\n    { name: \"CONCACAF Gold Cup\", type: \"international\" },\n    { name: \"International Friendly\", type: \"friendly\" },\n  ];\n\n  const leaguesByCountry: Record<string, { name: string; type: string }[]> = {\n    england: [\n      { name: \"Premier League\", type: \"league\" },\n      { name: \"EFL Championship\", type: \"league\" },\n      { name: \"EFL League One\", type: \"league\" },\n      { name: \"EFL League Two\", type: \"league\" },\n      { name: \"FA Cup\", type: \"cup\" },\n      { name: \"EFL Cup\", type: \"cup\" },\n      { name: \"Community Shield\", type: \"cup\" },\n    ],\n    spain: [\n      { name: \"La Liga\", type: \"league\" },\n      { name: \"La Liga 2\", type: \"league\" },\n      { name: \"Copa del Rey\", type: \"cup\" },\n      { name: \"Supercopa de Espana\", type: \"cup\" },\n    ],\n    germany: [\n      { name: \"Bundesliga\", type: \"league\" },\n      { name: \"2. Bundesliga\", type: \"league\" },\n      { name: \"DFB-Pokal\", type: \"cup\" },\n      { name: \"DFL-Supercup\", type: \"cup\" },\n    ],\n    italy: [\n      { name: \"Serie A\", type: \"league\" },\n      { name: \"Serie B\", type: \"league\" },\n      { name: \"Coppa Italia\", type: \"cup\" },\n      { name: \"Supercoppa Italiana\", type: \"cup\" },\n    ],\n    france: [\n      { name: \"Ligue 1\", type: \"league\" },\n      { name: \"Ligue 2\", type: \"league\" },\n      { name: \"Coupe de France\", type: \"cup\" },\n      { name: \"Coupe de la Ligue\", type: \"cup\" },\n      { name: \"Trophee des Champions\", type: \"cup\" },\n    ],\n    netherlands: [\n      { name: \"Eredivisie\", type: \"league\" },\n      { name: \"Eerste Divisie\", type: \"league\" },\n      { name: \"KNVB Cup\", type: \"cup\" },\n      { name: \"Johan Cruyff Shield\", type: \"cup\" },\n    ],\n    portugal: [\n      { name: \"Primeira Liga\", type: \"league\" },\n      { name: \"Liga Portugal 2\", type: \"league\" },\n      { name: \"Taca de Portugal\", type: \"cup\" },\n      { name: \"Supertaca Candido de Oliveira\", type: \"cup\" },\n    ],\n    norway: [\n      { name: \"Eliteserien\", type: \"league\" },\n      { name: \"OBOS-ligaen\", type: \"league\" },\n      { name: \"Norwegian Cup\", type: \"cup\" },\n    ],\n    nigeria: [\n      { name: \"Nigeria Professional Football League\", type: \"league\" },\n      { name: \"Nigeria National League\", type: \"league\" },\n      { name: \"Federation Cup\", type: \"cup\" },\n      { name: \"FA Cup\", type: \"cup\" },\n    ],\n    usa: [\n      { name: \"Major League Soccer\", type: \"league\" },\n      { name: \"USL Championship\", type: \"league\" },\n      { name: \"US Open Cup\", type: \"cup\" },\n      { name: \"MLS Cup\", type: \"cup\" },\n    ],\n  };\n\n  const continentalCompetitions = [\n    { name: \"UEFA Champions League\", type: \"continental\" },\n    { name: \"UEFA Europa League\", type: \"continental\" },\n    { name: \"UEFA Conference League\", type: \"continental\" },\n    { name: \"CAF Champions League\", type: \"continental\" },\n    { name: \"CAF Confederation Cup\", type: \"continental\" },\n    { name: \"Copa Libertadores\", type: \"continental\" },\n    { name: \"Copa Sudamericana\", type: \"continental\" },\n    { name: \"AFC Champions League\", type: \"continental\" },\n    { name: \"CONCACAF Champions Cup\", type: \"continental\" },\n  ];\n\n  const countryLower = country?.toLowerCase() || \"\";\n  const countryCompetitions = leaguesByCountry[countryLower] || [];\n\n  return [...countryCompetitions, ...continentalCompetitions, ...internationalCompetitions];\n}\n","path":null,"size_bytes":138393,"size_tokens":null},"server/db.ts":{"content":"import { Pool } from \"pg\";\nimport { drizzle } from \"drizzle-orm/node-postgres\";\n\nimport * as authSchema from \"@shared/models/auth\";\n\nif (!process.env.DATABASE_URL) {\n  throw new Error(\"DATABASE_URL must be set. Did you forget to provision a database?\");\n}\n\nconst pool = new Pool({ connectionString: process.env.DATABASE_URL });\nexport const db = drizzle(pool, { schema: { ...authSchema } });\n","path":null,"size_bytes":392,"size_tokens":null},"client/src/lib/auth-utils.ts":{"content":"export function isUnauthorizedError(error: Error): boolean {\n  return /^401: .*Unauthorized/.test(error.message);\n}\n\n// Redirect to login with a toast notification\nexport function redirectToLogin(toast?: (options: { title: string; description: string; variant: string }) => void) {\n  if (toast) {\n    toast({\n      title: \"Unauthorized\",\n      description: \"You are logged out. Logging in again...\",\n      variant: \"destructive\",\n    });\n  }\n  setTimeout(() => {\n    window.location.href = \"/api/login\";\n  }, 500);\n}\n","path":null,"size_bytes":517,"size_tokens":null},"client/src/components/ui/context-menu.tsx":{"content":"import * as React from \"react\"\nimport * as ContextMenuPrimitive from \"@radix-ui/react-context-menu\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ContextMenu = ContextMenuPrimitive.Root\n\nconst ContextMenuTrigger = ContextMenuPrimitive.Trigger\n\nconst ContextMenuGroup = ContextMenuPrimitive.Group\n\nconst ContextMenuPortal = ContextMenuPrimitive.Portal\n\nconst ContextMenuSub = ContextMenuPrimitive.Sub\n\nconst ContextMenuRadioGroup = ContextMenuPrimitive.RadioGroup\n\nconst ContextMenuSubTrigger = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <ContextMenuPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto h-4 w-4\" />\n  </ContextMenuPrimitive.SubTrigger>\n))\nContextMenuSubTrigger.displayName = ContextMenuPrimitive.SubTrigger.displayName\n\nconst ContextMenuSubContent = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-context-menu-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuSubContent.displayName = ContextMenuPrimitive.SubContent.displayName\n\nconst ContextMenuContent = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.Portal>\n    <ContextMenuPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"z-50 max-h-[--radix-context-menu-content-available-height] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md animate-in fade-in-80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-context-menu-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </ContextMenuPrimitive.Portal>\n))\nContextMenuContent.displayName = ContextMenuPrimitive.Content.displayName\n\nconst ContextMenuItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <ContextMenuPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuItem.displayName = ContextMenuPrimitive.Item.displayName\n\nconst ContextMenuCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <ContextMenuPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <ContextMenuPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </ContextMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </ContextMenuPrimitive.CheckboxItem>\n))\nContextMenuCheckboxItem.displayName =\n  ContextMenuPrimitive.CheckboxItem.displayName\n\nconst ContextMenuRadioItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <ContextMenuPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <ContextMenuPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </ContextMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </ContextMenuPrimitive.RadioItem>\n))\nContextMenuRadioItem.displayName = ContextMenuPrimitive.RadioItem.displayName\n\nconst ContextMenuLabel = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <ContextMenuPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold text-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuLabel.displayName = ContextMenuPrimitive.Label.displayName\n\nconst ContextMenuSeparator = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-border\", className)}\n    {...props}\n  />\n))\nContextMenuSeparator.displayName = ContextMenuPrimitive.Separator.displayName\n\nconst ContextMenuShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nContextMenuShortcut.displayName = \"ContextMenuShortcut\"\n\nexport {\n  ContextMenu,\n  ContextMenuTrigger,\n  ContextMenuContent,\n  ContextMenuItem,\n  ContextMenuCheckboxItem,\n  ContextMenuRadioItem,\n  ContextMenuLabel,\n  ContextMenuSeparator,\n  ContextMenuShortcut,\n  ContextMenuGroup,\n  ContextMenuPortal,\n  ContextMenuSub,\n  ContextMenuSubContent,\n  ContextMenuSubTrigger,\n  ContextMenuRadioGroup,\n}\n","path":null,"size_bytes":7428,"size_tokens":null},"client/src/pages/embassy-document-view.tsx":{"content":"import { useRoute } from \"wouter\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Button } from \"@/components/ui/button\";\nimport { ScrollArea } from \"@/components/ui/scroll-area\";\nimport { Separator } from \"@/components/ui/separator\";\nimport { LoadingSpinner } from \"@/components/LoadingScreen\";\nimport { FileText, User, Calendar, Shield, Clock, Eye, Download, Globe, Award, Activity } from \"lucide-react\";\nimport logoImage from \"@assets/WhatsApp_Image_2025-12-17_at_12.49.33_1766008177672.jpeg\";\nimport type { ComplianceDocument, Player, EmbassyDocumentAccess } from \"@shared/schema\";\n\ninterface DocumentDetails {\n  document: ComplianceDocument;\n  player: Player;\n  accessLogs: EmbassyDocumentAccess[];\n}\n\nexport default function EmbassyDocumentView() {\n  const [, params] = useRoute(\"/embassy/document/:id\");\n  const documentId = params?.id;\n\n  const { data, isLoading, error } = useQuery<DocumentDetails>({\n    queryKey: [`/api/embassy/documents/${documentId}`],\n    enabled: !!documentId,\n  });\n\n  if (isLoading) {\n    return (\n      <div className=\"flex items-center justify-center h-full\">\n        <LoadingSpinner size=\"lg\" />\n      </div>\n    );\n  }\n\n  if (error || !data) {\n    return (\n      <div className=\"flex items-center justify-center h-full\">\n        <Card className=\"max-w-md\">\n          <CardContent className=\"py-12 text-center\">\n            <Shield className=\"h-12 w-12 text-muted-foreground mx-auto mb-4\" />\n            <p className=\"text-muted-foreground\">Document not found or access denied</p>\n          </CardContent>\n        </Card>\n      </div>\n    );\n  }\n\n  const { document: doc, player, accessLogs } = data;\n\n  return (\n    <div className=\"p-6 space-y-6 max-w-5xl mx-auto\">\n      <div className=\"flex items-center gap-4 mb-6\">\n        <img \n          src={logoImage} \n          alt=\"Sports Reels\" \n          className=\"h-16 w-16 object-contain rounded-md\"\n        />\n        <div>\n          <h1 className=\"text-2xl font-bold\" data-testid=\"text-document-title\">\n            Compliance Document - {doc.documentType?.replace(/_/g, \" \").toUpperCase()}\n          </h1>\n          <p className=\"text-muted-foreground\">\n            Official document for visa and eligibility verification\n          </p>\n        </div>\n      </div>\n\n      <div className=\"grid md:grid-cols-3 gap-6\">\n        <Card className=\"md:col-span-2\">\n          <CardHeader>\n            <div className=\"flex items-start justify-between gap-4 flex-wrap\">\n              <div className=\"flex items-center gap-3\">\n                <div className=\"h-12 w-12 rounded-full bg-primary/10 flex items-center justify-center\">\n                  <User className=\"h-6 w-6 text-primary\" />\n                </div>\n                <div>\n                  <CardTitle>{player.firstName} {player.lastName}</CardTitle>\n                  <CardDescription>{player.position} - {player.nationality}</CardDescription>\n                </div>\n              </div>\n              <Badge variant=\"secondary\" className=\"bg-green-500/10 text-green-600 border-green-200\">\n                Verified Document\n              </Badge>\n            </div>\n          </CardHeader>\n          <CardContent className=\"space-y-6\">\n            <div className=\"grid grid-cols-2 md:grid-cols-4 gap-4\">\n              <div className=\"text-center p-4 rounded-md bg-muted/50\">\n                <Globe className=\"h-5 w-5 mx-auto mb-2 text-muted-foreground\" />\n                <p className=\"text-sm text-muted-foreground\">Nationality</p>\n                <p className=\"font-medium\">{player.nationality}</p>\n              </div>\n              <div className=\"text-center p-4 rounded-md bg-muted/50\">\n                <Calendar className=\"h-5 w-5 mx-auto mb-2 text-muted-foreground\" />\n                <p className=\"text-sm text-muted-foreground\">Date of Birth</p>\n                <p className=\"font-medium\">\n                  {player.dateOfBirth ? new Date(player.dateOfBirth).toLocaleDateString() : \"N/A\"}\n                </p>\n              </div>\n              <div className=\"text-center p-4 rounded-md bg-muted/50\">\n                <Award className=\"h-5 w-5 mx-auto mb-2 text-muted-foreground\" />\n                <p className=\"text-sm text-muted-foreground\">Int'l Caps</p>\n                <p className=\"font-medium\">{player.nationalTeamCaps || 0}</p>\n              </div>\n              <div className=\"text-center p-4 rounded-md bg-muted/50\">\n                <Activity className=\"h-5 w-5 mx-auto mb-2 text-muted-foreground\" />\n                <p className=\"text-sm text-muted-foreground\">Continental</p>\n                <p className=\"font-medium\">{player.continentalGames || 0}</p>\n              </div>\n            </div>\n\n            <Separator />\n\n            <div>\n              <h3 className=\"font-semibold mb-4 flex items-center gap-2\">\n                <FileText className=\"h-4 w-4\" />\n                Document Details\n              </h3>\n              <div className=\"grid grid-cols-2 gap-4 text-sm\">\n                <div>\n                  <p className=\"text-muted-foreground\">Document Type</p>\n                  <p className=\"font-medium\">{doc.documentType?.replace(/_/g, \" \").toUpperCase()}</p>\n                </div>\n                <div>\n                  <p className=\"text-muted-foreground\">Verification Code</p>\n                  <p className=\"font-medium font-mono\">{(doc as any).verificationCode || doc.id.slice(0, 8).toUpperCase()}</p>\n                </div>\n                <div>\n                  <p className=\"text-muted-foreground\">Generated Date</p>\n                  <p className=\"font-medium\">\n                    {doc.generatedAt ? new Date(doc.generatedAt).toLocaleDateString() : \"N/A\"}\n                  </p>\n                </div>\n                <div>\n                  <p className=\"text-muted-foreground\">Data Range</p>\n                  <p className=\"font-medium\">\n                    {doc.dataRangeStart && doc.dataRangeEnd\n                      ? `${new Date(doc.dataRangeStart).toLocaleDateString()} - ${new Date(doc.dataRangeEnd).toLocaleDateString()}`\n                      : \"N/A\"}\n                  </p>\n                </div>\n              </div>\n            </div>\n\n            <Separator />\n\n            <div className=\"bg-muted/30 rounded-md p-4\">\n              <div className=\"flex items-center gap-2 text-sm text-muted-foreground mb-2\">\n                <Shield className=\"h-4 w-4\" />\n                <span>Embassy Verification Notice</span>\n              </div>\n              <p className=\"text-sm\">\n                This document has been generated by Sports Reels and is intended for official visa and work permit verification purposes only. \n                All data has been verified against official football federation records and performance databases.\n              </p>\n            </div>\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardHeader>\n            <CardTitle className=\"text-lg flex items-center gap-2\">\n              <Eye className=\"h-5 w-5\" />\n              Access Log\n            </CardTitle>\n            <CardDescription>\n              All document access is logged and timestamped\n            </CardDescription>\n          </CardHeader>\n          <CardContent>\n            <ScrollArea className=\"h-[300px]\">\n              {accessLogs.length === 0 ? (\n                <p className=\"text-sm text-muted-foreground text-center py-4\">\n                  No previous access recorded\n                </p>\n              ) : (\n                <div className=\"space-y-3\">\n                  {accessLogs.map((log, i) => (\n                    <div key={i} className=\"p-3 rounded-md bg-muted/50 text-sm\">\n                      <div className=\"flex items-center gap-2 mb-1\">\n                        <Clock className=\"h-3 w-3 text-muted-foreground\" />\n                        <span className=\"text-muted-foreground\">\n                          {log.accessedAt ? new Date(log.accessedAt).toLocaleString() : \"N/A\"}\n                        </span>\n                      </div>\n                      <p className=\"font-medium capitalize\">{log.accessType} Access</p>\n                    </div>\n                  ))}\n                </div>\n              )}\n            </ScrollArea>\n          </CardContent>\n        </Card>\n      </div>\n\n      <Card>\n        <CardContent className=\"py-4\">\n          <div className=\"flex items-center justify-between gap-4 flex-wrap\">\n            <div className=\"flex items-center gap-4\">\n              <img \n                src={logoImage} \n                alt=\"Sports Reels\" \n                className=\"h-8 w-8 object-contain rounded\"\n              />\n              <div className=\"text-sm\">\n                <p className=\"font-medium\">Sports Reels Compliance Platform</p>\n                <p className=\"text-muted-foreground\">Official document verification system</p>\n              </div>\n            </div>\n            <div className=\"text-xs text-muted-foreground text-right\">\n              <p>Document ID: {doc.id}</p>\n              <p>This viewing session has been logged</p>\n            </div>\n          </div>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","path":null,"size_bytes":9264,"size_tokens":null},"client/src/pages/access.tsx":{"content":"import { useState } from \"react\";\nimport RoleAccessControl from \"@/components/RoleAccessControl\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from \"@/components/ui/table\";\nimport { Avatar, AvatarFallback } from \"@/components/ui/avatar\";\nimport { Shield, Users, Clock, Plus } from \"lucide-react\";\nimport type { UserRole } from \"@/lib/types\";\n\nexport default function Access() {\n  // todo: remove mock functionality\n  const [permissions, setPermissions] = useState([\n    { role: \"sporting_director\" as UserRole, label: \"Sporting Director\", hasAccess: true, icon: null as any },\n    { role: \"legal\" as UserRole, label: \"Legal Team\", hasAccess: true, icon: null as any },\n    { role: \"scout\" as UserRole, label: \"Scouts\", hasAccess: true, icon: null as any },\n    { role: \"coach\" as UserRole, label: \"Coaches\", hasAccess: false, icon: null as any },\n  ]);\n\n  const teamMembers = [\n    { id: \"1\", name: \"John Smith\", email: \"john@club.com\", role: \"sporting_director\", lastActive: \"2024-12-16T10:30:00Z\" },\n    { id: \"2\", name: \"Maria Garcia\", email: \"maria@club.com\", role: \"legal\", lastActive: \"2024-12-16T09:15:00Z\" },\n    { id: \"3\", name: \"David Wilson\", email: \"david@club.com\", role: \"scout\", lastActive: \"2024-12-15T14:45:00Z\" },\n    { id: \"4\", name: \"Sarah Johnson\", email: \"sarah@club.com\", role: \"coach\", lastActive: \"2024-12-14T16:20:00Z\" },\n  ];\n\n  const handlePermissionToggle = (role: UserRole, enabled: boolean) => {\n    setPermissions((prev) =>\n      prev.map((p) => (p.role === role ? { ...p, hasAccess: enabled } : p))\n    );\n  };\n\n  const getRoleBadge = (role: string) => {\n    const config: Record<string, { className: string; label: string }> = {\n      sporting_director: { className: \"bg-purple-100 text-purple-800 dark:bg-purple-900/30 dark:text-purple-400\", label: \"Sporting Director\" },\n      legal: { className: \"bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-400\", label: \"Legal\" },\n      scout: { className: \"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400\", label: \"Scout\" },\n      coach: { className: \"bg-orange-100 text-orange-800 dark:bg-orange-900/30 dark:text-orange-400\", label: \"Coach\" },\n    };\n    return config[role] || { className: \"bg-gray-100 text-gray-800\", label: role };\n  };\n\n  return (\n    <div className=\"p-6 space-y-6\" data-testid=\"page-access\">\n      <div className=\"flex flex-wrap items-center justify-between gap-4\">\n        <div>\n          <h1 className=\"text-2xl font-semibold\">Access Control</h1>\n          <p className=\"text-muted-foreground\">Manage team roles and permissions</p>\n        </div>\n        <Button data-testid=\"button-invite-member\">\n          <Plus className=\"h-4 w-4 mr-2\" />\n          Invite Team Member\n        </Button>\n      </div>\n\n      <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-6\">\n        <div className=\"lg:col-span-1\">\n          <RoleAccessControl permissions={permissions} onToggle={handlePermissionToggle} />\n        </div>\n\n        <div className=\"lg:col-span-2\">\n          <Card>\n            <CardHeader className=\"pb-4\">\n              <CardTitle className=\"text-lg flex items-center gap-2\">\n                <Users className=\"h-5 w-5\" />\n                Team Members\n              </CardTitle>\n            </CardHeader>\n            <CardContent>\n              <div className=\"border rounded-md overflow-hidden\">\n                <Table>\n                  <TableHeader>\n                    <TableRow>\n                      <TableHead className=\"font-bold text-xs uppercase\">Member</TableHead>\n                      <TableHead className=\"font-bold text-xs uppercase\">Role</TableHead>\n                      <TableHead className=\"font-bold text-xs uppercase\">Last Active</TableHead>\n                      <TableHead className=\"font-bold text-xs uppercase\">Status</TableHead>\n                    </TableRow>\n                  </TableHeader>\n                  <TableBody>\n                    {teamMembers.map((member) => {\n                      const roleBadge = getRoleBadge(member.role);\n                      const rolePermission = permissions.find((p) => p.role === member.role);\n                      const hasAccess = rolePermission?.hasAccess ?? false;\n                      return (\n                        <TableRow key={member.id} data-testid={`row-member-${member.id}`}>\n                          <TableCell>\n                            <div className=\"flex items-center gap-3\">\n                              <Avatar className=\"h-8 w-8\">\n                                <AvatarFallback className=\"bg-primary text-primary-foreground text-xs\">\n                                  {member.name.split(\" \").map((n) => n[0]).join(\"\")}\n                                </AvatarFallback>\n                              </Avatar>\n                              <div>\n                                <p className=\"font-medium\">{member.name}</p>\n                                <p className=\"text-xs text-muted-foreground\">{member.email}</p>\n                              </div>\n                            </div>\n                          </TableCell>\n                          <TableCell>\n                            <Badge variant=\"secondary\" className={roleBadge.className}>\n                              {roleBadge.label}\n                            </Badge>\n                          </TableCell>\n                          <TableCell>\n                            <div className=\"flex items-center gap-2 text-sm text-muted-foreground\">\n                              <Clock className=\"h-3 w-3\" />\n                              {new Date(member.lastActive).toLocaleString()}\n                            </div>\n                          </TableCell>\n                          <TableCell>\n                            <Badge\n                              variant=\"secondary\"\n                              className={\n                                hasAccess\n                                  ? \"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400\"\n                                  : \"bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-400\"\n                              }\n                            >\n                              {hasAccess ? \"Active\" : \"Restricted\"}\n                            </Badge>\n                          </TableCell>\n                        </TableRow>\n                      );\n                    })}\n                  </TableBody>\n                </Table>\n              </div>\n            </CardContent>\n          </Card>\n        </div>\n      </div>\n    </div>\n  );\n}\n","path":null,"size_bytes":6743,"size_tokens":null},"client/src/components/examples/VideoUpload.tsx":{"content":"import VideoUpload from \"../VideoUpload\";\n\nexport default function VideoUploadExample() {\n  return (\n    <div className=\"max-w-md\">\n      <VideoUpload \n        onUpload={(file, meta) => console.log(\"Upload\", file.name, meta)}\n        onIntegrationConnect={(source) => console.log(\"Connect\", source)}\n      />\n    </div>\n  );\n}\n","path":null,"size_bytes":327,"size_tokens":null},"client/src/components/PlayerProfileHeader.tsx":{"content":"import { Card, CardContent } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Avatar, AvatarFallback } from \"@/components/ui/avatar\";\nimport { Badge } from \"@/components/ui/badge\";\nimport StatusBadge from \"./StatusBadge\";\nimport { FileText, Share2, Clock, MapPin, Calendar, Activity } from \"lucide-react\";\nimport type { Player } from \"@/lib/types\";\n\ninterface PlayerProfileHeaderProps {\n  player: Player;\n  onGenerateReport?: () => void;\n  onShare?: () => void;\n}\n\nexport default function PlayerProfileHeader({ player, onGenerateReport, onShare }: PlayerProfileHeaderProps) {\n  const initials = `${player.firstName[0]}${player.lastName[0]}`;\n  const age = new Date().getFullYear() - new Date(player.dateOfBirth).getFullYear();\n\n  return (\n    <Card data-testid=\"card-player-profile-header\">\n      <CardContent className=\"p-6\">\n        <div className=\"flex flex-col md:flex-row gap-6\">\n          <Avatar className=\"h-24 w-24 shrink-0\">\n            <AvatarFallback className=\"bg-primary text-primary-foreground text-2xl font-semibold\">\n              {initials}\n            </AvatarFallback>\n          </Avatar>\n\n          <div className=\"flex-1 min-w-0 space-y-4\">\n            <div className=\"flex flex-wrap items-start justify-between gap-4\">\n              <div>\n                <h1 className=\"text-2xl font-semibold\">{player.firstName} {player.lastName}</h1>\n                <div className=\"flex flex-wrap items-center gap-2 mt-1\">\n                  <Badge variant=\"secondary\">{player.position}</Badge>\n                  <span className=\"text-muted-foreground\">|</span>\n                  <span className=\"text-sm text-muted-foreground\">{age} years old</span>\n                </div>\n              </div>\n              <StatusBadge score={player.overallEligibilityScore} />\n            </div>\n\n            <div className=\"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm\">\n              <div className=\"flex items-center gap-2\">\n                <MapPin className=\"h-4 w-4 text-muted-foreground\" />\n                <span>{player.nationality}</span>\n              </div>\n              <div className=\"flex items-center gap-2\">\n                <Activity className=\"h-4 w-4 text-muted-foreground\" />\n                <span>{player.currentClub}</span>\n              </div>\n              <div className=\"flex items-center gap-2\">\n                <Clock className=\"h-4 w-4 text-muted-foreground\" />\n                <span>{player.currentSeasonMinutes} mins this season</span>\n              </div>\n              <div className=\"flex items-center gap-2\">\n                <Calendar className=\"h-4 w-4 text-muted-foreground\" />\n                <span>Updated {new Date(player.lastUpdated).toLocaleDateString()}</span>\n              </div>\n            </div>\n\n            <div className=\"flex flex-wrap gap-2\">\n              {player.medicalDataAvailable && (\n                <Badge variant=\"secondary\" className=\"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400\">\n                  Medical Data Available\n                </Badge>\n              )}\n              {player.gpsDataAvailable && (\n                <Badge variant=\"secondary\" className=\"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400\">\n                  GPS Data Available\n                </Badge>\n              )}\n              {player.nationalTeamCaps >= 10 && (\n                <Badge variant=\"secondary\" className=\"bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-400\">\n                  Full International\n                </Badge>\n              )}\n            </div>\n          </div>\n\n          <div className=\"flex flex-row md:flex-col gap-2 shrink-0\">\n            <Button onClick={onGenerateReport} data-testid=\"button-generate-report\">\n              <FileText className=\"h-4 w-4 mr-2\" />\n              Generate Report\n            </Button>\n            <Button variant=\"outline\" onClick={onShare} data-testid=\"button-share-profile\">\n              <Share2 className=\"h-4 w-4 mr-2\" />\n              Share\n            </Button>\n          </div>\n        </div>\n      </CardContent>\n    </Card>\n  );\n}\n","path":null,"size_bytes":4134,"size_tokens":null},"client/src/components/ui/popover.tsx":{"content":"import * as React from \"react\"\nimport * as PopoverPrimitive from \"@radix-ui/react-popover\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Popover = PopoverPrimitive.Root\n\nconst PopoverTrigger = PopoverPrimitive.Trigger\n\nconst PopoverContent = React.forwardRef<\n  React.ElementRef<typeof PopoverPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof PopoverPrimitive.Content>\n>(({ className, align = \"center\", sideOffset = 4, ...props }, ref) => (\n  <PopoverPrimitive.Portal>\n    <PopoverPrimitive.Content\n      ref={ref}\n      align={align}\n      sideOffset={sideOffset}\n      className={cn(\n        \"z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-popover-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </PopoverPrimitive.Portal>\n))\nPopoverContent.displayName = PopoverPrimitive.Content.displayName\n\nexport { Popover, PopoverTrigger, PopoverContent }\n","path":null,"size_bytes":1280,"size_tokens":null},"client/src/components/ui/progress.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as ProgressPrimitive from \"@radix-ui/react-progress\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Progress = React.forwardRef<\n  React.ElementRef<typeof ProgressPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ProgressPrimitive.Root>\n>(({ className, value, ...props }, ref) => (\n  <ProgressPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative h-4 w-full overflow-hidden rounded-full bg-secondary\",\n      className\n    )}\n    {...props}\n  >\n    <ProgressPrimitive.Indicator\n      className=\"h-full w-full flex-1 bg-primary transition-all\"\n      style={{ transform: `translateX(-${100 - (value || 0)}%)` }}\n    />\n  </ProgressPrimitive.Root>\n))\nProgress.displayName = ProgressPrimitive.Root.displayName\n\nexport { Progress }\n","path":null,"size_bytes":791,"size_tokens":null},"client/src/components/ui/input-otp.tsx":{"content":"import * as React from \"react\"\nimport { OTPInput, OTPInputContext } from \"input-otp\"\nimport { Dot } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst InputOTP = React.forwardRef<\n  React.ElementRef<typeof OTPInput>,\n  React.ComponentPropsWithoutRef<typeof OTPInput>\n>(({ className, containerClassName, ...props }, ref) => (\n  <OTPInput\n    ref={ref}\n    containerClassName={cn(\n      \"flex items-center gap-2 has-[:disabled]:opacity-50\",\n      containerClassName\n    )}\n    className={cn(\"disabled:cursor-not-allowed\", className)}\n    {...props}\n  />\n))\nInputOTP.displayName = \"InputOTP\"\n\nconst InputOTPGroup = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\">\n>(({ className, ...props }, ref) => (\n  <div ref={ref} className={cn(\"flex items-center\", className)} {...props} />\n))\nInputOTPGroup.displayName = \"InputOTPGroup\"\n\nconst InputOTPSlot = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\"> & { index: number }\n>(({ index, className, ...props }, ref) => {\n  const inputOTPContext = React.useContext(OTPInputContext)\n  const { char, hasFakeCaret, isActive } = inputOTPContext.slots[index]\n\n  return (\n    <div\n      ref={ref}\n      className={cn(\n        \"relative flex h-10 w-10 items-center justify-center border-y border-r border-input text-sm transition-all first:rounded-l-md first:border-l last:rounded-r-md\",\n        isActive && \"z-10 ring-2 ring-ring ring-offset-background\",\n        className\n      )}\n      {...props}\n    >\n      {char}\n      {hasFakeCaret && (\n        <div className=\"pointer-events-none absolute inset-0 flex items-center justify-center\">\n          <div className=\"h-4 w-px animate-caret-blink bg-foreground duration-1000\" />\n        </div>\n      )}\n    </div>\n  )\n})\nInputOTPSlot.displayName = \"InputOTPSlot\"\n\nconst InputOTPSeparator = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\">\n>(({ ...props }, ref) => (\n  <div ref={ref} role=\"separator\" {...props}>\n    <Dot />\n  </div>\n))\nInputOTPSeparator.displayName = \"InputOTPSeparator\"\n\nexport { InputOTP, InputOTPGroup, InputOTPSlot, InputOTPSeparator }\n","path":null,"size_bytes":2154,"size_tokens":null},"client/src/components/ui/select.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as SelectPrimitive from \"@radix-ui/react-select\"\nimport { Check, ChevronDown, ChevronUp } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Select = SelectPrimitive.Root\n\nconst SelectGroup = SelectPrimitive.Group\n\nconst SelectValue = SelectPrimitive.Value\n\nconst SelectTrigger = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <SelectPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"flex h-9 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background data-[placeholder]:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <SelectPrimitive.Icon asChild>\n      <ChevronDown className=\"h-4 w-4 opacity-50\" />\n    </SelectPrimitive.Icon>\n  </SelectPrimitive.Trigger>\n))\nSelectTrigger.displayName = SelectPrimitive.Trigger.displayName\n\nconst SelectScrollUpButton = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.ScrollUpButton>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollUpButton>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.ScrollUpButton\n    ref={ref}\n    className={cn(\n      \"flex cursor-default items-center justify-center py-1\",\n      className\n    )}\n    {...props}\n  >\n    <ChevronUp className=\"h-4 w-4\" />\n  </SelectPrimitive.ScrollUpButton>\n))\nSelectScrollUpButton.displayName = SelectPrimitive.ScrollUpButton.displayName\n\nconst SelectScrollDownButton = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.ScrollDownButton>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollDownButton>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.ScrollDownButton\n    ref={ref}\n    className={cn(\n      \"flex cursor-default items-center justify-center py-1\",\n      className\n    )}\n    {...props}\n  >\n    <ChevronDown className=\"h-4 w-4\" />\n  </SelectPrimitive.ScrollDownButton>\n))\nSelectScrollDownButton.displayName =\n  SelectPrimitive.ScrollDownButton.displayName\n\nconst SelectContent = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Content>\n>(({ className, children, position = \"popper\", ...props }, ref) => (\n  <SelectPrimitive.Portal>\n    <SelectPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"relative z-50 max-h-[--radix-select-content-available-height] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-select-content-transform-origin]\",\n        position === \"popper\" &&\n          \"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1\",\n        className\n      )}\n      position={position}\n      {...props}\n    >\n      <SelectScrollUpButton />\n      <SelectPrimitive.Viewport\n        className={cn(\n          \"p-1\",\n          position === \"popper\" &&\n            \"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]\"\n        )}\n      >\n        {children}\n      </SelectPrimitive.Viewport>\n      <SelectScrollDownButton />\n    </SelectPrimitive.Content>\n  </SelectPrimitive.Portal>\n))\nSelectContent.displayName = SelectPrimitive.Content.displayName\n\nconst SelectLabel = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Label>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.Label\n    ref={ref}\n    className={cn(\"py-1.5 pl-8 pr-2 text-sm font-semibold\", className)}\n    {...props}\n  />\n))\nSelectLabel.displayName = SelectPrimitive.Label.displayName\n\nconst SelectItem = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Item>\n>(({ className, children, ...props }, ref) => (\n  <SelectPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <SelectPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </SelectPrimitive.ItemIndicator>\n    </span>\n\n    <SelectPrimitive.ItemText>{children}</SelectPrimitive.ItemText>\n  </SelectPrimitive.Item>\n))\nSelectItem.displayName = SelectPrimitive.Item.displayName\n\nconst SelectSeparator = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nSelectSeparator.displayName = SelectPrimitive.Separator.displayName\n\nexport {\n  Select,\n  SelectGroup,\n  SelectValue,\n  SelectTrigger,\n  SelectContent,\n  SelectLabel,\n  SelectItem,\n  SelectSeparator,\n  SelectScrollUpButton,\n  SelectScrollDownButton,\n}\n","path":null,"size_bytes":5741,"size_tokens":null},"client/src/components/PerformanceMetrics.tsx":{"content":"import { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Trophy, Clock, Globe, Activity, Heart, MapPin } from \"lucide-react\";\nimport type { Player } from \"@/lib/types\";\n\ninterface PerformanceMetricsProps {\n  player: Player;\n}\n\nexport default function PerformanceMetrics({ player }: PerformanceMetricsProps) {\n  const metrics = [\n    { \n      label: \"National Team Caps\", \n      value: player.nationalTeamCaps, \n      icon: Trophy,\n      description: player.nationalTeamDebut \n        ? `Debut: ${new Date(player.nationalTeamDebut).toLocaleDateString()}`\n        : \"No debut recorded\"\n    },\n    { \n      label: \"Continental Games\", \n      value: player.continentalGames, \n      icon: Globe,\n      description: \"CAF/CONMEBOL/AFC competitions\"\n    },\n    { \n      label: \"Season Minutes\", \n      value: player.currentSeasonMinutes.toLocaleString(), \n      icon: Clock,\n      description: `${player.currentLeague}`\n    },\n    { \n      label: \"Career Minutes\", \n      value: player.totalCareerMinutes.toLocaleString(), \n      icon: Activity,\n      description: \"Total professional minutes\"\n    },\n    { \n      label: \"Medical Data\", \n      value: player.medicalDataAvailable ? \"Available\" : \"Unavailable\", \n      icon: Heart,\n      description: \"Biometric verification\"\n    },\n    { \n      label: \"GPS Data\", \n      value: player.gpsDataAvailable ? \"Available\" : \"Unavailable\", \n      icon: MapPin,\n      description: \"Performance tracking\"\n    },\n  ];\n\n  return (\n    <Card data-testid=\"card-performance-metrics\">\n      <CardHeader className=\"pb-4\">\n        <CardTitle className=\"text-lg\">Performance Data</CardTitle>\n      </CardHeader>\n      <CardContent>\n        <div className=\"grid grid-cols-2 md:grid-cols-3 gap-4\">\n          {metrics.map((metric) => (\n            <div \n              key={metric.label} \n              className=\"p-4 bg-muted/50 rounded-md space-y-1\"\n              data-testid={`metric-${metric.label.toLowerCase().replace(/\\s+/g, \"-\")}`}\n            >\n              <div className=\"flex items-center gap-2\">\n                <metric.icon className=\"h-4 w-4 text-muted-foreground\" />\n                <span className=\"text-xs font-medium text-muted-foreground uppercase tracking-wide\">\n                  {metric.label}\n                </span>\n              </div>\n              <p className=\"text-xl font-semibold\">{metric.value}</p>\n              <p className=\"text-xs text-muted-foreground\">{metric.description}</p>\n            </div>\n          ))}\n        </div>\n      </CardContent>\n    </Card>\n  );\n}\n","path":null,"size_bytes":2557,"size_tokens":null},"server/replit_integrations/auth/index.ts":{"content":"export { setupAuth, isAuthenticated, getSession } from \"./replitAuth\";\nexport { authStorage, type IAuthStorage } from \"./storage\";\nexport { registerAuthRoutes } from \"./routes\";\n","path":null,"size_bytes":178,"size_tokens":null},"client/src/pages/videos.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport VideoUpload from \"@/components/VideoUpload\";\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Checkbox } from \"@/components/ui/checkbox\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Dialog, DialogContent, DialogDescription, DialogHeader, DialogTitle, DialogFooter } from \"@/components/ui/dialog\";\nimport { Separator } from \"@/components/ui/separator\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { Label } from \"@/components/ui/label\";\nimport { ScrollArea } from \"@/components/ui/scroll-area\";\nimport { queryClient, apiRequest } from \"@/lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { LoadingSpinner } from \"@/components/LoadingScreen\";\nimport { \n  Search, Video, Play, Calendar, FileText, Link2, Sparkles, BarChart2, \n  Activity, TrendingUp, UserPlus, Users, Clock, Trash2, Target, Award,\n  Edit2, Eye, UsersRound, X\n} from \"lucide-react\";\nimport type { Video as VideoType, VideoInsights, Player, VideoPlayerTag } from \"@shared/schema\";\n\ninterface VideoWithInsights extends VideoType {\n  insights?: VideoInsights;\n}\n\nconst POSITIONS = [\n  \"Goalkeeper\",\n  \"Center Back\",\n  \"Right Back\",\n  \"Left Back\",\n  \"Defensive Midfielder\",\n  \"Central Midfielder\",\n  \"Attacking Midfielder\",\n  \"Right Winger\",\n  \"Left Winger\",\n  \"Striker\",\n  \"Forward\",\n];\n\nexport default function Videos() {\n  const [searchQuery, setSearchQuery] = useState(\"\");\n  const [sourceFilter, setSourceFilter] = useState(\"all\");\n  const [selectedVideo, setSelectedVideo] = useState<VideoWithInsights | null>(null);\n  const [isAnalysisDialogOpen, setIsAnalysisDialogOpen] = useState(false);\n  const [isTagPlayerDialogOpen, setIsTagPlayerDialogOpen] = useState(false);\n  const [isVideoPlayerOpen, setIsVideoPlayerOpen] = useState(false);\n  const [isTeamSheetOpen, setIsTeamSheetOpen] = useState(false);\n  const [selectedPlayerId, setSelectedPlayerId] = useState(\"\");\n  const [tagMinutes, setTagMinutes] = useState(\"90\");\n  const [tagPosition, setTagPosition] = useState(\"\");\n  const [teamSheetPlayers, setTeamSheetPlayers] = useState<string[]>([]);\n  const [teamSheetDefaultMinutes, setTeamSheetDefaultMinutes] = useState(\"90\");\n  const { toast } = useToast();\n\n  const { data: videos = [], isLoading } = useQuery<VideoWithInsights[]>({\n    queryKey: [\"/api/videos\"],\n  });\n\n  const { data: players = [] } = useQuery<Player[]>({\n    queryKey: [\"/api/players\"],\n  });\n\n  const { data: playerTags = [], refetch: refetchTags } = useQuery<VideoPlayerTag[]>({\n    queryKey: [\"/api/videos\", selectedVideo?.id, \"player-tags\"],\n    enabled: !!selectedVideo?.id,\n    queryFn: async () => {\n      if (!selectedVideo?.id) return [];\n      const res = await fetch(`/api/videos/${selectedVideo.id}/player-tags`);\n      return res.json();\n    },\n  });\n\n  const analyzeVideoMutation = useMutation({\n    mutationFn: async (videoId: string) => {\n      const response = await apiRequest(\"POST\", `/api/videos/${videoId}/analyze`, {});\n      const data = await response.json();\n      if (!response.ok) {\n        throw new Error(data.needsTokens ? `Insufficient tokens. ${data.error}` : data.error);\n      }\n      return data;\n    },\n    onSuccess: (data: any) => {\n      toast({\n        title: \"Analysis Complete\",\n        description: \"AI has analyzed the video and generated performance insights. 8 tokens spent.\",\n      });\n      queryClient.invalidateQueries({ queryKey: [\"/api/videos\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/tokens/balance\"] });\n      setSelectedVideo(prev => prev ? { ...prev, insights: data.insights } : null);\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Analysis Failed\",\n        description: error.message || \"Failed to analyze video\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const uploadVideoMutation = useMutation({\n    mutationFn: async (videoData: {\n      title: string;\n      matchDate?: string;\n      source: string;\n      playerId: string;\n      competition?: string;\n      opponent?: string;\n      duration?: string;\n      minutesPlayed?: number;\n      fileUrl?: string;\n    }) => {\n      const response = await apiRequest(\"POST\", \"/api/videos\", videoData);\n      return await response.json();\n    },\n    onSuccess: (newVideo: VideoType) => {\n      toast({\n        title: \"Video Saved\",\n        description: \"Video has been saved to the database. You can now tag players.\",\n      });\n      queryClient.invalidateQueries({ queryKey: [\"/api/videos\"] });\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Upload Failed\",\n        description: error.message || \"Failed to save video\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const tagPlayerMutation = useMutation({\n    mutationFn: async ({ videoId, playerId, minutesPlayed, position }: { \n      videoId: string; \n      playerId: string; \n      minutesPlayed: number;\n      position: string;\n    }) => {\n      const response = await apiRequest(\"POST\", `/api/videos/${videoId}/player-tags`, {\n        playerId,\n        minutesPlayed,\n        position,\n      });\n      return await response.json();\n    },\n    onSuccess: () => {\n      toast({\n        title: \"Player Tagged\",\n        description: \"Player has been tagged to this video with their minutes played.\",\n      });\n      refetchTags();\n      setSelectedPlayerId(\"\");\n      setTagMinutes(\"90\");\n      setTagPosition(\"\");\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Tagging Failed\",\n        description: error.message || \"Failed to tag player\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const analyzePlayerTagMutation = useMutation({\n    mutationFn: async (tagId: string) => {\n      const response = await apiRequest(\"POST\", `/api/video-player-tags/${tagId}/analyze`, {});\n      return await response.json();\n    },\n    onSuccess: () => {\n      toast({\n        title: \"Player Analysis Complete\",\n        description: \"AI has analyzed this player's performance based on their position.\",\n      });\n      refetchTags();\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Analysis Failed\",\n        description: error.message || \"Failed to analyze player\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const deleteTagMutation = useMutation({\n    mutationFn: async (tagId: string) => {\n      await apiRequest(\"DELETE\", `/api/video-player-tags/${tagId}`, {});\n    },\n    onSuccess: () => {\n      toast({\n        title: \"Tag Removed\",\n        description: \"Player tag has been removed from this video.\",\n      });\n      refetchTags();\n    },\n  });\n\n  const batchTagPlayersMutation = useMutation({\n    mutationFn: async ({ videoId, playerIds, defaultMinutes }: { \n      videoId: string; \n      playerIds: string[]; \n      defaultMinutes: number;\n    }) => {\n      const results = [];\n      for (const playerId of playerIds) {\n        const player = players.find(p => p.id === playerId);\n        const response = await apiRequest(\"POST\", `/api/videos/${videoId}/player-tags`, {\n          playerId,\n          minutesPlayed: defaultMinutes,\n          position: player?.position || \"\",\n        });\n        results.push(await response.json());\n      }\n      return results;\n    },\n    onSuccess: (data) => {\n      toast({\n        title: \"Team Sheet Applied\",\n        description: `${data.length} players have been tagged to this video.`,\n      });\n      refetchTags();\n      setIsTeamSheetOpen(false);\n      setTeamSheetPlayers([]);\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Batch Tagging Failed\",\n        description: error.message || \"Failed to apply team sheet\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const filteredVideos = videos.filter((v) => {\n    const matchesSearch = v.title?.toLowerCase().includes(searchQuery.toLowerCase());\n    const matchesSource = sourceFilter === \"all\" || v.source === sourceFilter;\n    return matchesSearch && matchesSource;\n  });\n\n  const sourceColors: Record<string, string> = {\n    manual: \"bg-gray-100 text-gray-800 dark:bg-gray-800 dark:text-gray-300\",\n    wyscout: \"bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-400\",\n    transfermarkt: \"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400\",\n    veo: \"bg-purple-100 text-purple-800 dark:bg-purple-900/30 dark:text-purple-400\",\n  };\n\n  const handleAnalyzeVideo = (video: VideoWithInsights) => {\n    setSelectedVideo(video);\n    setIsAnalysisDialogOpen(true);\n    if (!video.insights) {\n      analyzeVideoMutation.mutate(video.id);\n    }\n  };\n\n  const handleOpenTagDialog = (video: VideoWithInsights) => {\n    setSelectedVideo(video);\n    setIsTagPlayerDialogOpen(true);\n  };\n\n  const handleTagPlayer = () => {\n    if (!selectedVideo || !selectedPlayerId) return;\n    tagPlayerMutation.mutate({\n      videoId: selectedVideo.id,\n      playerId: selectedPlayerId,\n      minutesPlayed: parseInt(tagMinutes) || 90,\n      position: tagPosition,\n    });\n  };\n\n  const handleOpenVideoPlayer = (video: VideoWithInsights) => {\n    setSelectedVideo(video);\n    setIsVideoPlayerOpen(true);\n  };\n\n  const handleOpenTeamSheet = (video: VideoWithInsights) => {\n    setSelectedVideo(video);\n    setTeamSheetPlayers([]);\n    setIsTeamSheetOpen(true);\n  };\n\n  const handleToggleTeamSheetPlayer = (playerId: string) => {\n    const alreadyTagged = playerTags.some(tag => tag.playerId === playerId);\n    if (alreadyTagged) return;\n    \n    setTeamSheetPlayers(prev => \n      prev.includes(playerId) \n        ? prev.filter(id => id !== playerId)\n        : prev.length < 15 - playerTags.length \n          ? [...prev, playerId]\n          : prev\n    );\n  };\n\n  const handleApplyTeamSheet = () => {\n    if (!selectedVideo || teamSheetPlayers.length === 0) return;\n    batchTagPlayersMutation.mutate({\n      videoId: selectedVideo.id,\n      playerIds: teamSheetPlayers,\n      defaultMinutes: parseInt(teamSheetDefaultMinutes) || 90,\n    });\n  };\n\n  const getPlayerName = (playerId: string) => {\n    const player = players.find(p => p.id === playerId);\n    return player ? `${player.firstName} ${player.lastName}` : \"Unknown Player\";\n  };\n\n  const getPlayerPosition = (playerId: string) => {\n    const player = players.find(p => p.id === playerId);\n    return player?.position || \"Unknown\";\n  };\n\n  if (isLoading) {\n    return (\n      <div className=\"flex items-center justify-center h-full\">\n        <LoadingSpinner size=\"lg\" />\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"p-6 space-y-6\" data-testid=\"page-videos\">\n      <div className=\"flex flex-wrap items-center justify-between gap-4\">\n        <div>\n          <h1 className=\"text-2xl font-semibold\">Video Management</h1>\n          <p className=\"text-muted-foreground\">Upload videos, tag players, and analyze positional performance</p>\n        </div>\n      </div>\n\n      <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-6\">\n        <div className=\"lg:col-span-1 space-y-4\">\n          <VideoUpload\n            players={players}\n            onUpload={(data) => uploadVideoMutation.mutate(data)}\n            onIntegrationConnect={(source) => {\n              toast({\n                title: \"Integration\",\n                description: `Connect to ${source} coming soon!`,\n              });\n            }}\n            isUploading={uploadVideoMutation.isPending}\n          />\n          \n          <Card>\n            <CardHeader className=\"pb-3\">\n              <CardTitle className=\"text-base flex items-center gap-2\">\n                <Users className=\"h-4 w-4 text-primary\" />\n                Multi-Player Tagging\n              </CardTitle>\n              <CardDescription className=\"text-sm\">\n                Tag multiple players per video\n              </CardDescription>\n            </CardHeader>\n            <CardContent className=\"space-y-3 text-sm\">\n              <div className=\"flex items-start gap-2\">\n                <UserPlus className=\"h-4 w-4 text-muted-foreground mt-0.5\" />\n                <p className=\"text-muted-foreground\">Tag registered players to each video</p>\n              </div>\n              <div className=\"flex items-start gap-2\">\n                <Clock className=\"h-4 w-4 text-muted-foreground mt-0.5\" />\n                <p className=\"text-muted-foreground\">Track minutes played per player</p>\n              </div>\n              <div className=\"flex items-start gap-2\">\n                <Target className=\"h-4 w-4 text-muted-foreground mt-0.5\" />\n                <p className=\"text-muted-foreground\">Position-specific AI analysis</p>\n              </div>\n            </CardContent>\n          </Card>\n\n          <Card>\n            <CardHeader className=\"pb-3\">\n              <CardTitle className=\"text-base flex items-center gap-2\">\n                <Sparkles className=\"h-4 w-4 text-primary\" />\n                Positional Analysis\n              </CardTitle>\n              <CardDescription className=\"text-sm\">\n                AI metrics based on playing position\n              </CardDescription>\n            </CardHeader>\n            <CardContent className=\"space-y-3 text-sm\">\n              <div className=\"flex items-start gap-2\">\n                <BarChart2 className=\"h-4 w-4 text-muted-foreground mt-0.5\" />\n                <p className=\"text-muted-foreground\">Goalkeeper: saves, distribution, clean sheets</p>\n              </div>\n              <div className=\"flex items-start gap-2\">\n                <Activity className=\"h-4 w-4 text-muted-foreground mt-0.5\" />\n                <p className=\"text-muted-foreground\">Defenders: tackles, interceptions, duels</p>\n              </div>\n              <div className=\"flex items-start gap-2\">\n                <TrendingUp className=\"h-4 w-4 text-muted-foreground mt-0.5\" />\n                <p className=\"text-muted-foreground\">Forwards: shots, goals, xG metrics</p>\n              </div>\n            </CardContent>\n          </Card>\n        </div>\n\n        <div className=\"lg:col-span-2\">\n          <Card>\n            <CardHeader className=\"pb-4\">\n              <div className=\"flex flex-wrap items-center justify-between gap-4\">\n                <CardTitle className=\"text-lg\">Video Library</CardTitle>\n                <div className=\"flex flex-wrap items-center gap-4\">\n                  <div className=\"relative\">\n                    <Search className=\"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground\" />\n                    <Input\n                      placeholder=\"Search videos...\"\n                      value={searchQuery}\n                      onChange={(e) => setSearchQuery(e.target.value)}\n                      className=\"pl-9 w-48\"\n                      data-testid=\"input-search-videos\"\n                    />\n                  </div>\n                  <Select value={sourceFilter} onValueChange={setSourceFilter}>\n                    <SelectTrigger className=\"w-36\" data-testid=\"select-source-filter\">\n                      <SelectValue placeholder=\"Source\" />\n                    </SelectTrigger>\n                    <SelectContent>\n                      <SelectItem value=\"all\">All Sources</SelectItem>\n                      <SelectItem value=\"manual\">Manual</SelectItem>\n                      <SelectItem value=\"wyscout\">Wyscout</SelectItem>\n                      <SelectItem value=\"transfermarkt\">Transfermarkt</SelectItem>\n                      <SelectItem value=\"veo\">Veo</SelectItem>\n                    </SelectContent>\n                  </Select>\n                </div>\n              </div>\n            </CardHeader>\n            <CardContent>\n              {filteredVideos.length === 0 ? (\n                <div className=\"text-center py-12 text-muted-foreground\">\n                  <Video className=\"h-12 w-12 mx-auto mb-4 opacity-50\" />\n                  <p>No videos found</p>\n                  <p className=\"text-sm mt-1\">Upload videos to tag players and analyze performance</p>\n                </div>\n              ) : (\n                <div className=\"space-y-4\">\n                  {filteredVideos.map((video) => (\n                    <div\n                      key={video.id}\n                      className=\"flex items-start gap-4 p-4 bg-muted/50 rounded-md hover-elevate\"\n                      data-testid={`video-card-${video.id}`}\n                    >\n                      <div \n                        className=\"relative bg-muted rounded-md w-32 h-20 flex items-center justify-center shrink-0 cursor-pointer\"\n                        onClick={() => handleOpenVideoPlayer(video)}\n                      >\n                        <Video className=\"h-8 w-8 text-muted-foreground\" />\n                        <Button\n                          size=\"icon\"\n                          variant=\"secondary\"\n                          className=\"absolute inset-0 m-auto w-10 h-10 rounded-full opacity-80\"\n                          data-testid={`button-play-${video.id}`}\n                        >\n                          <Play className=\"h-4 w-4\" />\n                        </Button>\n                      </div>\n                      <div className=\"flex-1 min-w-0 space-y-2\">\n                        <div className=\"flex flex-wrap items-start justify-between gap-2\">\n                          <div>\n                            <h3 className=\"font-medium truncate\">{video.title}</h3>\n                            <p className=\"text-sm text-muted-foreground\">\n                              {video.competition || \"Match footage\"} {video.opponent && `vs ${video.opponent}`}\n                            </p>\n                          </div>\n                          <div className=\"flex items-center gap-2\">\n                            {video.insights && (\n                              <Badge variant=\"secondary\" className=\"bg-green-500/10 text-green-600\">\n                                <Sparkles className=\"h-3 w-3 mr-1\" />\n                                Analyzed\n                              </Badge>\n                            )}\n                            <Badge variant=\"secondary\" className={sourceColors[video.source || \"manual\"]}>\n                              <Link2 className=\"h-3 w-3 mr-1\" />\n                              {video.source || \"manual\"}\n                            </Badge>\n                          </div>\n                        </div>\n                        <div className=\"flex flex-wrap items-center gap-4 text-xs text-muted-foreground\">\n                          <span className=\"flex items-center gap-1\">\n                            <Calendar className=\"h-3 w-3\" />\n                            {video.uploadDate ? new Date(video.uploadDate).toLocaleDateString() : \"Unknown date\"}\n                          </span>\n                          <span>{video.duration || \"Unknown duration\"}</span>\n                          {video.minutesPlayed && (\n                            <span className=\"flex items-center gap-1\">\n                              <Clock className=\"h-3 w-3\" />\n                              {video.minutesPlayed} min\n                            </span>\n                          )}\n                        </div>\n                        <div className=\"flex flex-wrap gap-2 pt-1\">\n                          <Button \n                            size=\"sm\" \n                            variant=\"outline\"\n                            onClick={() => handleOpenVideoPlayer(video)}\n                            data-testid={`button-watch-${video.id}`}\n                          >\n                            <Eye className=\"h-3 w-3 mr-1\" />\n                            Watch\n                          </Button>\n                          <Button \n                            size=\"sm\" \n                            variant=\"outline\"\n                            onClick={() => handleOpenTagDialog(video)}\n                            data-testid={`button-tag-players-${video.id}`}\n                          >\n                            <Users className=\"h-3 w-3 mr-1\" />\n                            Tag Players\n                          </Button>\n                          <Button \n                            size=\"sm\" \n                            variant=\"outline\"\n                            onClick={() => handleOpenTeamSheet(video)}\n                            data-testid={`button-team-sheet-${video.id}`}\n                          >\n                            <UsersRound className=\"h-3 w-3 mr-1\" />\n                            Team Sheet\n                          </Button>\n                          <Button \n                            size=\"sm\" \n                            variant=\"outline\"\n                            onClick={() => handleAnalyzeVideo(video)}\n                            data-testid={`button-analyze-${video.id}`}\n                          >\n                            <Sparkles className=\"h-3 w-3 mr-1\" />\n                            {video.insights ? \"View Analysis\" : \"Analyze\"}\n                          </Button>\n                        </div>\n                      </div>\n                    </div>\n                  ))}\n                </div>\n              )}\n            </CardContent>\n          </Card>\n        </div>\n      </div>\n\n      <Dialog open={isTagPlayerDialogOpen} onOpenChange={setIsTagPlayerDialogOpen}>\n        <DialogContent className=\"max-w-3xl max-h-[85vh]\">\n          <DialogHeader>\n            <DialogTitle className=\"flex items-center gap-2\">\n              <Users className=\"h-5 w-5 text-primary\" />\n              Tag Players to Video\n            </DialogTitle>\n            <DialogDescription className=\"flex items-center justify-between\">\n              <span>{selectedVideo?.title || \"Select players who appear in this video\"}</span>\n              <Badge variant={playerTags.length >= 15 ? \"destructive\" : \"secondary\"}>\n                {playerTags.length}/15 players\n              </Badge>\n            </DialogDescription>\n          </DialogHeader>\n\n          <Tabs defaultValue=\"tag\" className=\"mt-4\">\n            <TabsList className=\"grid w-full grid-cols-2\">\n              <TabsTrigger value=\"tag\" data-testid=\"tab-tag-player\">Tag New Player</TabsTrigger>\n              <TabsTrigger value=\"tagged\" data-testid=\"tab-tagged-players\">Tagged Players ({playerTags.length})</TabsTrigger>\n            </TabsList>\n\n            <TabsContent value=\"tag\" className=\"space-y-4 mt-4\">\n              {playerTags.length >= 15 ? (\n                <div className=\"text-center py-8 text-muted-foreground\">\n                  <Users className=\"h-12 w-12 mx-auto mb-4 text-destructive opacity-50\" />\n                  <p className=\"font-medium text-destructive\">Maximum players reached</p>\n                  <p className=\"text-sm mt-1\">You can tag up to 15 players per video</p>\n                </div>\n              ) : (\n              <div className=\"space-y-4\">\n                <div className=\"space-y-2\">\n                  <Label>Select Player</Label>\n                  <Select value={selectedPlayerId} onValueChange={setSelectedPlayerId}>\n                    <SelectTrigger data-testid=\"select-player\">\n                      <SelectValue placeholder=\"Choose a player to tag\" />\n                    </SelectTrigger>\n                    <SelectContent>\n                      {players\n                        .filter(player => !playerTags.some(tag => tag.playerId === player.id))\n                        .map((player) => (\n                        <SelectItem key={player.id} value={player.id}>\n                          {player.firstName} {player.lastName} - {player.position}\n                        </SelectItem>\n                      ))}\n                    </SelectContent>\n                  </Select>\n                </div>\n\n                <div className=\"grid grid-cols-2 gap-4\">\n                  <div className=\"space-y-2\">\n                    <Label>Minutes Played</Label>\n                    <Input\n                      type=\"number\"\n                      min=\"0\"\n                      max=\"120\"\n                      value={tagMinutes}\n                      onChange={(e) => setTagMinutes(e.target.value)}\n                      placeholder=\"90\"\n                      data-testid=\"input-minutes-played\"\n                    />\n                  </div>\n                  <div className=\"space-y-2\">\n                    <Label>Position in Match</Label>\n                    <Select value={tagPosition} onValueChange={setTagPosition}>\n                      <SelectTrigger data-testid=\"select-position\">\n                        <SelectValue placeholder=\"Select position\" />\n                      </SelectTrigger>\n                      <SelectContent>\n                        {POSITIONS.map((pos) => (\n                          <SelectItem key={pos} value={pos}>{pos}</SelectItem>\n                        ))}\n                      </SelectContent>\n                    </Select>\n                  </div>\n                </div>\n\n                <Button \n                  onClick={handleTagPlayer} \n                  disabled={!selectedPlayerId || tagPlayerMutation.isPending}\n                  className=\"w-full\"\n                  data-testid=\"button-confirm-tag\"\n                >\n                  {tagPlayerMutation.isPending ? (\n                    <>\n                      <LoadingSpinner size=\"sm\" />\n                      <span className=\"ml-2\">Tagging...</span>\n                    </>\n                  ) : (\n                    <>\n                      <UserPlus className=\"h-4 w-4 mr-2\" />\n                      Tag Player to Video\n                    </>\n                  )}\n                </Button>\n              </div>\n              )}\n            </TabsContent>\n\n            <TabsContent value=\"tagged\" className=\"mt-4\">\n              <ScrollArea className=\"h-[400px]\">\n                {playerTags.length === 0 ? (\n                  <div className=\"text-center py-12 text-muted-foreground\">\n                    <Users className=\"h-12 w-12 mx-auto mb-4 opacity-50\" />\n                    <p>No players tagged yet</p>\n                    <p className=\"text-sm mt-1\">Tag players to analyze their performance</p>\n                  </div>\n                ) : (\n                  <div className=\"space-y-3\">\n                    {playerTags.map((tag) => (\n                      <Card key={tag.id} className=\"p-4\">\n                        <div className=\"flex items-start justify-between gap-4\">\n                          <div className=\"flex-1 space-y-2\">\n                            <div className=\"flex items-center gap-2\">\n                              <h4 className=\"font-medium\">{getPlayerName(tag.playerId)}</h4>\n                              <Badge variant=\"outline\">{tag.position || getPlayerPosition(tag.playerId)}</Badge>\n                              {tag.analyzed && (\n                                <Badge variant=\"secondary\" className=\"bg-green-500/10 text-green-600\">\n                                  <Sparkles className=\"h-3 w-3 mr-1\" />\n                                  Analyzed\n                                </Badge>\n                              )}\n                            </div>\n                            <div className=\"flex flex-wrap gap-4 text-sm text-muted-foreground\">\n                              <span className=\"flex items-center gap-1\">\n                                <Clock className=\"h-3 w-3\" />\n                                {tag.minutesPlayed || 0} minutes\n                              </span>\n                              {tag.performanceRating && (\n                                <span className=\"flex items-center gap-1\">\n                                  <Award className=\"h-3 w-3\" />\n                                  Rating: {tag.performanceRating.toFixed(1)}/10\n                                </span>\n                              )}\n                              {tag.goals !== null && tag.goals > 0 && (\n                                <span>Goals: {tag.goals}</span>\n                              )}\n                              {tag.assists !== null && tag.assists > 0 && (\n                                <span>Assists: {tag.assists}</span>\n                              )}\n                            </div>\n                            {tag.aiAnalysis && (\n                              <p className=\"text-sm text-muted-foreground bg-muted/50 p-2 rounded-md mt-2\">\n                                {tag.aiAnalysis}\n                              </p>\n                            )}\n                            {(() => {\n                              const moments = tag.keyMoments as Array<{minute: number; type: string; description: string}> | null;\n                              if (!moments || !Array.isArray(moments) || moments.length === 0) return null;\n                              return (\n                                <div className=\"mt-3 space-y-2\">\n                                  <p className=\"text-xs font-medium text-muted-foreground uppercase tracking-wide\">Key Moments</p>\n                                  <div className=\"flex flex-wrap gap-2\">\n                                    {moments.slice(0, 5).map((moment, idx) => (\n                                      <Badge \n                                        key={idx} \n                                        variant=\"outline\" \n                                        className=\"text-xs\"\n                                      >\n                                        <Clock className=\"h-3 w-3 mr-1\" />\n                                        {String(moment.minute)}&apos; - {String(moment.type).replace(/_/g, ' ')}\n                                      </Badge>\n                                    ))}\n                                  </div>\n                                </div>\n                              );\n                            })()}\n                            {(() => {\n                              const strengths = tag.strengths as string[] | null;\n                              if (!strengths || !Array.isArray(strengths) || strengths.length === 0) return null;\n                              return (\n                                <div className=\"mt-2\">\n                                  <p className=\"text-xs font-medium text-green-600 dark:text-green-400\">Strengths: {strengths.slice(0, 3).join(', ')}</p>\n                                </div>\n                              );\n                            })()}\n                          </div>\n                          <div className=\"flex gap-2\">\n                            <Button\n                              size=\"sm\"\n                              variant=\"outline\"\n                              onClick={() => analyzePlayerTagMutation.mutate(tag.id)}\n                              disabled={analyzePlayerTagMutation.isPending}\n                              data-testid={`button-analyze-tag-${tag.id}`}\n                            >\n                              {analyzePlayerTagMutation.isPending ? (\n                                <LoadingSpinner size=\"sm\" />\n                              ) : (\n                                <>\n                                  <Sparkles className=\"h-3 w-3 mr-1\" />\n                                  {tag.analyzed ? \"Re-analyze\" : \"Analyze\"}\n                                </>\n                              )}\n                            </Button>\n                            <Button\n                              size=\"icon\"\n                              variant=\"ghost\"\n                              onClick={() => deleteTagMutation.mutate(tag.id)}\n                              data-testid={`button-delete-tag-${tag.id}`}\n                            >\n                              <Trash2 className=\"h-4 w-4 text-destructive\" />\n                            </Button>\n                          </div>\n                        </div>\n                      </Card>\n                    ))}\n                  </div>\n                )}\n              </ScrollArea>\n            </TabsContent>\n          </Tabs>\n\n          <DialogFooter>\n            <Button variant=\"outline\" onClick={() => setIsTagPlayerDialogOpen(false)}>\n              Close\n            </Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n\n      <Dialog open={isAnalysisDialogOpen} onOpenChange={setIsAnalysisDialogOpen}>\n        <DialogContent className=\"max-w-2xl\">\n          <DialogHeader>\n            <DialogTitle className=\"flex items-center gap-2\">\n              <Sparkles className=\"h-5 w-5 text-primary\" />\n              AI Video Analysis\n            </DialogTitle>\n            <DialogDescription>\n              {selectedVideo?.title || \"Video analysis results\"}\n            </DialogDescription>\n          </DialogHeader>\n          \n          {analyzeVideoMutation.isPending ? (\n            <div className=\"py-12 text-center\">\n              <LoadingSpinner size=\"lg\" />\n              <p className=\"mt-4 text-muted-foreground\">Analyzing video with AI...</p>\n              <p className=\"text-sm text-muted-foreground\">This may take a few moments</p>\n            </div>\n          ) : selectedVideo?.insights ? (\n            <div className=\"space-y-4\">\n              <div className=\"grid grid-cols-2 md:grid-cols-4 gap-4\">\n                <div className=\"p-3 rounded-md bg-muted/50 text-center\">\n                  <p className=\"text-2xl font-bold\">{selectedVideo.insights.minutesPlayed}</p>\n                  <p className=\"text-xs text-muted-foreground\">Minutes Played</p>\n                </div>\n                <div className=\"p-3 rounded-md bg-muted/50 text-center\">\n                  <p className=\"text-2xl font-bold\">{selectedVideo.insights.distanceCovered?.toFixed(1)}</p>\n                  <p className=\"text-xs text-muted-foreground\">Distance (km)</p>\n                </div>\n                <div className=\"p-3 rounded-md bg-muted/50 text-center\">\n                  <p className=\"text-2xl font-bold\">{selectedVideo.insights.sprintCount}</p>\n                  <p className=\"text-xs text-muted-foreground\">Sprints</p>\n                </div>\n                <div className=\"p-3 rounded-md bg-muted/50 text-center\">\n                  <p className=\"text-2xl font-bold\">\n                    {selectedVideo.insights.passesCompleted}/{selectedVideo.insights.passesAttempted}\n                  </p>\n                  <p className=\"text-xs text-muted-foreground\">Pass Accuracy</p>\n                </div>\n              </div>\n\n              <Separator />\n\n              <div className=\"grid grid-cols-3 gap-4\">\n                <div className=\"p-3 rounded-md bg-muted/50 text-center\">\n                  <p className=\"text-xl font-bold\">{selectedVideo.insights.shotsOnTarget}</p>\n                  <p className=\"text-xs text-muted-foreground\">Shots on Target</p>\n                </div>\n                <div className=\"p-3 rounded-md bg-muted/50 text-center\">\n                  <p className=\"text-xl font-bold\">{selectedVideo.insights.tackles}</p>\n                  <p className=\"text-xs text-muted-foreground\">Tackles</p>\n                </div>\n                <div className=\"p-3 rounded-md bg-muted/50 text-center\">\n                  <p className=\"text-xl font-bold\">{selectedVideo.insights.duelsWon}</p>\n                  <p className=\"text-xs text-muted-foreground\">Duels Won</p>\n                </div>\n              </div>\n\n              {selectedVideo.insights.aiAnalysis && (\n                <>\n                  <Separator />\n                  <div>\n                    <h4 className=\"font-medium mb-2 flex items-center gap-2\">\n                      <FileText className=\"h-4 w-4\" />\n                      AI Summary\n                    </h4>\n                    <p className=\"text-sm text-muted-foreground bg-muted/50 p-3 rounded-md\">\n                      {selectedVideo.insights.aiAnalysis}\n                    </p>\n                  </div>\n                </>\n              )}\n            </div>\n          ) : (\n            <div className=\"py-8 text-center text-muted-foreground\">\n              <p>Click analyze to generate AI insights</p>\n            </div>\n          )}\n\n          <DialogFooter>\n            <Button variant=\"outline\" onClick={() => setIsAnalysisDialogOpen(false)}>\n              Close\n            </Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n\n      <Dialog open={isVideoPlayerOpen} onOpenChange={setIsVideoPlayerOpen}>\n        <DialogContent className=\"max-w-4xl max-h-[90vh]\">\n          <DialogHeader className=\"flex flex-row items-center justify-between gap-4\">\n            <div>\n              <DialogTitle className=\"flex items-center gap-2\">\n                <Play className=\"h-5 w-5 text-primary\" />\n                Video Player\n              </DialogTitle>\n              <DialogDescription>\n                {selectedVideo?.title}\n              </DialogDescription>\n            </div>\n            <Button \n              size=\"icon\" \n              variant=\"ghost\" \n              onClick={() => setIsVideoPlayerOpen(false)}\n              data-testid=\"button-exit-video-player\"\n            >\n              <X className=\"h-5 w-5\" />\n            </Button>\n          </DialogHeader>\n          \n          <ScrollArea className=\"max-h-[calc(90vh-140px)]\">\n            <div className=\"space-y-4 pr-4\">\n              <div className=\"aspect-video bg-muted rounded-md flex items-center justify-center\">\n                {selectedVideo?.fileUrl ? (\n                  <video \n                    controls \n                    autoPlay\n                    className=\"w-full h-full rounded-md\"\n                    src={selectedVideo.fileUrl}\n                    data-testid=\"video-player\"\n                  >\n                    Your browser does not support the video tag.\n                  </video>\n                ) : (\n                  <div className=\"text-center text-muted-foreground\">\n                    <Video className=\"h-16 w-16 mx-auto mb-4 opacity-50\" />\n                    <p className=\"font-medium\">Video Preview</p>\n                    <p className=\"text-sm\">No video file uploaded yet</p>\n                    <p className=\"text-xs mt-2\">Video URL would appear here once uploaded</p>\n                  </div>\n                )}\n              </div>\n\n              <div className=\"grid grid-cols-2 md:grid-cols-3 gap-4 text-sm\">\n                <div className=\"p-3 bg-muted/50 rounded-md\">\n                  <p className=\"text-muted-foreground text-xs\">Competition</p>\n                  <p className=\"font-medium\">{selectedVideo?.competition || \"N/A\"}</p>\n                </div>\n                <div className=\"p-3 bg-muted/50 rounded-md\">\n                  <p className=\"text-muted-foreground text-xs\">Opponent</p>\n                  <p className=\"font-medium\">{selectedVideo?.opponent || \"N/A\"}</p>\n                </div>\n                <div className=\"p-3 bg-muted/50 rounded-md\">\n                  <p className=\"text-muted-foreground text-xs\">Duration</p>\n                  <p className=\"font-medium\">{selectedVideo?.duration || \"N/A\"}</p>\n                </div>\n              </div>\n\n              {selectedVideo && (\n                <div className=\"flex flex-wrap gap-2\">\n                  <Button \n                    variant=\"outline\" \n                    onClick={() => {\n                      setIsVideoPlayerOpen(false);\n                      handleOpenTagDialog(selectedVideo);\n                    }}\n                  >\n                    <Users className=\"h-4 w-4 mr-2\" />\n                    Tag Players\n                  </Button>\n                  <Button \n                    variant=\"outline\" \n                    onClick={() => {\n                      setIsVideoPlayerOpen(false);\n                      handleAnalyzeVideo(selectedVideo);\n                    }}\n                  >\n                    <Sparkles className=\"h-4 w-4 mr-2\" />\n                    Analyze Video\n                  </Button>\n                </div>\n              )}\n            </div>\n          </ScrollArea>\n\n          <DialogFooter>\n            <Button variant=\"default\" onClick={() => setIsVideoPlayerOpen(false)} data-testid=\"button-close-video-player\">\n              <X className=\"h-4 w-4 mr-2\" />\n              Exit\n            </Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n\n      <Dialog open={isTeamSheetOpen} onOpenChange={setIsTeamSheetOpen}>\n        <DialogContent className=\"max-w-2xl max-h-[85vh]\">\n          <DialogHeader>\n            <DialogTitle className=\"flex items-center gap-2\">\n              <UsersRound className=\"h-5 w-5 text-primary\" />\n              Attach Team Sheet\n            </DialogTitle>\n            <DialogDescription asChild>\n              <div className=\"flex items-center justify-between\">\n                <span>Select multiple players to tag at once: {selectedVideo?.title}</span>\n                <Badge variant={teamSheetPlayers.length + playerTags.length >= 15 ? \"destructive\" : \"secondary\"}>\n                  {teamSheetPlayers.length} selected ({playerTags.length + teamSheetPlayers.length}/15 total)\n                </Badge>\n              </div>\n            </DialogDescription>\n          </DialogHeader>\n          \n          <div className=\"space-y-4\">\n            <div className=\"space-y-2\">\n              <Label>Default Minutes Played</Label>\n              <Input\n                type=\"number\"\n                min=\"0\"\n                max=\"120\"\n                value={teamSheetDefaultMinutes}\n                onChange={(e) => setTeamSheetDefaultMinutes(e.target.value)}\n                placeholder=\"90\"\n                className=\"w-32\"\n                data-testid=\"input-team-sheet-minutes\"\n              />\n              <p className=\"text-xs text-muted-foreground\">\n                All selected players will be tagged with this minutes value\n              </p>\n            </div>\n\n            <Separator />\n\n            <div className=\"space-y-2\">\n              <Label>Select Players</Label>\n              <ScrollArea className=\"h-[300px] border rounded-md p-2\">\n                <div className=\"space-y-2\">\n                  {players.map((player) => {\n                    const isAlreadyTagged = playerTags.some(tag => tag.playerId === player.id);\n                    const isSelected = teamSheetPlayers.includes(player.id);\n                    \n                    return (\n                      <div \n                        key={player.id}\n                        className={`flex items-center gap-3 p-2 rounded-md ${\n                          isAlreadyTagged \n                            ? \"bg-muted/50 opacity-50\" \n                            : isSelected \n                              ? \"bg-primary/10 border border-primary/30\" \n                              : \"hover-elevate\"\n                        }`}\n                        data-testid={`team-sheet-player-${player.id}`}\n                      >\n                        <Checkbox\n                          checked={isSelected || isAlreadyTagged}\n                          disabled={isAlreadyTagged}\n                          onCheckedChange={() => handleToggleTeamSheetPlayer(player.id)}\n                          data-testid={`checkbox-player-${player.id}`}\n                        />\n                        <div className=\"flex-1\">\n                          <p className=\"font-medium text-sm\">\n                            {player.firstName} {player.lastName}\n                          </p>\n                          <p className=\"text-xs text-muted-foreground\">{player.position}</p>\n                        </div>\n                        {isAlreadyTagged && (\n                          <Badge variant=\"secondary\" className=\"text-xs\">Already Tagged</Badge>\n                        )}\n                      </div>\n                    );\n                  })}\n                </div>\n              </ScrollArea>\n            </div>\n          </div>\n\n          <DialogFooter className=\"gap-2\">\n            <Button variant=\"outline\" onClick={() => setIsTeamSheetOpen(false)}>\n              Cancel\n            </Button>\n            <Button \n              onClick={handleApplyTeamSheet}\n              disabled={teamSheetPlayers.length === 0 || batchTagPlayersMutation.isPending}\n              data-testid=\"button-apply-team-sheet\"\n            >\n              {batchTagPlayersMutation.isPending ? (\n                <>\n                  <LoadingSpinner size=\"sm\" />\n                  <span className=\"ml-2\">Tagging Players...</span>\n                </>\n              ) : (\n                <>\n                  <UsersRound className=\"h-4 w-4 mr-2\" />\n                  Tag {teamSheetPlayers.length} Players\n                </>\n              )}\n            </Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n    </div>\n  );\n}\n","path":null,"size_bytes":44879,"size_tokens":null},"client/src/hooks/use-mobile.tsx":{"content":"import * as React from \"react\"\n\nconst MOBILE_BREAKPOINT = 768\n\nexport function useIsMobile() {\n  const [isMobile, setIsMobile] = React.useState<boolean | undefined>(undefined)\n\n  React.useEffect(() => {\n    const mql = window.matchMedia(`(max-width: ${MOBILE_BREAKPOINT - 1}px)`)\n    const onChange = () => {\n      setIsMobile(window.innerWidth < MOBILE_BREAKPOINT)\n    }\n    mql.addEventListener(\"change\", onChange)\n    setIsMobile(window.innerWidth < MOBILE_BREAKPOINT)\n    return () => mql.removeEventListener(\"change\", onChange)\n  }, [])\n\n  return !!isMobile\n}\n","path":null,"size_bytes":565,"size_tokens":null},"client/src/components/ui/calendar.tsx":{"content":"import * as React from \"react\"\nimport { ChevronLeft, ChevronRight } from \"lucide-react\"\nimport { DayPicker } from \"react-day-picker\"\n\nimport { cn } from \"@/lib/utils\"\nimport { buttonVariants } from \"@/components/ui/button\"\n\nexport type CalendarProps = React.ComponentProps<typeof DayPicker>\n\nfunction Calendar({\n  className,\n  classNames,\n  showOutsideDays = true,\n  ...props\n}: CalendarProps) {\n  return (\n    <DayPicker\n      showOutsideDays={showOutsideDays}\n      className={cn(\"p-3\", className)}\n      classNames={{\n        months: \"flex flex-col sm:flex-row space-y-4 sm:space-x-4 sm:space-y-0\",\n        month: \"space-y-4\",\n        caption: \"flex justify-center pt-1 relative items-center\",\n        caption_label: \"text-sm font-medium\",\n        nav: \"space-x-1 flex items-center\",\n        nav_button: cn(\n          buttonVariants({ variant: \"outline\" }),\n          \"h-7 w-7 bg-transparent p-0 opacity-50 hover:opacity-100\"\n        ),\n        nav_button_previous: \"absolute left-1\",\n        nav_button_next: \"absolute right-1\",\n        table: \"w-full border-collapse space-y-1\",\n        head_row: \"flex\",\n        head_cell:\n          \"text-muted-foreground rounded-md w-9 font-normal text-[0.8rem]\",\n        row: \"flex w-full mt-2\",\n        cell: \"h-9 w-9 text-center text-sm p-0 relative [&:has([aria-selected].day-range-end)]:rounded-r-md [&:has([aria-selected].day-outside)]:bg-accent/50 [&:has([aria-selected])]:bg-accent first:[&:has([aria-selected])]:rounded-l-md last:[&:has([aria-selected])]:rounded-r-md focus-within:relative focus-within:z-20\",\n        day: cn(\n          buttonVariants({ variant: \"ghost\" }),\n          \"h-9 w-9 p-0 font-normal aria-selected:opacity-100\"\n        ),\n        day_range_end: \"day-range-end\",\n        day_selected:\n          \"bg-primary text-primary-foreground hover:bg-primary hover:text-primary-foreground focus:bg-primary focus:text-primary-foreground\",\n        day_today: \"bg-accent text-accent-foreground\",\n        day_outside:\n          \"day-outside text-muted-foreground aria-selected:bg-accent/50 aria-selected:text-muted-foreground\",\n        day_disabled: \"text-muted-foreground opacity-50\",\n        day_range_middle:\n          \"aria-selected:bg-accent aria-selected:text-accent-foreground\",\n        day_hidden: \"invisible\",\n        ...classNames,\n      }}\n      components={{\n        IconLeft: ({ className, ...props }) => (\n          <ChevronLeft className={cn(\"h-4 w-4\", className)} {...props} />\n        ),\n        IconRight: ({ className, ...props }) => (\n          <ChevronRight className={cn(\"h-4 w-4\", className)} {...props} />\n        ),\n      }}\n      {...props}\n    />\n  )\n}\nCalendar.displayName = \"Calendar\"\n\nexport { Calendar }\n","path":null,"size_bytes":2695,"size_tokens":null},"client/src/components/ui/accordion.tsx":{"content":"import * as React from \"react\"\nimport * as AccordionPrimitive from \"@radix-ui/react-accordion\"\nimport { ChevronDown } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Accordion = AccordionPrimitive.Root\n\nconst AccordionItem = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Item>\n>(({ className, ...props }, ref) => (\n  <AccordionPrimitive.Item\n    ref={ref}\n    className={cn(\"border-b\", className)}\n    {...props}\n  />\n))\nAccordionItem.displayName = \"AccordionItem\"\n\nconst AccordionTrigger = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <AccordionPrimitive.Header className=\"flex\">\n    <AccordionPrimitive.Trigger\n      ref={ref}\n      className={cn(\n        \"flex flex-1 items-center justify-between py-4 font-medium transition-all hover:underline [&[data-state=open]>svg]:rotate-180\",\n        className\n      )}\n      {...props}\n    >\n      {children}\n      <ChevronDown className=\"h-4 w-4 shrink-0 transition-transform duration-200\" />\n    </AccordionPrimitive.Trigger>\n  </AccordionPrimitive.Header>\n))\nAccordionTrigger.displayName = AccordionPrimitive.Trigger.displayName\n\nconst AccordionContent = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <AccordionPrimitive.Content\n    ref={ref}\n    className=\"overflow-hidden text-sm transition-all data-[state=closed]:animate-accordion-up data-[state=open]:animate-accordion-down\"\n    {...props}\n  >\n    <div className={cn(\"pb-4 pt-0\", className)}>{children}</div>\n  </AccordionPrimitive.Content>\n))\n\nAccordionContent.displayName = AccordionPrimitive.Content.displayName\n\nexport { Accordion, AccordionItem, AccordionTrigger, AccordionContent }\n","path":null,"size_bytes":1977,"size_tokens":null},"client/src/pages/messages.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { ScrollArea } from \"@/components/ui/scroll-area\";\nimport { Avatar, AvatarFallback } from \"@/components/ui/avatar\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Separator } from \"@/components/ui/separator\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Dialog, DialogContent, DialogDescription, DialogHeader, DialogTitle, DialogTrigger, DialogFooter } from \"@/components/ui/dialog\";\nimport { Form, FormControl, FormField, FormItem, FormLabel, FormMessage } from \"@/components/ui/form\";\nimport { useForm } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { queryClient, apiRequest } from \"@/lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { LoadingSpinner } from \"@/components/LoadingScreen\";\nimport { MessageSquare, Send, Plus, Users, Building2, UserCheck, Globe } from \"lucide-react\";\nimport { z } from \"zod\";\nimport type { Conversation, Message, Player } from \"@shared/schema\";\n\ninterface ConversationWithMessages {\n  conversation: Conversation;\n  participants: { userId: string; role: string }[];\n  messages: Message[];\n}\n\nconst newConversationSchema = z.object({\n  title: z.string().min(3, \"Title must be at least 3 characters\"),\n  playerId: z.string().optional(),\n  type: z.enum([\"transfer_inquiry\", \"scout_contact\", \"embassy_verification\", \"general\"]),\n});\n\ntype NewConversationFormData = z.infer<typeof newConversationSchema>;\n\nexport default function MessagesPage() {\n  const [selectedConversation, setSelectedConversation] = useState<string | null>(null);\n  const [newMessage, setNewMessage] = useState(\"\");\n  const [isDialogOpen, setIsDialogOpen] = useState(false);\n  const { toast } = useToast();\n\n  const form = useForm<NewConversationFormData>({\n    resolver: zodResolver(newConversationSchema),\n    defaultValues: {\n      title: \"\",\n      playerId: \"\",\n      type: \"general\",\n    },\n  });\n\n  const { data: conversations = [], isLoading } = useQuery<Conversation[]>({\n    queryKey: [\"/api/conversations\"],\n  });\n\n  const { data: players = [] } = useQuery<Player[]>({\n    queryKey: [\"/api/players\"],\n  });\n\n  const { data: conversationDetails, isLoading: detailsLoading } = useQuery<ConversationWithMessages>({\n    queryKey: [\"/api/conversations\", selectedConversation],\n    enabled: !!selectedConversation,\n  });\n\n  const createConversationMutation = useMutation({\n    mutationFn: async (data: NewConversationFormData) => {\n      const response = await apiRequest(\"POST\", \"/api/conversations\", data);\n      return await response.json();\n    },\n    onSuccess: (newConv: any) => {\n      toast({\n        title: \"Conversation Created\",\n        description: \"You can now start messaging in this conversation.\",\n      });\n      queryClient.invalidateQueries({ queryKey: [\"/api/conversations\"] });\n      setSelectedConversation(newConv.id);\n      setIsDialogOpen(false);\n      form.reset();\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Failed to create conversation\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const sendMessageMutation = useMutation({\n    mutationFn: async (content: string) => {\n      return apiRequest(\"POST\", `/api/conversations/${selectedConversation}/messages`, { content });\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/conversations\", selectedConversation] });\n      setNewMessage(\"\");\n    },\n  });\n\n  const handleSendMessage = () => {\n    if (newMessage.trim() && selectedConversation) {\n      sendMessageMutation.mutate(newMessage.trim());\n    }\n  };\n\n  const onSubmitNewConversation = (data: NewConversationFormData) => {\n    createConversationMutation.mutate(data);\n  };\n\n  const getConversationTypeIcon = (type: string) => {\n    switch (type) {\n      case \"transfer_inquiry\":\n        return <Globe className=\"h-5 w-5 text-blue-500\" />;\n      case \"scout_contact\":\n        return <UserCheck className=\"h-5 w-5 text-green-500\" />;\n      case \"embassy_verification\":\n        return <Building2 className=\"h-5 w-5 text-purple-500\" />;\n      default:\n        return <Users className=\"h-5 w-5 text-primary\" />;\n    }\n  };\n\n  const getRoleBadgeColor = (role: string) => {\n    switch (role) {\n      case \"team\":\n      case \"sporting_director\":\n      case \"admin\":\n        return \"bg-blue-500/10 text-blue-600 border-blue-200\";\n      case \"scout\":\n      case \"agent\":\n        return \"bg-green-500/10 text-green-600 border-green-200\";\n      case \"embassy\":\n        return \"bg-purple-500/10 text-purple-600 border-purple-200\";\n      default:\n        return \"\";\n    }\n  };\n\n  if (isLoading) {\n    return (\n      <div className=\"flex items-center justify-center h-full\">\n        <LoadingSpinner size=\"lg\" />\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"flex h-full\">\n      <div className=\"w-80 border-r bg-card\">\n        <div className=\"p-4 border-b\">\n          <div className=\"flex items-center justify-between gap-2\">\n            <h2 className=\"font-semibold\">Messages</h2>\n            <Dialog open={isDialogOpen} onOpenChange={setIsDialogOpen}>\n              <DialogTrigger asChild>\n                <Button size=\"icon\" variant=\"ghost\" data-testid=\"button-new-conversation\">\n                  <Plus className=\"h-4 w-4\" />\n                </Button>\n              </DialogTrigger>\n              <DialogContent>\n                <DialogHeader>\n                  <DialogTitle>New Conversation</DialogTitle>\n                  <DialogDescription>\n                    Start a three-way conversation with teams, scouts/agents, or embassy officials\n                  </DialogDescription>\n                </DialogHeader>\n                <Form {...form}>\n                  <form onSubmit={form.handleSubmit(onSubmitNewConversation)} className=\"space-y-4\">\n                    <FormField\n                      control={form.control}\n                      name=\"title\"\n                      render={({ field }) => (\n                        <FormItem>\n                          <FormLabel>Conversation Title</FormLabel>\n                          <FormControl>\n                            <Input placeholder=\"e.g., Transfer Discussion - Player Name\" {...field} data-testid=\"input-conv-title\" />\n                          </FormControl>\n                          <FormMessage />\n                        </FormItem>\n                      )}\n                    />\n\n                    <FormField\n                      control={form.control}\n                      name=\"type\"\n                      render={({ field }) => (\n                        <FormItem>\n                          <FormLabel>Conversation Type</FormLabel>\n                          <Select onValueChange={field.onChange} value={field.value}>\n                            <FormControl>\n                              <SelectTrigger data-testid=\"select-conv-type\">\n                                <SelectValue placeholder=\"Select type\" />\n                              </SelectTrigger>\n                            </FormControl>\n                            <SelectContent>\n                              <SelectItem value=\"transfer_inquiry\">\n                                <div className=\"flex items-center gap-2\">\n                                  <Globe className=\"h-4 w-4\" />\n                                  Transfer Inquiry\n                                </div>\n                              </SelectItem>\n                              <SelectItem value=\"scout_contact\">\n                                <div className=\"flex items-center gap-2\">\n                                  <UserCheck className=\"h-4 w-4\" />\n                                  Scout/Agent Contact\n                                </div>\n                              </SelectItem>\n                              <SelectItem value=\"embassy_verification\">\n                                <div className=\"flex items-center gap-2\">\n                                  <Building2 className=\"h-4 w-4\" />\n                                  Embassy Verification\n                                </div>\n                              </SelectItem>\n                              <SelectItem value=\"general\">\n                                <div className=\"flex items-center gap-2\">\n                                  <MessageSquare className=\"h-4 w-4\" />\n                                  General Discussion\n                                </div>\n                              </SelectItem>\n                            </SelectContent>\n                          </Select>\n                          <FormMessage />\n                        </FormItem>\n                      )}\n                    />\n\n                    <FormField\n                      control={form.control}\n                      name=\"playerId\"\n                      render={({ field }) => (\n                        <FormItem>\n                          <FormLabel>Related Player (Optional)</FormLabel>\n                          <Select onValueChange={field.onChange} value={field.value}>\n                            <FormControl>\n                              <SelectTrigger data-testid=\"select-conv-player\">\n                                <SelectValue placeholder=\"Select a player\" />\n                              </SelectTrigger>\n                            </FormControl>\n                            <SelectContent>\n                              <SelectItem value=\"\">None</SelectItem>\n                              {players.map((player) => (\n                                <SelectItem key={player.id} value={player.id}>\n                                  {player.firstName} {player.lastName}\n                                </SelectItem>\n                              ))}\n                            </SelectContent>\n                          </Select>\n                          <FormMessage />\n                        </FormItem>\n                      )}\n                    />\n\n                    <DialogFooter>\n                      <Button type=\"button\" variant=\"outline\" onClick={() => setIsDialogOpen(false)}>\n                        Cancel\n                      </Button>\n                      <Button type=\"submit\" disabled={createConversationMutation.isPending} data-testid=\"button-create-conversation\">\n                        {createConversationMutation.isPending ? <LoadingSpinner size=\"sm\" /> : \"Create Conversation\"}\n                      </Button>\n                    </DialogFooter>\n                  </form>\n                </Form>\n              </DialogContent>\n            </Dialog>\n          </div>\n          <p className=\"text-xs text-muted-foreground mt-1\">\n            Three-way messaging: Team, Scout/Agent, Embassy\n          </p>\n        </div>\n        <ScrollArea className=\"h-[calc(100vh-200px)]\">\n          {conversations.length === 0 ? (\n            <div className=\"p-4 text-center text-muted-foreground\">\n              <MessageSquare className=\"h-8 w-8 mx-auto mb-2\" />\n              <p className=\"text-sm\">No conversations yet</p>\n              <p className=\"text-xs mt-1\">Click + to start one</p>\n            </div>\n          ) : (\n            <div className=\"space-y-1 p-2\">\n              {conversations.map((conv) => (\n                <button\n                  key={conv.id}\n                  onClick={() => setSelectedConversation(conv.id)}\n                  className={`w-full p-3 rounded-md text-left hover-elevate ${\n                    selectedConversation === conv.id ? \"bg-accent\" : \"\"\n                  }`}\n                  data-testid={`button-conversation-${conv.id}`}\n                >\n                  <div className=\"flex items-center gap-3\">\n                    <div className=\"h-10 w-10 rounded-full bg-muted flex items-center justify-center\">\n                      {getConversationTypeIcon(conv.type)}\n                    </div>\n                    <div className=\"flex-1 min-w-0\">\n                      <p className=\"font-medium truncate text-sm\">{conv.title || \"Untitled Conversation\"}</p>\n                      <p className=\"text-xs text-muted-foreground truncate capitalize\">\n                        {conv.type.replace(/_/g, \" \")}\n                      </p>\n                    </div>\n                  </div>\n                </button>\n              ))}\n            </div>\n          )}\n        </ScrollArea>\n      </div>\n\n      <div className=\"flex-1 flex flex-col\">\n        {selectedConversation && conversationDetails ? (\n          <>\n            <div className=\"p-4 border-b\">\n              <div className=\"flex items-center justify-between gap-4 flex-wrap\">\n                <div className=\"flex items-center gap-3\">\n                  {getConversationTypeIcon(conversationDetails.conversation.type)}\n                  <div>\n                    <h2 className=\"font-semibold\">{conversationDetails.conversation.title || \"Conversation\"}</h2>\n                    <p className=\"text-xs text-muted-foreground capitalize\">\n                      {conversationDetails.conversation.type.replace(/_/g, \" \")} - {conversationDetails.participants.length} participants\n                    </p>\n                  </div>\n                </div>\n                <div className=\"flex gap-2 flex-wrap\">\n                  {conversationDetails.participants.map((p, i) => (\n                    <Badge key={i} variant=\"outline\" className={getRoleBadgeColor(p.role)}>\n                      {p.role}\n                    </Badge>\n                  ))}\n                </div>\n              </div>\n            </div>\n            <ScrollArea className=\"flex-1 p-4\">\n              {detailsLoading ? (\n                <div className=\"flex justify-center py-8\">\n                  <LoadingSpinner size=\"md\" />\n                </div>\n              ) : conversationDetails.messages.length === 0 ? (\n                <div className=\"text-center py-12 text-muted-foreground\">\n                  <MessageSquare className=\"h-8 w-8 mx-auto mb-2\" />\n                  <p className=\"text-sm\">No messages yet</p>\n                  <p className=\"text-xs\">Start the conversation below</p>\n                </div>\n              ) : (\n                <div className=\"space-y-4\">\n                  {conversationDetails.messages.map((msg) => (\n                    <div key={msg.id} className=\"flex gap-3\">\n                      <Avatar className=\"h-8 w-8\">\n                        <AvatarFallback className={`text-xs ${getRoleBadgeColor(msg.senderRole || \"\")}`}>\n                          {msg.senderRole?.charAt(0).toUpperCase() || \"U\"}\n                        </AvatarFallback>\n                      </Avatar>\n                      <div className=\"flex-1\">\n                        <div className=\"flex items-center gap-2 mb-1 flex-wrap\">\n                          <Badge variant=\"outline\" className={getRoleBadgeColor(msg.senderRole || \"\")}>\n                            {msg.senderRole}\n                          </Badge>\n                          <span className=\"text-xs text-muted-foreground\">\n                            {msg.createdAt ? new Date(msg.createdAt).toLocaleString() : \"\"}\n                          </span>\n                        </div>\n                        <p className=\"text-sm bg-muted/50 rounded-md p-2\">{msg.content}</p>\n                      </div>\n                    </div>\n                  ))}\n                </div>\n              )}\n            </ScrollArea>\n            <div className=\"p-4 border-t\">\n              <div className=\"flex gap-2\">\n                <Input\n                  placeholder=\"Type a message...\"\n                  value={newMessage}\n                  onChange={(e) => setNewMessage(e.target.value)}\n                  onKeyDown={(e) => e.key === \"Enter\" && !e.shiftKey && handleSendMessage()}\n                  data-testid=\"input-message\"\n                />\n                <Button \n                  onClick={handleSendMessage} \n                  disabled={sendMessageMutation.isPending || !newMessage.trim()}\n                  data-testid=\"button-send-message\"\n                >\n                  {sendMessageMutation.isPending ? <LoadingSpinner size=\"sm\" /> : <Send className=\"h-4 w-4\" />}\n                </Button>\n              </div>\n            </div>\n          </>\n        ) : (\n          <div className=\"flex-1 flex items-center justify-center text-muted-foreground\">\n            <div className=\"text-center\">\n              <MessageSquare className=\"h-12 w-12 mx-auto mb-4\" />\n              <p className=\"font-medium\">Select a conversation</p>\n              <p className=\"text-sm mt-1\">Or create a new one to start messaging</p>\n              <div className=\"mt-6 grid grid-cols-3 gap-4 text-xs\">\n                <div className=\"p-3 rounded-md bg-blue-500/10 text-blue-600\">\n                  <Users className=\"h-6 w-6 mx-auto mb-2\" />\n                  Team\n                </div>\n                <div className=\"p-3 rounded-md bg-green-500/10 text-green-600\">\n                  <UserCheck className=\"h-6 w-6 mx-auto mb-2\" />\n                  Scout/Agent\n                </div>\n                <div className=\"p-3 rounded-md bg-purple-500/10 text-purple-600\">\n                  <Building2 className=\"h-6 w-6 mx-auto mb-2\" />\n                  Embassy\n                </div>\n              </div>\n            </div>\n          </div>\n        )}\n      </div>\n    </div>\n  );\n}\n","path":null,"size_bytes":17636,"size_tokens":null},"vite.config.ts":{"content":"import { defineConfig } from \"vite\";\nimport react from \"@vitejs/plugin-react\";\nimport path from \"path\";\nimport runtimeErrorOverlay from \"@replit/vite-plugin-runtime-error-modal\";\n\nexport default defineConfig({\n  plugins: [\n    react(),\n    runtimeErrorOverlay(),\n    ...(process.env.NODE_ENV !== \"production\" &&\n    process.env.REPL_ID !== undefined\n      ? [\n          await import(\"@replit/vite-plugin-cartographer\").then((m) =>\n            m.cartographer(),\n          ),\n          await import(\"@replit/vite-plugin-dev-banner\").then((m) =>\n            m.devBanner(),\n          ),\n        ]\n      : []),\n  ],\n  resolve: {\n    alias: {\n      \"@\": path.resolve(import.meta.dirname, \"client\", \"src\"),\n      \"@shared\": path.resolve(import.meta.dirname, \"shared\"),\n      \"@assets\": path.resolve(import.meta.dirname, \"attached_assets\"),\n    },\n  },\n  root: path.resolve(import.meta.dirname, \"client\"),\n  build: {\n    outDir: path.resolve(import.meta.dirname, \"dist/public\"),\n    emptyOutDir: true,\n  },\n  server: {\n    fs: {\n      strict: true,\n      deny: [\"**/.*\"],\n    },\n  },\n});\n","path":null,"size_bytes":1080,"size_tokens":null},"client/src/main.tsx":{"content":"import { createRoot } from \"react-dom/client\";\nimport App from \"./App\";\nimport \"./index.css\";\n\ncreateRoot(document.getElementById(\"root\")!).render(<App />);\n","path":null,"size_bytes":157,"size_tokens":null},"client/src/components/ui/breadcrumb.tsx":{"content":"import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { ChevronRight, MoreHorizontal } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Breadcrumb = React.forwardRef<\n  HTMLElement,\n  React.ComponentPropsWithoutRef<\"nav\"> & {\n    separator?: React.ReactNode\n  }\n>(({ ...props }, ref) => <nav ref={ref} aria-label=\"breadcrumb\" {...props} />)\nBreadcrumb.displayName = \"Breadcrumb\"\n\nconst BreadcrumbList = React.forwardRef<\n  HTMLOListElement,\n  React.ComponentPropsWithoutRef<\"ol\">\n>(({ className, ...props }, ref) => (\n  <ol\n    ref={ref}\n    className={cn(\n      \"flex flex-wrap items-center gap-1.5 break-words text-sm text-muted-foreground sm:gap-2.5\",\n      className\n    )}\n    {...props}\n  />\n))\nBreadcrumbList.displayName = \"BreadcrumbList\"\n\nconst BreadcrumbItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentPropsWithoutRef<\"li\">\n>(({ className, ...props }, ref) => (\n  <li\n    ref={ref}\n    className={cn(\"inline-flex items-center gap-1.5\", className)}\n    {...props}\n  />\n))\nBreadcrumbItem.displayName = \"BreadcrumbItem\"\n\nconst BreadcrumbLink = React.forwardRef<\n  HTMLAnchorElement,\n  React.ComponentPropsWithoutRef<\"a\"> & {\n    asChild?: boolean\n  }\n>(({ asChild, className, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"a\"\n\n  return (\n    <Comp\n      ref={ref}\n      className={cn(\"transition-colors hover:text-foreground\", className)}\n      {...props}\n    />\n  )\n})\nBreadcrumbLink.displayName = \"BreadcrumbLink\"\n\nconst BreadcrumbPage = React.forwardRef<\n  HTMLSpanElement,\n  React.ComponentPropsWithoutRef<\"span\">\n>(({ className, ...props }, ref) => (\n  <span\n    ref={ref}\n    role=\"link\"\n    aria-disabled=\"true\"\n    aria-current=\"page\"\n    className={cn(\"font-normal text-foreground\", className)}\n    {...props}\n  />\n))\nBreadcrumbPage.displayName = \"BreadcrumbPage\"\n\nconst BreadcrumbSeparator = ({\n  children,\n  className,\n  ...props\n}: React.ComponentProps<\"li\">) => (\n  <li\n    role=\"presentation\"\n    aria-hidden=\"true\"\n    className={cn(\"[&>svg]:w-3.5 [&>svg]:h-3.5\", className)}\n    {...props}\n  >\n    {children ?? <ChevronRight />}\n  </li>\n)\nBreadcrumbSeparator.displayName = \"BreadcrumbSeparator\"\n\nconst BreadcrumbEllipsis = ({\n  className,\n  ...props\n}: React.ComponentProps<\"span\">) => (\n  <span\n    role=\"presentation\"\n    aria-hidden=\"true\"\n    className={cn(\"flex h-9 w-9 items-center justify-center\", className)}\n    {...props}\n  >\n    <MoreHorizontal className=\"h-4 w-4\" />\n    <span className=\"sr-only\">More</span>\n  </span>\n)\nBreadcrumbEllipsis.displayName = \"BreadcrumbElipssis\"\n\nexport {\n  Breadcrumb,\n  BreadcrumbList,\n  BreadcrumbItem,\n  BreadcrumbLink,\n  BreadcrumbPage,\n  BreadcrumbSeparator,\n  BreadcrumbEllipsis,\n}\n","path":null,"size_bytes":2712,"size_tokens":null},"server/replit_integrations/auth/routes.ts":{"content":"import type { Express } from \"express\";\nimport { authStorage } from \"./storage\";\nimport { isAuthenticated } from \"./replitAuth\";\n\n// Register auth-specific routes\nexport function registerAuthRoutes(app: Express): void {\n  // Get current authenticated user\n  app.get(\"/api/auth/user\", isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const user = await authStorage.getUser(userId);\n      res.json(user);\n    } catch (error) {\n      console.error(\"Error fetching user:\", error);\n      res.status(500).json({ message: \"Failed to fetch user\" });\n    }\n  });\n}\n","path":null,"size_bytes":609,"size_tokens":null},"client/src/components/ui/toggle.tsx":{"content":"import * as React from \"react\"\nimport * as TogglePrimitive from \"@radix-ui/react-toggle\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst toggleVariants = cva(\n  \"inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors hover:bg-muted hover:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=on]:bg-accent data-[state=on]:text-accent-foreground [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0 gap-2\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-transparent\",\n        outline:\n          \"border border-input bg-transparent hover:bg-accent hover:text-accent-foreground\",\n      },\n      size: {\n        default: \"h-10 px-3 min-w-10\",\n        sm: \"h-9 px-2.5 min-w-9\",\n        lg: \"h-11 px-5 min-w-11\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nconst Toggle = React.forwardRef<\n  React.ElementRef<typeof TogglePrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof TogglePrimitive.Root> &\n    VariantProps<typeof toggleVariants>\n>(({ className, variant, size, ...props }, ref) => (\n  <TogglePrimitive.Root\n    ref={ref}\n    className={cn(toggleVariants({ variant, size, className }))}\n    {...props}\n  />\n))\n\nToggle.displayName = TogglePrimitive.Root.displayName\n\nexport { Toggle, toggleVariants }\n","path":null,"size_bytes":1527,"size_tokens":null},"client/src/pages/invitation-letters.tsx":{"content":"import { useState, useCallback } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { useDropzone } from \"react-dropzone\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Separator } from \"@/components/ui/separator\";\nimport { ScrollArea } from \"@/components/ui/scroll-area\";\nimport { Dialog, DialogContent, DialogDescription, DialogHeader, DialogTitle, DialogTrigger, DialogFooter } from \"@/components/ui/dialog\";\nimport { Form, FormControl, FormField, FormItem, FormLabel, FormMessage } from \"@/components/ui/form\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { useForm } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { queryClient, apiRequest } from \"@/lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { LoadingSpinner } from \"@/components/LoadingScreen\";\nimport { FileText, Upload, Plus, Calendar, Globe, Building2, User, CheckCircle, Clock, AlertCircle, MapPin, FileCheck, QrCode, Eye, Trash2, Sparkles, X, File } from \"lucide-react\";\nimport { z } from \"zod\";\nimport type { Player, InvitationLetter, ConsularReport } from \"@shared/schema\";\n\nconst invitationLetterSchema = z.object({\n  playerId: z.string().min(1, \"Please select a player\"),\n  targetClubName: z.string().min(2, \"Club name is required\"),\n  targetClubAddress: z.string().optional(),\n  targetLeague: z.string().min(2, \"League is required\"),\n  targetLeagueBand: z.coerce.number().min(1).max(5),\n  targetCountry: z.string().min(2, \"Country is required\"),\n  trialStartDate: z.string().optional(),\n  trialEndDate: z.string().optional(),\n  offerType: z.string().default(\"trial\"),\n  scoutAgentName: z.string().optional(),\n  scoutAgentId: z.string().optional(),\n  fileUrl: z.string().optional(),\n});\n\ntype InvitationLetterFormData = z.infer<typeof invitationLetterSchema>;\n\ninterface InvitationLetterWithPlayer extends InvitationLetter {\n  player?: Player;\n}\n\nexport default function InvitationLettersPage() {\n  const [isDialogOpen, setIsDialogOpen] = useState(false);\n  const [selectedLetter, setSelectedLetter] = useState<InvitationLetterWithPlayer | null>(null);\n  const [isViewDialogOpen, setIsViewDialogOpen] = useState(false);\n  const [uploadedFile, setUploadedFile] = useState<File | null>(null);\n  const { toast } = useToast();\n\n  const onDrop = useCallback((acceptedFiles: File[]) => {\n    if (acceptedFiles.length > 0) {\n      setUploadedFile(acceptedFiles[0]);\n    }\n  }, []);\n\n  const { getRootProps, getInputProps, isDragActive } = useDropzone({\n    onDrop,\n    accept: { \n      \"application/pdf\": [\".pdf\"],\n      \"application/msword\": [\".doc\"],\n      \"application/vnd.openxmlformats-officedocument.wordprocessingml.document\": [\".docx\"],\n      \"image/*\": [\".jpg\", \".jpeg\", \".png\"]\n    },\n    maxFiles: 1,\n  });\n\n  const { data: players = [], isLoading: playersLoading } = useQuery<Player[]>({\n    queryKey: [\"/api/players\"],\n  });\n\n  const { data: allLetters = [], isLoading: lettersLoading } = useQuery<InvitationLetterWithPlayer[]>({\n    queryKey: [\"/api/invitation-letters\"],\n  });\n\n  const form = useForm<InvitationLetterFormData>({\n    resolver: zodResolver(invitationLetterSchema),\n    defaultValues: {\n      playerId: \"\",\n      targetClubName: \"\",\n      targetClubAddress: \"\",\n      targetLeague: \"\",\n      targetLeagueBand: 3,\n      targetCountry: \"\",\n      trialStartDate: \"\",\n      trialEndDate: \"\",\n      offerType: \"trial\",\n      scoutAgentName: \"\",\n      scoutAgentId: \"\",\n      fileUrl: \"\",\n    },\n  });\n\n  const uploadMutation = useMutation({\n    mutationFn: async (data: InvitationLetterFormData) => {\n      const response = await apiRequest(\"POST\", \"/api/invitation-letters\", data);\n      return await response.json();\n    },\n    onSuccess: () => {\n      toast({\n        title: \"Invitation Letter Uploaded\",\n        description: \"The letter has been submitted for processing. League band will be applied to eligibility calculation.\",\n      });\n      form.reset();\n      setUploadedFile(null);\n      setIsDialogOpen(false);\n      queryClient.invalidateQueries({ queryKey: [\"/api/invitation-letters\"] });\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Upload Failed\",\n        description: error.message || \"Failed to upload invitation letter\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const generateReportMutation = useMutation({\n    mutationFn: async (letterId: string) => {\n      const response = await apiRequest(\"POST\", `/api/invitation-letters/${letterId}/generate-consular-report`, {});\n      return await response.json();\n    },\n    onSuccess: (report: ConsularReport) => {\n      toast({\n        title: \"Consular Report Generated\",\n        description: `Verification code: ${report.verificationCode}. Report is now accessible to embassy officials.`,\n      });\n      queryClient.invalidateQueries({ queryKey: [\"/api/invitation-letters\"] });\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Failed to Generate Report\",\n        description: error.message || \"Could not generate consular report\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const deleteMutation = useMutation({\n    mutationFn: async (letterId: string) => {\n      const response = await apiRequest(\"DELETE\", `/api/invitation-letters/${letterId}`, {});\n      return await response.json();\n    },\n    onSuccess: () => {\n      toast({\n        title: \"Letter Deleted\",\n        description: \"The invitation letter has been removed.\",\n      });\n      queryClient.invalidateQueries({ queryKey: [\"/api/invitation-letters\"] });\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Delete Failed\",\n        description: error.message || \"Failed to delete invitation letter\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const onSubmit = (data: InvitationLetterFormData) => {\n    const fileUrl = uploadedFile ? URL.createObjectURL(uploadedFile) : undefined;\n    uploadMutation.mutate({ ...data, fileUrl });\n  };\n\n  const getStatusBadge = (status: string | null) => {\n    switch (status) {\n      case \"verified\":\n        return <Badge className=\"bg-green-500/10 text-green-600 border-green-200\"><CheckCircle className=\"h-3 w-3 mr-1\" />Verified</Badge>;\n      case \"pending\":\n        return <Badge className=\"bg-yellow-500/10 text-yellow-600 border-yellow-200\"><Clock className=\"h-3 w-3 mr-1\" />Pending</Badge>;\n      case \"rejected\":\n        return <Badge className=\"bg-red-500/10 text-red-600 border-red-200\"><AlertCircle className=\"h-3 w-3 mr-1\" />Rejected</Badge>;\n      default:\n        return <Badge variant=\"secondary\">{status || \"Pending\"}</Badge>;\n    }\n  };\n\n  const leagueBands = [\n    { value: 1, label: \"Band 1 - Top Tier (Premier League, La Liga, etc.)\" },\n    { value: 2, label: \"Band 2 - High Level (Championship, Serie B, etc.)\" },\n    { value: 3, label: \"Band 3 - Mid Level (League One, etc.)\" },\n    { value: 4, label: \"Band 4 - Lower Level\" },\n    { value: 5, label: \"Band 5 - Regional/Amateur\" },\n  ];\n\n  const offerTypes = [\n    { value: \"trial\", label: \"Trial Offer\" },\n    { value: \"permanent\", label: \"Permanent Transfer\" },\n    { value: \"loan\", label: \"Loan\" },\n    { value: \"contract\", label: \"Contract Offer\" },\n  ];\n\n  if (playersLoading || lettersLoading) {\n    return (\n      <div className=\"flex items-center justify-center h-full\">\n        <LoadingSpinner size=\"lg\" />\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"p-6 space-y-6\">\n      <div className=\"flex flex-col gap-4 md:flex-row md:items-center md:justify-between\">\n        <div>\n          <h1 className=\"text-2xl font-bold\" data-testid=\"text-page-title\">Invitation Letters</h1>\n          <p className=\"text-muted-foreground\">Upload club invitation letters for automatic eligibility scoring and embassy verification</p>\n        </div>\n        <Dialog open={isDialogOpen} onOpenChange={setIsDialogOpen}>\n          <DialogTrigger asChild>\n            <Button data-testid=\"button-upload-letter\">\n              <Plus className=\"mr-2 h-4 w-4\" />\n              Upload Document\n            </Button>\n          </DialogTrigger>\n          <DialogContent className=\"max-w-lg max-h-[90vh]\">\n            <DialogHeader>\n              <DialogTitle>Upload Invitation Document</DialogTitle>\n              <DialogDescription>\n                Submit an official invitation letter from the target club. The system will automatically assign league band and recalculate eligibility.\n              </DialogDescription>\n            </DialogHeader>\n            <ScrollArea className=\"max-h-[calc(90vh-180px)]\">\n              <Form {...form}>\n                <form onSubmit={form.handleSubmit(onSubmit)} className=\"space-y-4 pr-4\">\n                  <FormField\n                    control={form.control}\n                    name=\"playerId\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>Player</FormLabel>\n                        <Select onValueChange={field.onChange} value={field.value}>\n                          <FormControl>\n                            <SelectTrigger data-testid=\"select-player\">\n                              <SelectValue placeholder=\"Select a player\" />\n                            </SelectTrigger>\n                          </FormControl>\n                          <SelectContent>\n                            {players.map((player) => (\n                              <SelectItem key={player.id} value={player.id}>\n                                {player.firstName} {player.lastName} - {player.position}\n                              </SelectItem>\n                            ))}\n                          </SelectContent>\n                        </Select>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n\n                  <Separator />\n\n                  <div className=\"space-y-1\">\n                    <Label className=\"text-sm font-medium\">Target Club Details</Label>\n                    <p className=\"text-xs text-muted-foreground\">Information extracted from invitation letter</p>\n                  </div>\n\n                  <div className=\"grid grid-cols-2 gap-4\">\n                    <FormField\n                      control={form.control}\n                      name=\"targetClubName\"\n                      render={({ field }) => (\n                        <FormItem>\n                          <FormLabel>Club Name</FormLabel>\n                          <FormControl>\n                            <Input placeholder=\"e.g., Manchester United\" {...field} data-testid=\"input-target-club\" />\n                          </FormControl>\n                          <FormMessage />\n                        </FormItem>\n                      )}\n                    />\n                    <FormField\n                      control={form.control}\n                      name=\"targetCountry\"\n                      render={({ field }) => (\n                        <FormItem>\n                          <FormLabel>Country</FormLabel>\n                          <FormControl>\n                            <Input placeholder=\"e.g., United Kingdom\" {...field} data-testid=\"input-target-country\" />\n                          </FormControl>\n                          <FormMessage />\n                        </FormItem>\n                      )}\n                    />\n                  </div>\n\n                  <FormField\n                    control={form.control}\n                    name=\"targetClubAddress\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>Club Address</FormLabel>\n                        <FormControl>\n                          <Textarea \n                            placeholder=\"Full club address as shown on letter\"\n                            className=\"resize-none\"\n                            rows={2}\n                            {...field} \n                            data-testid=\"input-club-address\" \n                          />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n\n                  <FormField\n                    control={form.control}\n                    name=\"targetLeague\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>Target League</FormLabel>\n                        <FormControl>\n                          <Input placeholder=\"e.g., Premier League\" {...field} data-testid=\"input-target-league\" />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n\n                  <FormField\n                    control={form.control}\n                    name=\"targetLeagueBand\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>League Band (auto-assigned based on league)</FormLabel>\n                        <Select onValueChange={(v) => field.onChange(parseInt(v))} value={field.value.toString()}>\n                          <FormControl>\n                            <SelectTrigger data-testid=\"select-league-band\">\n                              <SelectValue placeholder=\"Select league band\" />\n                            </SelectTrigger>\n                          </FormControl>\n                          <SelectContent>\n                            {leagueBands.map((band) => (\n                              <SelectItem key={band.value} value={band.value.toString()}>\n                                {band.label}\n                              </SelectItem>\n                            ))}\n                          </SelectContent>\n                        </Select>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n\n                  <Separator />\n\n                  <div className=\"space-y-1\">\n                    <Label className=\"text-sm font-medium\">Offer Details</Label>\n                  </div>\n\n                  <div className=\"grid grid-cols-2 gap-4\">\n                    <FormField\n                      control={form.control}\n                      name=\"offerType\"\n                      render={({ field }) => (\n                        <FormItem>\n                          <FormLabel>Offer Type</FormLabel>\n                          <Select onValueChange={field.onChange} value={field.value}>\n                            <FormControl>\n                              <SelectTrigger data-testid=\"select-offer-type\">\n                                <SelectValue placeholder=\"Select offer type\" />\n                              </SelectTrigger>\n                            </FormControl>\n                            <SelectContent>\n                              {offerTypes.map((type) => (\n                                <SelectItem key={type.value} value={type.value}>\n                                  {type.label}\n                                </SelectItem>\n                              ))}\n                            </SelectContent>\n                          </Select>\n                          <FormMessage />\n                        </FormItem>\n                      )}\n                    />\n                  </div>\n\n                  <div className=\"grid grid-cols-2 gap-4\">\n                    <FormField\n                      control={form.control}\n                      name=\"trialStartDate\"\n                      render={({ field }) => (\n                        <FormItem>\n                          <FormLabel>Trial/Start Date</FormLabel>\n                          <FormControl>\n                            <Input type=\"date\" {...field} data-testid=\"input-trial-start\" />\n                          </FormControl>\n                          <FormMessage />\n                        </FormItem>\n                      )}\n                    />\n                    <FormField\n                      control={form.control}\n                      name=\"trialEndDate\"\n                      render={({ field }) => (\n                        <FormItem>\n                          <FormLabel>Trial/End Date</FormLabel>\n                          <FormControl>\n                            <Input type=\"date\" {...field} data-testid=\"input-trial-end\" />\n                          </FormControl>\n                          <FormMessage />\n                        </FormItem>\n                      )}\n                    />\n                  </div>\n\n                  <Separator />\n\n                  <div className=\"grid grid-cols-2 gap-4\">\n                    <FormField\n                      control={form.control}\n                      name=\"scoutAgentName\"\n                      render={({ field }) => (\n                        <FormItem>\n                          <FormLabel>Scout/Agent Name</FormLabel>\n                          <FormControl>\n                            <Input placeholder=\"Agent name\" {...field} data-testid=\"input-scout-name\" />\n                          </FormControl>\n                          <FormMessage />\n                        </FormItem>\n                      )}\n                    />\n                    <FormField\n                      control={form.control}\n                      name=\"scoutAgentId\"\n                      render={({ field }) => (\n                        <FormItem>\n                          <FormLabel>Agent License ID</FormLabel>\n                          <FormControl>\n                            <Input placeholder=\"License ID\" {...field} data-testid=\"input-scout-id\" />\n                          </FormControl>\n                          <FormMessage />\n                        </FormItem>\n                      )}\n                    />\n                  </div>\n\n                  <div className=\"space-y-2\">\n                    <Label className=\"text-sm font-medium\">Document Upload</Label>\n                    <div\n                      {...getRootProps()}\n                      className={`border-2 border-dashed rounded-md p-6 text-center cursor-pointer transition-colors ${\n                        isDragActive ? \"border-primary bg-primary/5\" : \"border-muted-foreground/25 hover:border-primary/50\"\n                      }`}\n                      data-testid=\"dropzone-document\"\n                    >\n                      <input {...getInputProps()} data-testid=\"input-document-file\" />\n                      {uploadedFile ? (\n                        <div className=\"flex items-center justify-center gap-2\">\n                          <File className=\"h-6 w-6 text-primary\" />\n                          <span className=\"font-medium text-sm truncate max-w-[200px]\">{uploadedFile.name}</span>\n                          <Button \n                            size=\"icon\" \n                            variant=\"ghost\" \n                            type=\"button\"\n                            onClick={(e) => { e.stopPropagation(); setUploadedFile(null); }}\n                            data-testid=\"button-remove-document\"\n                          >\n                            <X className=\"h-4 w-4\" />\n                          </Button>\n                        </div>\n                      ) : (\n                        <div className=\"space-y-1\">\n                          <Upload className=\"h-8 w-8 mx-auto text-muted-foreground\" />\n                          <p className=\"text-sm text-muted-foreground\">\n                            {isDragActive ? \"Drop document here\" : \"Drop PDF/DOC or click to browse\"}\n                          </p>\n                          <p className=\"text-xs text-muted-foreground\">Supports PDF, DOC, DOCX, JPG, PNG</p>\n                        </div>\n                      )}\n                    </div>\n                    <p className=\"text-xs text-muted-foreground\">Upload the official invitation letter from the target club</p>\n                  </div>\n\n                  <DialogFooter className=\"pt-4\">\n                    <Button type=\"button\" variant=\"outline\" onClick={() => setIsDialogOpen(false)}>\n                      Cancel\n                    </Button>\n                    <Button type=\"submit\" disabled={uploadMutation.isPending} data-testid=\"button-submit-letter\">\n                      {uploadMutation.isPending ? <LoadingSpinner size=\"sm\" /> : \"Submit Letter\"}\n                    </Button>\n                  </DialogFooter>\n                </form>\n              </Form>\n            </ScrollArea>\n          </DialogContent>\n        </Dialog>\n      </div>\n\n      <div className=\"grid gap-4\">\n        <Card>\n          <CardHeader>\n            <CardTitle className=\"text-lg flex items-center gap-2\">\n              <FileText className=\"h-5 w-5\" />\n              How Invitation Letters Work\n            </CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"grid md:grid-cols-3 gap-6\">\n              <div className=\"space-y-2\">\n                <div className=\"flex items-center gap-2 text-primary font-medium\">\n                  <Upload className=\"h-4 w-4\" />\n                  <span>1. Upload Document</span>\n                </div>\n                <p className=\"text-sm text-muted-foreground\">\n                  Upload official invitation letters with player information, club address, country, and trial offer details. League band is automatically assigned.\n                </p>\n              </div>\n              <div className=\"space-y-2\">\n                <div className=\"flex items-center gap-2 text-primary font-medium\">\n                  <Sparkles className=\"h-4 w-4\" />\n                  <span>2. Automatic Scoring</span>\n                </div>\n                <p className=\"text-sm text-muted-foreground\">\n                  The system recalculates eligibility scores based on the target club's league band and country requirements.\n                </p>\n              </div>\n              <div className=\"space-y-2\">\n                <div className=\"flex items-center gap-2 text-primary font-medium\">\n                  <QrCode className=\"h-4 w-4\" />\n                  <span>3. Embassy Verification</span>\n                </div>\n                <p className=\"text-sm text-muted-foreground\">\n                  Consular data reports with QR codes for player videos are generated and made accessible to embassy officials.\n                </p>\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n\n        {players.length === 0 ? (\n          <Card>\n            <CardContent className=\"py-12 text-center\">\n              <User className=\"h-12 w-12 text-muted-foreground mx-auto mb-4\" />\n              <p className=\"text-muted-foreground\">Add players to your roster before uploading invitation letters.</p>\n            </CardContent>\n          </Card>\n        ) : allLetters.length === 0 ? (\n          <Card>\n            <CardHeader>\n              <CardTitle className=\"text-lg\">Uploaded Documents</CardTitle>\n              <CardDescription>Invitation letters for eligibility processing</CardDescription>\n            </CardHeader>\n            <CardContent>\n              <div className=\"text-center py-8 text-muted-foreground\">\n                <FileText className=\"h-8 w-8 mx-auto mb-2\" />\n                <p>No invitation letters uploaded yet</p>\n                <p className=\"text-sm\">Click \"Upload Document\" to get started</p>\n              </div>\n            </CardContent>\n          </Card>\n        ) : (\n          <Card>\n            <CardHeader>\n              <CardTitle className=\"text-lg\">Uploaded Documents</CardTitle>\n              <CardDescription>{allLetters.length} invitation letter(s) on file</CardDescription>\n            </CardHeader>\n            <CardContent>\n              <div className=\"space-y-3\">\n                {allLetters.map((letter) => (\n                  <div \n                    key={letter.id} \n                    className=\"flex flex-wrap items-center justify-between gap-4 p-4 border rounded-md hover-elevate\"\n                    data-testid={`card-letter-${letter.id}`}\n                  >\n                    <div className=\"flex items-center gap-4 min-w-0 flex-1\">\n                      <div className=\"h-10 w-10 rounded-md bg-primary/10 flex items-center justify-center shrink-0\">\n                        <FileText className=\"h-5 w-5 text-primary\" />\n                      </div>\n                      <div className=\"min-w-0\">\n                        <p className=\"font-medium truncate\">\n                          {letter.player?.firstName} {letter.player?.lastName}\n                        </p>\n                        <div className=\"flex flex-wrap items-center gap-2 text-sm text-muted-foreground\">\n                          <span className=\"flex items-center gap-1\">\n                            <Building2 className=\"h-3 w-3\" />\n                            {letter.targetClubName}\n                          </span>\n                          <span className=\"flex items-center gap-1\">\n                            <Globe className=\"h-3 w-3\" />\n                            {letter.targetCountry}\n                          </span>\n                          <span className=\"flex items-center gap-1\">\n                            <MapPin className=\"h-3 w-3\" />\n                            Band {letter.targetLeagueBand}\n                          </span>\n                        </div>\n                      </div>\n                    </div>\n                    <div className=\"flex flex-wrap items-center gap-2\">\n                      {getStatusBadge(letter.status)}\n                      {letter.consularReportGenerated && (\n                        <Badge className=\"bg-blue-500/10 text-blue-600 border-blue-200\">\n                          <FileCheck className=\"h-3 w-3 mr-1\" />\n                          Report Ready\n                        </Badge>\n                      )}\n                      <Button \n                        size=\"sm\" \n                        variant=\"outline\"\n                        onClick={() => {\n                          setSelectedLetter(letter);\n                          setIsViewDialogOpen(true);\n                        }}\n                        data-testid={`button-view-letter-${letter.id}`}\n                      >\n                        <Eye className=\"h-4 w-4 mr-1\" />\n                        View\n                      </Button>\n                      {!letter.consularReportGenerated && (\n                        <Button \n                          size=\"sm\"\n                          onClick={() => generateReportMutation.mutate(letter.id)}\n                          disabled={generateReportMutation.isPending}\n                          data-testid={`button-generate-report-${letter.id}`}\n                        >\n                          <QrCode className=\"h-4 w-4 mr-1\" />\n                          Generate Report\n                        </Button>\n                      )}\n                      <Button \n                        size=\"icon\" \n                        variant=\"ghost\"\n                        onClick={() => deleteMutation.mutate(letter.id)}\n                        disabled={deleteMutation.isPending}\n                        data-testid={`button-delete-letter-${letter.id}`}\n                      >\n                        <Trash2 className=\"h-4 w-4 text-destructive\" />\n                      </Button>\n                    </div>\n                  </div>\n                ))}\n              </div>\n            </CardContent>\n          </Card>\n        )}\n      </div>\n\n      <Dialog open={isViewDialogOpen} onOpenChange={setIsViewDialogOpen}>\n        <DialogContent className=\"max-w-2xl\">\n          <DialogHeader>\n            <DialogTitle>Invitation Letter Details</DialogTitle>\n            <DialogDescription>\n              {selectedLetter?.player?.firstName} {selectedLetter?.player?.lastName} - {selectedLetter?.targetClubName}\n            </DialogDescription>\n          </DialogHeader>\n          {selectedLetter && (\n            <div className=\"space-y-4\">\n              <div className=\"grid grid-cols-2 gap-4\">\n                <div className=\"space-y-1\">\n                  <Label className=\"text-xs text-muted-foreground\">Player</Label>\n                  <p className=\"font-medium\">{selectedLetter.player?.firstName} {selectedLetter.player?.lastName}</p>\n                </div>\n                <div className=\"space-y-1\">\n                  <Label className=\"text-xs text-muted-foreground\">Status</Label>\n                  <div>{getStatusBadge(selectedLetter.status)}</div>\n                </div>\n              </div>\n              <Separator />\n              <div className=\"grid grid-cols-2 gap-4\">\n                <div className=\"space-y-1\">\n                  <Label className=\"text-xs text-muted-foreground\">Target Club</Label>\n                  <p className=\"font-medium\">{selectedLetter.targetClubName}</p>\n                </div>\n                <div className=\"space-y-1\">\n                  <Label className=\"text-xs text-muted-foreground\">Country</Label>\n                  <p className=\"font-medium\">{selectedLetter.targetCountry}</p>\n                </div>\n              </div>\n              {selectedLetter.targetClubAddress && (\n                <div className=\"space-y-1\">\n                  <Label className=\"text-xs text-muted-foreground\">Club Address</Label>\n                  <p className=\"text-sm\">{selectedLetter.targetClubAddress}</p>\n                </div>\n              )}\n              <div className=\"grid grid-cols-3 gap-4\">\n                <div className=\"space-y-1\">\n                  <Label className=\"text-xs text-muted-foreground\">League</Label>\n                  <p className=\"font-medium\">{selectedLetter.targetLeague}</p>\n                </div>\n                <div className=\"space-y-1\">\n                  <Label className=\"text-xs text-muted-foreground\">League Band</Label>\n                  <Badge variant=\"secondary\">Band {selectedLetter.targetLeagueBand}</Badge>\n                </div>\n                <div className=\"space-y-1\">\n                  <Label className=\"text-xs text-muted-foreground\">Offer Type</Label>\n                  <p className=\"font-medium capitalize\">{selectedLetter.offerType || \"Trial\"}</p>\n                </div>\n              </div>\n              {(selectedLetter.trialStartDate || selectedLetter.trialEndDate) && (\n                <div className=\"grid grid-cols-2 gap-4\">\n                  <div className=\"space-y-1\">\n                    <Label className=\"text-xs text-muted-foreground\">Start Date</Label>\n                    <p className=\"font-medium\">{selectedLetter.trialStartDate || \"Not specified\"}</p>\n                  </div>\n                  <div className=\"space-y-1\">\n                    <Label className=\"text-xs text-muted-foreground\">End Date</Label>\n                    <p className=\"font-medium\">{selectedLetter.trialEndDate || \"Not specified\"}</p>\n                  </div>\n                </div>\n              )}\n              {selectedLetter.qrCodeData && (\n                <>\n                  <Separator />\n                  <div className=\"p-4 bg-muted/50 rounded-md\">\n                    <div className=\"flex items-center gap-2 mb-2\">\n                      <QrCode className=\"h-4 w-4 text-primary\" />\n                      <Label className=\"font-medium\">Verification Code</Label>\n                    </div>\n                    <p className=\"font-mono text-sm\">{selectedLetter.qrCodeData}</p>\n                    <p className=\"text-xs text-muted-foreground mt-1\">\n                      Embassy officials can use this code to verify the consular report\n                    </p>\n                  </div>\n                </>\n              )}\n            </div>\n          )}\n          <DialogFooter>\n            <Button variant=\"outline\" onClick={() => setIsViewDialogOpen(false)}>\n              Close\n            </Button>\n            {selectedLetter && !selectedLetter.consularReportGenerated && (\n              <Button \n                onClick={() => {\n                  generateReportMutation.mutate(selectedLetter.id);\n                  setIsViewDialogOpen(false);\n                }}\n                disabled={generateReportMutation.isPending}\n              >\n                <QrCode className=\"h-4 w-4 mr-2\" />\n                Generate Consular Report\n              </Button>\n            )}\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n    </div>\n  );\n}\n","path":null,"size_bytes":32751,"size_tokens":null},"client/src/pages/role-picker.tsx":{"content":"import { Card, CardContent, CardHeader, CardTitle, CardDescription } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Shield, Users, Search, Building2, FileCheck } from \"lucide-react\";\n\ninterface RolePickerProps {\n  onSelectRole: (role: string) => void;\n}\n\nconst roles = [\n  {\n    id: \"sporting_director\",\n    title: \"Team Staff\",\n    description: \"Sporting Directors, Legal, Coaches - Manage squad, compliance, and visa eligibility\",\n    icon: Users,\n    color: \"bg-blue-500/10 text-blue-600 dark:text-blue-400\",\n  },\n  {\n    id: \"scout\",\n    title: \"Scout / Agent\",\n    description: \"Discover players, initiate transfer inquiries, and view eligibility data\",\n    icon: Search,\n    color: \"bg-green-500/10 text-green-600 dark:text-green-400\",\n  },\n  {\n    id: \"embassy\",\n    title: \"Embassy Official\",\n    description: \"View-only access to verify player documentation for visa processing\",\n    icon: Building2,\n    color: \"bg-purple-500/10 text-purple-600 dark:text-purple-400\",\n  },\n  {\n    id: \"federation_admin\",\n    title: \"Federation Administrator\",\n    description: \"Process letter requests, manage fees, and issue federation documents\",\n    icon: FileCheck,\n    color: \"bg-orange-500/10 text-orange-600 dark:text-orange-400\",\n  },\n];\n\nexport default function RolePicker({ onSelectRole }: RolePickerProps) {\n  return (\n    <div className=\"min-h-screen bg-background flex items-center justify-center p-4\" data-testid=\"page-role-picker\">\n      <div className=\"w-full max-w-2xl space-y-6\">\n        <div className=\"text-center space-y-4\">\n          <div className=\"mx-auto p-3 bg-primary rounded-md w-fit\">\n            <Shield className=\"h-8 w-8 text-primary-foreground\" />\n          </div>\n          <div>\n            <h1 className=\"text-3xl font-bold\">Sports Reels</h1>\n            <p className=\"text-muted-foreground mt-2\">\n              Player Compliance & Visa Eligibility Platform\n            </p>\n          </div>\n        </div>\n\n        <Card>\n          <CardHeader className=\"text-center\">\n            <CardTitle>Select Your Role</CardTitle>\n            <CardDescription>\n              Choose how you want to access the platform\n            </CardDescription>\n          </CardHeader>\n          <CardContent className=\"space-y-3\">\n            {roles.map((role) => (\n              <Button\n                key={role.id}\n                variant=\"outline\"\n                className=\"w-full h-auto p-4 justify-start text-left\"\n                onClick={() => onSelectRole(role.id)}\n                data-testid={`button-role-${role.id}`}\n              >\n                <div className={`p-2 rounded-md mr-4 ${role.color}`}>\n                  <role.icon className=\"h-5 w-5\" />\n                </div>\n                <div className=\"flex-1\">\n                  <p className=\"font-medium\">{role.title}</p>\n                  <p className=\"text-sm text-muted-foreground font-normal\">\n                    {role.description}\n                  </p>\n                </div>\n              </Button>\n            ))}\n          </CardContent>\n        </Card>\n\n        <p className=\"text-center text-xs text-muted-foreground\">\n          Demo mode - no authentication required\n        </p>\n      </div>\n    </div>\n  );\n}\n","path":null,"size_bytes":3246,"size_tokens":null},"client/src/components/PlayerInternationalRecords.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { useForm } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { z } from \"zod\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogTrigger, DialogDescription } from \"@/components/ui/dialog\";\nimport { Form, FormControl, FormField, FormItem, FormLabel, FormMessage } from \"@/components/ui/form\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Plus, Globe, Trophy, Calendar, Edit2, Trash2, Flag, Clock, FileText } from \"lucide-react\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport type { PlayerInternationalRecord } from \"@shared/schema\";\n\nconst internationalRecordSchema = z.object({\n  nationalTeam: z.string().min(1, \"National team is required\"),\n  teamLevel: z.string().default(\"senior\"),\n  caps: z.coerce.number().min(0).default(0),\n  goals: z.coerce.number().min(0).default(0),\n  assists: z.coerce.number().min(0).default(0),\n  debutDate: z.string().optional(),\n  lastAppearance: z.string().optional(),\n  competitionLevel: z.string().optional(),\n  notes: z.string().optional(),\n  documentUrl: z.string().optional(),\n});\n\ntype InternationalRecordFormData = z.infer<typeof internationalRecordSchema>;\n\ninterface PlayerInternationalRecordsProps {\n  playerId: string;\n  playerName: string;\n}\n\nexport default function PlayerInternationalRecords({ playerId, playerName }: PlayerInternationalRecordsProps) {\n  const [isAddDialogOpen, setIsAddDialogOpen] = useState(false);\n  const [editingRecord, setEditingRecord] = useState<PlayerInternationalRecord | null>(null);\n  const { toast } = useToast();\n\n  const { data: records = [], isLoading } = useQuery<PlayerInternationalRecord[]>({\n    queryKey: [\"/api/players\", playerId, \"international-records\"],\n    queryFn: async () => {\n      const res = await fetch(`/api/players/${playerId}/international-records`);\n      if (!res.ok) throw new Error(\"Failed to fetch international records\");\n      return res.json();\n    },\n  });\n\n  const form = useForm<InternationalRecordFormData>({\n    resolver: zodResolver(internationalRecordSchema),\n    defaultValues: {\n      nationalTeam: \"\",\n      teamLevel: \"senior\",\n      caps: 0,\n      goals: 0,\n      assists: 0,\n      debutDate: \"\",\n      lastAppearance: \"\",\n      competitionLevel: \"\",\n      notes: \"\",\n      documentUrl: \"\",\n    },\n  });\n\n  const createMutation = useMutation({\n    mutationFn: async (data: InternationalRecordFormData) => {\n      return apiRequest(\"POST\", `/api/players/${playerId}/international-records`, data);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/players\", playerId, \"international-records\"] });\n      setIsAddDialogOpen(false);\n      form.reset();\n      toast({\n        title: \"Record added\",\n        description: \"International record has been added successfully.\",\n      });\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Error\",\n        description: error.message || \"Failed to add record\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const updateMutation = useMutation({\n    mutationFn: async ({ id, data }: { id: string; data: InternationalRecordFormData }) => {\n      return apiRequest(\"PUT\", `/api/players/${playerId}/international-records/${id}`, data);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/players\", playerId, \"international-records\"] });\n      setEditingRecord(null);\n      form.reset();\n      toast({\n        title: \"Record updated\",\n        description: \"International record has been updated successfully.\",\n      });\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Error\",\n        description: error.message || \"Failed to update record\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const deleteMutation = useMutation({\n    mutationFn: async (id: string) => {\n      return apiRequest(\"DELETE\", `/api/players/${playerId}/international-records/${id}`);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/players\", playerId, \"international-records\"] });\n      toast({\n        title: \"Record deleted\",\n        description: \"International record has been removed.\",\n      });\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Error\",\n        description: error.message || \"Failed to delete record\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const onSubmit = (data: InternationalRecordFormData) => {\n    if (editingRecord) {\n      updateMutation.mutate({ id: editingRecord.id, data });\n    } else {\n      createMutation.mutate(data);\n    }\n  };\n\n  const handleEdit = (record: PlayerInternationalRecord) => {\n    setEditingRecord(record);\n    form.reset({\n      nationalTeam: record.nationalTeam,\n      teamLevel: record.teamLevel || \"senior\",\n      caps: record.caps || 0,\n      goals: record.goals || 0,\n      assists: record.assists || 0,\n      debutDate: record.debutDate || \"\",\n      lastAppearance: record.lastAppearance || \"\",\n      competitionLevel: record.competitionLevel || \"\",\n      notes: record.notes || \"\",\n      documentUrl: record.documentUrl || \"\",\n    });\n  };\n\n  const closeDialog = () => {\n    setIsAddDialogOpen(false);\n    setEditingRecord(null);\n    form.reset();\n  };\n\n  const totalCaps = records.reduce((sum, r) => sum + (r.caps || 0), 0);\n  const totalGoals = records.reduce((sum, r) => sum + (r.goals || 0), 0);\n  const totalAssists = records.reduce((sum, r) => sum + (r.assists || 0), 0);\n\n  const RecordForm = () => (\n    <Form {...form}>\n      <form onSubmit={form.handleSubmit(onSubmit)} className=\"space-y-4\">\n        <div className=\"grid grid-cols-2 gap-4\">\n          <FormField\n            control={form.control}\n            name=\"nationalTeam\"\n            render={({ field }) => (\n              <FormItem>\n                <FormLabel>National Team</FormLabel>\n                <FormControl>\n                  <Input {...field} placeholder=\"e.g., Nigeria, Brazil\" data-testid=\"input-national-team\" />\n                </FormControl>\n                <FormMessage />\n              </FormItem>\n            )}\n          />\n          <FormField\n            control={form.control}\n            name=\"teamLevel\"\n            render={({ field }) => (\n              <FormItem>\n                <FormLabel>Team Level</FormLabel>\n                <Select onValueChange={field.onChange} value={field.value}>\n                  <FormControl>\n                    <SelectTrigger data-testid=\"select-team-level\">\n                      <SelectValue placeholder=\"Select level\" />\n                    </SelectTrigger>\n                  </FormControl>\n                  <SelectContent>\n                    <SelectItem value=\"senior\">Senior</SelectItem>\n                    <SelectItem value=\"u23\">U-23</SelectItem>\n                    <SelectItem value=\"u21\">U-21</SelectItem>\n                    <SelectItem value=\"u20\">U-20</SelectItem>\n                    <SelectItem value=\"u19\">U-19</SelectItem>\n                    <SelectItem value=\"u17\">U-17</SelectItem>\n                  </SelectContent>\n                </Select>\n                <FormMessage />\n              </FormItem>\n            )}\n          />\n        </div>\n\n        <div className=\"grid grid-cols-3 gap-4\">\n          <FormField\n            control={form.control}\n            name=\"caps\"\n            render={({ field }) => (\n              <FormItem>\n                <FormLabel>Caps</FormLabel>\n                <FormControl>\n                  <Input type=\"number\" {...field} min={0} data-testid=\"input-caps\" />\n                </FormControl>\n                <FormMessage />\n              </FormItem>\n            )}\n          />\n          <FormField\n            control={form.control}\n            name=\"goals\"\n            render={({ field }) => (\n              <FormItem>\n                <FormLabel>Goals</FormLabel>\n                <FormControl>\n                  <Input type=\"number\" {...field} min={0} data-testid=\"input-goals\" />\n                </FormControl>\n                <FormMessage />\n              </FormItem>\n            )}\n          />\n          <FormField\n            control={form.control}\n            name=\"assists\"\n            render={({ field }) => (\n              <FormItem>\n                <FormLabel>Assists</FormLabel>\n                <FormControl>\n                  <Input type=\"number\" {...field} min={0} data-testid=\"input-assists\" />\n                </FormControl>\n                <FormMessage />\n              </FormItem>\n            )}\n          />\n        </div>\n\n        <div className=\"grid grid-cols-2 gap-4\">\n          <FormField\n            control={form.control}\n            name=\"debutDate\"\n            render={({ field }) => (\n              <FormItem>\n                <FormLabel>Debut Date</FormLabel>\n                <FormControl>\n                  <Input type=\"date\" {...field} data-testid=\"input-debut-date\" />\n                </FormControl>\n                <FormMessage />\n              </FormItem>\n            )}\n          />\n          <FormField\n            control={form.control}\n            name=\"lastAppearance\"\n            render={({ field }) => (\n              <FormItem>\n                <FormLabel>Last Appearance</FormLabel>\n                <FormControl>\n                  <Input type=\"date\" {...field} data-testid=\"input-last-appearance\" />\n                </FormControl>\n                <FormMessage />\n              </FormItem>\n            )}\n          />\n        </div>\n\n        <FormField\n          control={form.control}\n          name=\"competitionLevel\"\n          render={({ field }) => (\n            <FormItem>\n              <FormLabel>Competition Level</FormLabel>\n              <Select onValueChange={field.onChange} value={field.value || \"\"}>\n                <FormControl>\n                  <SelectTrigger data-testid=\"select-competition-level\">\n                    <SelectValue placeholder=\"Select competition level\" />\n                  </SelectTrigger>\n                </FormControl>\n                <SelectContent>\n                  <SelectItem value=\"world_cup\">FIFA World Cup</SelectItem>\n                  <SelectItem value=\"continental\">Continental Championship</SelectItem>\n                  <SelectItem value=\"world_cup_qualifier\">World Cup Qualifier</SelectItem>\n                  <SelectItem value=\"continental_qualifier\">Continental Qualifier</SelectItem>\n                  <SelectItem value=\"friendly\">Friendly</SelectItem>\n                  <SelectItem value=\"youth_tournament\">Youth Tournament</SelectItem>\n                </SelectContent>\n              </Select>\n              <FormMessage />\n            </FormItem>\n          )}\n        />\n\n        <FormField\n          control={form.control}\n          name=\"documentUrl\"\n          render={({ field }) => (\n            <FormItem>\n              <FormLabel>Supporting Document URL (optional)</FormLabel>\n              <FormControl>\n                <Input {...field} placeholder=\"https://...\" data-testid=\"input-document-url\" />\n              </FormControl>\n              <FormMessage />\n            </FormItem>\n          )}\n        />\n\n        <FormField\n          control={form.control}\n          name=\"notes\"\n          render={({ field }) => (\n            <FormItem>\n              <FormLabel>Notes (optional)</FormLabel>\n              <FormControl>\n                <Textarea {...field} placeholder=\"Additional notes about international career...\" data-testid=\"textarea-notes\" />\n              </FormControl>\n              <FormMessage />\n            </FormItem>\n          )}\n        />\n\n        <div className=\"flex gap-2 pt-4\">\n          <Button type=\"button\" variant=\"outline\" onClick={closeDialog}>\n            Cancel\n          </Button>\n          <Button \n            type=\"submit\" \n            disabled={createMutation.isPending || updateMutation.isPending} \n            data-testid=\"button-submit-record\"\n          >\n            {createMutation.isPending || updateMutation.isPending \n              ? \"Saving...\" \n              : editingRecord ? \"Update Record\" : \"Add Record\"}\n          </Button>\n        </div>\n      </form>\n    </Form>\n  );\n\n  return (\n    <Card data-testid=\"card-international-records\">\n      <CardHeader className=\"flex flex-row items-center justify-between gap-2 pb-4\">\n        <div className=\"flex items-center gap-2\">\n          <Globe className=\"h-5 w-5 text-primary\" />\n          <CardTitle className=\"text-lg\">International Career</CardTitle>\n        </div>\n        <Dialog open={isAddDialogOpen || !!editingRecord} onOpenChange={(open) => !open && closeDialog()}>\n          <DialogTrigger asChild>\n            <Button size=\"sm\" onClick={() => setIsAddDialogOpen(true)} data-testid=\"button-add-international-record\">\n              <Plus className=\"h-4 w-4 mr-1\" />\n              Add Record\n            </Button>\n          </DialogTrigger>\n          <DialogContent className=\"max-w-lg max-h-[90vh] overflow-y-auto\">\n            <DialogHeader>\n              <DialogTitle className=\"flex items-center gap-2\">\n                <Flag className=\"h-5 w-5\" />\n                {editingRecord ? \"Edit International Record\" : \"Add International Record\"}\n              </DialogTitle>\n              <DialogDescription>\n                {editingRecord \n                  ? `Update ${playerName}'s international record for ${editingRecord.nationalTeam}`\n                  : `Add a new international record for ${playerName}`}\n              </DialogDescription>\n            </DialogHeader>\n            <RecordForm />\n          </DialogContent>\n        </Dialog>\n      </CardHeader>\n      <CardContent>\n        {isLoading ? (\n          <div className=\"text-center py-8 text-muted-foreground\">Loading records...</div>\n        ) : records.length === 0 ? (\n          <div className=\"text-center py-8 text-muted-foreground\">\n            <Globe className=\"h-12 w-12 mx-auto mb-2 opacity-50\" />\n            <p>No international records yet</p>\n            <p className=\"text-sm\">Add records to track international career</p>\n          </div>\n        ) : (\n          <div className=\"space-y-4\">\n            <div className=\"grid grid-cols-3 gap-4 p-4 bg-muted/50 rounded-md\">\n              <div className=\"text-center\">\n                <p className=\"text-2xl font-bold text-primary\">{totalCaps}</p>\n                <p className=\"text-xs text-muted-foreground\">Total Caps</p>\n              </div>\n              <div className=\"text-center\">\n                <p className=\"text-2xl font-bold text-green-600\">{totalGoals}</p>\n                <p className=\"text-xs text-muted-foreground\">Goals</p>\n              </div>\n              <div className=\"text-center\">\n                <p className=\"text-2xl font-bold text-blue-600\">{totalAssists}</p>\n                <p className=\"text-xs text-muted-foreground\">Assists</p>\n              </div>\n            </div>\n\n            <div className=\"space-y-3\">\n              {records.map((record) => (\n                <div \n                  key={record.id} \n                  className=\"flex items-start justify-between gap-4 p-4 border rounded-md\"\n                  data-testid={`international-record-${record.id}`}\n                >\n                  <div className=\"flex-1 space-y-2\">\n                    <div className=\"flex items-center gap-2\">\n                      <Flag className=\"h-4 w-4 text-muted-foreground\" />\n                      <span className=\"font-medium\">{record.nationalTeam}</span>\n                      <Badge variant=\"secondary\" className=\"text-xs\">\n                        {record.teamLevel || \"senior\"}\n                      </Badge>\n                      {record.verificationStatus === \"verified\" && (\n                        <Badge variant=\"outline\" className=\"text-xs bg-green-50 text-green-700 dark:bg-green-900/30 dark:text-green-400\">\n                          Verified\n                        </Badge>\n                      )}\n                    </div>\n                    <div className=\"flex flex-wrap gap-4 text-sm text-muted-foreground\">\n                      <span className=\"flex items-center gap-1\">\n                        <Trophy className=\"h-3 w-3\" />\n                        {record.caps || 0} caps\n                      </span>\n                      <span>{record.goals || 0} goals</span>\n                      <span>{record.assists || 0} assists</span>\n                    </div>\n                    {record.debutDate && (\n                      <div className=\"flex items-center gap-1 text-xs text-muted-foreground\">\n                        <Calendar className=\"h-3 w-3\" />\n                        Debut: {record.debutDate}\n                        {record.lastAppearance && ` - Last: ${record.lastAppearance}`}\n                      </div>\n                    )}\n                    {record.competitionLevel && (\n                      <Badge variant=\"outline\" className=\"text-xs\">\n                        {record.competitionLevel.replace(/_/g, \" \")}\n                      </Badge>\n                    )}\n                    {record.documentUrl && (\n                      <a \n                        href={record.documentUrl} \n                        target=\"_blank\" \n                        rel=\"noopener noreferrer\"\n                        className=\"flex items-center gap-1 text-xs text-primary hover:underline\"\n                      >\n                        <FileText className=\"h-3 w-3\" />\n                        View Document\n                      </a>\n                    )}\n                  </div>\n                  <div className=\"flex gap-1\">\n                    <Button \n                      size=\"icon\" \n                      variant=\"ghost\" \n                      onClick={() => handleEdit(record)}\n                      data-testid={`button-edit-record-${record.id}`}\n                    >\n                      <Edit2 className=\"h-4 w-4\" />\n                    </Button>\n                    <Button \n                      size=\"icon\" \n                      variant=\"ghost\" \n                      onClick={() => deleteMutation.mutate(record.id)}\n                      data-testid={`button-delete-record-${record.id}`}\n                    >\n                      <Trash2 className=\"h-4 w-4 text-destructive\" />\n                    </Button>\n                  </div>\n                </div>\n              ))}\n            </div>\n          </div>\n        )}\n      </CardContent>\n    </Card>\n  );\n}\n","path":null,"size_bytes":18813,"size_tokens":null},"client/src/components/PlayerProfileEditor.tsx":{"content":"import { useForm } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { z } from \"zod\";\nimport { useMutation } from \"@tanstack/react-query\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Form, FormControl, FormField, FormItem, FormLabel, FormMessage } from \"@/components/ui/form\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { Activity, Clock, User, Ruler, Weight, Heart, Save } from \"lucide-react\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport type { Player } from \"@shared/schema\";\n\nconst profileSchema = z.object({\n  firstName: z.string().min(1, \"First name is required\"),\n  lastName: z.string().min(1, \"Last name is required\"),\n  nationality: z.string().min(1, \"Nationality is required\"),\n  secondNationality: z.string().optional(),\n  dateOfBirth: z.string().optional(),\n  birthPlace: z.string().optional(),\n  position: z.string().min(1, \"Position is required\"),\n  secondaryPosition: z.string().optional(),\n  currentClubName: z.string().optional(),\n  jerseyNumber: z.coerce.number().min(0).optional(),\n  agentName: z.string().optional(),\n  agentContact: z.string().optional(),\n  contractEndDate: z.string().optional(),\n  marketValue: z.coerce.number().min(0).optional(),\n  height: z.coerce.number().min(0).optional(),\n  heightUnit: z.string().default(\"cm\"),\n  weight: z.coerce.number().min(0).optional(),\n  weightUnit: z.string().default(\"kg\"),\n  wingspan: z.coerce.number().min(0).optional(),\n  preferredFoot: z.string().optional(),\n  bmi: z.coerce.number().min(0).optional(),\n  nationalTeamCaps: z.coerce.number().min(0).default(0),\n  nationalTeamGoals: z.coerce.number().min(0).default(0),\n  internationalCaps: z.coerce.number().min(0).default(0),\n  internationalGoals: z.coerce.number().min(0).default(0),\n  continentalGames: z.coerce.number().min(0).default(0),\n  clubMinutesCurrentSeason: z.coerce.number().min(0).default(0),\n  clubMinutesLast12Months: z.coerce.number().min(0).default(0),\n  internationalMinutesCurrentSeason: z.coerce.number().min(0).default(0),\n  internationalMinutesLast12Months: z.coerce.number().min(0).default(0),\n  totalCareerMinutes: z.coerce.number().min(0).default(0),\n  profileDocumentUrl: z.string().optional(),\n});\n\ntype ProfileFormData = z.infer<typeof profileSchema>;\n\ninterface PlayerProfileEditorProps {\n  player: Player;\n  onSaved?: () => void;\n}\n\nexport default function PlayerProfileEditor({ player, onSaved }: PlayerProfileEditorProps) {\n  const { toast } = useToast();\n\n  const form = useForm<ProfileFormData>({\n    resolver: zodResolver(profileSchema),\n    defaultValues: {\n      firstName: player.firstName || \"\",\n      lastName: player.lastName || \"\",\n      nationality: player.nationality || \"\",\n      secondNationality: player.secondNationality || \"\",\n      dateOfBirth: player.dateOfBirth || \"\",\n      birthPlace: player.birthPlace || \"\",\n      position: player.position || \"\",\n      secondaryPosition: player.secondaryPosition || \"\",\n      currentClubName: player.currentClubName || \"\",\n      jerseyNumber: player.jerseyNumber ?? 0,\n      agentName: player.agentName || \"\",\n      agentContact: player.agentContact || \"\",\n      contractEndDate: player.contractEndDate || \"\",\n      marketValue: player.marketValue ?? 0,\n      height: player.height ?? 0,\n      heightUnit: player.heightUnit || \"cm\",\n      weight: player.weight ?? 0,\n      weightUnit: player.weightUnit || \"kg\",\n      wingspan: player.wingspan ?? 0,\n      preferredFoot: player.preferredFoot || \"\",\n      bmi: player.bmi ?? 0,\n      nationalTeamCaps: player.nationalTeamCaps || 0,\n      nationalTeamGoals: player.nationalTeamGoals || 0,\n      internationalCaps: player.internationalCaps || 0,\n      internationalGoals: player.internationalGoals || 0,\n      continentalGames: player.continentalGames || 0,\n      clubMinutesCurrentSeason: player.clubMinutesCurrentSeason || 0,\n      clubMinutesLast12Months: player.clubMinutesLast12Months || 0,\n      internationalMinutesCurrentSeason: player.internationalMinutesCurrentSeason || 0,\n      internationalMinutesLast12Months: player.internationalMinutesLast12Months || 0,\n      totalCareerMinutes: player.totalCareerMinutes || 0,\n      profileDocumentUrl: player.profileDocumentUrl || \"\",\n    },\n  });\n\n  const updateMutation = useMutation({\n    mutationFn: async (data: ProfileFormData) => {\n      return apiRequest(\"PUT\", `/api/players/${player.id}`, data);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/players\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/players\", player.id] });\n      toast({\n        title: \"Profile updated\",\n        description: \"Player profile has been saved successfully.\",\n      });\n      onSaved?.();\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Error\",\n        description: error.message || \"Failed to update profile\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const onSubmit = (data: ProfileFormData) => {\n    if (data.secondaryPosition === \"none\") {\n      data.secondaryPosition = undefined;\n    }\n    if (data.height && data.weight) {\n      const heightInMeters = data.heightUnit === \"cm\" ? data.height / 100 : data.height * 0.3048;\n      const weightInKg = data.weightUnit === \"kg\" ? data.weight : data.weight * 0.453592;\n      data.bmi = Math.round((weightInKg / (heightInMeters * heightInMeters)) * 10) / 10;\n    }\n    updateMutation.mutate(data);\n  };\n\n  return (\n    <Card data-testid=\"card-player-profile-editor\">\n      <CardHeader className=\"pb-4\">\n        <CardTitle className=\"text-lg flex items-center gap-2\">\n          <User className=\"h-5 w-5 text-primary\" />\n          Player Profile\n        </CardTitle>\n      </CardHeader>\n      <CardContent>\n        <Form {...form}>\n          <form onSubmit={form.handleSubmit(onSubmit)} className=\"space-y-6\">\n            <Tabs defaultValue=\"basic\" className=\"w-full\">\n              <TabsList className=\"grid w-full grid-cols-4\">\n                <TabsTrigger value=\"basic\" data-testid=\"tab-basic\">Basic</TabsTrigger>\n                <TabsTrigger value=\"biometrics\" data-testid=\"tab-biometrics\">Biometrics</TabsTrigger>\n                <TabsTrigger value=\"international\" data-testid=\"tab-international\">International</TabsTrigger>\n                <TabsTrigger value=\"minutes\" data-testid=\"tab-minutes\">Minutes</TabsTrigger>\n              </TabsList>\n\n              <TabsContent value=\"basic\" className=\"space-y-4 pt-4\">\n                <div className=\"grid grid-cols-2 gap-4\">\n                  <FormField\n                    control={form.control}\n                    name=\"firstName\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>First Name</FormLabel>\n                        <FormControl>\n                          <Input {...field} data-testid=\"input-edit-first-name\" />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n                  <FormField\n                    control={form.control}\n                    name=\"lastName\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>Last Name</FormLabel>\n                        <FormControl>\n                          <Input {...field} data-testid=\"input-edit-last-name\" />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n                </div>\n\n                <div className=\"grid grid-cols-2 gap-4\">\n                  <FormField\n                    control={form.control}\n                    name=\"nationality\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>Nationality</FormLabel>\n                        <FormControl>\n                          <Input {...field} data-testid=\"input-edit-nationality\" />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n                  <FormField\n                    control={form.control}\n                    name=\"secondNationality\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>Second Nationality (optional)</FormLabel>\n                        <FormControl>\n                          <Input {...field} data-testid=\"input-edit-second-nationality\" />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n                </div>\n\n                <div className=\"grid grid-cols-2 gap-4\">\n                  <FormField\n                    control={form.control}\n                    name=\"position\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>Position</FormLabel>\n                        <Select onValueChange={field.onChange} value={field.value}>\n                          <FormControl>\n                            <SelectTrigger data-testid=\"select-edit-position\">\n                              <SelectValue placeholder=\"Select position\" />\n                            </SelectTrigger>\n                          </FormControl>\n                          <SelectContent>\n                            <SelectItem value=\"Goalkeeper\">Goalkeeper</SelectItem>\n                            <SelectItem value=\"Defender\">Defender</SelectItem>\n                            <SelectItem value=\"Midfielder\">Midfielder</SelectItem>\n                            <SelectItem value=\"Winger\">Winger</SelectItem>\n                            <SelectItem value=\"Striker\">Striker</SelectItem>\n                          </SelectContent>\n                        </Select>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n                  <FormField\n                    control={form.control}\n                    name=\"secondaryPosition\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>Secondary Position (optional)</FormLabel>\n                        <Select onValueChange={field.onChange} value={field.value || \"\"}>\n                          <FormControl>\n                            <SelectTrigger data-testid=\"select-edit-secondary-position\">\n                              <SelectValue placeholder=\"Select position\" />\n                            </SelectTrigger>\n                          </FormControl>\n                          <SelectContent>\n                            <SelectItem value=\"none\">None</SelectItem>\n                            <SelectItem value=\"Goalkeeper\">Goalkeeper</SelectItem>\n                            <SelectItem value=\"Defender\">Defender</SelectItem>\n                            <SelectItem value=\"Midfielder\">Midfielder</SelectItem>\n                            <SelectItem value=\"Winger\">Winger</SelectItem>\n                            <SelectItem value=\"Striker\">Striker</SelectItem>\n                          </SelectContent>\n                        </Select>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n                </div>\n\n                <div className=\"grid grid-cols-2 gap-4\">\n                  <FormField\n                    control={form.control}\n                    name=\"dateOfBirth\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>Date of Birth</FormLabel>\n                        <FormControl>\n                          <Input type=\"date\" {...field} data-testid=\"input-edit-dob\" />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n                  <FormField\n                    control={form.control}\n                    name=\"birthPlace\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>Birth Place</FormLabel>\n                        <FormControl>\n                          <Input {...field} placeholder=\"City, Country\" data-testid=\"input-edit-birthplace\" />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n                </div>\n\n                <div className=\"grid grid-cols-2 gap-4\">\n                  <FormField\n                    control={form.control}\n                    name=\"currentClubName\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>Current Club</FormLabel>\n                        <FormControl>\n                          <Input {...field} placeholder=\"Club name\" data-testid=\"input-edit-club\" />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n                  <FormField\n                    control={form.control}\n                    name=\"jerseyNumber\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>Jersey Number</FormLabel>\n                        <FormControl>\n                          <Input type=\"number\" {...field} min={0} max={99} data-testid=\"input-edit-jersey\" />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n                </div>\n\n                <div className=\"grid grid-cols-2 gap-4\">\n                  <FormField\n                    control={form.control}\n                    name=\"contractEndDate\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>Contract End Date</FormLabel>\n                        <FormControl>\n                          <Input type=\"date\" {...field} data-testid=\"input-edit-contract\" />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n                  <FormField\n                    control={form.control}\n                    name=\"marketValue\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>Market Value (EUR)</FormLabel>\n                        <FormControl>\n                          <Input type=\"number\" {...field} min={0} data-testid=\"input-edit-market-value\" />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n                </div>\n\n                <div className=\"grid grid-cols-2 gap-4\">\n                  <FormField\n                    control={form.control}\n                    name=\"agentName\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>Agent Name</FormLabel>\n                        <FormControl>\n                          <Input {...field} placeholder=\"Agent name\" data-testid=\"input-edit-agent\" />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n                  <FormField\n                    control={form.control}\n                    name=\"agentContact\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>Agent Contact</FormLabel>\n                        <FormControl>\n                          <Input {...field} placeholder=\"Email or phone\" data-testid=\"input-edit-agent-contact\" />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n                </div>\n              </TabsContent>\n\n              <TabsContent value=\"biometrics\" className=\"space-y-4 pt-4\">\n                <div className=\"flex items-center gap-2 mb-4\">\n                  <Heart className=\"h-5 w-5 text-muted-foreground\" />\n                  <p className=\"text-sm text-muted-foreground\">Physical measurements and biometric data</p>\n                </div>\n\n                <div className=\"grid grid-cols-3 gap-4\">\n                  <FormField\n                    control={form.control}\n                    name=\"height\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel className=\"flex items-center gap-1\">\n                          <Ruler className=\"h-3 w-3\" />\n                          Height\n                        </FormLabel>\n                        <FormControl>\n                          <Input type=\"number\" {...field} min={0} data-testid=\"input-edit-height\" />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n                  <FormField\n                    control={form.control}\n                    name=\"heightUnit\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>Unit</FormLabel>\n                        <Select onValueChange={field.onChange} value={field.value}>\n                          <FormControl>\n                            <SelectTrigger data-testid=\"select-height-unit\">\n                              <SelectValue />\n                            </SelectTrigger>\n                          </FormControl>\n                          <SelectContent>\n                            <SelectItem value=\"cm\">cm</SelectItem>\n                            <SelectItem value=\"ft\">ft</SelectItem>\n                          </SelectContent>\n                        </Select>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n                  <FormField\n                    control={form.control}\n                    name=\"wingspan\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>Wingspan (cm)</FormLabel>\n                        <FormControl>\n                          <Input type=\"number\" {...field} min={0} data-testid=\"input-edit-wingspan\" />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n                </div>\n\n                <div className=\"grid grid-cols-3 gap-4\">\n                  <FormField\n                    control={form.control}\n                    name=\"weight\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel className=\"flex items-center gap-1\">\n                          <Weight className=\"h-3 w-3\" />\n                          Weight\n                        </FormLabel>\n                        <FormControl>\n                          <Input type=\"number\" {...field} min={0} data-testid=\"input-edit-weight\" />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n                  <FormField\n                    control={form.control}\n                    name=\"weightUnit\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>Unit</FormLabel>\n                        <Select onValueChange={field.onChange} value={field.value}>\n                          <FormControl>\n                            <SelectTrigger data-testid=\"select-weight-unit\">\n                              <SelectValue />\n                            </SelectTrigger>\n                          </FormControl>\n                          <SelectContent>\n                            <SelectItem value=\"kg\">kg</SelectItem>\n                            <SelectItem value=\"lbs\">lbs</SelectItem>\n                          </SelectContent>\n                        </Select>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n                  <FormField\n                    control={form.control}\n                    name=\"bmi\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>BMI (auto-calculated)</FormLabel>\n                        <FormControl>\n                          <Input type=\"number\" {...field} readOnly className=\"bg-muted\" data-testid=\"input-edit-bmi\" />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n                </div>\n\n                <FormField\n                  control={form.control}\n                  name=\"preferredFoot\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Preferred Foot</FormLabel>\n                      <Select onValueChange={field.onChange} value={field.value || \"\"}>\n                        <FormControl>\n                          <SelectTrigger data-testid=\"select-preferred-foot\">\n                            <SelectValue placeholder=\"Select preferred foot\" />\n                          </SelectTrigger>\n                        </FormControl>\n                        <SelectContent>\n                          <SelectItem value=\"Right\">Right</SelectItem>\n                          <SelectItem value=\"Left\">Left</SelectItem>\n                          <SelectItem value=\"Both\">Both</SelectItem>\n                        </SelectContent>\n                      </Select>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                <FormField\n                  control={form.control}\n                  name=\"profileDocumentUrl\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Profile Document URL (optional)</FormLabel>\n                      <FormControl>\n                        <Input {...field} placeholder=\"https://...\" data-testid=\"input-profile-doc\" />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n              </TabsContent>\n\n              <TabsContent value=\"international\" className=\"space-y-4 pt-4\">\n                <div className=\"flex items-center gap-2 mb-4\">\n                  <Activity className=\"h-5 w-5 text-muted-foreground\" />\n                  <p className=\"text-sm text-muted-foreground\">National team statistics</p>\n                </div>\n\n                <div className=\"grid grid-cols-2 gap-4\">\n                  <FormField\n                    control={form.control}\n                    name=\"nationalTeamCaps\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>National Team Caps</FormLabel>\n                        <FormControl>\n                          <Input type=\"number\" {...field} min={0} data-testid=\"input-national-caps\" />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n                  <FormField\n                    control={form.control}\n                    name=\"nationalTeamGoals\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>National Team Goals</FormLabel>\n                        <FormControl>\n                          <Input type=\"number\" {...field} min={0} data-testid=\"input-national-goals\" />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n                </div>\n\n                <div className=\"grid grid-cols-2 gap-4\">\n                  <FormField\n                    control={form.control}\n                    name=\"internationalCaps\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>International Caps (All)</FormLabel>\n                        <FormControl>\n                          <Input type=\"number\" {...field} min={0} data-testid=\"input-intl-caps\" />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n                  <FormField\n                    control={form.control}\n                    name=\"internationalGoals\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>International Goals (All)</FormLabel>\n                        <FormControl>\n                          <Input type=\"number\" {...field} min={0} data-testid=\"input-intl-goals\" />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n                </div>\n\n                <FormField\n                  control={form.control}\n                  name=\"continentalGames\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Continental Games</FormLabel>\n                      <FormControl>\n                        <Input type=\"number\" {...field} min={0} data-testid=\"input-continental-games\" />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n              </TabsContent>\n\n              <TabsContent value=\"minutes\" className=\"space-y-4 pt-4\">\n                <div className=\"flex items-center gap-2 mb-4\">\n                  <Clock className=\"h-5 w-5 text-muted-foreground\" />\n                  <p className=\"text-sm text-muted-foreground\">Playing time tracking</p>\n                </div>\n\n                <div className=\"grid grid-cols-2 gap-4\">\n                  <FormField\n                    control={form.control}\n                    name=\"clubMinutesCurrentSeason\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>Club Minutes (Current Season)</FormLabel>\n                        <FormControl>\n                          <Input type=\"number\" {...field} min={0} data-testid=\"input-club-minutes-season\" />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n                  <FormField\n                    control={form.control}\n                    name=\"clubMinutesLast12Months\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>Club Minutes (Last 12 Months)</FormLabel>\n                        <FormControl>\n                          <Input type=\"number\" {...field} min={0} data-testid=\"input-club-minutes-12m\" />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n                </div>\n\n                <div className=\"grid grid-cols-2 gap-4\">\n                  <FormField\n                    control={form.control}\n                    name=\"internationalMinutesCurrentSeason\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>International Minutes (Current Season)</FormLabel>\n                        <FormControl>\n                          <Input type=\"number\" {...field} min={0} data-testid=\"input-intl-minutes-season\" />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n                  <FormField\n                    control={form.control}\n                    name=\"internationalMinutesLast12Months\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>International Minutes (Last 12 Months)</FormLabel>\n                        <FormControl>\n                          <Input type=\"number\" {...field} min={0} data-testid=\"input-intl-minutes-12m\" />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n                </div>\n\n                <FormField\n                  control={form.control}\n                  name=\"totalCareerMinutes\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Total Career Minutes</FormLabel>\n                      <FormControl>\n                        <Input type=\"number\" {...field} min={0} data-testid=\"input-total-career-minutes\" />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n              </TabsContent>\n            </Tabs>\n\n            <div className=\"flex justify-end pt-4 border-t\">\n              <Button \n                type=\"submit\" \n                disabled={updateMutation.isPending} \n                data-testid=\"button-save-profile\"\n              >\n                <Save className=\"h-4 w-4 mr-2\" />\n                {updateMutation.isPending ? \"Saving...\" : \"Save Profile\"}\n              </Button>\n            </div>\n          </form>\n        </Form>\n      </CardContent>\n    </Card>\n  );\n}\n","path":null,"size_bytes":30158,"size_tokens":null},"client/src/pages/team-sheets.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { useLocation } from \"wouter\";\nimport { queryClient, apiRequest } from \"@/lib/queryClient\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { ScrollArea } from \"@/components/ui/scroll-area\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle } from \"@/components/ui/dialog\";\nimport { Separator } from \"@/components/ui/separator\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { \n  Plus, \n  X, \n  Users, \n  Calendar, \n  Clock, \n  MapPin, \n  Trophy, \n  Video, \n  UserPlus, \n  ArrowLeft,\n  FileText,\n  Play,\n  Trash2\n} from \"lucide-react\";\nimport type { Player, TeamSheet, TeamSheetPlayer } from \"@shared/schema\";\n\nconst COUNTRIES = [\n  \"England\", \"Spain\", \"Germany\", \"Italy\", \"France\", \n  \"Netherlands\", \"Portugal\", \"Norway\", \"Nigeria\", \"USA\"\n];\n\nconst POSITIONS = [\n  \"GK\", \"LB\", \"CB\", \"RB\", \"LWB\", \"RWB\", \"CDM\", \"CM\", \"CAM\", \n  \"LM\", \"RM\", \"LW\", \"RW\", \"CF\", \"ST\"\n];\n\nexport default function TeamSheets() {\n  const [, navigate] = useLocation();\n  const { toast } = useToast();\n  const [showCreateDialog, setShowCreateDialog] = useState(false);\n  const [selectedSheet, setSelectedSheet] = useState<string | null>(null);\n  const [showPlayerSelect, setShowPlayerSelect] = useState(false);\n  const [addingRole, setAddingRole] = useState<\"starting\" | \"substitute\">(\"starting\");\n  const [selectedCountry, setSelectedCountry] = useState(\"England\");\n  \n  const [formCompetition, setFormCompetition] = useState(\"\");\n  const [formHomeAway, setFormHomeAway] = useState(\"home\");\n  const [formFormation, setFormFormation] = useState(\"4-3-3\");\n  \n  const handleCountryChange = (country: string) => {\n    setSelectedCountry(country);\n    setFormCompetition(\"\");\n  };\n\n  const { data: teamSheets, isLoading: sheetsLoading } = useQuery<TeamSheet[]>({\n    queryKey: [\"/api/team-sheets\"],\n  });\n\n  const { data: players } = useQuery<Player[]>({\n    queryKey: [\"/api/players\"],\n  });\n\n  const { data: selectedSheetData, isLoading: sheetDataLoading } = useQuery<TeamSheet & { players: TeamSheetPlayer[] }>({\n    queryKey: [\"/api/team-sheets\", selectedSheet],\n    enabled: !!selectedSheet,\n  });\n\n  const { data: competitions } = useQuery<{ name: string; type: string }[]>({\n    queryKey: [\"/api/competitions\", selectedCountry],\n    queryFn: () => fetch(`/api/competitions?country=${selectedCountry}`).then(r => r.json()),\n  });\n\n  const createSheetMutation = useMutation({\n    mutationFn: async (data: any) => apiRequest(\"POST\", \"/api/team-sheets\", data),\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/team-sheets\"] });\n      setShowCreateDialog(false);\n      setFormCompetition(\"\");\n      setFormHomeAway(\"home\");\n      setFormFormation(\"4-3-3\");\n      toast({ title: \"Team sheet created\" });\n    },\n    onError: (err: any) => toast({ title: \"Error\", description: err.message, variant: \"destructive\" }),\n  });\n\n  const addPlayerMutation = useMutation({\n    mutationFn: async ({ sheetId, data }: { sheetId: string; data: any }) => \n      apiRequest(\"POST\", `/api/team-sheets/${sheetId}/players`, data),\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/team-sheets\", selectedSheet] });\n      setShowPlayerSelect(false);\n      toast({ title: \"Player added\" });\n    },\n    onError: (err: any) => toast({ title: \"Error\", description: err.message, variant: \"destructive\" }),\n  });\n\n  const removePlayerMutation = useMutation({\n    mutationFn: async (playerId: string) => \n      apiRequest(\"DELETE\", `/api/team-sheet-players/${playerId}`),\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/team-sheets\", selectedSheet] });\n      toast({ title: \"Player removed\" });\n    },\n  });\n\n  const deleteSheetMutation = useMutation({\n    mutationFn: async (id: string) => apiRequest(\"DELETE\", `/api/team-sheets/${id}`),\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/team-sheets\"] });\n      setSelectedSheet(null);\n      toast({ title: \"Team sheet deleted\" });\n    },\n  });\n\n  const handleCreateSheet = (e: React.FormEvent<HTMLFormElement>) => {\n    e.preventDefault();\n    const formData = new FormData(e.currentTarget);\n    const title = formData.get(\"title\") as string;\n    const matchDate = formData.get(\"matchDate\") as string;\n    \n    if (!title || !matchDate || !formCompetition) {\n      toast({ title: \"Error\", description: \"Please fill in all required fields\", variant: \"destructive\" });\n      return;\n    }\n\n    const competitionItem = competitions?.find(c => c.name === formCompetition);\n    \n    createSheetMutation.mutate({\n      title,\n      matchDate,\n      kickoffTime: (formData.get(\"kickoffTime\") as string) || undefined,\n      stadium: (formData.get(\"stadium\") as string) || undefined,\n      competition: formCompetition,\n      competitionType: competitionItem?.type || \"league\",\n      isHome: formHomeAway === \"home\",\n      awayTeam: (formData.get(\"opponentName\") as string) || undefined,\n      formation: formFormation,\n      referee: (formData.get(\"referee\") as string) || undefined,\n    });\n  };\n  \n  const resetFormState = () => {\n    setFormCompetition(\"\");\n    setFormHomeAway(\"home\");\n    setFormFormation(\"4-3-3\");\n    setSelectedCountry(\"England\");\n  };\n\n  const handleAddPlayer = (player: Player) => {\n    if (!selectedSheet) return;\n    const existingPlayers = selectedSheetData?.players || [];\n    const starters = existingPlayers.filter(p => p.role === \"starting\");\n    \n    if (addingRole === \"starting\" && starters.length >= 11) {\n      toast({ title: \"Limit reached\", description: \"Maximum 11 starting players allowed\", variant: \"destructive\" });\n      return;\n    }\n    \n    const alreadyAdded = existingPlayers.find(p => p.playerId === player.id);\n    if (alreadyAdded) {\n      toast({ title: \"Already added\", description: \"This player is already in the team sheet\", variant: \"destructive\" });\n      return;\n    }\n    \n    const positionOrder = existingPlayers.filter(p => p.role === addingRole).length + 1;\n    \n    addPlayerMutation.mutate({\n      sheetId: selectedSheet,\n      data: {\n        playerId: player.id,\n        role: addingRole,\n        shirtNumber: player.jerseyNumber || positionOrder,\n        position: player.position || \"CM\",\n        positionOrder,\n      },\n    });\n  };\n\n  const startingPlayers = selectedSheetData?.players?.filter(p => p.role === \"starting\") || [];\n  const substitutes = selectedSheetData?.players?.filter(p => p.role === \"substitute\") || [];\n  const addedPlayerIds = selectedSheetData?.players?.map(p => p.playerId) || [];\n\n  if (sheetsLoading) {\n    return (\n      <div className=\"flex items-center justify-center h-full\">\n        <div className=\"text-muted-foreground\">Loading team sheets...</div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"flex h-full\">\n      <div className=\"w-80 border-r flex flex-col\">\n        <div className=\"p-4 border-b flex items-center justify-between gap-2\">\n          <h2 className=\"font-semibold flex items-center gap-2\">\n            <FileText className=\"h-5 w-5\" />\n            Team Sheets\n          </h2>\n          <Button size=\"icon\" variant=\"ghost\" onClick={() => setShowCreateDialog(true)} data-testid=\"button-create-sheet\">\n            <Plus className=\"h-4 w-4\" />\n          </Button>\n        </div>\n        \n        <ScrollArea className=\"flex-1\">\n          <div className=\"p-2 space-y-2\">\n            {teamSheets?.length === 0 && (\n              <div className=\"text-center text-muted-foreground py-8 text-sm\">\n                No team sheets yet. Create one to get started.\n              </div>\n            )}\n            {teamSheets?.map(sheet => (\n              <Card \n                key={sheet.id} \n                className={`cursor-pointer hover-elevate ${selectedSheet === sheet.id ? \"ring-2 ring-primary\" : \"\"}`}\n                onClick={() => setSelectedSheet(sheet.id)}\n                data-testid={`card-team-sheet-${sheet.id}`}\n              >\n                <CardContent className=\"p-3\">\n                  <div className=\"font-medium text-sm truncate\">{sheet.title}</div>\n                  <div className=\"text-xs text-muted-foreground flex items-center gap-2 mt-1\">\n                    <Calendar className=\"h-3 w-3\" />\n                    {sheet.matchDate ? new Date(sheet.matchDate).toLocaleDateString() : \"No date\"}\n                  </div>\n                  <div className=\"flex items-center gap-2 mt-2\">\n                    <Badge variant={sheet.status === \"finalized\" ? \"default\" : \"secondary\"}>\n                      {sheet.status}\n                    </Badge>\n                    {sheet.competition && (\n                      <Badge variant=\"outline\" className=\"truncate max-w-[120px]\">\n                        {sheet.competition}\n                      </Badge>\n                    )}\n                  </div>\n                </CardContent>\n              </Card>\n            ))}\n          </div>\n        </ScrollArea>\n      </div>\n\n      <div className=\"flex-1 flex flex-col overflow-hidden\">\n        {!selectedSheet ? (\n          <div className=\"flex-1 flex items-center justify-center\">\n            <div className=\"text-center text-muted-foreground\">\n              <FileText className=\"h-16 w-16 mx-auto mb-4 opacity-30\" />\n              <p>Select a team sheet or create a new one</p>\n            </div>\n          </div>\n        ) : sheetDataLoading ? (\n          <div className=\"flex-1 flex items-center justify-center\">\n            <div className=\"text-muted-foreground\">Loading...</div>\n          </div>\n        ) : selectedSheetData ? (\n          <>\n            <div className=\"p-4 border-b flex items-center justify-between gap-4\">\n              <div className=\"flex items-center gap-4\">\n                <Button variant=\"ghost\" size=\"icon\" onClick={() => setSelectedSheet(null)} data-testid=\"button-back\">\n                  <ArrowLeft className=\"h-4 w-4\" />\n                </Button>\n                <div>\n                  <h1 className=\"text-xl font-semibold\">{selectedSheetData.title}</h1>\n                  <div className=\"text-sm text-muted-foreground flex items-center gap-4 flex-wrap\">\n                    {selectedSheetData.competition && (\n                      <span className=\"flex items-center gap-1\">\n                        <Trophy className=\"h-3 w-3\" />\n                        {selectedSheetData.competition}\n                      </span>\n                    )}\n                    {selectedSheetData.stadium && (\n                      <span className=\"flex items-center gap-1\">\n                        <MapPin className=\"h-3 w-3\" />\n                        {selectedSheetData.stadium}\n                      </span>\n                    )}\n                    {selectedSheetData.kickoffTime && (\n                      <span className=\"flex items-center gap-1\">\n                        <Clock className=\"h-3 w-3\" />\n                        {selectedSheetData.kickoffTime}\n                      </span>\n                    )}\n                  </div>\n                </div>\n              </div>\n              <div className=\"flex items-center gap-2\">\n                {selectedSheetData.videoId && (\n                  <Button variant=\"outline\" size=\"sm\" data-testid=\"button-view-video\">\n                    <Play className=\"h-4 w-4 mr-1\" />\n                    View Video\n                  </Button>\n                )}\n                <Button \n                  variant=\"ghost\" \n                  size=\"icon\" \n                  onClick={() => deleteSheetMutation.mutate(selectedSheet)}\n                  data-testid=\"button-delete-sheet\"\n                >\n                  <Trash2 className=\"h-4 w-4\" />\n                </Button>\n                <Button variant=\"ghost\" size=\"icon\" onClick={() => setSelectedSheet(null)} data-testid=\"button-close\">\n                  <X className=\"h-4 w-4\" />\n                </Button>\n              </div>\n            </div>\n\n            <ScrollArea className=\"flex-1 p-4\">\n              <div className=\"space-y-6 max-w-4xl\">\n                <div className=\"grid grid-cols-2 gap-6\">\n                  <Card>\n                    <CardHeader className=\"pb-2 flex flex-row items-center justify-between gap-2\">\n                      <CardTitle className=\"text-base flex items-center gap-2\">\n                        <Users className=\"h-4 w-4\" />\n                        Starting XI ({startingPlayers.length}/11)\n                      </CardTitle>\n                      <Button \n                        size=\"sm\" \n                        variant=\"outline\"\n                        disabled={startingPlayers.length >= 11}\n                        onClick={() => { setAddingRole(\"starting\"); setShowPlayerSelect(true); }}\n                        data-testid=\"button-add-starter\"\n                      >\n                        <UserPlus className=\"h-4 w-4 mr-1\" />\n                        Add\n                      </Button>\n                    </CardHeader>\n                    <CardContent>\n                      {startingPlayers.length === 0 ? (\n                        <div className=\"text-sm text-muted-foreground text-center py-4\">\n                          No starting players added\n                        </div>\n                      ) : (\n                        <div className=\"space-y-2\">\n                          {startingPlayers.map((sp, idx) => {\n                            const player = players?.find(p => p.id === sp.playerId);\n                            return (\n                              <div \n                                key={sp.id} \n                                className=\"flex items-center gap-3 p-2 rounded-md bg-muted/50\"\n                                data-testid={`row-starter-${sp.id}`}\n                              >\n                                <Badge variant=\"outline\" className=\"min-w-[28px] justify-center\">\n                                  {sp.shirtNumber || idx + 1}\n                                </Badge>\n                                <div className=\"flex-1\">\n                                  <div className=\"font-medium text-sm\">{player ? `${player.firstName} ${player.lastName}` : \"Unknown\"}</div>\n                                  <div className=\"text-xs text-muted-foreground\">{sp.position}</div>\n                                </div>\n                                <Button \n                                  variant=\"ghost\" \n                                  size=\"icon\" \n                                  className=\"h-6 w-6\"\n                                  onClick={() => removePlayerMutation.mutate(sp.id)}\n                                  data-testid={`button-remove-starter-${sp.id}`}\n                                >\n                                  <X className=\"h-3 w-3\" />\n                                </Button>\n                              </div>\n                            );\n                          })}\n                        </div>\n                      )}\n                    </CardContent>\n                  </Card>\n\n                  <Card>\n                    <CardHeader className=\"pb-2 flex flex-row items-center justify-between gap-2\">\n                      <CardTitle className=\"text-base flex items-center gap-2\">\n                        <Users className=\"h-4 w-4\" />\n                        Substitutes ({substitutes.length})\n                      </CardTitle>\n                      <Button \n                        size=\"sm\" \n                        variant=\"outline\"\n                        onClick={() => { setAddingRole(\"substitute\"); setShowPlayerSelect(true); }}\n                        data-testid=\"button-add-substitute\"\n                      >\n                        <UserPlus className=\"h-4 w-4 mr-1\" />\n                        Add\n                      </Button>\n                    </CardHeader>\n                    <CardContent>\n                      {substitutes.length === 0 ? (\n                        <div className=\"text-sm text-muted-foreground text-center py-4\">\n                          No substitutes added\n                        </div>\n                      ) : (\n                        <div className=\"space-y-2\">\n                          {substitutes.map((sp, idx) => {\n                            const player = players?.find(p => p.id === sp.playerId);\n                            return (\n                              <div \n                                key={sp.id} \n                                className=\"flex items-center gap-3 p-2 rounded-md bg-muted/50\"\n                                data-testid={`row-substitute-${sp.id}`}\n                              >\n                                <Badge variant=\"outline\" className=\"min-w-[28px] justify-center\">\n                                  {sp.shirtNumber || 12 + idx}\n                                </Badge>\n                                <div className=\"flex-1\">\n                                  <div className=\"font-medium text-sm\">{player ? `${player.firstName} ${player.lastName}` : \"Unknown\"}</div>\n                                  <div className=\"text-xs text-muted-foreground\">{sp.position}</div>\n                                </div>\n                                <Button \n                                  variant=\"ghost\" \n                                  size=\"icon\" \n                                  className=\"h-6 w-6\"\n                                  onClick={() => removePlayerMutation.mutate(sp.id)}\n                                  data-testid={`button-remove-substitute-${sp.id}`}\n                                >\n                                  <X className=\"h-3 w-3\" />\n                                </Button>\n                              </div>\n                            );\n                          })}\n                        </div>\n                      )}\n                    </CardContent>\n                  </Card>\n                </div>\n\n                <Separator />\n\n                <Card>\n                  <CardHeader className=\"pb-2\">\n                    <CardTitle className=\"text-base\">Match Details</CardTitle>\n                  </CardHeader>\n                  <CardContent>\n                    <div className=\"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm\">\n                      <div>\n                        <div className=\"text-muted-foreground mb-1\">Opponent</div>\n                        <div className=\"font-medium\">{selectedSheetData.awayTeam || \"\"}</div>\n                      </div>\n                      <div>\n                        <div className=\"text-muted-foreground mb-1\">Home/Away</div>\n                        <div className=\"font-medium capitalize\">{selectedSheetData.isHome ? \"Home\" : \"Away\"}</div>\n                      </div>\n                      <div>\n                        <div className=\"text-muted-foreground mb-1\">Formation</div>\n                        <div className=\"font-medium\">{selectedSheetData.formation || \"\"}</div>\n                      </div>\n                      <div>\n                        <div className=\"text-muted-foreground mb-1\">Referee</div>\n                        <div className=\"font-medium\">{selectedSheetData.referee || \"\"}</div>\n                      </div>\n                    </div>\n                  </CardContent>\n                </Card>\n\n                {selectedSheetData.videoId && (\n                  <Card>\n                    <CardHeader className=\"pb-2\">\n                      <CardTitle className=\"text-base flex items-center gap-2\">\n                        <Video className=\"h-4 w-4\" />\n                        Linked Video\n                      </CardTitle>\n                    </CardHeader>\n                    <CardContent>\n                      <div className=\"aspect-video bg-muted rounded-md flex items-center justify-center\">\n                        <Button variant=\"ghost\" size=\"lg\">\n                          <Play className=\"h-8 w-8\" />\n                        </Button>\n                      </div>\n                    </CardContent>\n                  </Card>\n                )}\n              </div>\n            </ScrollArea>\n          </>\n        ) : null}\n      </div>\n\n      <Dialog open={showCreateDialog} onOpenChange={setShowCreateDialog}>\n        <DialogContent className=\"max-w-lg\">\n          <DialogHeader>\n            <DialogTitle>Create Team Sheet</DialogTitle>\n          </DialogHeader>\n          <form onSubmit={handleCreateSheet} className=\"space-y-4\">\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"title\">Title</Label>\n              <Input id=\"title\" name=\"title\" placeholder=\"e.g., vs Manchester United\" required data-testid=\"input-title\" />\n            </div>\n\n            <div className=\"grid grid-cols-2 gap-4\">\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"matchDate\">Match Date</Label>\n                <Input id=\"matchDate\" name=\"matchDate\" type=\"date\" required data-testid=\"input-match-date\" />\n              </div>\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"kickoffTime\">Kickoff Time</Label>\n                <Input id=\"kickoffTime\" name=\"kickoffTime\" type=\"time\" placeholder=\"15:00\" data-testid=\"input-kickoff-time\" />\n              </div>\n            </div>\n\n            <div className=\"grid grid-cols-2 gap-4\">\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"country\">Country</Label>\n                <Select value={selectedCountry} onValueChange={handleCountryChange}>\n                  <SelectTrigger data-testid=\"select-country\">\n                    <SelectValue placeholder=\"Select country\" />\n                  </SelectTrigger>\n                  <SelectContent>\n                    {COUNTRIES.map(country => (\n                      <SelectItem key={country} value={country}>\n                        {country}\n                      </SelectItem>\n                    ))}\n                  </SelectContent>\n                </Select>\n              </div>\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"competition\">Competition</Label>\n                <Select value={formCompetition} onValueChange={setFormCompetition}>\n                  <SelectTrigger data-testid=\"select-competition\">\n                    <SelectValue placeholder=\"Select competition\" />\n                  </SelectTrigger>\n                  <SelectContent>\n                    {competitions?.map(comp => (\n                      <SelectItem key={comp.name} value={comp.name}>\n                        {comp.name}\n                      </SelectItem>\n                    ))}\n                  </SelectContent>\n                </Select>\n              </div>\n            </div>\n\n            <div className=\"grid grid-cols-2 gap-4\">\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"opponentName\">Opponent</Label>\n                <Input id=\"opponentName\" name=\"opponentName\" placeholder=\"Opponent team name\" data-testid=\"input-opponent\" />\n              </div>\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"homeAway\">Home/Away</Label>\n                <Select value={formHomeAway} onValueChange={setFormHomeAway}>\n                  <SelectTrigger data-testid=\"select-home-away\">\n                    <SelectValue />\n                  </SelectTrigger>\n                  <SelectContent>\n                    <SelectItem value=\"home\">Home</SelectItem>\n                    <SelectItem value=\"away\">Away</SelectItem>\n                    <SelectItem value=\"neutral\">Neutral</SelectItem>\n                  </SelectContent>\n                </Select>\n              </div>\n            </div>\n\n            <div className=\"grid grid-cols-2 gap-4\">\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"stadium\">Stadium</Label>\n                <Input id=\"stadium\" name=\"stadium\" placeholder=\"Stadium name\" data-testid=\"input-stadium\" />\n              </div>\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"formation\">Formation</Label>\n                <Select value={formFormation} onValueChange={setFormFormation}>\n                  <SelectTrigger data-testid=\"select-formation\">\n                    <SelectValue />\n                  </SelectTrigger>\n                  <SelectContent>\n                    <SelectItem value=\"4-3-3\">4-3-3</SelectItem>\n                    <SelectItem value=\"4-4-2\">4-4-2</SelectItem>\n                    <SelectItem value=\"3-5-2\">3-5-2</SelectItem>\n                    <SelectItem value=\"4-2-3-1\">4-2-3-1</SelectItem>\n                    <SelectItem value=\"5-3-2\">5-3-2</SelectItem>\n                    <SelectItem value=\"3-4-3\">3-4-3</SelectItem>\n                  </SelectContent>\n                </Select>\n              </div>\n            </div>\n\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"referee\">Referee (Optional)</Label>\n              <Input id=\"referee\" name=\"referee\" placeholder=\"Referee name\" data-testid=\"input-referee\" />\n            </div>\n\n            <div className=\"flex justify-end gap-2 pt-2\">\n              <Button type=\"button\" variant=\"outline\" onClick={() => setShowCreateDialog(false)} data-testid=\"button-cancel-create\">\n                Cancel\n              </Button>\n              <Button type=\"submit\" disabled={createSheetMutation.isPending} data-testid=\"button-submit-create\">\n                {createSheetMutation.isPending ? \"Creating...\" : \"Create\"}\n              </Button>\n            </div>\n          </form>\n        </DialogContent>\n      </Dialog>\n\n      <Dialog open={showPlayerSelect} onOpenChange={setShowPlayerSelect}>\n        <DialogContent className=\"max-w-md\">\n          <DialogHeader>\n            <DialogTitle>Add {addingRole === \"starting\" ? \"Starting\" : \"Substitute\"} Player</DialogTitle>\n          </DialogHeader>\n          <ScrollArea className=\"max-h-[400px]\">\n            <div className=\"space-y-2\">\n              {players?.filter(p => !addedPlayerIds.includes(p.id)).map(player => (\n                <div \n                  key={player.id}\n                  className=\"flex items-center gap-3 p-3 rounded-md hover-elevate cursor-pointer bg-muted/30\"\n                  onClick={() => handleAddPlayer(player)}\n                  data-testid={`row-select-player-${player.id}`}\n                >\n                  <Badge variant=\"outline\">{player.jerseyNumber || \"\"}</Badge>\n                  <div className=\"flex-1\">\n                    <div className=\"font-medium\">{player.firstName} {player.lastName}</div>\n                    <div className=\"text-xs text-muted-foreground\">{player.position}  {player.nationality}</div>\n                  </div>\n                  <UserPlus className=\"h-4 w-4 text-muted-foreground\" />\n                </div>\n              ))}\n              {players?.filter(p => !addedPlayerIds.includes(p.id)).length === 0 && (\n                <div className=\"text-center text-muted-foreground py-8\">\n                  All players have been added\n                </div>\n              )}\n            </div>\n          </ScrollArea>\n        </DialogContent>\n      </Dialog>\n    </div>\n  );\n}\n","path":null,"size_bytes":27393,"size_tokens":null},"client/src/components/PlayerDocumentManager.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { queryClient, apiRequest } from \"@/lib/queryClient\";\nimport { Card } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogTrigger } from \"@/components/ui/dialog\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { Upload, FileText, Trash2, CheckCircle, Clock, AlertCircle, Plus } from \"lucide-react\";\nimport type { PlayerDocument } from \"@shared/schema\";\n\ninterface PlayerDocumentManagerProps {\n  playerId: string;\n  playerName: string;\n}\n\nconst DOCUMENT_TYPES = [\n  { value: \"passport\", label: \"International Passport\" },\n  { value: \"national_id\", label: \"National ID Card\" },\n  { value: \"birth_certificate\", label: \"Birth Certificate\" },\n];\n\nconst ALLOWED_MIME_TYPES = [\n  \"application/pdf\",\n  \"image/jpeg\",\n  \"image/png\",\n  \"image/webp\",\n];\n\nexport default function PlayerDocumentManager({ playerId, playerName }: PlayerDocumentManagerProps) {\n  const { toast } = useToast();\n  const [isUploadOpen, setIsUploadOpen] = useState(false);\n  const [selectedType, setSelectedType] = useState<string>(\"\");\n  const [selectedFile, setSelectedFile] = useState<File | null>(null);\n  const [documentNumber, setDocumentNumber] = useState(\"\");\n  const [issuingCountry, setIssuingCountry] = useState(\"\");\n  const [expiryDate, setExpiryDate] = useState(\"\");\n  const [uploading, setUploading] = useState(false);\n\n  const { data: documents = [], isLoading } = useQuery<PlayerDocument[]>({\n    queryKey: [`/api/players/${playerId}/documents`],\n  });\n\n  const deleteMutation = useMutation({\n    mutationFn: async (docId: string) => {\n      await apiRequest(\"DELETE\", `/api/players/${playerId}/documents/${docId}`);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [`/api/players/${playerId}/documents`] });\n      toast({ title: \"Document deleted successfully\" });\n    },\n    onError: () => {\n      toast({ title: \"Failed to delete document\", variant: \"destructive\" });\n    },\n  });\n\n  const verifyMutation = useMutation({\n    mutationFn: async (docId: string) => {\n      await apiRequest(\"POST\", `/api/players/${playerId}/documents/${docId}/verify`);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [`/api/players/${playerId}/documents`] });\n      toast({ title: \"Document verified successfully\" });\n    },\n    onError: () => {\n      toast({ title: \"Failed to verify document\", variant: \"destructive\" });\n    },\n  });\n\n  const handleFileChange = (e: React.ChangeEvent<HTMLInputElement>) => {\n    const file = e.target.files?.[0];\n    if (file) {\n      if (!ALLOWED_MIME_TYPES.includes(file.type)) {\n        toast({\n          title: \"Invalid file type\",\n          description: \"Please upload a PDF, JPEG, PNG, or WebP file\",\n          variant: \"destructive\",\n        });\n        return;\n      }\n      if (file.size > 10 * 1024 * 1024) {\n        toast({\n          title: \"File too large\",\n          description: \"Maximum file size is 10MB\",\n          variant: \"destructive\",\n        });\n        return;\n      }\n      setSelectedFile(file);\n    }\n  };\n\n  const handleUpload = async () => {\n    if (!selectedFile || !selectedType) {\n      toast({\n        title: \"Missing information\",\n        description: \"Please select a document type and file\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    setUploading(true);\n    try {\n      const presignRes = await fetch(\"/api/object-storage/presign\", {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({\n          filename: selectedFile.name,\n          contentType: selectedFile.type,\n          folder: `.private/player-documents/${playerId}`,\n        }),\n      });\n\n      if (!presignRes.ok) {\n        throw new Error(\"Failed to get upload URL\");\n      }\n\n      const { url, objectPath, storageKey } = await presignRes.json();\n\n      const uploadRes = await fetch(url, {\n        method: \"PUT\",\n        headers: { \"Content-Type\": selectedFile.type },\n        body: selectedFile,\n      });\n\n      if (!uploadRes.ok) {\n        throw new Error(\"Failed to upload file\");\n      }\n\n      await apiRequest(\"POST\", `/api/players/${playerId}/documents`, {\n        documentType: selectedType,\n        originalName: selectedFile.name,\n        mimeType: selectedFile.type,\n        fileSize: selectedFile.size,\n        storageKey,\n        objectPath,\n        documentNumber: documentNumber || undefined,\n        issuingCountry: issuingCountry || undefined,\n        expiryDate: expiryDate || undefined,\n      });\n\n      queryClient.invalidateQueries({ queryKey: [`/api/players/${playerId}/documents`] });\n      toast({ title: \"Document uploaded successfully\" });\n      resetForm();\n      setIsUploadOpen(false);\n    } catch (error: any) {\n      toast({\n        title: \"Upload failed\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    } finally {\n      setUploading(false);\n    }\n  };\n\n  const resetForm = () => {\n    setSelectedType(\"\");\n    setSelectedFile(null);\n    setDocumentNumber(\"\");\n    setIssuingCountry(\"\");\n    setExpiryDate(\"\");\n  };\n\n  const getDocumentTypeLabel = (type: string) => {\n    return DOCUMENT_TYPES.find(t => t.value === type)?.label || type;\n  };\n\n  const getStatusIcon = (status: string) => {\n    switch (status) {\n      case \"verified\":\n        return <CheckCircle className=\"h-4 w-4 text-green-600\" />;\n      case \"rejected\":\n        return <AlertCircle className=\"h-4 w-4 text-red-600\" />;\n      default:\n        return <Clock className=\"h-4 w-4 text-amber-600\" />;\n    }\n  };\n\n  const getStatusBadge = (status: string) => {\n    switch (status) {\n      case \"verified\":\n        return <Badge className=\"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200\">Verified</Badge>;\n      case \"rejected\":\n        return <Badge className=\"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200\">Rejected</Badge>;\n      default:\n        return <Badge className=\"bg-amber-100 text-amber-800 dark:bg-amber-900 dark:text-amber-200\">Pending</Badge>;\n    }\n  };\n\n  if (isLoading) {\n    return (\n      <div className=\"flex items-center justify-center py-12\">\n        <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-primary\"></div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"space-y-4\">\n      <div className=\"flex items-center justify-between gap-4 flex-wrap\">\n        <div>\n          <h3 className=\"text-lg font-semibold\">Identity Documents</h3>\n          <p className=\"text-sm text-muted-foreground\">\n            Upload and manage passport, national ID, and birth certificate for {playerName}\n          </p>\n        </div>\n        <Dialog open={isUploadOpen} onOpenChange={setIsUploadOpen}>\n          <DialogTrigger asChild>\n            <Button data-testid=\"button-upload-document\">\n              <Plus className=\"h-4 w-4 mr-2\" />\n              Upload Document\n            </Button>\n          </DialogTrigger>\n          <DialogContent>\n            <DialogHeader>\n              <DialogTitle>Upload Identity Document</DialogTitle>\n            </DialogHeader>\n            <div className=\"space-y-4 mt-4\">\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"documentType\">Document Type</Label>\n                <Select value={selectedType} onValueChange={setSelectedType}>\n                  <SelectTrigger data-testid=\"select-document-type\">\n                    <SelectValue placeholder=\"Select document type\" />\n                  </SelectTrigger>\n                  <SelectContent>\n                    {DOCUMENT_TYPES.map(type => (\n                      <SelectItem key={type.value} value={type.value}>\n                        {type.label}\n                      </SelectItem>\n                    ))}\n                  </SelectContent>\n                </Select>\n              </div>\n\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"file\">Document File</Label>\n                <div className=\"border-2 border-dashed rounded-md p-4 text-center\">\n                  <input\n                    type=\"file\"\n                    id=\"file\"\n                    onChange={handleFileChange}\n                    accept=\".pdf,.jpg,.jpeg,.png,.webp\"\n                    className=\"hidden\"\n                    data-testid=\"input-file\"\n                  />\n                  <label htmlFor=\"file\" className=\"cursor-pointer\">\n                    {selectedFile ? (\n                      <div className=\"flex items-center justify-center gap-2\">\n                        <FileText className=\"h-5 w-5\" />\n                        <span className=\"text-sm\">{selectedFile.name}</span>\n                      </div>\n                    ) : (\n                      <div className=\"space-y-1\">\n                        <Upload className=\"h-8 w-8 mx-auto text-muted-foreground\" />\n                        <p className=\"text-sm text-muted-foreground\">\n                          Click to select file (PDF, JPEG, PNG)\n                        </p>\n                        <p className=\"text-xs text-muted-foreground\">Max 10MB</p>\n                      </div>\n                    )}\n                  </label>\n                </div>\n              </div>\n\n              <div className=\"grid grid-cols-2 gap-4\">\n                <div className=\"space-y-2\">\n                  <Label htmlFor=\"documentNumber\">Document Number</Label>\n                  <Input\n                    id=\"documentNumber\"\n                    value={documentNumber}\n                    onChange={e => setDocumentNumber(e.target.value)}\n                    placeholder=\"e.g., AB1234567\"\n                    data-testid=\"input-document-number\"\n                  />\n                </div>\n                <div className=\"space-y-2\">\n                  <Label htmlFor=\"issuingCountry\">Issuing Country</Label>\n                  <Input\n                    id=\"issuingCountry\"\n                    value={issuingCountry}\n                    onChange={e => setIssuingCountry(e.target.value)}\n                    placeholder=\"e.g., United Kingdom\"\n                    data-testid=\"input-issuing-country\"\n                  />\n                </div>\n              </div>\n\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"expiryDate\">Expiry Date (if applicable)</Label>\n                <Input\n                  id=\"expiryDate\"\n                  type=\"date\"\n                  value={expiryDate}\n                  onChange={e => setExpiryDate(e.target.value)}\n                  data-testid=\"input-expiry-date\"\n                />\n              </div>\n\n              <div className=\"flex justify-end gap-2 pt-4\">\n                <Button variant=\"outline\" onClick={() => setIsUploadOpen(false)} data-testid=\"button-cancel\">\n                  Cancel\n                </Button>\n                <Button onClick={handleUpload} disabled={uploading || !selectedFile || !selectedType} data-testid=\"button-submit-upload\">\n                  {uploading ? \"Uploading...\" : \"Upload\"}\n                </Button>\n              </div>\n            </div>\n          </DialogContent>\n        </Dialog>\n      </div>\n\n      {documents.length === 0 ? (\n        <Card className=\"p-8 text-center\">\n          <FileText className=\"h-12 w-12 mx-auto text-muted-foreground mb-4\" />\n          <p className=\"text-muted-foreground\">No documents uploaded yet</p>\n          <p className=\"text-sm text-muted-foreground mt-1\">\n            Upload passport, national ID, or birth certificate to complete the player profile\n          </p>\n        </Card>\n      ) : (\n        <div className=\"grid gap-4 md:grid-cols-2 lg:grid-cols-3\">\n          {documents.map(doc => (\n            <Card key={doc.id} className=\"p-4\" data-testid={`card-document-${doc.id}`}>\n              <div className=\"flex items-start justify-between gap-2\">\n                <div className=\"flex items-center gap-2\">\n                  <FileText className=\"h-5 w-5 text-muted-foreground\" />\n                  <div>\n                    <p className=\"font-medium text-sm\">{getDocumentTypeLabel(doc.documentType)}</p>\n                    <p className=\"text-xs text-muted-foreground truncate max-w-[150px]\" title={doc.originalName}>\n                      {doc.originalName}\n                    </p>\n                  </div>\n                </div>\n                {getStatusIcon(doc.verificationStatus || \"pending\")}\n              </div>\n\n              <div className=\"mt-3 space-y-1 text-xs text-muted-foreground\">\n                {doc.documentNumber && (\n                  <p>Number: {doc.documentNumber}</p>\n                )}\n                {doc.issuingCountry && (\n                  <p>Country: {doc.issuingCountry}</p>\n                )}\n                {doc.expiryDate && (\n                  <p>Expires: {doc.expiryDate}</p>\n                )}\n              </div>\n\n              <div className=\"mt-3 flex items-center justify-between gap-2 flex-wrap\">\n                {getStatusBadge(doc.verificationStatus || \"pending\")}\n                <div className=\"flex gap-1\">\n                  {doc.verificationStatus === \"pending\" && (\n                    <Button\n                      size=\"icon\"\n                      variant=\"ghost\"\n                      onClick={() => verifyMutation.mutate(doc.id)}\n                      disabled={verifyMutation.isPending}\n                      title=\"Verify document\"\n                      data-testid={`button-verify-${doc.id}`}\n                    >\n                      <CheckCircle className=\"h-4 w-4\" />\n                    </Button>\n                  )}\n                  <Button\n                    size=\"icon\"\n                    variant=\"ghost\"\n                    onClick={() => deleteMutation.mutate(doc.id)}\n                    disabled={deleteMutation.isPending}\n                    title=\"Delete document\"\n                    data-testid={`button-delete-${doc.id}`}\n                  >\n                    <Trash2 className=\"h-4 w-4 text-destructive\" />\n                  </Button>\n                </div>\n              </div>\n            </Card>\n          ))}\n        </div>\n      )}\n    </div>\n  );\n}\n","path":null,"size_bytes":14452,"size_tokens":null},"server/replit_integrations/object_storage/index.ts":{"content":"export {\n  ObjectStorageService,\n  ObjectNotFoundError,\n  objectStorageClient,\n} from \"./objectStorage\";\n\nexport type {\n  ObjectAclPolicy,\n  ObjectAccessGroup,\n  ObjectAccessGroupType,\n  ObjectAclRule,\n} from \"./objectAcl\";\n\nexport {\n  canAccessObject,\n  getObjectAclPolicy,\n  setObjectAclPolicy,\n} from \"./objectAcl\";\n\nexport { registerObjectStorageRoutes } from \"./routes\";\n\n","path":null,"size_bytes":377,"size_tokens":null},"client/src/pages/federation-letters.tsx":{"content":"import { useState, useCallback } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { useDropzone } from \"react-dropzone\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Separator } from \"@/components/ui/separator\";\nimport { ScrollArea } from \"@/components/ui/scroll-area\";\nimport { Dialog, DialogContent, DialogDescription, DialogHeader, DialogTitle, DialogFooter } from \"@/components/ui/dialog\";\nimport { Form, FormControl, FormField, FormItem, FormLabel, FormMessage } from \"@/components/ui/form\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { useForm } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { queryClient, apiRequest } from \"@/lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { LoadingSpinner } from \"@/components/LoadingScreen\";\nimport { \n  FileText, Upload, Plus, Calendar, Globe, Building2, User, CheckCircle, Clock, \n  AlertCircle, Download, Eye, Trash2, CreditCard, Send, FileCheck, X,\n  RefreshCw, Filter, Search, DollarSign, Receipt, MessageCircle, History, ArrowRight, Loader2\n} from \"lucide-react\";\nimport { z } from \"zod\";\nimport type { Player, PlayerMetrics, FederationLetterRequest, PlayerDocument, FederationRequestActivity, FederationRequestMessage, FederationIssuedDocument } from \"@shared/schema\";\n\nconst federationLetterRequestSchema = z.object({\n  playerId: z.string().min(1, \"Please select a player\"),\n  federationName: z.string().optional(),\n  federationCountry: z.string().optional(),\n  athleteFullName: z.string().min(2, \"Athlete name is required\"),\n  athleteNationality: z.string().min(2, \"Nationality is required\"),\n  athleteDateOfBirth: z.string().optional(),\n  athletePosition: z.string().optional(),\n  targetClubName: z.string().min(2, \"Target club name is required\"),\n  targetClubCountry: z.string().min(2, \"Target country is required\"),\n  transferType: z.string().min(1, \"Transfer type is required\"),\n  passportDocumentId: z.string().optional(),\n  requestPurpose: z.string().optional(),\n  additionalNotes: z.string().optional(),\n});\n\ntype FederationLetterFormData = z.infer<typeof federationLetterRequestSchema>;\n\ninterface FederationRequestWithPlayer extends FederationLetterRequest {\n  player?: Player;\n  passportDocument?: PlayerDocument;\n}\n\nconst TRANSFER_TYPES = [\n  { value: \"permanent\", label: \"Permanent Transfer\" },\n  { value: \"loan\", label: \"Loan\" },\n  { value: \"trial\", label: \"Trial Period\" },\n  { value: \"youth_transfer\", label: \"Youth Transfer\" },\n];\n\nconst STATUS_CONFIG: Record<string, { label: string; color: string; icon: typeof Clock }> = {\n  pending: { label: \"Pending\", color: \"bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200\", icon: Clock },\n  submitted: { label: \"Submitted\", color: \"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200\", icon: Send },\n  processing: { label: \"Processing\", color: \"bg-purple-100 text-purple-800 dark:bg-purple-900 dark:text-purple-200\", icon: RefreshCw },\n  issued: { label: \"Issued\", color: \"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200\", icon: CheckCircle },\n  rejected: { label: \"Rejected\", color: \"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200\", icon: AlertCircle },\n};\n\nexport default function FederationLettersPage() {\n  const [isDialogOpen, setIsDialogOpen] = useState(false);\n  const [selectedRequest, setSelectedRequest] = useState<FederationRequestWithPlayer | null>(null);\n  const [isViewDialogOpen, setIsViewDialogOpen] = useState(false);\n  const [isPaymentDialogOpen, setIsPaymentDialogOpen] = useState(false);\n  const [uploadedInvitationLetter, setUploadedInvitationLetter] = useState<File | null>(null);\n  const [uploadedPassport, setUploadedPassport] = useState<File | null>(null);\n  const [isUploadingPassport, setIsUploadingPassport] = useState(false);\n  const [statusFilter, setStatusFilter] = useState<string>(\"all\");\n  const [searchQuery, setSearchQuery] = useState(\"\");\n  const [viewTab, setViewTab] = useState<string>(\"details\");\n  const [newMessage, setNewMessage] = useState(\"\");\n  const { toast } = useToast();\n\n  const onDropInvitation = useCallback((acceptedFiles: File[]) => {\n    if (acceptedFiles.length > 0) {\n      setUploadedInvitationLetter(acceptedFiles[0]);\n    }\n  }, []);\n\n  const onDropPassport = useCallback((acceptedFiles: File[]) => {\n    if (acceptedFiles.length > 0) {\n      setUploadedPassport(acceptedFiles[0]);\n    }\n  }, []);\n\n  const { getRootProps: getInvitationRootProps, getInputProps: getInvitationInputProps, isDragActive: isInvitationDragActive } = useDropzone({\n    onDrop: onDropInvitation,\n    accept: { \n      \"application/pdf\": [\".pdf\"],\n      \"image/*\": [\".jpg\", \".jpeg\", \".png\"]\n    },\n    maxFiles: 1,\n  });\n\n  const { getRootProps: getPassportRootProps, getInputProps: getPassportInputProps, isDragActive: isPassportDragActive } = useDropzone({\n    onDrop: onDropPassport,\n    accept: { \n      \"application/pdf\": [\".pdf\"],\n      \"image/*\": [\".jpg\", \".jpeg\", \".png\"]\n    },\n    maxFiles: 1,\n  });\n\n  const { data: players = [], isLoading: playersLoading } = useQuery<Player[]>({\n    queryKey: [\"/api/players\"],\n  });\n\n  const { data: requests = [], isLoading: requestsLoading } = useQuery<FederationRequestWithPlayer[]>({\n    queryKey: [\"/api/federation-letter-requests\"],\n    refetchInterval: 5000,\n  });\n\n  const { data: summary } = useQuery<{\n    total: number;\n    pending: number;\n    submitted: number;\n    processing: number;\n    issued: number;\n    rejected: number;\n  }>({\n    queryKey: [\"/api/federation-letter-requests/summary\"],\n    refetchInterval: 5000,\n  });\n\n  const form = useForm<FederationLetterFormData>({\n    resolver: zodResolver(federationLetterRequestSchema),\n    defaultValues: {\n      playerId: \"\",\n      federationName: \"\",\n      federationCountry: \"\",\n      athleteFullName: \"\",\n      athleteNationality: \"\",\n      athleteDateOfBirth: \"\",\n      athletePosition: \"\",\n      targetClubName: \"\",\n      targetClubCountry: \"\",\n      transferType: \"permanent\",\n      passportDocumentId: \"\",\n      requestPurpose: \"\",\n      additionalNotes: \"\",\n    },\n  });\n\n  const selectedPlayerId = form.watch(\"playerId\");\n\n  const { data: playerDocuments = [] } = useQuery<PlayerDocument[]>({\n    queryKey: [\"/api/players\", selectedPlayerId, \"documents\"],\n    enabled: !!selectedPlayerId,\n  });\n\n  const { data: playerMetrics } = useQuery<PlayerMetrics[]>({\n    queryKey: [\"/api/players\", selectedPlayerId, \"metrics\"],\n    enabled: !!selectedPlayerId,\n  });\n\n  const passportDocuments = playerDocuments.filter(\n    (doc) => doc.documentType === \"passport\"\n  );\n\n  const selectedPlayer = players.find((p) => p.id === selectedPlayerId);\n\n  const { data: requestActivities = [] } = useQuery<FederationRequestActivity[]>({\n    queryKey: [\"/api/federation-requests\", selectedRequest?.id, \"activities\"],\n    enabled: !!selectedRequest?.id && isViewDialogOpen,\n  });\n\n  const { data: requestMessages = [] } = useQuery<FederationRequestMessage[]>({\n    queryKey: [\"/api/federation-requests\", selectedRequest?.id, \"messages\"],\n    enabled: !!selectedRequest?.id && isViewDialogOpen,\n  });\n\n  const { data: issuedDocuments = [] } = useQuery<FederationIssuedDocument[]>({\n    queryKey: [\"/api/federation-requests\", selectedRequest?.id, \"issued-documents\"],\n    enabled: !!selectedRequest?.id && isViewDialogOpen,\n  });\n\n  const sendMessageMutation = useMutation({\n    mutationFn: async (content: string) => {\n      return apiRequest(\"POST\", `/api/federation-requests/${selectedRequest?.id}/messages`, {\n        content,\n        senderName: \"Team User\",\n        recipientPortal: \"federation\",\n      });\n    },\n    onSuccess: () => {\n      toast({\n        title: \"Message Sent\",\n        description: \"Your message has been sent to the federation.\",\n      });\n      setNewMessage(\"\");\n      queryClient.invalidateQueries({ queryKey: [\"/api/federation-requests\", selectedRequest?.id, \"messages\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/federation-requests\", selectedRequest?.id, \"activities\"] });\n    },\n    onError: (error: Error) => {\n      toast({\n        title: \"Failed to Send\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const createMutation = useMutation({\n    mutationFn: async (data: FederationLetterFormData) => {\n      let passportDocId = data.passportDocumentId;\n      \n      if (uploadedPassport && selectedPlayerId) {\n        setIsUploadingPassport(true);\n        try {\n          const uploadUrlRes = await apiRequest(\"GET\", \"/api/object-storage/upload-url?folder=.private&contentType=\" + encodeURIComponent(uploadedPassport.type));\n          const { signedUrl, key, objectPath } = await uploadUrlRes.json();\n          \n          await fetch(signedUrl, {\n            method: \"PUT\",\n            headers: { \"Content-Type\": uploadedPassport.type },\n            body: uploadedPassport,\n          });\n          \n          const docRes = await apiRequest(\"POST\", `/api/players/${selectedPlayerId}/documents`, {\n            documentType: \"passport\",\n            originalName: uploadedPassport.name,\n            mimeType: uploadedPassport.type,\n            fileSize: uploadedPassport.size,\n            storageKey: key,\n            objectPath,\n          });\n          const newDoc = await docRes.json();\n          passportDocId = newDoc.id;\n        } finally {\n          setIsUploadingPassport(false);\n        }\n      }\n      \n      const response = await apiRequest(\"POST\", \"/api/federation-letter-requests\", {\n        ...data,\n        passportDocumentId: passportDocId,\n      });\n      return await response.json();\n    },\n    onSuccess: () => {\n      toast({\n        title: \"Request Created\",\n        description: \"Your federation letter request has been created. Please complete payment to submit.\",\n      });\n      form.reset();\n      setUploadedInvitationLetter(null);\n      setUploadedPassport(null);\n      setIsDialogOpen(false);\n      queryClient.invalidateQueries({ queryKey: [\"/api/federation-letter-requests\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/players\", selectedPlayerId, \"documents\"] });\n    },\n    onError: (error: Error) => {\n      toast({\n        title: \"Error\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const paymentMutation = useMutation({\n    mutationFn: async (requestId: string) => {\n      const paymentId = `PAY-${Date.now().toString(36).toUpperCase()}`;\n      const response = await apiRequest(\"POST\", `/api/federation-letter-requests/${requestId}/confirm-payment`, {\n        paymentId,\n      });\n      return await response.json();\n    },\n    onSuccess: () => {\n      toast({\n        title: \"Payment Confirmed\",\n        description: \"Your payment has been processed. The request will now be submitted for processing.\",\n      });\n      setIsPaymentDialogOpen(false);\n      queryClient.invalidateQueries({ queryKey: [\"/api/federation-letter-requests\"] });\n    },\n    onError: (error: Error) => {\n      toast({\n        title: \"Payment Failed\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const submitMutation = useMutation({\n    mutationFn: async (requestId: string) => {\n      const response = await apiRequest(\"POST\", `/api/federation-letter-requests/${requestId}/submit`, {});\n      return await response.json();\n    },\n    onSuccess: () => {\n      toast({\n        title: \"Request Submitted\",\n        description: \"Your federation letter request has been submitted for processing.\",\n      });\n      queryClient.invalidateQueries({ queryKey: [\"/api/federation-letter-requests\"] });\n    },\n    onError: (error: Error) => {\n      toast({\n        title: \"Submission Failed\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const deleteMutation = useMutation({\n    mutationFn: async (requestId: string) => {\n      const response = await apiRequest(\"DELETE\", `/api/federation-letter-requests/${requestId}`, {});\n      return await response.json();\n    },\n    onSuccess: () => {\n      toast({\n        title: \"Request Deleted\",\n        description: \"The federation letter request has been deleted.\",\n      });\n      queryClient.invalidateQueries({ queryKey: [\"/api/federation-letter-requests\"] });\n    },\n    onError: (error: Error) => {\n      toast({\n        title: \"Delete Failed\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const onSubmit = (data: FederationLetterFormData) => {\n    createMutation.mutate(data);\n  };\n\n  const handlePlayerSelect = (playerId: string) => {\n    const player = players.find((p) => p.id === playerId);\n    if (player) {\n      form.setValue(\"playerId\", playerId);\n      form.setValue(\"athleteFullName\", `${player.firstName} ${player.lastName}`);\n      form.setValue(\"athleteNationality\", player.nationality || \"\");\n      form.setValue(\"athleteDateOfBirth\", player.dateOfBirth || \"\");\n      form.setValue(\"athletePosition\", player.position || \"\");\n    }\n  };\n\n  const filteredRequests = requests.filter((req) => {\n    const matchesStatus = statusFilter === \"all\" || req.status === statusFilter;\n    const matchesSearch =\n      !searchQuery ||\n      req.athleteFullName.toLowerCase().includes(searchQuery.toLowerCase()) ||\n      req.requestNumber.toLowerCase().includes(searchQuery.toLowerCase()) ||\n      req.targetClubName.toLowerCase().includes(searchQuery.toLowerCase());\n    return matchesStatus && matchesSearch;\n  });\n\n  const getStatusBadge = (status: string) => {\n    const config = STATUS_CONFIG[status] || STATUS_CONFIG.pending;\n    const Icon = config.icon;\n    return (\n      <Badge variant=\"outline\" className={`${config.color} flex items-center gap-1`}>\n        <Icon className=\"h-3 w-3\" />\n        {config.label}\n      </Badge>\n    );\n  };\n\n  const latestMetrics = playerMetrics?.[0];\n\n  if (playersLoading || requestsLoading) {\n    return (\n      <div className=\"flex items-center justify-center h-full\">\n        <LoadingSpinner />\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"flex-1 overflow-auto p-6\">\n      <div className=\"max-w-7xl mx-auto space-y-6\">\n        <div className=\"flex items-center justify-between gap-4 flex-wrap\">\n          <div>\n            <h1 className=\"text-2xl font-bold\" data-testid=\"text-page-title\">\n              Federation Letter Requests\n            </h1>\n            <p className=\"text-muted-foreground\">\n              Request official letters from football federations for player transfers and clearances\n            </p>\n          </div>\n          <Button onClick={() => setIsDialogOpen(true)} data-testid=\"button-new-request\">\n            <Plus className=\"h-4 w-4 mr-2\" />\n            New Request\n          </Button>\n        </div>\n\n        {/* Dashboard Stats */}\n        <div className=\"grid grid-cols-2 md:grid-cols-4 gap-4 mb-6\">\n          <Card>\n            <CardContent className=\"p-4\">\n              <div className=\"flex items-center justify-between gap-2\">\n                <div>\n                  <p className=\"text-sm text-muted-foreground\">Total Requests</p>\n                  <p className=\"text-2xl font-bold\" data-testid=\"stat-total\">{summary?.total || 0}</p>\n                </div>\n                <FileText className=\"h-8 w-8 text-muted-foreground opacity-50\" />\n              </div>\n            </CardContent>\n          </Card>\n          <Card>\n            <CardContent className=\"p-4\">\n              <div className=\"flex items-center justify-between gap-2\">\n                <div>\n                  <p className=\"text-sm text-muted-foreground\">Pending Review</p>\n                  <p className=\"text-2xl font-bold text-blue-600\" data-testid=\"stat-pending\">{(summary?.pending || 0) + (summary?.submitted || 0)}</p>\n                </div>\n                <Clock className=\"h-8 w-8 text-blue-600 opacity-50\" />\n              </div>\n            </CardContent>\n          </Card>\n          <Card>\n            <CardContent className=\"p-4\">\n              <div className=\"flex items-center justify-between gap-2\">\n                <div>\n                  <p className=\"text-sm text-muted-foreground\">Processing</p>\n                  <p className=\"text-2xl font-bold text-purple-600\" data-testid=\"stat-processing\">{summary?.processing || 0}</p>\n                </div>\n                <RefreshCw className=\"h-8 w-8 text-purple-600 opacity-50\" />\n              </div>\n            </CardContent>\n          </Card>\n          <Card>\n            <CardContent className=\"p-4\">\n              <div className=\"flex items-center justify-between gap-2\">\n                <div>\n                  <p className=\"text-sm text-muted-foreground\">Issued Letters</p>\n                  <p className=\"text-2xl font-bold text-green-600\" data-testid=\"stat-issued\">{summary?.issued || 0}</p>\n                </div>\n                <CheckCircle className=\"h-8 w-8 text-green-600 opacity-50\" />\n              </div>\n            </CardContent>\n          </Card>\n        </div>\n\n        <Card>\n          <CardHeader className=\"pb-4\">\n            <div className=\"flex items-center justify-between gap-4 flex-wrap\">\n              <div className=\"flex items-center gap-2\">\n                <div className=\"relative\">\n                  <Search className=\"absolute left-2 top-2.5 h-4 w-4 text-muted-foreground\" />\n                  <Input\n                    placeholder=\"Search requests...\"\n                    className=\"pl-8 w-64\"\n                    value={searchQuery}\n                    onChange={(e) => setSearchQuery(e.target.value)}\n                    data-testid=\"input-search\"\n                  />\n                </div>\n                <Select value={statusFilter} onValueChange={setStatusFilter}>\n                  <SelectTrigger className=\"w-40\" data-testid=\"select-status-filter\">\n                    <Filter className=\"h-4 w-4 mr-2\" />\n                    <SelectValue placeholder=\"Status\" />\n                  </SelectTrigger>\n                  <SelectContent>\n                    <SelectItem value=\"all\">All Status</SelectItem>\n                    <SelectItem value=\"pending\">Pending</SelectItem>\n                    <SelectItem value=\"submitted\">Submitted</SelectItem>\n                    <SelectItem value=\"processing\">Processing</SelectItem>\n                    <SelectItem value=\"issued\">Issued</SelectItem>\n                    <SelectItem value=\"rejected\">Rejected</SelectItem>\n                  </SelectContent>\n                </Select>\n              </div>\n              <div className=\"flex items-center gap-2 text-sm text-muted-foreground\">\n                <FileText className=\"h-4 w-4\" />\n                {filteredRequests.length} requests\n              </div>\n            </div>\n          </CardHeader>\n          <CardContent>\n            {filteredRequests.length === 0 ? (\n              <div className=\"text-center py-12\">\n                <FileText className=\"h-12 w-12 mx-auto text-muted-foreground mb-4\" />\n                <h3 className=\"text-lg font-semibold mb-2\">No Requests Found</h3>\n                <p className=\"text-muted-foreground mb-4\">\n                  {searchQuery || statusFilter !== \"all\"\n                    ? \"Try adjusting your filters\"\n                    : \"Create your first federation letter request to get started\"}\n                </p>\n                {!searchQuery && statusFilter === \"all\" && (\n                  <Button onClick={() => setIsDialogOpen(true)}>\n                    <Plus className=\"h-4 w-4 mr-2\" />\n                    Create Request\n                  </Button>\n                )}\n              </div>\n            ) : (\n              <ScrollArea className=\"h-[500px]\">\n                <div className=\"space-y-4\">\n                  {filteredRequests.map((request) => (\n                    <Card key={request.id} className=\"hover-elevate\" data-testid={`card-request-${request.id}`}>\n                      <CardContent className=\"p-4\">\n                        <div className=\"flex items-start justify-between gap-4 flex-wrap\">\n                          <div className=\"space-y-2 flex-1 min-w-[200px]\">\n                            <div className=\"flex items-center gap-2 flex-wrap\">\n                              <span className=\"font-mono text-sm font-medium\" data-testid={`text-request-number-${request.id}`}>\n                                {request.requestNumber}\n                              </span>\n                              {getStatusBadge(request.status)}\n                              {request.paymentStatus === \"unpaid\" && (\n                                <Badge variant=\"outline\" className=\"bg-orange-100 text-orange-800 dark:bg-orange-900 dark:text-orange-200\">\n                                  <DollarSign className=\"h-3 w-3 mr-1\" />\n                                  Payment Required\n                                </Badge>\n                              )}\n                            </div>\n                            <h4 className=\"font-semibold\">{request.athleteFullName}</h4>\n                            <div className=\"flex items-center gap-4 text-sm text-muted-foreground flex-wrap\">\n                              <span className=\"flex items-center gap-1\">\n                                <Globe className=\"h-4 w-4\" />\n                                {request.athleteNationality}\n                              </span>\n                              <span className=\"flex items-center gap-1\">\n                                <Building2 className=\"h-4 w-4\" />\n                                {request.targetClubName}\n                              </span>\n                              <span className=\"flex items-center gap-1\">\n                                <Calendar className=\"h-4 w-4\" />\n                                {new Date(request.createdAt!).toLocaleDateString()}\n                              </span>\n                            </div>\n                          </div>\n                          <div className=\"flex items-center gap-2 flex-wrap\">\n                            {request.status === \"pending\" && request.paymentStatus === \"unpaid\" && (\n                              <Button\n                                size=\"sm\"\n                                onClick={() => {\n                                  setSelectedRequest(request);\n                                  setIsPaymentDialogOpen(true);\n                                }}\n                                data-testid={`button-pay-${request.id}`}\n                              >\n                                <CreditCard className=\"h-4 w-4 mr-1\" />\n                                Pay ${request.totalAmount}\n                              </Button>\n                            )}\n                            {request.status === \"pending\" && request.paymentStatus === \"paid\" && (\n                              <Button\n                                size=\"sm\"\n                                onClick={() => submitMutation.mutate(request.id)}\n                                disabled={submitMutation.isPending}\n                                data-testid={`button-submit-${request.id}`}\n                              >\n                                <Send className=\"h-4 w-4 mr-1\" />\n                                Submit\n                              </Button>\n                            )}\n                            {request.status === \"issued\" && (\n                              <Button\n                                size=\"sm\"\n                                variant=\"outline\"\n                                onClick={() => {\n                                  setSelectedRequest(request);\n                                  setIsViewDialogOpen(true);\n                                }}\n                                data-testid={`button-download-${request.id}`}\n                              >\n                                <Download className=\"h-4 w-4 mr-1\" />\n                                View Documents\n                              </Button>\n                            )}\n                            <Button\n                              size=\"icon\"\n                              variant=\"ghost\"\n                              onClick={() => {\n                                setSelectedRequest(request);\n                                setIsViewDialogOpen(true);\n                              }}\n                              data-testid={`button-view-${request.id}`}\n                            >\n                              <Eye className=\"h-4 w-4\" />\n                            </Button>\n                            {request.status === \"pending\" && (\n                              <Button\n                                size=\"icon\"\n                                variant=\"ghost\"\n                                onClick={() => deleteMutation.mutate(request.id)}\n                                disabled={deleteMutation.isPending}\n                                data-testid={`button-delete-${request.id}`}\n                              >\n                                <Trash2 className=\"h-4 w-4\" />\n                              </Button>\n                            )}\n                          </div>\n                        </div>\n                      </CardContent>\n                    </Card>\n                  ))}\n                </div>\n              </ScrollArea>\n            )}\n          </CardContent>\n        </Card>\n\n        <Dialog open={isDialogOpen} onOpenChange={setIsDialogOpen}>\n          <DialogContent className=\"max-w-3xl max-h-[90vh] overflow-y-auto\">\n            <DialogHeader>\n              <DialogTitle className=\"flex items-center gap-2\">\n                <FileCheck className=\"h-5 w-5\" />\n                New Federation Letter Request\n              </DialogTitle>\n              <DialogDescription>\n                Submit a request for an official federation clearance letter for player transfer or registration\n              </DialogDescription>\n            </DialogHeader>\n            <Form {...form}>\n              <form onSubmit={form.handleSubmit(onSubmit)} className=\"space-y-6\">\n                <Tabs defaultValue=\"player\" className=\"w-full\">\n                  <TabsList className=\"grid w-full grid-cols-3\">\n                    <TabsTrigger value=\"player\">Player</TabsTrigger>\n                    <TabsTrigger value=\"transfer\">Transfer Details</TabsTrigger>\n                    <TabsTrigger value=\"documents\">Documents</TabsTrigger>\n                  </TabsList>\n\n                  <TabsContent value=\"player\" className=\"space-y-4 mt-4\">\n                    <FormField\n                      control={form.control}\n                      name=\"playerId\"\n                      render={({ field }) => (\n                        <FormItem>\n                          <FormLabel>Select Player</FormLabel>\n                          <Select onValueChange={handlePlayerSelect} value={field.value}>\n                            <FormControl>\n                              <SelectTrigger data-testid=\"select-player\">\n                                <SelectValue placeholder=\"Choose a player\" />\n                              </SelectTrigger>\n                            </FormControl>\n                            <SelectContent>\n                              {players.map((player) => (\n                                <SelectItem key={player.id} value={player.id}>\n                                  {player.firstName} {player.lastName} - {player.position}\n                                </SelectItem>\n                              ))}\n                            </SelectContent>\n                          </Select>\n                          <FormMessage />\n                        </FormItem>\n                      )}\n                    />\n\n                    {selectedPlayer && (\n                      <Card>\n                        <CardHeader className=\"pb-2\">\n                          <CardTitle className=\"text-base\">Player Information</CardTitle>\n                        </CardHeader>\n                        <CardContent className=\"grid grid-cols-2 gap-4 text-sm\">\n                          <div>\n                            <span className=\"text-muted-foreground\">Name:</span>\n                            <p className=\"font-medium\">{selectedPlayer.firstName} {selectedPlayer.lastName}</p>\n                          </div>\n                          <div>\n                            <span className=\"text-muted-foreground\">Position:</span>\n                            <p className=\"font-medium\">{selectedPlayer.position}</p>\n                          </div>\n                          <div>\n                            <span className=\"text-muted-foreground\">Nationality:</span>\n                            <p className=\"font-medium\">{selectedPlayer.nationality}</p>\n                          </div>\n                          <div>\n                            <span className=\"text-muted-foreground\">Date of Birth:</span>\n                            <p className=\"font-medium\">{selectedPlayer.dateOfBirth || \"Not specified\"}</p>\n                          </div>\n                          {latestMetrics && (\n                            <>\n                              <div>\n                                <span className=\"text-muted-foreground\">Games Played:</span>\n                                <p className=\"font-medium\">{latestMetrics.gamesPlayed || 0}</p>\n                              </div>\n                              <div>\n                                <span className=\"text-muted-foreground\">Goals:</span>\n                                <p className=\"font-medium\">{latestMetrics.goals || 0}</p>\n                              </div>\n                            </>\n                          )}\n                        </CardContent>\n                      </Card>\n                    )}\n\n                    <div className=\"grid grid-cols-2 gap-4\">\n                      <FormField\n                        control={form.control}\n                        name=\"athleteFullName\"\n                        render={({ field }) => (\n                          <FormItem>\n                            <FormLabel>Full Name (as on passport)</FormLabel>\n                            <FormControl>\n                              <Input {...field} data-testid=\"input-athlete-name\" />\n                            </FormControl>\n                            <FormMessage />\n                          </FormItem>\n                        )}\n                      />\n                      <FormField\n                        control={form.control}\n                        name=\"athleteNationality\"\n                        render={({ field }) => (\n                          <FormItem>\n                            <FormLabel>Nationality</FormLabel>\n                            <FormControl>\n                              <Input {...field} data-testid=\"input-nationality\" />\n                            </FormControl>\n                            <FormMessage />\n                          </FormItem>\n                        )}\n                      />\n                    </div>\n                  </TabsContent>\n\n                  <TabsContent value=\"transfer\" className=\"space-y-4 mt-4\">\n                    <div className=\"grid grid-cols-2 gap-4\">\n                      <FormField\n                        control={form.control}\n                        name=\"targetClubName\"\n                        render={({ field }) => (\n                          <FormItem>\n                            <FormLabel>Target Club Name</FormLabel>\n                            <FormControl>\n                              <Input {...field} placeholder=\"e.g., Manchester City\" data-testid=\"input-target-club\" />\n                            </FormControl>\n                            <FormMessage />\n                          </FormItem>\n                        )}\n                      />\n                      <FormField\n                        control={form.control}\n                        name=\"targetClubCountry\"\n                        render={({ field }) => (\n                          <FormItem>\n                            <FormLabel>Target Country</FormLabel>\n                            <FormControl>\n                              <Input {...field} placeholder=\"e.g., England\" data-testid=\"input-target-country\" />\n                            </FormControl>\n                            <FormMessage />\n                          </FormItem>\n                        )}\n                      />\n                    </div>\n\n                    <FormField\n                      control={form.control}\n                      name=\"transferType\"\n                      render={({ field }) => (\n                        <FormItem>\n                          <FormLabel>Transfer Type</FormLabel>\n                          <Select onValueChange={field.onChange} value={field.value}>\n                            <FormControl>\n                              <SelectTrigger data-testid=\"select-transfer-type\">\n                                <SelectValue placeholder=\"Select transfer type\" />\n                              </SelectTrigger>\n                            </FormControl>\n                            <SelectContent>\n                              {TRANSFER_TYPES.map((type) => (\n                                <SelectItem key={type.value} value={type.value}>\n                                  {type.label}\n                                </SelectItem>\n                              ))}\n                            </SelectContent>\n                          </Select>\n                          <FormMessage />\n                        </FormItem>\n                      )}\n                    />\n\n                    <div className=\"grid grid-cols-2 gap-4\">\n                      <FormField\n                        control={form.control}\n                        name=\"federationName\"\n                        render={({ field }) => (\n                          <FormItem>\n                            <FormLabel>Federation Name (Optional)</FormLabel>\n                            <FormControl>\n                              <Input {...field} placeholder=\"e.g., Nigerian Football Federation\" data-testid=\"input-federation-name\" />\n                            </FormControl>\n                            <FormMessage />\n                          </FormItem>\n                        )}\n                      />\n                      <FormField\n                        control={form.control}\n                        name=\"federationCountry\"\n                        render={({ field }) => (\n                          <FormItem>\n                            <FormLabel>Federation Country</FormLabel>\n                            <FormControl>\n                              <Input {...field} placeholder=\"e.g., Nigeria\" data-testid=\"input-federation-country\" />\n                            </FormControl>\n                            <FormMessage />\n                          </FormItem>\n                        )}\n                      />\n                    </div>\n\n                    <FormField\n                      control={form.control}\n                      name=\"requestPurpose\"\n                      render={({ field }) => (\n                        <FormItem>\n                          <FormLabel>Purpose of Request</FormLabel>\n                          <FormControl>\n                            <Textarea\n                              {...field}\n                              placeholder=\"Describe the reason for this federation letter request...\"\n                              className=\"min-h-[80px]\"\n                              data-testid=\"textarea-purpose\"\n                            />\n                          </FormControl>\n                          <FormMessage />\n                        </FormItem>\n                      )}\n                    />\n                  </TabsContent>\n\n                  <TabsContent value=\"documents\" className=\"space-y-4 mt-4\">\n                    <FormField\n                      control={form.control}\n                      name=\"passportDocumentId\"\n                      render={({ field }) => (\n                        <FormItem>\n                          <FormLabel>Select Existing Passport</FormLabel>\n                          <Select \n                            onValueChange={(value) => {\n                              field.onChange(value);\n                              if (value && value !== \"none\") {\n                                setUploadedPassport(null);\n                              }\n                            }} \n                            value={uploadedPassport ? \"\" : field.value}\n                            disabled={!!uploadedPassport}\n                          >\n                            <FormControl>\n                              <SelectTrigger data-testid=\"select-passport\">\n                                <SelectValue placeholder={uploadedPassport ? \"Using uploaded passport\" : \"Select from player's documents\"} />\n                              </SelectTrigger>\n                            </FormControl>\n                            <SelectContent>\n                              {passportDocuments.length === 0 ? (\n                                <SelectItem value=\"none\" disabled>\n                                  No passports on file - upload one below\n                                </SelectItem>\n                              ) : (\n                                passportDocuments.map((doc) => (\n                                  <SelectItem key={doc.id} value={doc.id}>\n                                    <div className=\"flex items-center gap-2\">\n                                      <span>{doc.originalName}</span>\n                                      {doc.issuingCountry && <span className=\"text-muted-foreground\">({doc.issuingCountry})</span>}\n                                      {doc.verificationStatus === \"verified\" ? (\n                                        <Badge variant=\"outline\" className=\"text-xs bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200\">Verified</Badge>\n                                      ) : doc.verificationStatus === \"pending\" ? (\n                                        <Badge variant=\"outline\" className=\"text-xs bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200\">Pending</Badge>\n                                      ) : (\n                                        <Badge variant=\"outline\" className=\"text-xs\">Unverified</Badge>\n                                      )}\n                                    </div>\n                                  </SelectItem>\n                                ))\n                              )}\n                            </SelectContent>\n                          </Select>\n                          <FormMessage />\n                          <p className=\"text-xs text-muted-foreground\">Choose an existing passport from the player's profile or upload a new one below</p>\n                        </FormItem>\n                      )}\n                    />\n\n                    <div className=\"space-y-2\">\n                      <FormLabel>Upload New Passport (Optional)</FormLabel>\n                      <div\n                        {...getPassportRootProps()}\n                        className={`border-2 border-dashed rounded-lg p-4 text-center cursor-pointer transition-colors ${\n                          isPassportDragActive\n                            ? \"border-primary bg-primary/5\"\n                            : \"border-muted-foreground/25 hover:border-primary/50\"\n                        }`}\n                      >\n                        <input {...getPassportInputProps()} data-testid=\"input-passport-upload\" />\n                        <Upload className=\"h-6 w-6 mx-auto text-muted-foreground mb-2\" />\n                        {uploadedPassport ? (\n                          <div className=\"flex items-center justify-center gap-2\">\n                            <FileCheck className=\"h-4 w-4 text-green-600\" />\n                            <p className=\"text-sm font-medium\">{uploadedPassport.name}</p>\n                            <Button\n                              type=\"button\"\n                              variant=\"ghost\"\n                              size=\"icon\"\n                              className=\"h-6 w-6\"\n                              onClick={(e) => {\n                                e.stopPropagation();\n                                setUploadedPassport(null);\n                              }}\n                            >\n                              <X className=\"h-4 w-4\" />\n                            </Button>\n                          </div>\n                        ) : (\n                          <p className=\"text-sm text-muted-foreground\">\n                            Or drag and drop a new passport to upload\n                          </p>\n                        )}\n                        <p className=\"text-xs text-muted-foreground mt-1\">PDF, JPG, or PNG</p>\n                      </div>\n                    </div>\n\n                    <div className=\"space-y-2\">\n                      <FormLabel>Invitation Letter (Optional)</FormLabel>\n                      <div\n                        {...getInvitationRootProps()}\n                        className={`border-2 border-dashed rounded-lg p-4 text-center cursor-pointer transition-colors ${\n                          isInvitationDragActive\n                            ? \"border-primary bg-primary/5\"\n                            : \"border-muted-foreground/25 hover:border-primary/50\"\n                        }`}\n                      >\n                        <input {...getInvitationInputProps()} data-testid=\"input-invitation-letter\" />\n                        <Upload className=\"h-6 w-6 mx-auto text-muted-foreground mb-2\" />\n                        {uploadedInvitationLetter ? (\n                          <div className=\"flex items-center justify-center gap-2\">\n                            <FileCheck className=\"h-4 w-4 text-green-600\" />\n                            <p className=\"text-sm font-medium\">{uploadedInvitationLetter.name}</p>\n                            <Button\n                              type=\"button\"\n                              variant=\"ghost\"\n                              size=\"icon\"\n                              className=\"h-6 w-6\"\n                              onClick={(e) => {\n                                e.stopPropagation();\n                                setUploadedInvitationLetter(null);\n                              }}\n                            >\n                              <X className=\"h-4 w-4\" />\n                            </Button>\n                          </div>\n                        ) : (\n                          <p className=\"text-sm text-muted-foreground\">\n                            Drag and drop an invitation letter, or click to browse\n                          </p>\n                        )}\n                        <p className=\"text-xs text-muted-foreground mt-1\">PDF, JPG, or PNG</p>\n                      </div>\n                    </div>\n\n                    <FormField\n                      control={form.control}\n                      name=\"additionalNotes\"\n                      render={({ field }) => (\n                        <FormItem>\n                          <FormLabel>Additional Notes</FormLabel>\n                          <FormControl>\n                            <Textarea\n                              {...field}\n                              placeholder=\"Any additional information for the federation...\"\n                              className=\"min-h-[80px]\"\n                              data-testid=\"textarea-notes\"\n                            />\n                          </FormControl>\n                          <FormMessage />\n                        </FormItem>\n                      )}\n                    />\n\n                    <Card className=\"bg-muted/50\">\n                      <CardContent className=\"p-4\">\n                        <div className=\"flex items-center justify-between\">\n                          <div>\n                            <h4 className=\"font-semibold\">Fee Summary</h4>\n                            <p className=\"text-sm text-muted-foreground\">Processing fees for federation letter</p>\n                          </div>\n                          <div className=\"text-right\">\n                            <div className=\"flex items-center gap-2 text-sm\">\n                              <span className=\"text-muted-foreground\">Federation Fee:</span>\n                              <span>$150.00</span>\n                            </div>\n                            <div className=\"flex items-center gap-2 text-sm\">\n                              <span className=\"text-muted-foreground\">Service Charge:</span>\n                              <span>$25.00</span>\n                            </div>\n                            <Separator className=\"my-2\" />\n                            <div className=\"flex items-center gap-2 font-semibold\">\n                              <Receipt className=\"h-4 w-4\" />\n                              <span>Total: $175.00</span>\n                            </div>\n                          </div>\n                        </div>\n                      </CardContent>\n                    </Card>\n                  </TabsContent>\n                </Tabs>\n\n                <DialogFooter>\n                  <Button type=\"button\" variant=\"outline\" onClick={() => setIsDialogOpen(false)}>\n                    Cancel\n                  </Button>\n                  <Button type=\"submit\" disabled={createMutation.isPending || isUploadingPassport} data-testid=\"button-create-request\">\n                    {createMutation.isPending || isUploadingPassport ? (\n                      <>\n                        <Loader2 className=\"h-4 w-4 mr-2 animate-spin\" />\n                        {isUploadingPassport ? \"Uploading Passport...\" : \"Creating...\"}\n                      </>\n                    ) : (\n                      <>\n                        <Plus className=\"h-4 w-4 mr-2\" />\n                        Create Request\n                      </>\n                    )}\n                  </Button>\n                </DialogFooter>\n              </form>\n            </Form>\n          </DialogContent>\n        </Dialog>\n\n        <Dialog open={isViewDialogOpen} onOpenChange={(open) => { setIsViewDialogOpen(open); if (!open) setViewTab(\"details\"); }}>\n          <DialogContent className=\"max-w-3xl max-h-[85vh] overflow-y-auto\">\n            <DialogHeader>\n              <DialogTitle className=\"flex items-center gap-2\">\n                <FileText className=\"h-5 w-5\" />\n                Request Details\n              </DialogTitle>\n              <DialogDescription>\n                {selectedRequest?.requestNumber}\n              </DialogDescription>\n            </DialogHeader>\n            {selectedRequest && (\n              <Tabs value={viewTab} onValueChange={setViewTab} className=\"w-full\">\n                <TabsList className=\"grid w-full grid-cols-4\">\n                  <TabsTrigger value=\"details\" className=\"flex items-center gap-1\">\n                    <FileText className=\"h-4 w-4\" />\n                    Details\n                  </TabsTrigger>\n                  <TabsTrigger value=\"history\" className=\"flex items-center gap-1\">\n                    <History className=\"h-4 w-4\" />\n                    History\n                  </TabsTrigger>\n                  <TabsTrigger value=\"messages\" className=\"flex items-center gap-1\">\n                    <MessageCircle className=\"h-4 w-4\" />\n                    Messages\n                    {requestMessages.filter(m => !m.isRead && m.senderPortal === 'federation').length > 0 && (\n                      <Badge variant=\"destructive\" className=\"ml-1 h-5 min-w-[20px] px-1\">\n                        {requestMessages.filter(m => !m.isRead && m.senderPortal === 'federation').length}\n                      </Badge>\n                    )}\n                  </TabsTrigger>\n                  <TabsTrigger value=\"documents\" className=\"flex items-center gap-1\">\n                    <Download className=\"h-4 w-4\" />\n                    Documents\n                  </TabsTrigger>\n                </TabsList>\n\n                <TabsContent value=\"details\" className=\"space-y-4 mt-4\">\n                  <div className=\"flex items-center gap-2 flex-wrap\">\n                    {getStatusBadge(selectedRequest.status)}\n                    {selectedRequest.paymentStatus === \"paid\" && (\n                      <Badge variant=\"outline\" className=\"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200\">\n                        <CheckCircle className=\"h-3 w-3 mr-1\" />\n                        Payment Confirmed\n                      </Badge>\n                    )}\n                  </div>\n                  <Separator />\n                  <div className=\"grid grid-cols-2 gap-4 text-sm\">\n                    <div>\n                      <span className=\"text-muted-foreground\">Athlete Name:</span>\n                      <p className=\"font-medium\">{selectedRequest.athleteFullName}</p>\n                    </div>\n                    <div>\n                      <span className=\"text-muted-foreground\">Nationality:</span>\n                      <p className=\"font-medium\">{selectedRequest.athleteNationality}</p>\n                    </div>\n                    <div>\n                      <span className=\"text-muted-foreground\">Target Club:</span>\n                      <p className=\"font-medium\">{selectedRequest.targetClubName}</p>\n                    </div>\n                    <div>\n                      <span className=\"text-muted-foreground\">Target Country:</span>\n                      <p className=\"font-medium\">{selectedRequest.targetClubCountry}</p>\n                    </div>\n                    <div>\n                      <span className=\"text-muted-foreground\">Transfer Type:</span>\n                      <p className=\"font-medium capitalize\">{selectedRequest.transferType}</p>\n                    </div>\n                    <div>\n                      <span className=\"text-muted-foreground\">Total Amount:</span>\n                      <p className=\"font-medium\">${selectedRequest.totalAmount}</p>\n                    </div>\n                    {selectedRequest.federationName && (\n                      <div>\n                        <span className=\"text-muted-foreground\">Federation:</span>\n                        <p className=\"font-medium\">{selectedRequest.federationName}</p>\n                      </div>\n                    )}\n                    <div>\n                      <span className=\"text-muted-foreground\">Created:</span>\n                      <p className=\"font-medium\">{new Date(selectedRequest.createdAt!).toLocaleString()}</p>\n                    </div>\n                  </div>\n                  {selectedRequest.requestPurpose && (\n                    <div>\n                      <span className=\"text-muted-foreground text-sm\">Purpose:</span>\n                      <p className=\"text-sm mt-1\">{selectedRequest.requestPurpose}</p>\n                    </div>\n                  )}\n                  {selectedRequest.rejectionReason && (\n                    <Card className=\"border-destructive\">\n                      <CardContent className=\"p-4\">\n                        <div className=\"flex items-center gap-2 text-destructive mb-2\">\n                          <AlertCircle className=\"h-4 w-4\" />\n                          <span className=\"font-semibold\">Rejection Reason</span>\n                        </div>\n                        <p className=\"text-sm\">{selectedRequest.rejectionReason}</p>\n                      </CardContent>\n                    </Card>\n                  )}\n                </TabsContent>\n\n                <TabsContent value=\"history\" className=\"space-y-4 mt-4\">\n                  <ScrollArea className=\"h-[400px]\">\n                    {requestActivities.length === 0 ? (\n                      <div className=\"text-center py-8 text-muted-foreground\">\n                        <History className=\"h-8 w-8 mx-auto mb-2 opacity-50\" />\n                        <p>No activity history yet</p>\n                      </div>\n                    ) : (\n                      <div className=\"space-y-4\">\n                        {requestActivities.map((activity) => (\n                          <div key={activity.id} className=\"flex gap-3 pb-4 border-b last:border-0\">\n                            <div className=\"flex-shrink-0 mt-1\">\n                              <div className=\"h-8 w-8 rounded-full bg-muted flex items-center justify-center\">\n                                {activity.activityType === 'status_change' && <RefreshCw className=\"h-4 w-4\" />}\n                                {activity.activityType === 'message_sent' && <MessageCircle className=\"h-4 w-4\" />}\n                                {activity.activityType === 'document_issued' && <FileCheck className=\"h-4 w-4\" />}\n                                {activity.activityType === 'document_downloaded' && <Download className=\"h-4 w-4\" />}\n                                {!['status_change', 'message_sent', 'document_issued', 'document_downloaded'].includes(activity.activityType) && <History className=\"h-4 w-4\" />}\n                              </div>\n                            </div>\n                            <div className=\"flex-1 min-w-0\">\n                              <div className=\"flex items-center gap-2 flex-wrap\">\n                                <span className=\"font-medium text-sm\">{activity.actorName || 'System'}</span>\n                                {activity.actorRole && (\n                                  <Badge variant=\"outline\" className=\"text-xs\">{activity.actorRole}</Badge>\n                                )}\n                              </div>\n                              <p className=\"text-sm text-muted-foreground mt-0.5\">{activity.description}</p>\n                              {activity.previousStatus && activity.newStatus && (\n                                <div className=\"flex items-center gap-2 text-xs mt-1\">\n                                  <Badge variant=\"outline\">{activity.previousStatus}</Badge>\n                                  <ArrowRight className=\"h-3 w-3\" />\n                                  <Badge variant=\"outline\">{activity.newStatus}</Badge>\n                                </div>\n                              )}\n                              <p className=\"text-xs text-muted-foreground mt-1\">\n                                {activity.timestamp && new Date(activity.timestamp).toLocaleString()}\n                              </p>\n                            </div>\n                          </div>\n                        ))}\n                      </div>\n                    )}\n                  </ScrollArea>\n                </TabsContent>\n\n                <TabsContent value=\"messages\" className=\"space-y-4 mt-4\">\n                  <ScrollArea className=\"h-[300px]\">\n                    {requestMessages.length === 0 ? (\n                      <div className=\"text-center py-8 text-muted-foreground\">\n                        <MessageCircle className=\"h-8 w-8 mx-auto mb-2 opacity-50\" />\n                        <p>No messages yet</p>\n                        <p className=\"text-xs mt-1\">Send a message to communicate with the federation</p>\n                      </div>\n                    ) : (\n                      <div className=\"space-y-3\">\n                        {requestMessages.slice().reverse().map((message) => (\n                          <div \n                            key={message.id} \n                            className={`p-3 rounded-lg ${\n                              message.senderPortal === 'team' \n                                ? 'bg-primary/10 ml-8' \n                                : 'bg-muted mr-8'\n                            }`}\n                          >\n                            <div className=\"flex items-center justify-between gap-2 mb-1\">\n                              <span className=\"font-medium text-sm\">{message.senderName}</span>\n                              <span className=\"text-xs text-muted-foreground\">\n                                {message.createdAt && new Date(message.createdAt).toLocaleString()}\n                              </span>\n                            </div>\n                            {message.subject && (\n                              <p className=\"text-sm font-medium\">{message.subject}</p>\n                            )}\n                            <p className=\"text-sm\">{message.content}</p>\n                          </div>\n                        ))}\n                      </div>\n                    )}\n                  </ScrollArea>\n                  <Separator />\n                  <div className=\"flex gap-2\">\n                    <Textarea\n                      placeholder=\"Type your message to the federation...\"\n                      value={newMessage}\n                      onChange={(e) => setNewMessage(e.target.value)}\n                      className=\"flex-1 min-h-[80px]\"\n                      data-testid=\"input-message\"\n                    />\n                  </div>\n                  <Button \n                    onClick={() => sendMessageMutation.mutate(newMessage)}\n                    disabled={!newMessage.trim() || sendMessageMutation.isPending}\n                    className=\"w-full\"\n                    data-testid=\"button-send-message\"\n                  >\n                    {sendMessageMutation.isPending ? (\n                      <LoadingSpinner />\n                    ) : (\n                      <>\n                        <Send className=\"h-4 w-4 mr-2\" />\n                        Send Message\n                      </>\n                    )}\n                  </Button>\n                </TabsContent>\n\n                <TabsContent value=\"documents\" className=\"space-y-4 mt-4\">\n                  {issuedDocuments.length === 0 ? (\n                    <div className=\"text-center py-8 text-muted-foreground\">\n                      <FileCheck className=\"h-8 w-8 mx-auto mb-2 opacity-50\" />\n                      <p>No documents issued yet</p>\n                      <p className=\"text-xs mt-1\">Documents will appear here once the federation issues them</p>\n                    </div>\n                  ) : (\n                    <div className=\"space-y-3\">\n                      {issuedDocuments.map((doc) => (\n                        <Card key={doc.id}>\n                          <CardContent className=\"p-4\">\n                            <div className=\"flex items-center justify-between gap-4\">\n                              <div className=\"flex items-center gap-3\">\n                                <div className=\"h-10 w-10 rounded bg-primary/10 flex items-center justify-center\">\n                                  <FileCheck className=\"h-5 w-5 text-primary\" />\n                                </div>\n                                <div>\n                                  <p className=\"font-medium\">{doc.originalName}</p>\n                                  <div className=\"flex items-center gap-2 text-xs text-muted-foreground\">\n                                    <span>{doc.documentType}</span>\n                                    {doc.documentNumber && <span>#{doc.documentNumber}</span>}\n                                  </div>\n                                </div>\n                              </div>\n                              <div className=\"text-right space-y-2\">\n                                <p className=\"text-xs text-muted-foreground\">\n                                  Issued: {doc.createdAt && new Date(doc.createdAt).toLocaleDateString()}\n                                </p>\n                                {doc.downloadCount !== null && doc.downloadCount > 0 && (\n                                  <p className=\"text-xs text-muted-foreground\">\n                                    Downloaded {doc.downloadCount} times\n                                  </p>\n                                )}\n                                <div className=\"flex flex-col gap-1\">\n                                  <Button \n                                    size=\"sm\" \n                                    variant=\"default\" \n                                    data-testid={`button-download-certificate-${doc.id}`}\n                                    onClick={() => {\n                                      window.open(`/api/federation-requests/${selectedRequest?.id}/issued-documents/${doc.id}/download-file`, '_blank');\n                                      toast({\n                                        title: \"Certificate Downloaded\",\n                                        description: \"Platform certificate with timestamp downloaded\",\n                                      });\n                                    }}\n                                  >\n                                    <FileCheck className=\"h-4 w-4 mr-1\" />\n                                    Certificate\n                                  </Button>\n                                  <Button \n                                    size=\"sm\" \n                                    variant=\"outline\" \n                                    data-testid={`button-download-original-${doc.id}`}\n                                    onClick={() => {\n                                      window.open(`/api/federation-requests/${selectedRequest?.id}/issued-documents/${doc.id}/download-original`, '_blank');\n                                      toast({\n                                        title: \"Download Started\",\n                                        description: `Downloading original: ${doc.originalName}`,\n                                      });\n                                    }}\n                                  >\n                                    <Download className=\"h-4 w-4 mr-1\" />\n                                    Original\n                                  </Button>\n                                </div>\n                              </div>\n                            </div>\n                          </CardContent>\n                        </Card>\n                      ))}\n                    </div>\n                  )}\n                </TabsContent>\n              </Tabs>\n            )}\n          </DialogContent>\n        </Dialog>\n\n        <Dialog open={isPaymentDialogOpen} onOpenChange={setIsPaymentDialogOpen}>\n          <DialogContent>\n            <DialogHeader>\n              <DialogTitle className=\"flex items-center gap-2\">\n                <CreditCard className=\"h-5 w-5\" />\n                Complete Payment\n              </DialogTitle>\n              <DialogDescription>\n                Pay the processing fee to submit your federation letter request\n              </DialogDescription>\n            </DialogHeader>\n            {selectedRequest && (\n              <div className=\"space-y-4\">\n                <Card>\n                  <CardContent className=\"p-4 space-y-2\">\n                    <div className=\"flex justify-between text-sm\">\n                      <span className=\"text-muted-foreground\">Federation Fee</span>\n                      <span>${selectedRequest.feeAmount}</span>\n                    </div>\n                    <div className=\"flex justify-between text-sm\">\n                      <span className=\"text-muted-foreground\">Service Charge</span>\n                      <span>${selectedRequest.serviceCharge}</span>\n                    </div>\n                    <Separator />\n                    <div className=\"flex justify-between font-semibold\">\n                      <span>Total</span>\n                      <span>${selectedRequest.totalAmount}</span>\n                    </div>\n                  </CardContent>\n                </Card>\n                <DialogFooter>\n                  <Button variant=\"outline\" onClick={() => setIsPaymentDialogOpen(false)}>\n                    Cancel\n                  </Button>\n                  <Button\n                    onClick={() => paymentMutation.mutate(selectedRequest.id)}\n                    disabled={paymentMutation.isPending}\n                    data-testid=\"button-confirm-payment\"\n                  >\n                    {paymentMutation.isPending ? (\n                      <>\n                        <LoadingSpinner />\n                        Processing...\n                      </>\n                    ) : (\n                      <>\n                        <CreditCard className=\"h-4 w-4 mr-2\" />\n                        Pay ${selectedRequest.totalAmount}\n                      </>\n                    )}\n                  </Button>\n                </DialogFooter>\n              </div>\n            )}\n          </DialogContent>\n        </Dialog>\n      </div>\n    </div>\n  );\n}\n","path":null,"size_bytes":65095,"size_tokens":null},"server/replit_integrations/object_storage/objectAcl.ts":{"content":"import { File } from \"@google-cloud/storage\";\n\nconst ACL_POLICY_METADATA_KEY = \"custom:aclPolicy\";\n\n// The type of the access group.\n//\n// Can be flexibly defined according to the use case.\n//\n// Examples:\n// - USER_LIST: the users from a list stored in the database;\n// - EMAIL_DOMAIN: the users whose email is in a specific domain;\n// - GROUP_MEMBER: the users who are members of a specific group;\n// - SUBSCRIBER: the users who are subscribers of a specific service / content\n//   creator.\nexport enum ObjectAccessGroupType {}\n\n// The logic user group that can access the object.\nexport interface ObjectAccessGroup {\n  // The type of the access group.\n  type: ObjectAccessGroupType;\n  // The logic id that is enough to identify the qualified group members.\n  //\n  // It may have different format for different types. For example:\n  // - for USER_LIST, the id could be the user list db entity id, and the\n  //   user list db entity could contain a bunch of user ids. User needs\n  //   to be a member of the user list to be able to access the object.\n  // - for EMAIL_DOMAIN, the id could be the email domain, and the user needs\n  //   to have an email with the domain to be able to access the object.\n  // - for GROUP_MEMBER, the id could be the group db entity id, and the\n  //   group db entity could contain a bunch of user ids. User needs to be\n  //   a member of the group to be able to access the object.\n  // - for SUBSCRIBER, the id could be the subscriber db entity id, and the\n  //   subscriber db entity could contain a bunch of user ids. User needs to\n  //   be a subscriber to be able to access the object.\n  id: string;\n}\n\nexport enum ObjectPermission {\n  READ = \"read\",\n  WRITE = \"write\",\n}\n\nexport interface ObjectAclRule {\n  group: ObjectAccessGroup;\n  permission: ObjectPermission;\n}\n\n// The ACL policy of the object.\n// This would be set as part of the object custom metadata:\n// - key: \"custom:aclPolicy\"\n// - value: JSON string of the ObjectAclPolicy object.\nexport interface ObjectAclPolicy {\n  owner: string;\n  visibility: \"public\" | \"private\";\n  aclRules?: Array<ObjectAclRule>;\n}\n\n// Check if the requested permission is allowed based on the granted permission.\nfunction isPermissionAllowed(\n  requested: ObjectPermission,\n  granted: ObjectPermission,\n): boolean {\n  // Users granted with read or write permissions can read the object.\n  if (requested === ObjectPermission.READ) {\n    return [ObjectPermission.READ, ObjectPermission.WRITE].includes(granted);\n  }\n\n  // Only users granted with write permissions can write the object.\n  return granted === ObjectPermission.WRITE;\n}\n\n// The base class for all access groups.\n//\n// Different types of access groups can be implemented according to the use case.\nabstract class BaseObjectAccessGroup implements ObjectAccessGroup {\n  constructor(\n    public readonly type: ObjectAccessGroupType,\n    public readonly id: string,\n  ) {}\n\n  // Check if the user is a member of the group.\n  public abstract hasMember(userId: string): Promise<boolean>;\n}\n\nfunction createObjectAccessGroup(\n  group: ObjectAccessGroup,\n): BaseObjectAccessGroup {\n  switch (group.type) {\n    // Implement the case for each type of access group to instantiate.\n    //\n    // For example:\n    // case \"USER_LIST\":\n    //   return new UserListAccessGroup(group.id);\n    // case \"EMAIL_DOMAIN\":\n    //   return new EmailDomainAccessGroup(group.id);\n    // case \"GROUP_MEMBER\":\n    //   return new GroupMemberAccessGroup(group.id);\n    // case \"SUBSCRIBER\":\n    //   return new SubscriberAccessGroup(group.id);\n    default:\n      throw new Error(`Unknown access group type: ${group.type}`);\n  }\n}\n\n// Sets the ACL policy to the object metadata.\nexport async function setObjectAclPolicy(\n  objectFile: File,\n  aclPolicy: ObjectAclPolicy,\n): Promise<void> {\n  const [exists] = await objectFile.exists();\n  if (!exists) {\n    throw new Error(`Object not found: ${objectFile.name}`);\n  }\n\n  await objectFile.setMetadata({\n    metadata: {\n      [ACL_POLICY_METADATA_KEY]: JSON.stringify(aclPolicy),\n    },\n  });\n}\n\n// Gets the ACL policy from the object metadata.\nexport async function getObjectAclPolicy(\n  objectFile: File,\n): Promise<ObjectAclPolicy | null> {\n  const [metadata] = await objectFile.getMetadata();\n  const aclPolicy = metadata?.metadata?.[ACL_POLICY_METADATA_KEY];\n  if (!aclPolicy) {\n    return null;\n  }\n  return JSON.parse(aclPolicy as string);\n}\n\n// Checks if the user can access the object.\nexport async function canAccessObject({\n  userId,\n  objectFile,\n  requestedPermission,\n}: {\n  userId?: string;\n  objectFile: File;\n  requestedPermission: ObjectPermission;\n}): Promise<boolean> {\n  // When this function is called, the acl policy is required.\n  const aclPolicy = await getObjectAclPolicy(objectFile);\n  if (!aclPolicy) {\n    return false;\n  }\n\n  // Public objects are always accessible for read.\n  if (\n    aclPolicy.visibility === \"public\" &&\n    requestedPermission === ObjectPermission.READ\n  ) {\n    return true;\n  }\n\n  // Access control requires the user id.\n  if (!userId) {\n    return false;\n  }\n\n  // The owner of the object can always access it.\n  if (aclPolicy.owner === userId) {\n    return true;\n  }\n\n  // Go through the ACL rules to check if the user has the required permission.\n  for (const rule of aclPolicy.aclRules || []) {\n    const accessGroup = createObjectAccessGroup(rule.group);\n    if (\n      (await accessGroup.hasMember(userId)) &&\n      isPermissionAllowed(requestedPermission, rule.permission)\n    ) {\n      return true;\n    }\n  }\n\n  return false;\n}\n\n","path":null,"size_bytes":5545,"size_tokens":null},"client/src/components/ObjectUploader.tsx":{"content":"import { useState } from \"react\";\nimport type { ReactNode } from \"react\";\nimport Uppy from \"@uppy/core\";\nimport type { UppyFile, UploadResult } from \"@uppy/core\";\nimport DashboardModal from \"@uppy/react/dashboard-modal\";\nimport \"@uppy/core/css/style.min.css\";\nimport \"@uppy/dashboard/css/style.min.css\";\nimport AwsS3 from \"@uppy/aws-s3\";\nimport { Button } from \"@/components/ui/button\";\n\ninterface ObjectUploaderProps {\n  maxNumberOfFiles?: number;\n  maxFileSize?: number;\n  /**\n   * Function to get upload parameters for each file.\n   * IMPORTANT: This receives the file object - use file.name, file.size, file.type\n   * to request per-file presigned URLs from your backend.\n   */\n  onGetUploadParameters: (\n    file: UppyFile<Record<string, unknown>, Record<string, unknown>>\n  ) => Promise<{\n    method: \"PUT\";\n    url: string;\n    headers?: Record<string, string>;\n  }>;\n  onComplete?: (\n    result: UploadResult<Record<string, unknown>, Record<string, unknown>>\n  ) => void;\n  buttonClassName?: string;\n  children: ReactNode;\n}\n\n/**\n * A file upload component that renders as a button and provides a modal interface for\n * file management.\n *\n * Features:\n * - Renders as a customizable button that opens a file upload modal\n * - Provides a modal interface for:\n *   - File selection\n *   - File preview\n *   - Upload progress tracking\n *   - Upload status display\n *\n * The component uses Uppy v5 under the hood to handle all file upload functionality.\n * All file management features are automatically handled by the Uppy dashboard modal.\n *\n * @param props - Component props\n * @param props.maxNumberOfFiles - Maximum number of files allowed to be uploaded\n *   (default: 1)\n * @param props.maxFileSize - Maximum file size in bytes (default: 10MB)\n * @param props.onGetUploadParameters - Function to get upload parameters for each file.\n *   Receives the UppyFile object with file.name, file.size, file.type properties.\n *   Use these to request per-file presigned URLs from your backend. Returns method,\n *   url, and optional headers for the upload request.\n * @param props.onComplete - Callback function called when upload is complete. Typically\n *   used to make post-upload API calls to update server state and set object ACL\n *   policies.\n * @param props.buttonClassName - Optional CSS class name for the button\n * @param props.children - Content to be rendered inside the button\n */\nexport function ObjectUploader({\n  maxNumberOfFiles = 1,\n  maxFileSize = 10485760, // 10MB default\n  onGetUploadParameters,\n  onComplete,\n  buttonClassName,\n  children,\n}: ObjectUploaderProps) {\n  const [showModal, setShowModal] = useState(false);\n  const [uppy] = useState(() =>\n    new Uppy({\n      restrictions: {\n        maxNumberOfFiles,\n        maxFileSize,\n      },\n      autoProceed: false,\n    })\n      .use(AwsS3, {\n        shouldUseMultipart: false,\n        getUploadParameters: onGetUploadParameters,\n      })\n      .on(\"complete\", (result) => {\n        onComplete?.(result);\n      })\n  );\n\n  return (\n    <div>\n      <Button onClick={() => setShowModal(true)} className={buttonClassName}>\n        {children}\n      </Button>\n\n      <DashboardModal\n        uppy={uppy}\n        open={showModal}\n        onRequestClose={() => setShowModal(false)}\n        proudlyDisplayPoweredByUppy={false}\n      />\n    </div>\n  );\n}\n\n","path":null,"size_bytes":3327,"size_tokens":null},"client/src/components/TransferEligibilityDashboard.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Button } from \"@/components/ui/button\";\nimport { Progress } from \"@/components/ui/progress\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { Tooltip, TooltipContent, TooltipTrigger } from \"@/components/ui/tooltip\";\nimport { RefreshCw, Clock, Globe, Award, TrendingUp, AlertTriangle, CheckCircle, XCircle, Info } from \"lucide-react\";\nimport { queryClient, apiRequest } from \"@/lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\n\ninterface VisaScore {\n  score: number;\n  status: \"green\" | \"yellow\" | \"red\";\n  breakdown: {\n    minutesScore: number;\n    internationalScore: number;\n    leagueScore: number;\n    performanceScore: number;\n  };\n  recommendations: string[];\n}\n\ninterface TransferEligibilityData {\n  assessment: {\n    id: string;\n    playerId: string;\n    totalMinutesVerified: number;\n    overallStatus: string;\n    calculatedAt: string;\n  };\n  player: {\n    id: string;\n    name: string;\n    position: string;\n    nationality: string;\n    currentClub: string;\n    marketValue: number;\n  };\n  minutesBreakdown: {\n    club: number;\n    international: number;\n    video: number;\n    total: number;\n    minimum: number;\n    needed: number;\n  };\n  visaScores: {\n    schengen: VisaScore;\n    o1: VisaScore;\n    p1: VisaScore;\n    ukGbe: VisaScore;\n    esc: VisaScore;\n  };\n  overallStatus: \"green\" | \"yellow\" | \"red\";\n  recommendations: string[];\n  capsNeeded: number;\n  leagueBandApplied: number;\n}\n\ninterface TransferEligibilityDashboardProps {\n  playerId: string;\n}\n\nfunction StatusBadge({ status }: { status: \"green\" | \"yellow\" | \"red\" }) {\n  const config = {\n    green: { label: \"Eligible\", variant: \"default\" as const, className: \"bg-green-600 hover:bg-green-700 text-white\" },\n    yellow: { label: \"Conditional\", variant: \"secondary\" as const, className: \"bg-yellow-500 hover:bg-yellow-600 text-black\" },\n    red: { label: \"Ineligible\", variant: \"destructive\" as const, className: \"bg-red-600 hover:bg-red-700 text-white\" },\n  };\n  \n  const { label, className } = config[status];\n  return <Badge className={className}>{label}</Badge>;\n}\n\nfunction StatusIcon({ status }: { status: \"green\" | \"yellow\" | \"red\" }) {\n  switch (status) {\n    case \"green\":\n      return <CheckCircle className=\"h-5 w-5 text-green-600\" />;\n    case \"yellow\":\n      return <AlertTriangle className=\"h-5 w-5 text-yellow-500\" />;\n    case \"red\":\n      return <XCircle className=\"h-5 w-5 text-red-600\" />;\n  }\n}\n\nfunction VisaCard({ name, visa, icon }: { name: string; visa: VisaScore; icon: React.ReactNode }) {\n  const statusColors = {\n    green: \"border-green-500\",\n    yellow: \"border-yellow-500\",\n    red: \"border-red-500\",\n  };\n\n  return (\n    <Card className={`border-l-4 ${statusColors[visa.status]}`} data-testid={`card-visa-${name.toLowerCase()}`}>\n      <CardHeader className=\"pb-2\">\n        <div className=\"flex items-center justify-between gap-2\">\n          <div className=\"flex items-center gap-2\">\n            {icon}\n            <CardTitle className=\"text-sm font-medium\">{name}</CardTitle>\n          </div>\n          <StatusBadge status={visa.status} />\n        </div>\n      </CardHeader>\n      <CardContent>\n        <div className=\"space-y-3\">\n          <div className=\"flex items-center justify-between\">\n            <span className=\"text-2xl font-bold\">{visa.score}</span>\n            <span className=\"text-sm text-muted-foreground\">/ 100</span>\n          </div>\n          <Progress value={visa.score} className=\"h-2\" />\n          \n          <div className=\"grid grid-cols-2 gap-2 text-xs\">\n            <div className=\"flex justify-between\">\n              <span className=\"text-muted-foreground\">Minutes</span>\n              <span>{Math.round(visa.breakdown.minutesScore)}</span>\n            </div>\n            <div className=\"flex justify-between\">\n              <span className=\"text-muted-foreground\">International</span>\n              <span>{Math.round(visa.breakdown.internationalScore)}</span>\n            </div>\n            <div className=\"flex justify-between\">\n              <span className=\"text-muted-foreground\">League</span>\n              <span>{Math.round(visa.breakdown.leagueScore)}</span>\n            </div>\n            <div className=\"flex justify-between\">\n              <span className=\"text-muted-foreground\">Performance</span>\n              <span>{Math.round(visa.breakdown.performanceScore)}</span>\n            </div>\n          </div>\n\n          {visa.recommendations.length > 0 && (\n            <div className=\"pt-2 border-t\">\n              <p className=\"text-xs text-muted-foreground mb-1\">Recommendations:</p>\n              <ul className=\"text-xs space-y-1\">\n                {visa.recommendations.slice(0, 2).map((rec, i) => (\n                  <li key={i} className=\"flex items-start gap-1\">\n                    <TrendingUp className=\"h-3 w-3 mt-0.5 text-muted-foreground flex-shrink-0\" />\n                    <span>{rec}</span>\n                  </li>\n                ))}\n              </ul>\n            </div>\n          )}\n        </div>\n      </CardContent>\n    </Card>\n  );\n}\n\nexport default function TransferEligibilityDashboard({ playerId }: TransferEligibilityDashboardProps) {\n  const { toast } = useToast();\n  const [activeTab, setActiveTab] = useState(\"overview\");\n\n  const { data, isLoading, error } = useQuery<TransferEligibilityData>({\n    queryKey: [\"/api/players\", playerId, \"transfer-eligibility\"],\n    queryFn: async () => {\n      const res = await fetch(`/api/players/${playerId}/transfer-eligibility`);\n      if (!res.ok) throw new Error(\"Failed to fetch eligibility data\");\n      return res.json();\n    },\n    enabled: !!playerId,\n  });\n\n  const recalculateMutation = useMutation({\n    mutationFn: async () => {\n      return apiRequest(\"POST\", `/api/players/${playerId}/transfer-eligibility/recalculate`);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/players\", playerId, \"transfer-eligibility\"] });\n      toast({ title: \"Success\", description: \"Eligibility scores recalculated\" });\n    },\n    onError: () => {\n      toast({ title: \"Error\", description: \"Failed to recalculate scores\", variant: \"destructive\" });\n    },\n  });\n\n  if (isLoading) {\n    return (\n      <Card data-testid=\"card-transfer-eligibility-loading\">\n        <CardContent className=\"flex items-center justify-center py-12\">\n          <RefreshCw className=\"h-8 w-8 animate-spin text-muted-foreground\" />\n          <span className=\"ml-3 text-muted-foreground\">Calculating eligibility scores...</span>\n        </CardContent>\n      </Card>\n    );\n  }\n\n  if (error || !data) {\n    return (\n      <Card data-testid=\"card-transfer-eligibility-error\">\n        <CardContent className=\"flex flex-col items-center justify-center py-12 gap-4\">\n          <AlertTriangle className=\"h-8 w-8 text-yellow-500\" />\n          <p className=\"text-muted-foreground\">Unable to load eligibility data</p>\n          <Button variant=\"outline\" onClick={() => recalculateMutation.mutate()}>\n            Try Again\n          </Button>\n        </CardContent>\n      </Card>\n    );\n  }\n\n  const statusColorClass = {\n    green: \"bg-green-600\",\n    yellow: \"bg-yellow-500\",\n    red: \"bg-red-600\",\n  };\n\n  const minutesPercentage = Math.min(100, (data.minutesBreakdown.total / data.minutesBreakdown.minimum) * 100);\n\n  return (\n    <div className=\"space-y-6\" data-testid=\"container-transfer-eligibility\">\n      <Card className=\"border-2\" data-testid=\"card-eligibility-summary\">\n        <CardHeader className=\"pb-4\">\n          <div className=\"flex items-center justify-between gap-4 flex-wrap\">\n            <div className=\"flex items-center gap-3\">\n              <div className={`p-3 rounded-full ${statusColorClass[data.overallStatus]}`}>\n                <StatusIcon status={data.overallStatus} />\n              </div>\n              <div>\n                <CardTitle className=\"text-xl\">Transfer Eligibility</CardTitle>\n                <p className=\"text-sm text-muted-foreground\">\n                  {data.player.name} - {data.player.position}\n                </p>\n              </div>\n            </div>\n            <div className=\"flex items-center gap-2\">\n              <StatusBadge status={data.overallStatus} />\n              <Tooltip>\n                <TooltipTrigger asChild>\n                  <Button \n                    variant=\"outline\" \n                    size=\"icon\"\n                    onClick={() => recalculateMutation.mutate()}\n                    disabled={recalculateMutation.isPending}\n                    data-testid=\"button-recalculate\"\n                  >\n                    <RefreshCw className={`h-4 w-4 ${recalculateMutation.isPending ? 'animate-spin' : ''}`} />\n                  </Button>\n                </TooltipTrigger>\n                <TooltipContent>Recalculate eligibility</TooltipContent>\n              </Tooltip>\n            </div>\n          </div>\n        </CardHeader>\n        <CardContent>\n          <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\n            <div className=\"space-y-2\">\n              <div className=\"flex items-center justify-between text-sm\">\n                <span className=\"flex items-center gap-2\">\n                  <Clock className=\"h-4 w-4\" />\n                  Total Verified Minutes\n                </span>\n                <span className=\"font-bold\">{data.minutesBreakdown.total.toLocaleString()}</span>\n              </div>\n              <Progress value={minutesPercentage} className=\"h-3\" />\n              <p className=\"text-xs text-muted-foreground\">\n                {data.minutesBreakdown.needed > 0 \n                  ? `${data.minutesBreakdown.needed} more minutes needed (min: ${data.minutesBreakdown.minimum})`\n                  : \"Minimum threshold met\"\n                }\n              </p>\n            </div>\n            \n            <div className=\"space-y-2\">\n              <p className=\"text-sm font-medium flex items-center gap-2\">\n                <TrendingUp className=\"h-4 w-4\" />\n                Minutes Breakdown\n              </p>\n              <div className=\"flex gap-2\">\n                <Tooltip>\n                  <TooltipTrigger asChild>\n                    <div \n                      className=\"h-6 bg-blue-500 rounded\" \n                      style={{ width: `${Math.max(5, (data.minutesBreakdown.club / Math.max(data.minutesBreakdown.total, 1)) * 100)}%` }}\n                    />\n                  </TooltipTrigger>\n                  <TooltipContent>Club: {data.minutesBreakdown.club} mins</TooltipContent>\n                </Tooltip>\n                <Tooltip>\n                  <TooltipTrigger asChild>\n                    <div \n                      className=\"h-6 bg-green-500 rounded\" \n                      style={{ width: `${Math.max(5, (data.minutesBreakdown.international / Math.max(data.minutesBreakdown.total, 1)) * 100)}%` }}\n                    />\n                  </TooltipTrigger>\n                  <TooltipContent>International: {data.minutesBreakdown.international} mins</TooltipContent>\n                </Tooltip>\n                <Tooltip>\n                  <TooltipTrigger asChild>\n                    <div \n                      className=\"h-6 bg-purple-500 rounded\" \n                      style={{ width: `${Math.max(5, (data.minutesBreakdown.video / Math.max(data.minutesBreakdown.total, 1)) * 100)}%` }}\n                    />\n                  </TooltipTrigger>\n                  <TooltipContent>Video: {data.minutesBreakdown.video} mins</TooltipContent>\n                </Tooltip>\n              </div>\n              <div className=\"flex gap-4 text-xs\">\n                <span className=\"flex items-center gap-1\"><div className=\"w-2 h-2 bg-blue-500 rounded\" /> Club</span>\n                <span className=\"flex items-center gap-1\"><div className=\"w-2 h-2 bg-green-500 rounded\" /> International</span>\n                <span className=\"flex items-center gap-1\"><div className=\"w-2 h-2 bg-purple-500 rounded\" /> Video</span>\n              </div>\n            </div>\n\n            <div className=\"space-y-2\">\n              <p className=\"text-sm font-medium flex items-center gap-2\">\n                <Info className=\"h-4 w-4\" />\n                Assessment Info\n              </p>\n              <div className=\"text-xs space-y-1\">\n                <div className=\"flex justify-between\">\n                  <span className=\"text-muted-foreground\">League Band Applied:</span>\n                  <Badge variant=\"outline\" className=\"text-xs\">Band {data.leagueBandApplied}</Badge>\n                </div>\n                {data.capsNeeded > 0 && (\n                  <div className=\"flex justify-between\">\n                    <span className=\"text-muted-foreground\">Caps Needed:</span>\n                    <span>{data.capsNeeded}</span>\n                  </div>\n                )}\n              </div>\n            </div>\n          </div>\n        </CardContent>\n      </Card>\n\n      <Tabs value={activeTab} onValueChange={setActiveTab} className=\"w-full\">\n        <TabsList className=\"grid w-full grid-cols-2\">\n          <TabsTrigger value=\"overview\" data-testid=\"tab-overview\">Visa Eligibility</TabsTrigger>\n          <TabsTrigger value=\"recommendations\" data-testid=\"tab-recommendations\">Recommendations</TabsTrigger>\n        </TabsList>\n\n        <TabsContent value=\"overview\" className=\"space-y-4 mt-4\">\n          <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\">\n            <VisaCard \n              name=\"Schengen\" \n              visa={data.visaScores.schengen} \n              icon={<Globe className=\"h-4 w-4 text-blue-500\" />}\n            />\n            <VisaCard \n              name=\"O-1 (US)\" \n              visa={data.visaScores.o1} \n              icon={<Award className=\"h-4 w-4 text-yellow-600\" />}\n            />\n            <VisaCard \n              name=\"P-1 (US)\" \n              visa={data.visaScores.p1} \n              icon={<TrendingUp className=\"h-4 w-4 text-green-600\" />}\n            />\n            <VisaCard \n              name=\"UK GBE\" \n              visa={data.visaScores.ukGbe} \n              icon={<Globe className=\"h-4 w-4 text-indigo-500\" />}\n            />\n            <VisaCard \n              name=\"ESC (UK)\" \n              visa={data.visaScores.esc} \n              icon={<Award className=\"h-4 w-4 text-purple-500\" />}\n            />\n          </div>\n        </TabsContent>\n\n        <TabsContent value=\"recommendations\" className=\"mt-4\">\n          <Card data-testid=\"card-recommendations\">\n            <CardHeader>\n              <CardTitle className=\"text-lg flex items-center gap-2\">\n                <TrendingUp className=\"h-5 w-5\" />\n                Steps to Improve Transfer Readiness\n              </CardTitle>\n            </CardHeader>\n            <CardContent>\n              {data.recommendations.length > 0 ? (\n                <ul className=\"space-y-3\">\n                  {data.recommendations.map((rec, index) => (\n                    <li key={index} className=\"flex items-start gap-3 p-3 bg-muted/50 rounded-md\" data-testid={`recommendation-${index}`}>\n                      <div className=\"flex-shrink-0 w-6 h-6 rounded-full bg-primary/10 flex items-center justify-center text-sm font-medium\">\n                        {index + 1}\n                      </div>\n                      <span>{rec}</span>\n                    </li>\n                  ))}\n                </ul>\n              ) : (\n                <div className=\"flex items-center justify-center py-8 text-muted-foreground\">\n                  <CheckCircle className=\"h-6 w-6 mr-2 text-green-600\" />\n                  Player meets all eligibility requirements\n                </div>\n              )}\n            </CardContent>\n          </Card>\n        </TabsContent>\n      </Tabs>\n    </div>\n  );\n}\n","path":null,"size_bytes":15929,"size_tokens":null},"client/src/hooks/use-upload.ts":{"content":"import { useState, useCallback } from \"react\";\nimport type { UppyFile } from \"@uppy/core\";\n\ninterface UploadMetadata {\n  name: string;\n  size: number;\n  contentType: string;\n}\n\ninterface UploadResponse {\n  uploadURL: string;\n  objectPath: string;\n  metadata: UploadMetadata;\n}\n\ninterface UseUploadOptions {\n  onSuccess?: (response: UploadResponse) => void;\n  onError?: (error: Error) => void;\n}\n\n/**\n * React hook for handling file uploads with presigned URLs.\n *\n * This hook implements the two-step presigned URL upload flow:\n * 1. Request a presigned URL from your backend (sends JSON metadata, NOT the file)\n * 2. Upload the file directly to the presigned URL\n *\n * @example\n * ```tsx\n * function FileUploader() {\n *   const { uploadFile, isUploading, error } = useUpload({\n *     onSuccess: (response) => {\n *       console.log(\"Uploaded to:\", response.objectPath);\n *     },\n *   });\n *\n *   const handleFileChange = async (e: React.ChangeEvent<HTMLInputElement>) => {\n *     const file = e.target.files?.[0];\n *     if (file) {\n *       await uploadFile(file);\n *     }\n *   };\n *\n *   return (\n *     <div>\n *       <input type=\"file\" onChange={handleFileChange} disabled={isUploading} />\n *       {isUploading && <p>Uploading...</p>}\n *       {error && <p>Error: {error.message}</p>}\n *     </div>\n *   );\n * }\n * ```\n */\nexport function useUpload(options: UseUploadOptions = {}) {\n  const [isUploading, setIsUploading] = useState(false);\n  const [error, setError] = useState<Error | null>(null);\n  const [progress, setProgress] = useState(0);\n\n  /**\n   * Request a presigned URL from the backend.\n   * IMPORTANT: Send JSON metadata, NOT the file itself.\n   */\n  const requestUploadUrl = useCallback(\n    async (file: File): Promise<UploadResponse> => {\n      const response = await fetch(\"/api/uploads/request-url\", {\n        method: \"POST\",\n        headers: {\n          \"Content-Type\": \"application/json\",\n        },\n        body: JSON.stringify({\n          name: file.name,\n          size: file.size,\n          contentType: file.type || \"application/octet-stream\",\n        }),\n      });\n\n      if (!response.ok) {\n        const errorData = await response.json().catch(() => ({}));\n        throw new Error(errorData.error || \"Failed to get upload URL\");\n      }\n\n      return response.json();\n    },\n    []\n  );\n\n  /**\n   * Upload a file directly to the presigned URL.\n   */\n  const uploadToPresignedUrl = useCallback(\n    async (file: File, uploadURL: string): Promise<void> => {\n      const response = await fetch(uploadURL, {\n        method: \"PUT\",\n        body: file,\n        headers: {\n          \"Content-Type\": file.type || \"application/octet-stream\",\n        },\n      });\n\n      if (!response.ok) {\n        throw new Error(\"Failed to upload file to storage\");\n      }\n    },\n    []\n  );\n\n  /**\n   * Upload a file using the presigned URL flow.\n   *\n   * @param file - The file to upload\n   * @returns The upload response containing the object path\n   */\n  const uploadFile = useCallback(\n    async (file: File): Promise<UploadResponse | null> => {\n      setIsUploading(true);\n      setError(null);\n      setProgress(0);\n\n      try {\n        // Step 1: Request presigned URL (send metadata as JSON)\n        setProgress(10);\n        const uploadResponse = await requestUploadUrl(file);\n\n        // Step 2: Upload file directly to presigned URL\n        setProgress(30);\n        await uploadToPresignedUrl(file, uploadResponse.uploadURL);\n\n        setProgress(100);\n        options.onSuccess?.(uploadResponse);\n        return uploadResponse;\n      } catch (err) {\n        const error = err instanceof Error ? err : new Error(\"Upload failed\");\n        setError(error);\n        options.onError?.(error);\n        return null;\n      } finally {\n        setIsUploading(false);\n      }\n    },\n    [requestUploadUrl, uploadToPresignedUrl, options]\n  );\n\n  /**\n   * Get upload parameters for Uppy's AWS S3 plugin.\n   *\n   * IMPORTANT: This function receives the UppyFile object from Uppy.\n   * Use file.name, file.size, file.type to request per-file presigned URLs.\n   *\n   * Use this with the ObjectUploader component:\n   * ```tsx\n   * <ObjectUploader onGetUploadParameters={getUploadParameters}>\n   *   Upload\n   * </ObjectUploader>\n   * ```\n   */\n  const getUploadParameters = useCallback(\n    async (\n      file: UppyFile<Record<string, unknown>, Record<string, unknown>>\n    ): Promise<{\n      method: \"PUT\";\n      url: string;\n      headers?: Record<string, string>;\n    }> => {\n      // Use the actual file properties to request a per-file presigned URL\n      const response = await fetch(\"/api/uploads/request-url\", {\n        method: \"POST\",\n        headers: {\n          \"Content-Type\": \"application/json\",\n        },\n        body: JSON.stringify({\n          name: file.name,\n          size: file.size,\n          contentType: file.type || \"application/octet-stream\",\n        }),\n      });\n\n      if (!response.ok) {\n        throw new Error(\"Failed to get upload URL\");\n      }\n\n      const data = await response.json();\n      return {\n        method: \"PUT\",\n        url: data.uploadURL,\n        headers: { \"Content-Type\": file.type || \"application/octet-stream\" },\n      };\n    },\n    []\n  );\n\n  return {\n    uploadFile,\n    getUploadParameters,\n    isUploading,\n    error,\n    progress,\n  };\n}\n\n","path":null,"size_bytes":5309,"size_tokens":null},"server/eligibilityScoring.ts":{"content":"import type { Player, PlayerMetrics, Video, VideoInsights, PlayerInternationalRecord, InvitationLetter } from \"@shared/schema\";\n\nconst MINIMUM_MINUTES_REQUIRED = 800;\nconst GREEN_THRESHOLD = 800;\nconst YELLOW_THRESHOLD = 600;\n\nexport type AmberStatus = \"green\" | \"yellow\" | \"red\";\n\nexport interface VisaScoreResult {\n  score: number;\n  status: AmberStatus;\n  breakdown: {\n    minutesScore: number;\n    internationalScore: number;\n    leagueScore: number;\n    performanceScore: number;\n  };\n  recommendations: string[];\n}\n\nexport interface TransferEligibilityResult {\n  totalMinutesVerified: number;\n  clubMinutes: number;\n  internationalMinutes: number;\n  videoMinutes: number;\n  totalCaps: number;\n  seniorCaps: number;\n  continentalAppearances: number;\n  overallStatus: AmberStatus;\n  schengen: VisaScoreResult;\n  o1: VisaScoreResult;\n  p1: VisaScoreResult;\n  ukGbe: VisaScoreResult;\n  esc: VisaScoreResult;\n  escEligible: boolean;\n  minutesNeeded: number;\n  capsNeeded: number;\n  recommendations: string[];\n}\n\ninterface ScoringData {\n  player: Player;\n  metrics: PlayerMetrics[];\n  videos: Video[];\n  videoInsights: VideoInsights[];\n  internationalRecords: PlayerInternationalRecord[];\n  invitationLetters: InvitationLetter[];\n  leagueBand: number;\n}\n\nfunction getStatus(score: number): AmberStatus {\n  if (score >= 60) return \"green\";\n  if (score >= 35) return \"yellow\";\n  return \"red\";\n}\n\nfunction getMinutesStatus(minutes: number): AmberStatus {\n  if (minutes >= GREEN_THRESHOLD) return \"green\";\n  if (minutes >= YELLOW_THRESHOLD) return \"yellow\";\n  return \"red\";\n}\n\nfunction calculateClubMinutes(player: Player, metrics: PlayerMetrics[]): number {\n  const playerMinutes = (player.clubMinutesCurrentSeason || 0) + (player.clubMinutesLast12Months || 0);\n  const metricsMinutes = metrics.reduce((sum, m) => sum + (m.currentSeasonMinutes || 0), 0);\n  return Math.max(playerMinutes, metricsMinutes);\n}\n\nfunction calculateInternationalMinutes(player: Player, records: PlayerInternationalRecord[]): number {\n  const playerMinutes = (player.internationalMinutesCurrentSeason || 0) + (player.internationalMinutesLast12Months || 0);\n  const recordsCaps = records.reduce((sum, r) => sum + (r.caps || 0), 0);\n  const estimatedFromCaps = recordsCaps * 45;\n  return Math.max(playerMinutes, estimatedFromCaps);\n}\n\nfunction calculateVideoMinutes(videos: Video[], insights: VideoInsights[]): number {\n  const videoMinutesFromVideos = videos.reduce((sum, v) => sum + (v.minutesPlayed || 0), 0);\n  const videoMinutesFromInsights = insights.reduce((sum, i) => sum + (i.minutesPlayed || 0), 0);\n  return Math.max(videoMinutesFromVideos, videoMinutesFromInsights);\n}\n\nfunction calculateTotalCaps(records: PlayerInternationalRecord[]): { total: number; senior: number } {\n  let total = 0;\n  let senior = 0;\n  for (const record of records) {\n    const caps = record.caps || 0;\n    total += caps;\n    if (record.teamLevel === \"senior\") {\n      senior += caps;\n    }\n  }\n  return { total, senior };\n}\n\nfunction getLeagueBandMultiplier(band: number): number {\n  switch (band) {\n    case 1: return 1.0;\n    case 2: return 0.9;\n    case 3: return 0.75;\n    case 4: return 0.5;\n    case 5: return 0.25;\n    default: return 0.5;\n  }\n}\n\nexport function calculateSchengenScore(data: ScoringData): VisaScoreResult {\n  const { player, metrics, videos, videoInsights, internationalRecords, leagueBand } = data;\n  \n  const clubMinutes = calculateClubMinutes(player, metrics);\n  const intlMinutes = calculateInternationalMinutes(player, internationalRecords);\n  const videoMins = calculateVideoMinutes(videos, videoInsights);\n  const totalMinutes = clubMinutes + intlMinutes + videoMins;\n  const { total: totalCaps } = calculateTotalCaps(internationalRecords);\n  \n  const minutesScore = Math.min(40, (totalMinutes / MINIMUM_MINUTES_REQUIRED) * 40);\n  const internationalScore = Math.min(30, totalCaps * 3);\n  const leagueMultiplier = getLeagueBandMultiplier(leagueBand);\n  const leagueScore = 20 * leagueMultiplier;\n  const performanceMetrics = metrics[0];\n  const performanceScore = performanceMetrics \n    ? Math.min(10, ((performanceMetrics.goals || 0) + (performanceMetrics.assists || 0)) * 0.5)\n    : 0;\n  \n  const totalScore = Math.round(minutesScore + internationalScore + leagueScore + performanceScore);\n  const status = getStatus(totalScore);\n  \n  const recommendations: string[] = [];\n  if (totalMinutes < MINIMUM_MINUTES_REQUIRED) {\n    recommendations.push(`Play ${MINIMUM_MINUTES_REQUIRED - totalMinutes} more minutes to reach minimum threshold`);\n  }\n  if (totalCaps < 5) {\n    recommendations.push(`Earn ${5 - totalCaps} more international caps to strengthen application`);\n  }\n  \n  return {\n    score: totalScore,\n    status,\n    breakdown: { minutesScore, internationalScore, leagueScore, performanceScore },\n    recommendations,\n  };\n}\n\nexport function calculateO1Score(data: ScoringData): VisaScoreResult {\n  const { player, metrics, videos, videoInsights, internationalRecords, leagueBand } = data;\n  \n  const clubMinutes = calculateClubMinutes(player, metrics);\n  const intlMinutes = calculateInternationalMinutes(player, internationalRecords);\n  const videoMins = calculateVideoMinutes(videos, videoInsights);\n  const totalMinutes = clubMinutes + intlMinutes + videoMins;\n  const { senior: seniorCaps } = calculateTotalCaps(internationalRecords);\n  \n  const hasRecognition = (player.marketValue || 0) > 1000000;\n  const recognitionScore = hasRecognition ? 35 : Math.min(35, (player.marketValue || 0) / 50000);\n  \n  const intlScore = Math.min(30, seniorCaps * 2 + (player.continentalGames || 0) * 3);\n  \n  const marketPercentile = Math.min(20, ((player.marketValue || 0) / 5000000) * 20);\n  \n  const aiAnalysisCount = videoInsights.filter(i => i.aiAnalysis).length;\n  const performanceScore = Math.min(15, aiAnalysisCount * 2 + (totalMinutes >= MINIMUM_MINUTES_REQUIRED ? 5 : 0));\n  \n  const totalScore = Math.round(recognitionScore + intlScore + marketPercentile + performanceScore);\n  const status = getStatus(totalScore);\n  \n  const recommendations: string[] = [];\n  if (!hasRecognition) {\n    recommendations.push(\"Increase market value or obtain recognition/awards for extraordinary ability\");\n  }\n  if (seniorCaps < 10) {\n    recommendations.push(`Earn ${10 - seniorCaps} more senior international caps`);\n  }\n  if (totalMinutes < MINIMUM_MINUTES_REQUIRED) {\n    recommendations.push(`Record ${MINIMUM_MINUTES_REQUIRED - totalMinutes} more verified minutes`);\n  }\n  \n  return {\n    score: totalScore,\n    status,\n    breakdown: { \n      minutesScore: performanceScore, \n      internationalScore: intlScore, \n      leagueScore: marketPercentile, \n      performanceScore: recognitionScore \n    },\n    recommendations,\n  };\n}\n\nexport function calculateP1Score(data: ScoringData): VisaScoreResult {\n  const { player, metrics, videos, videoInsights, internationalRecords, leagueBand } = data;\n  \n  const clubMinutes = calculateClubMinutes(player, metrics);\n  const intlMinutes = calculateInternationalMinutes(player, internationalRecords);\n  const videoMins = calculateVideoMinutes(videos, videoInsights);\n  const totalMinutes = clubMinutes + intlMinutes + videoMins;\n  \n  const minutesScore = Math.min(40, (totalMinutes / MINIMUM_MINUTES_REQUIRED) * 40);\n  \n  const leagueMultiplier = getLeagueBandMultiplier(leagueBand);\n  const leagueScore = 25 * leagueMultiplier;\n  \n  const videoPerformance = videos.length > 0 ? Math.min(20, videos.length * 4) : 0;\n  \n  const hasAgent = !!player.agentName;\n  const hasContract = !!player.contractEndDate;\n  const validationScore = (hasAgent ? 7.5 : 0) + (hasContract ? 7.5 : 0);\n  \n  const totalScore = Math.round(minutesScore + leagueScore + videoPerformance + validationScore);\n  const status = getStatus(totalScore);\n  \n  const recommendations: string[] = [];\n  if (totalMinutes < MINIMUM_MINUTES_REQUIRED) {\n    recommendations.push(`Record ${MINIMUM_MINUTES_REQUIRED - totalMinutes} more professional minutes`);\n  }\n  if (!hasAgent) {\n    recommendations.push(\"Register an agent contact for validation\");\n  }\n  if (videos.length < 5) {\n    recommendations.push(`Upload ${5 - videos.length} more performance videos`);\n  }\n  \n  return {\n    score: totalScore,\n    status,\n    breakdown: { \n      minutesScore, \n      internationalScore: 0, \n      leagueScore, \n      performanceScore: videoPerformance + validationScore \n    },\n    recommendations,\n  };\n}\n\nexport function calculateUKGBEScore(data: ScoringData): VisaScoreResult {\n  const { player, internationalRecords, metrics, videos, videoInsights, leagueBand } = data;\n  \n  const clubMinutes = calculateClubMinutes(player, metrics);\n  const intlMinutes = calculateInternationalMinutes(player, internationalRecords);\n  const videoMins = calculateVideoMinutes(videos, videoInsights);\n  const totalMinutes = clubMinutes + intlMinutes + videoMins;\n  const { senior: seniorCaps, total: totalCaps } = calculateTotalCaps(internationalRecords);\n  \n  let nationalTeamPoints = 0;\n  if (seniorCaps >= 75) nationalTeamPoints = 15;\n  else if (seniorCaps >= 50) nationalTeamPoints = 12;\n  else if (seniorCaps >= 30) nationalTeamPoints = 10;\n  else if (seniorCaps >= 15) nationalTeamPoints = 8;\n  else if (seniorCaps >= 5) nationalTeamPoints = 5;\n  else if (seniorCaps >= 1) nationalTeamPoints = 3;\n  \n  let clubLeaguePoints = 0;\n  switch (leagueBand) {\n    case 1: clubLeaguePoints = 15; break;\n    case 2: clubLeaguePoints = 12; break;\n    case 3: clubLeaguePoints = 8; break;\n    case 4: clubLeaguePoints = 4; break;\n    default: clubLeaguePoints = 2;\n  }\n  \n  const continentalApps = player.continentalGames || 0;\n  let continentalPoints = 0;\n  if (continentalApps >= 20) continentalPoints = 10;\n  else if (continentalApps >= 10) continentalPoints = 7;\n  else if (continentalApps >= 5) continentalPoints = 4;\n  else if (continentalApps >= 1) continentalPoints = 2;\n  \n  let minutesPoints = 0;\n  const domesticMinutes = clubMinutes;\n  if (domesticMinutes >= 1800) minutesPoints = 10;\n  else if (domesticMinutes >= 1200) minutesPoints = 7;\n  else if (domesticMinutes >= 600) minutesPoints = 4;\n  else if (domesticMinutes >= 300) minutesPoints = 2;\n  \n  const gbePoints = nationalTeamPoints + clubLeaguePoints + continentalPoints + minutesPoints;\n  \n  let status: AmberStatus;\n  if (gbePoints >= 15) status = \"green\";\n  else if (gbePoints >= 10) status = \"yellow\";\n  else status = \"red\";\n  \n  const normalizedScore = Math.round((gbePoints / 50) * 100);\n  \n  const recommendations: string[] = [];\n  if (gbePoints < 15) {\n    const pointsNeeded = 15 - gbePoints;\n    recommendations.push(`Need ${pointsNeeded} more GBE points to qualify automatically`);\n    \n    if (seniorCaps < 5) {\n      recommendations.push(`Earn ${5 - seniorCaps} senior international caps (+${5 - seniorCaps > 0 ? 5 : 0} points)`);\n    }\n    if (domesticMinutes < 600) {\n      recommendations.push(`Play ${600 - domesticMinutes} more domestic league minutes (+4 points at 600 mins)`);\n    }\n    if (totalMinutes < MINIMUM_MINUTES_REQUIRED) {\n      recommendations.push(`Record ${MINIMUM_MINUTES_REQUIRED - totalMinutes} more verified minutes`);\n    }\n  }\n  \n  return {\n    score: normalizedScore,\n    status,\n    breakdown: { \n      minutesScore: minutesPoints * 2.5, \n      internationalScore: nationalTeamPoints * 2, \n      leagueScore: clubLeaguePoints * 2.5, \n      performanceScore: continentalPoints * 2.5 \n    },\n    recommendations,\n  };\n}\n\nexport function calculateESCScore(data: ScoringData, gbeResult: VisaScoreResult): VisaScoreResult {\n  const { player, metrics, videos, videoInsights, internationalRecords } = data;\n  \n  const clubMinutes = calculateClubMinutes(player, metrics);\n  const intlMinutes = calculateInternationalMinutes(player, internationalRecords);\n  const videoMins = calculateVideoMinutes(videos, videoInsights);\n  const totalMinutes = clubMinutes + intlMinutes + videoMins;\n  const { senior: seniorCaps } = calculateTotalCaps(internationalRecords);\n  \n  const gbeStatus = gbeResult.status;\n  const escEligible = gbeStatus === \"yellow\";\n  \n  if (!escEligible) {\n    return {\n      score: gbeStatus === \"green\" ? 100 : 0,\n      status: gbeStatus === \"green\" ? \"green\" : \"red\",\n      breakdown: gbeResult.breakdown,\n      recommendations: gbeStatus === \"green\" \n        ? [\"Player qualifies via standard GBE route\"] \n        : [\"Player must first reach GBE yellow zone (10+ points) for ESC consideration\"],\n    };\n  }\n  \n  let escScore = 50;\n  \n  if (seniorCaps >= 3) escScore += 15;\n  else if (seniorCaps >= 1) escScore += 10;\n  \n  if (totalMinutes >= MINIMUM_MINUTES_REQUIRED) escScore += 15;\n  else if (totalMinutes >= 500) escScore += 10;\n  \n  const videoEvidence = videos.length;\n  if (videoEvidence >= 10) escScore += 10;\n  else if (videoEvidence >= 5) escScore += 7;\n  else if (videoEvidence >= 3) escScore += 4;\n  \n  const performanceMetrics = metrics[0];\n  if (performanceMetrics) {\n    const goalsAssists = (performanceMetrics.goals || 0) + (performanceMetrics.assists || 0);\n    if (goalsAssists >= 15) escScore += 10;\n    else if (goalsAssists >= 10) escScore += 7;\n    else if (goalsAssists >= 5) escScore += 4;\n  }\n  \n  escScore = Math.min(100, escScore);\n  const status = getStatus(escScore);\n  \n  const recommendations: string[] = [];\n  if (seniorCaps < 3) {\n    recommendations.push(`Earn ${3 - seniorCaps} more senior caps to strengthen ESC case`);\n  }\n  if (totalMinutes < MINIMUM_MINUTES_REQUIRED) {\n    recommendations.push(`Record ${MINIMUM_MINUTES_REQUIRED - totalMinutes} more verified minutes`);\n  }\n  if (videoEvidence < 5) {\n    recommendations.push(`Upload ${5 - videoEvidence} more video evidence clips`);\n  }\n  \n  return {\n    score: escScore,\n    status,\n    breakdown: gbeResult.breakdown,\n    recommendations,\n  };\n}\n\nexport function calculateTransferEligibility(data: ScoringData): TransferEligibilityResult {\n  const { player, metrics, videos, videoInsights, internationalRecords } = data;\n  \n  const clubMinutes = calculateClubMinutes(player, metrics);\n  const internationalMinutes = calculateInternationalMinutes(player, internationalRecords);\n  const videoMinutes = calculateVideoMinutes(videos, videoInsights);\n  const totalMinutesVerified = clubMinutes + internationalMinutes + videoMinutes;\n  \n  const { total: totalCaps, senior: seniorCaps } = calculateTotalCaps(internationalRecords);\n  const continentalAppearances = player.continentalGames || 0;\n  \n  const schengen = calculateSchengenScore(data);\n  const o1 = calculateO1Score(data);\n  const p1 = calculateP1Score(data);\n  const ukGbe = calculateUKGBEScore(data);\n  const esc = calculateESCScore(data, ukGbe);\n  \n  const scores = [schengen.score, o1.score, p1.score, ukGbe.score, esc.score];\n  const maxScore = Math.max(...scores);\n  \n  let overallStatus: AmberStatus;\n  if (totalMinutesVerified >= GREEN_THRESHOLD && maxScore >= 60) {\n    overallStatus = \"green\";\n  } else if (totalMinutesVerified >= YELLOW_THRESHOLD || maxScore >= 35) {\n    overallStatus = \"yellow\";\n  } else {\n    overallStatus = \"red\";\n  }\n  \n  const minutesNeeded = Math.max(0, MINIMUM_MINUTES_REQUIRED - totalMinutesVerified);\n  \n  let capsNeeded = 0;\n  if (ukGbe.status !== \"green\" && seniorCaps < 5) {\n    capsNeeded = 5 - seniorCaps;\n  }\n  \n  const recommendations: string[] = [];\n  \n  if (minutesNeeded > 0) {\n    recommendations.push(`Play ${minutesNeeded} more minutes to reach minimum ${MINIMUM_MINUTES_REQUIRED} minutes`);\n  }\n  \n  if (capsNeeded > 0) {\n    recommendations.push(`Earn ${capsNeeded} more senior international caps for UK GBE eligibility`);\n  }\n  \n  const allRecommendations = Array.from(new Set([\n    ...schengen.recommendations,\n    ...o1.recommendations,\n    ...p1.recommendations,\n    ...ukGbe.recommendations,\n    ...esc.recommendations,\n  ]));\n  \n  for (let i = 0; i < allRecommendations.length; i++) {\n    const rec = allRecommendations[i];\n    if (!recommendations.includes(rec)) {\n      recommendations.push(rec);\n    }\n  }\n  \n  return {\n    totalMinutesVerified,\n    clubMinutes,\n    internationalMinutes,\n    videoMinutes,\n    totalCaps,\n    seniorCaps,\n    continentalAppearances,\n    overallStatus,\n    schengen,\n    o1,\n    p1,\n    ukGbe,\n    esc,\n    escEligible: ukGbe.status === \"yellow\",\n    minutesNeeded,\n    capsNeeded,\n    recommendations: recommendations.slice(0, 5),\n  };\n}\n","path":null,"size_bytes":16266,"size_tokens":null},"server/replit_integrations/object_storage/routes.ts":{"content":"import type { Express } from \"express\";\nimport { ObjectStorageService, ObjectNotFoundError } from \"./objectStorage\";\n\n/**\n * Register object storage routes for file uploads.\n *\n * This provides example routes for the presigned URL upload flow:\n * 1. POST /api/uploads/request-url - Get a presigned URL for uploading\n * 2. The client then uploads directly to the presigned URL\n *\n * IMPORTANT: These are example routes. Customize based on your use case:\n * - Add authentication middleware for protected uploads\n * - Add file metadata storage (save to database after upload)\n * - Add ACL policies for access control\n */\nexport function registerObjectStorageRoutes(app: Express): void {\n  const objectStorageService = new ObjectStorageService();\n\n  /**\n   * Request a presigned URL for file upload.\n   *\n   * Request body (JSON):\n   * {\n   *   \"name\": \"filename.jpg\",\n   *   \"size\": 12345,\n   *   \"contentType\": \"image/jpeg\"\n   * }\n   *\n   * Response:\n   * {\n   *   \"uploadURL\": \"https://storage.googleapis.com/...\",\n   *   \"objectPath\": \"/objects/uploads/uuid\"\n   * }\n   *\n   * IMPORTANT: The client should NOT send the file to this endpoint.\n   * Send JSON metadata only, then upload the file directly to uploadURL.\n   */\n  app.post(\"/api/uploads/request-url\", async (req, res) => {\n    try {\n      const { name, size, contentType } = req.body;\n\n      if (!name) {\n        return res.status(400).json({\n          error: \"Missing required field: name\",\n        });\n      }\n\n      const uploadURL = await objectStorageService.getObjectEntityUploadURL();\n\n      // Extract object path from the presigned URL for later reference\n      const objectPath = objectStorageService.normalizeObjectEntityPath(uploadURL);\n\n      res.json({\n        uploadURL,\n        objectPath,\n        // Echo back the metadata for client convenience\n        metadata: { name, size, contentType },\n      });\n    } catch (error) {\n      console.error(\"Error generating upload URL:\", error);\n      res.status(500).json({ error: \"Failed to generate upload URL\" });\n    }\n  });\n\n  /**\n   * Serve uploaded objects.\n   *\n   * GET /objects/:objectPath(*)\n   *\n   * This serves files from object storage. For public files, no auth needed.\n   * For protected files, add authentication middleware and ACL checks.\n   */\n  app.get(\"/objects/:objectPath(*)\", async (req, res) => {\n    try {\n      const objectFile = await objectStorageService.getObjectEntityFile(req.path);\n      await objectStorageService.downloadObject(objectFile, res);\n    } catch (error) {\n      console.error(\"Error serving object:\", error);\n      if (error instanceof ObjectNotFoundError) {\n        return res.status(404).json({ error: \"Object not found\" });\n      }\n      return res.status(500).json({ error: \"Failed to serve object\" });\n    }\n  });\n}\n\n","path":null,"size_bytes":2786,"size_tokens":null},"client/src/pages/federation-admin.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { queryClient, apiRequest } from \"@/lib/queryClient\";\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { ScrollArea } from \"@/components/ui/scroll-area\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogFooter, DialogDescription } from \"@/components/ui/dialog\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { LoadingSpinner } from \"@/components/LoadingScreen\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { \n  FileText, CheckCircle, Clock, AlertCircle, Search, Filter, \n  RefreshCw, Eye, FileCheck, Download, X, DollarSign,\n  Globe, Building2, Calendar, Send, TrendingUp, Users, BarChart3,\n  Settings, Plus, Trash2, MessageCircle, History, ArrowRight, Upload\n} from \"lucide-react\";\nimport { Separator } from \"@/components/ui/separator\";\nimport type { FederationLetterRequest, FederationFeeSchedule, FederationRequestActivity, FederationRequestMessage } from \"@shared/schema\";\n\nconst PLATFORM_SERVICE_CHARGE = 25;\n\nconst STATUS_CONFIG: Record<string, { label: string; color: string; icon: typeof Clock }> = {\n  submitted: { label: \"New Submissions\", color: \"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200\", icon: Send },\n  processing: { label: \"In Progress\", color: \"bg-purple-100 text-purple-800 dark:bg-purple-900 dark:text-purple-200\", icon: RefreshCw },\n  issued: { label: \"Completed\", color: \"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200\", icon: CheckCircle },\n  rejected: { label: \"Rejected\", color: \"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200\", icon: AlertCircle },\n};\n\nexport default function FederationAdminPage() {\n  const { toast } = useToast();\n  const [selectedRequest, setSelectedRequest] = useState<FederationLetterRequest | null>(null);\n  const [isDetailDialogOpen, setIsDetailDialogOpen] = useState(false);\n  const [isRejectDialogOpen, setIsRejectDialogOpen] = useState(false);\n  const [isFeeDialogOpen, setIsFeeDialogOpen] = useState(false);\n  const [rejectionReason, setRejectionReason] = useState(\"\");\n  const [statusFilter, setStatusFilter] = useState<string>(\"all\");\n  const [searchQuery, setSearchQuery] = useState(\"\");\n  const [activeTab, setActiveTab] = useState(\"queue\");\n  const [newFee, setNewFee] = useState({ country: \"\", baseFee: 0, currency: \"USD\" });\n  const [detailTab, setDetailTab] = useState(\"details\");\n  const [newMessage, setNewMessage] = useState(\"\");\n  const [isIssueDialogOpen, setIsIssueDialogOpen] = useState(false);\n  const [uploadedDocument, setUploadedDocument] = useState<File | null>(null);\n\n  const { data: stats } = useQuery<{ totalRequests: number; processed: number; pending: number; totalRevenue: number }>({\n    queryKey: [\"/api/federation-admin/dashboard-stats\"],\n  });\n\n  const { data: requests = [], isLoading } = useQuery<FederationLetterRequest[]>({\n    queryKey: [\"/api/federation-admin/requests\", statusFilter],\n    queryFn: async () => {\n      const url = statusFilter && statusFilter !== \"all\" \n        ? `/api/federation-admin/requests?status=${statusFilter}` \n        : \"/api/federation-admin/requests\";\n      const res = await fetch(url, { credentials: \"include\" });\n      if (!res.ok) throw new Error(\"Failed to fetch requests\");\n      return res.json();\n    },\n  });\n\n  const { data: feeSchedules = [] } = useQuery<FederationFeeSchedule[]>({\n    queryKey: [\"/api/federation-admin/fee-schedules\"],\n    enabled: activeTab === \"fees\",\n  });\n\n  const { data: requestActivities = [] } = useQuery<FederationRequestActivity[]>({\n    queryKey: [\"/api/federation-requests\", selectedRequest?.id, \"activities\"],\n    enabled: !!selectedRequest?.id && isDetailDialogOpen,\n  });\n\n  const { data: requestMessages = [] } = useQuery<FederationRequestMessage[]>({\n    queryKey: [\"/api/federation-requests\", selectedRequest?.id, \"messages\"],\n    enabled: !!selectedRequest?.id && isDetailDialogOpen,\n  });\n\n  const sendMessageMutation = useMutation({\n    mutationFn: async (content: string) => {\n      return apiRequest(\"POST\", `/api/federation-requests/${selectedRequest?.id}/messages`, {\n        content,\n        senderName: \"Federation Admin\",\n        recipientPortal: \"team\",\n      });\n    },\n    onSuccess: () => {\n      toast({ title: \"Message Sent\", description: \"Your message has been sent to the team.\" });\n      setNewMessage(\"\");\n      queryClient.invalidateQueries({ queryKey: [\"/api/federation-requests\", selectedRequest?.id, \"messages\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/federation-requests\", selectedRequest?.id, \"activities\"] });\n    },\n    onError: (error: Error) => {\n      toast({ title: \"Failed to Send\", description: error.message, variant: \"destructive\" });\n    },\n  });\n\n  const acceptMutation = useMutation({\n    mutationFn: async (id: string) => {\n      return apiRequest(\"POST\", `/api/federation-admin/requests/${id}/accept`);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/federation-admin/requests\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/federation-admin/dashboard-stats\"] });\n      toast({ title: \"Request accepted\", description: \"Request is now being processed\" });\n      setIsDetailDialogOpen(false);\n    },\n    onError: (error: Error) => {\n      toast({ title: \"Error\", description: error.message, variant: \"destructive\" });\n    },\n  });\n\n  const issueMutation = useMutation({\n    mutationFn: async ({ id, file }: { id: string; file: File }) => {\n      // Step 1: Get presigned upload URL\n      const urlResponse = await fetch(\"/api/uploads/request-url\", {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        credentials: \"include\",\n        body: JSON.stringify({ \n          name: file.name,\n          size: file.size,\n          contentType: file.type \n        }),\n      });\n      if (!urlResponse.ok) throw new Error(\"Failed to get upload URL\");\n      const { uploadURL, objectPath } = await urlResponse.json();\n      \n      // Step 2: Upload file directly to storage\n      const uploadResponse = await fetch(uploadURL, {\n        method: \"PUT\",\n        headers: { \"Content-Type\": file.type },\n        body: file,\n      });\n      if (!uploadResponse.ok) throw new Error(\"Failed to upload file\");\n      \n      // Step 3: Issue the letter with the uploaded file info\n      return apiRequest(\"POST\", `/api/federation-admin/requests/${id}/issue`, {\n        issuedDocumentStorageKey: `issued-${id}-${Date.now()}`,\n        issuedDocumentObjectPath: objectPath,\n        issuedDocumentOriginalName: file.name,\n        mimeType: file.type,\n        fileSize: file.size,\n      });\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/federation-admin/requests\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/federation-admin/dashboard-stats\"] });\n      toast({ title: \"Letter issued\", description: \"Federation letter has been issued and sent to the team\" });\n      setIsDetailDialogOpen(false);\n    },\n    onError: (error: Error) => {\n      toast({ title: \"Error\", description: error.message, variant: \"destructive\" });\n    },\n  });\n\n  const rejectMutation = useMutation({\n    mutationFn: async ({ id, reason }: { id: string; reason: string }) => {\n      return apiRequest(\"POST\", `/api/federation-admin/requests/${id}/reject`, { rejectionReason: reason });\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/federation-admin/requests\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/federation-admin/dashboard-stats\"] });\n      toast({ title: \"Request rejected\", description: \"Request has been rejected\" });\n      setIsRejectDialogOpen(false);\n      setIsDetailDialogOpen(false);\n      setRejectionReason(\"\");\n    },\n    onError: (error: Error) => {\n      toast({ title: \"Error\", description: error.message, variant: \"destructive\" });\n    },\n  });\n\n  const filteredRequests = requests.filter((req) => {\n    const matchesSearch =\n      !searchQuery ||\n      req.athleteFullName.toLowerCase().includes(searchQuery.toLowerCase()) ||\n      req.requestNumber.toLowerCase().includes(searchQuery.toLowerCase()) ||\n      req.targetClubName.toLowerCase().includes(searchQuery.toLowerCase());\n    return matchesSearch;\n  });\n\n  const getStatusBadge = (status: string) => {\n    const config = STATUS_CONFIG[status] || STATUS_CONFIG.submitted;\n    const Icon = config.icon;\n    return (\n      <Badge variant=\"outline\" className={`${config.color} flex items-center gap-1`}>\n        <Icon className=\"h-3 w-3\" />\n        {config.label}\n      </Badge>\n    );\n  };\n\n  if (isLoading) {\n    return (\n      <div className=\"flex items-center justify-center h-full\">\n        <LoadingSpinner />\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"flex-1 overflow-auto p-6\">\n      <div className=\"max-w-7xl mx-auto space-y-6\">\n        <div>\n          <h1 className=\"text-2xl font-bold\" data-testid=\"text-federation-admin-title\">\n            Federation Administration\n          </h1>\n          <p className=\"text-muted-foreground\">\n            Manage letter requests, process documents, and track revenue\n          </p>\n        </div>\n\n        <div className=\"grid grid-cols-4 gap-4\">\n          <Card data-testid=\"card-stat-total\">\n            <CardContent className=\"p-4\">\n              <div className=\"flex items-center justify-between gap-2\">\n                <div className=\"min-w-0\">\n                  <p className=\"text-xs text-muted-foreground\">Total Requests</p>\n                  <p className=\"text-2xl font-bold\">{stats?.totalRequests || 0}</p>\n                </div>\n                <FileText className=\"h-6 w-6 text-muted-foreground/50 flex-shrink-0\" />\n              </div>\n            </CardContent>\n          </Card>\n          <Card data-testid=\"card-stat-pending\">\n            <CardContent className=\"p-4\">\n              <div className=\"flex items-center justify-between gap-2\">\n                <div className=\"min-w-0\">\n                  <p className=\"text-xs text-muted-foreground\">Pending</p>\n                  <p className=\"text-2xl font-bold\">{stats?.pending || 0}</p>\n                </div>\n                <Clock className=\"h-6 w-6 text-yellow-500 flex-shrink-0\" />\n              </div>\n            </CardContent>\n          </Card>\n          <Card data-testid=\"card-stat-processed\">\n            <CardContent className=\"p-4\">\n              <div className=\"flex items-center justify-between gap-2\">\n                <div className=\"min-w-0\">\n                  <p className=\"text-xs text-muted-foreground\">Processed</p>\n                  <p className=\"text-2xl font-bold\">{stats?.processed || 0}</p>\n                </div>\n                <CheckCircle className=\"h-6 w-6 text-green-500 flex-shrink-0\" />\n              </div>\n            </CardContent>\n          </Card>\n          <Card data-testid=\"card-stat-revenue\">\n            <CardContent className=\"p-4\">\n              <div className=\"flex items-center justify-between gap-2\">\n                <div className=\"min-w-0\">\n                  <p className=\"text-xs text-muted-foreground\">Total Revenue</p>\n                  <p className=\"text-2xl font-bold\">${stats?.totalRevenue || 0}</p>\n                </div>\n                <TrendingUp className=\"h-6 w-6 text-green-500 flex-shrink-0\" />\n              </div>\n            </CardContent>\n          </Card>\n        </div>\n\n        <Tabs value={activeTab} onValueChange={setActiveTab}>\n          <TabsList>\n            <TabsTrigger value=\"queue\" className=\"flex items-center gap-2\">\n              <FileCheck className=\"h-4 w-4\" />\n              Request Queue\n            </TabsTrigger>\n            <TabsTrigger value=\"fees\" className=\"flex items-center gap-2\">\n              <DollarSign className=\"h-4 w-4\" />\n              Fee Management\n            </TabsTrigger>\n            <TabsTrigger value=\"reports\" className=\"flex items-center gap-2\">\n              <BarChart3 className=\"h-4 w-4\" />\n              Reports\n            </TabsTrigger>\n          </TabsList>\n\n          <TabsContent value=\"queue\" className=\"mt-6\">\n            <Card>\n              <CardHeader className=\"pb-4\">\n                <div className=\"flex items-center justify-between gap-4 flex-wrap\">\n                  <CardTitle>Request Queue</CardTitle>\n                  <div className=\"flex items-center gap-2\">\n                    <div className=\"relative\">\n                      <Search className=\"absolute left-2 top-2.5 h-4 w-4 text-muted-foreground\" />\n                      <Input\n                        placeholder=\"Search requests...\"\n                        className=\"pl-8 w-64\"\n                        value={searchQuery}\n                        onChange={(e) => setSearchQuery(e.target.value)}\n                        data-testid=\"input-search-requests\"\n                      />\n                    </div>\n                    <Select value={statusFilter} onValueChange={setStatusFilter}>\n                      <SelectTrigger className=\"w-48\" data-testid=\"select-status-filter\">\n                        <Filter className=\"h-4 w-4 mr-2\" />\n                        <SelectValue placeholder=\"Status\" />\n                      </SelectTrigger>\n                      <SelectContent>\n                        <SelectItem value=\"all\">All Requests</SelectItem>\n                        <SelectItem value=\"submitted\">New Submissions</SelectItem>\n                        <SelectItem value=\"processing\">In Progress</SelectItem>\n                        <SelectItem value=\"issued\">Completed</SelectItem>\n                        <SelectItem value=\"rejected\">Rejected</SelectItem>\n                      </SelectContent>\n                    </Select>\n                  </div>\n                </div>\n              </CardHeader>\n              <CardContent>\n                {filteredRequests.length === 0 ? (\n                  <div className=\"text-center py-12\">\n                    <FileText className=\"h-12 w-12 mx-auto text-muted-foreground mb-4\" />\n                    <h3 className=\"text-lg font-semibold mb-2\">No Requests Found</h3>\n                    <p className=\"text-muted-foreground\">\n                      {searchQuery ? \"Try adjusting your search\" : \"No requests in this category\"}\n                    </p>\n                  </div>\n                ) : (\n                  <ScrollArea className=\"h-[500px]\">\n                    <div className=\"space-y-4\">\n                      {filteredRequests.map((request) => (\n                        <Card key={request.id} className=\"hover-elevate\" data-testid={`card-request-${request.id}`}>\n                          <CardContent className=\"p-4\">\n                            <div className=\"flex items-start justify-between gap-4 flex-wrap\">\n                              <div className=\"space-y-2 flex-1 min-w-[250px]\">\n                                <div className=\"flex items-center gap-2 flex-wrap\">\n                                  <span className=\"font-mono text-sm font-medium\">\n                                    {request.requestNumber}\n                                  </span>\n                                  {getStatusBadge(request.status)}\n                                </div>\n                                <h4 className=\"font-semibold text-lg\">{request.athleteFullName}</h4>\n                                <div className=\"flex items-center gap-4 text-sm text-muted-foreground flex-wrap\">\n                                  <span className=\"flex items-center gap-1\">\n                                    <Globe className=\"h-4 w-4\" />\n                                    {request.athleteNationality}\n                                  </span>\n                                  <span className=\"flex items-center gap-1\">\n                                    <Building2 className=\"h-4 w-4\" />\n                                    {request.targetClubName}, {request.targetClubCountry}\n                                  </span>\n                                  <span className=\"flex items-center gap-1\">\n                                    <Calendar className=\"h-4 w-4\" />\n                                    {new Date(request.createdAt!).toLocaleDateString()}\n                                  </span>\n                                </div>\n                                <div className=\"flex items-center gap-4 text-sm flex-wrap\">\n                                  <span>\n                                    <span className=\"text-muted-foreground\">Fee: </span>\n                                    <span className=\"font-medium\">${request.totalAmount}</span>\n                                  </span>\n                                  <span>\n                                    <span className=\"text-muted-foreground\">Type: </span>\n                                    <span className=\"capitalize font-medium\">{request.transferType}</span>\n                                  </span>\n                                </div>\n                              </div>\n                              <div className=\"flex items-center gap-2 flex-wrap\">\n                                {request.status === \"submitted\" && (\n                                  <Button\n                                    size=\"sm\"\n                                    onClick={() => acceptMutation.mutate(request.id)}\n                                    disabled={acceptMutation.isPending}\n                                    data-testid={`button-accept-${request.id}`}\n                                  >\n                                    <CheckCircle className=\"h-4 w-4 mr-1\" />\n                                    Accept\n                                  </Button>\n                                )}\n                                {request.status === \"processing\" && (\n                                  <Button\n                                    size=\"sm\"\n                                    onClick={() => {\n                                      setSelectedRequest(request);\n                                      setIsIssueDialogOpen(true);\n                                    }}\n                                    disabled={issueMutation.isPending}\n                                    data-testid={`button-issue-${request.id}`}\n                                  >\n                                    <Upload className=\"h-4 w-4 mr-1\" />\n                                    Upload & Issue\n                                  </Button>\n                                )}\n                                {(request.status === \"submitted\" || request.status === \"processing\") && (\n                                  <Button\n                                    size=\"sm\"\n                                    variant=\"outline\"\n                                    onClick={() => {\n                                      setSelectedRequest(request);\n                                      setIsRejectDialogOpen(true);\n                                    }}\n                                    data-testid={`button-reject-${request.id}`}\n                                  >\n                                    <X className=\"h-4 w-4 mr-1\" />\n                                    Reject\n                                  </Button>\n                                )}\n                                <Button\n                                  size=\"icon\"\n                                  variant=\"ghost\"\n                                  onClick={() => {\n                                    setSelectedRequest(request);\n                                    setIsDetailDialogOpen(true);\n                                  }}\n                                  data-testid={`button-view-${request.id}`}\n                                >\n                                  <Eye className=\"h-4 w-4\" />\n                                </Button>\n                              </div>\n                            </div>\n                          </CardContent>\n                        </Card>\n                      ))}\n                    </div>\n                  </ScrollArea>\n                )}\n              </CardContent>\n            </Card>\n          </TabsContent>\n\n          <TabsContent value=\"fees\" className=\"mt-6\">\n            <Card>\n              <CardHeader>\n                <div className=\"flex items-center justify-between gap-4 flex-wrap\">\n                  <div>\n                    <CardTitle>Fee Schedule</CardTitle>\n                    <CardDescription>\n                      Set base fees by destination country. Platform service charge of ${PLATFORM_SERVICE_CHARGE} is automatically added.\n                    </CardDescription>\n                  </div>\n                  <Button onClick={() => setIsFeeDialogOpen(true)} data-testid=\"button-add-fee\">\n                    <Plus className=\"h-4 w-4 mr-1\" />\n                    Add Fee Rule\n                  </Button>\n                </div>\n              </CardHeader>\n              <CardContent>\n                <div className=\"space-y-4\">\n                  <div className=\"bg-muted p-4 rounded-lg\">\n                    <div className=\"flex items-center justify-between gap-2\">\n                      <div>\n                        <p className=\"font-medium\">Default Fee Structure</p>\n                        <p className=\"text-sm text-muted-foreground\">\n                          Base fee per request + ${PLATFORM_SERVICE_CHARGE} platform service charge\n                        </p>\n                      </div>\n                      <Badge>Active</Badge>\n                    </div>\n                  </div>\n                  \n                  {feeSchedules.length === 0 ? (\n                    <div className=\"text-center py-8\">\n                      <DollarSign className=\"h-12 w-12 mx-auto text-muted-foreground mb-4\" />\n                      <p className=\"text-muted-foreground\">No custom fee rules configured</p>\n                      <p className=\"text-sm text-muted-foreground\">\n                        Add country-specific fees to override defaults\n                      </p>\n                    </div>\n                  ) : (\n                    <div className=\"space-y-2\">\n                      {feeSchedules.map((schedule) => (\n                        <div\n                          key={schedule.id}\n                          className=\"flex items-center justify-between p-3 border rounded-lg\"\n                          data-testid={`fee-schedule-${schedule.id}`}\n                        >\n                          <div className=\"flex items-center gap-4\">\n                            <Globe className=\"h-5 w-5 text-muted-foreground\" />\n                            <div>\n                              <p className=\"font-medium\">{schedule.country}</p>\n                              <p className=\"text-sm text-muted-foreground\">\n                                Base: ${schedule.baseFee} + ${schedule.platformServiceCharge} platform = ${(schedule.baseFee || 0) + (schedule.platformServiceCharge || 0)} total\n                              </p>\n                            </div>\n                          </div>\n                          <div className=\"flex items-center gap-2\">\n                            <Badge variant={schedule.isActive ? \"default\" : \"outline\"}>\n                              {schedule.isActive ? \"Active\" : \"Inactive\"}\n                            </Badge>\n                            <Button size=\"icon\" variant=\"ghost\">\n                              <Trash2 className=\"h-4 w-4\" />\n                            </Button>\n                          </div>\n                        </div>\n                      ))}\n                    </div>\n                  )}\n                </div>\n              </CardContent>\n            </Card>\n          </TabsContent>\n\n          <TabsContent value=\"reports\" className=\"mt-6\">\n            <div className=\"grid grid-cols-2 gap-6\">\n              <Card>\n                <CardHeader>\n                  <CardTitle className=\"flex items-center gap-2\">\n                    <BarChart3 className=\"h-5 w-5\" />\n                    Revenue Summary\n                  </CardTitle>\n                </CardHeader>\n                <CardContent>\n                  <div className=\"space-y-4\">\n                    <div className=\"flex items-center justify-between p-3 bg-muted rounded-lg\">\n                      <span className=\"text-muted-foreground\">Total Revenue (All Time)</span>\n                      <span className=\"text-xl font-bold\">${stats?.totalRevenue || 0}</span>\n                    </div>\n                    <div className=\"flex items-center justify-between p-3 bg-muted rounded-lg\">\n                      <span className=\"text-muted-foreground\">Platform Fees Collected</span>\n                      <span className=\"text-xl font-bold\">${(stats?.processed || 0) * PLATFORM_SERVICE_CHARGE}</span>\n                    </div>\n                    <div className=\"flex items-center justify-between p-3 bg-muted rounded-lg\">\n                      <span className=\"text-muted-foreground\">Federation Share</span>\n                      <span className=\"text-xl font-bold\">\n                        ${(stats?.totalRevenue || 0) - (stats?.processed || 0) * PLATFORM_SERVICE_CHARGE}\n                      </span>\n                    </div>\n                  </div>\n                </CardContent>\n              </Card>\n              <Card>\n                <CardHeader>\n                  <CardTitle className=\"flex items-center gap-2\">\n                    <Users className=\"h-5 w-5\" />\n                    Processing Metrics\n                  </CardTitle>\n                </CardHeader>\n                <CardContent>\n                  <div className=\"space-y-4\">\n                    <div className=\"flex items-center justify-between p-3 bg-muted rounded-lg\">\n                      <span className=\"text-muted-foreground\">Total Requests</span>\n                      <span className=\"text-xl font-bold\">{stats?.totalRequests || 0}</span>\n                    </div>\n                    <div className=\"flex items-center justify-between p-3 bg-muted rounded-lg\">\n                      <span className=\"text-muted-foreground\">Completed</span>\n                      <span className=\"text-xl font-bold text-green-600\">{stats?.processed || 0}</span>\n                    </div>\n                    <div className=\"flex items-center justify-between p-3 bg-muted rounded-lg\">\n                      <span className=\"text-muted-foreground\">Pending Review</span>\n                      <span className=\"text-xl font-bold text-yellow-600\">{stats?.pending || 0}</span>\n                    </div>\n                  </div>\n                </CardContent>\n              </Card>\n            </div>\n          </TabsContent>\n        </Tabs>\n\n        <Dialog open={isDetailDialogOpen} onOpenChange={(open) => { setIsDetailDialogOpen(open); if (!open) setDetailTab(\"details\"); }}>\n          <DialogContent className=\"max-w-3xl max-h-[85vh] overflow-y-auto\">\n            <DialogHeader>\n              <DialogTitle className=\"flex items-center gap-2\">\n                <FileText className=\"h-5 w-5\" />\n                Request Details - {selectedRequest?.requestNumber}\n              </DialogTitle>\n            </DialogHeader>\n            {selectedRequest && (\n              <Tabs value={detailTab} onValueChange={setDetailTab} className=\"w-full\">\n                <TabsList className=\"grid w-full grid-cols-3\">\n                  <TabsTrigger value=\"details\" className=\"flex items-center gap-1\">\n                    <FileText className=\"h-4 w-4\" />\n                    Details\n                  </TabsTrigger>\n                  <TabsTrigger value=\"history\" className=\"flex items-center gap-1\">\n                    <History className=\"h-4 w-4\" />\n                    History\n                  </TabsTrigger>\n                  <TabsTrigger value=\"messages\" className=\"flex items-center gap-1\">\n                    <MessageCircle className=\"h-4 w-4\" />\n                    Messages\n                    {requestMessages.filter(m => !m.isRead && m.senderPortal === 'team').length > 0 && (\n                      <Badge variant=\"destructive\" className=\"ml-1 h-5 min-w-[20px] px-1\">\n                        {requestMessages.filter(m => !m.isRead && m.senderPortal === 'team').length}\n                      </Badge>\n                    )}\n                  </TabsTrigger>\n                </TabsList>\n\n                <TabsContent value=\"details\" className=\"space-y-4 mt-4\">\n                  <div className=\"flex items-center gap-2 flex-wrap\">\n                    {getStatusBadge(selectedRequest.status)}\n                  </div>\n\n                  <div className=\"grid grid-cols-2 gap-4 text-sm\">\n                    <div>\n                      <span className=\"text-muted-foreground\">Athlete Name:</span>\n                      <p className=\"font-medium\">{selectedRequest.athleteFullName}</p>\n                    </div>\n                    <div>\n                      <span className=\"text-muted-foreground\">Nationality:</span>\n                      <p className=\"font-medium\">{selectedRequest.athleteNationality}</p>\n                    </div>\n                    <div>\n                      <span className=\"text-muted-foreground\">Position:</span>\n                      <p className=\"font-medium\">{selectedRequest.athletePosition || \"Not specified\"}</p>\n                    </div>\n                    <div>\n                      <span className=\"text-muted-foreground\">Date of Birth:</span>\n                      <p className=\"font-medium\">{selectedRequest.athleteDateOfBirth || \"Not specified\"}</p>\n                    </div>\n                    <div>\n                      <span className=\"text-muted-foreground\">Target Club:</span>\n                      <p className=\"font-medium\">{selectedRequest.targetClubName}</p>\n                    </div>\n                    <div>\n                      <span className=\"text-muted-foreground\">Target Country:</span>\n                      <p className=\"font-medium\">{selectedRequest.targetClubCountry}</p>\n                    </div>\n                    <div>\n                      <span className=\"text-muted-foreground\">Transfer Type:</span>\n                      <p className=\"font-medium capitalize\">{selectedRequest.transferType}</p>\n                    </div>\n                    <div>\n                      <span className=\"text-muted-foreground\">Total Fee:</span>\n                      <p className=\"font-medium\">${selectedRequest.totalAmount}</p>\n                    </div>\n                  </div>\n\n                  {selectedRequest.requestPurpose && (\n                    <div>\n                      <span className=\"text-muted-foreground text-sm\">Purpose:</span>\n                      <p className=\"text-sm mt-1\">{selectedRequest.requestPurpose}</p>\n                    </div>\n                  )}\n\n                  {selectedRequest.additionalNotes && (\n                    <div>\n                      <span className=\"text-muted-foreground text-sm\">Additional Notes:</span>\n                      <p className=\"text-sm mt-1\">{selectedRequest.additionalNotes}</p>\n                    </div>\n                  )}\n\n                  <Separator />\n\n                  <div className=\"flex items-center justify-end gap-2\">\n                    {selectedRequest.status === \"submitted\" && (\n                      <>\n                        <Button\n                          onClick={() => acceptMutation.mutate(selectedRequest.id)}\n                          disabled={acceptMutation.isPending}\n                          data-testid=\"button-dialog-accept\"\n                        >\n                          <CheckCircle className=\"h-4 w-4 mr-1\" />\n                          Accept Request\n                        </Button>\n                        <Button\n                          variant=\"outline\"\n                          onClick={() => setIsRejectDialogOpen(true)}\n                          data-testid=\"button-dialog-reject\"\n                        >\n                          <X className=\"h-4 w-4 mr-1\" />\n                          Reject\n                        </Button>\n                      </>\n                    )}\n                    {selectedRequest.status === \"processing\" && (\n                      <>\n                        <Button\n                          onClick={() => setIsIssueDialogOpen(true)}\n                          data-testid=\"button-dialog-issue\"\n                        >\n                          <Upload className=\"h-4 w-4 mr-1\" />\n                          Upload & Issue Letter\n                        </Button>\n                        <Button\n                          variant=\"outline\"\n                          onClick={() => setIsRejectDialogOpen(true)}\n                          data-testid=\"button-dialog-reject-processing\"\n                        >\n                          <X className=\"h-4 w-4 mr-1\" />\n                          Reject\n                        </Button>\n                      </>\n                    )}\n                  </div>\n                </TabsContent>\n\n                <TabsContent value=\"history\" className=\"space-y-4 mt-4\">\n                  <ScrollArea className=\"h-[400px]\">\n                    {requestActivities.length === 0 ? (\n                      <div className=\"text-center py-8 text-muted-foreground\">\n                        <History className=\"h-8 w-8 mx-auto mb-2 opacity-50\" />\n                        <p>No activity history yet</p>\n                      </div>\n                    ) : (\n                      <div className=\"space-y-4\">\n                        {requestActivities.map((activity) => (\n                          <div key={activity.id} className=\"flex gap-3 pb-4 border-b last:border-0\">\n                            <div className=\"flex-shrink-0 mt-1\">\n                              <div className=\"h-8 w-8 rounded-full bg-muted flex items-center justify-center\">\n                                {activity.activityType === 'status_change' && <RefreshCw className=\"h-4 w-4\" />}\n                                {activity.activityType === 'message_sent' && <MessageCircle className=\"h-4 w-4\" />}\n                                {activity.activityType === 'document_issued' && <FileCheck className=\"h-4 w-4\" />}\n                                {activity.activityType === 'accepted' && <CheckCircle className=\"h-4 w-4\" />}\n                                {activity.activityType === 'rejected' && <X className=\"h-4 w-4\" />}\n                                {!['status_change', 'message_sent', 'document_issued', 'accepted', 'rejected'].includes(activity.activityType) && <History className=\"h-4 w-4\" />}\n                              </div>\n                            </div>\n                            <div className=\"flex-1 min-w-0\">\n                              <div className=\"flex items-center gap-2 flex-wrap\">\n                                <span className=\"font-medium text-sm\">{activity.actorName || 'System'}</span>\n                                {activity.actorRole && (\n                                  <Badge variant=\"outline\" className=\"text-xs\">{activity.actorRole}</Badge>\n                                )}\n                              </div>\n                              <p className=\"text-sm text-muted-foreground mt-0.5\">{activity.description}</p>\n                              {activity.previousStatus && activity.newStatus && (\n                                <div className=\"flex items-center gap-2 text-xs mt-1\">\n                                  <Badge variant=\"outline\">{activity.previousStatus}</Badge>\n                                  <ArrowRight className=\"h-3 w-3\" />\n                                  <Badge variant=\"outline\">{activity.newStatus}</Badge>\n                                </div>\n                              )}\n                              <p className=\"text-xs text-muted-foreground mt-1\">\n                                {activity.timestamp && new Date(activity.timestamp).toLocaleString()}\n                              </p>\n                            </div>\n                          </div>\n                        ))}\n                      </div>\n                    )}\n                  </ScrollArea>\n                </TabsContent>\n\n                <TabsContent value=\"messages\" className=\"space-y-4 mt-4\">\n                  <ScrollArea className=\"h-[300px]\">\n                    {requestMessages.length === 0 ? (\n                      <div className=\"text-center py-8 text-muted-foreground\">\n                        <MessageCircle className=\"h-8 w-8 mx-auto mb-2 opacity-50\" />\n                        <p>No messages yet</p>\n                        <p className=\"text-xs mt-1\">Send a message to communicate with the team</p>\n                      </div>\n                    ) : (\n                      <div className=\"space-y-3\">\n                        {requestMessages.slice().reverse().map((message) => (\n                          <div \n                            key={message.id} \n                            className={`p-3 rounded-lg ${\n                              message.senderPortal === 'federation' \n                                ? 'bg-primary/10 ml-8' \n                                : 'bg-muted mr-8'\n                            }`}\n                          >\n                            <div className=\"flex items-center justify-between gap-2 mb-1\">\n                              <span className=\"font-medium text-sm\">{message.senderName}</span>\n                              <span className=\"text-xs text-muted-foreground\">\n                                {message.createdAt && new Date(message.createdAt).toLocaleString()}\n                              </span>\n                            </div>\n                            {message.subject && (\n                              <p className=\"text-sm font-medium\">{message.subject}</p>\n                            )}\n                            <p className=\"text-sm\">{message.content}</p>\n                          </div>\n                        ))}\n                      </div>\n                    )}\n                  </ScrollArea>\n                  <Separator />\n                  <div className=\"flex gap-2\">\n                    <Textarea\n                      placeholder=\"Type your message to the team...\"\n                      value={newMessage}\n                      onChange={(e) => setNewMessage(e.target.value)}\n                      className=\"flex-1 min-h-[80px]\"\n                      data-testid=\"input-admin-message\"\n                    />\n                  </div>\n                  <Button \n                    onClick={() => sendMessageMutation.mutate(newMessage)}\n                    disabled={!newMessage.trim() || sendMessageMutation.isPending}\n                    className=\"w-full\"\n                    data-testid=\"button-send-admin-message\"\n                  >\n                    {sendMessageMutation.isPending ? (\n                      <LoadingSpinner />\n                    ) : (\n                      <>\n                        <Send className=\"h-4 w-4 mr-2\" />\n                        Send Message\n                      </>\n                    )}\n                  </Button>\n                </TabsContent>\n              </Tabs>\n            )}\n          </DialogContent>\n        </Dialog>\n\n        <Dialog open={isRejectDialogOpen} onOpenChange={setIsRejectDialogOpen}>\n          <DialogContent>\n            <DialogHeader>\n              <DialogTitle>Reject Request</DialogTitle>\n              <DialogDescription>\n                Please provide a reason for rejecting this request. The team will be notified.\n              </DialogDescription>\n            </DialogHeader>\n            <div className=\"space-y-4\">\n              <div>\n                <Label htmlFor=\"rejection-reason\">Rejection Reason</Label>\n                <Textarea\n                  id=\"rejection-reason\"\n                  placeholder=\"Enter the reason for rejection...\"\n                  value={rejectionReason}\n                  onChange={(e) => setRejectionReason(e.target.value)}\n                  className=\"mt-2\"\n                  data-testid=\"input-rejection-reason\"\n                />\n              </div>\n            </div>\n            <DialogFooter>\n              <Button variant=\"outline\" onClick={() => setIsRejectDialogOpen(false)}>\n                Cancel\n              </Button>\n              <Button\n                variant=\"destructive\"\n                onClick={() => {\n                  if (selectedRequest && rejectionReason) {\n                    rejectMutation.mutate({ id: selectedRequest.id, reason: rejectionReason });\n                  }\n                }}\n                disabled={!rejectionReason || rejectMutation.isPending}\n                data-testid=\"button-confirm-reject\"\n              >\n                Reject Request\n              </Button>\n            </DialogFooter>\n          </DialogContent>\n        </Dialog>\n\n        <Dialog open={isFeeDialogOpen} onOpenChange={setIsFeeDialogOpen}>\n          <DialogContent>\n            <DialogHeader>\n              <DialogTitle>Add Fee Rule</DialogTitle>\n              <DialogDescription>\n                Set a custom fee for requests from a specific country.\n              </DialogDescription>\n            </DialogHeader>\n            <div className=\"space-y-4\">\n              <div>\n                <Label htmlFor=\"fee-country\">Country</Label>\n                <Input\n                  id=\"fee-country\"\n                  placeholder=\"e.g. United Kingdom, Spain, Germany\"\n                  value={newFee.country}\n                  onChange={(e) => setNewFee({ ...newFee, country: e.target.value })}\n                  className=\"mt-2\"\n                  data-testid=\"input-fee-country\"\n                />\n              </div>\n              <div>\n                <Label htmlFor=\"fee-amount\">Base Fee (USD)</Label>\n                <Input\n                  id=\"fee-amount\"\n                  type=\"number\"\n                  placeholder=\"0\"\n                  value={newFee.baseFee}\n                  onChange={(e) => setNewFee({ ...newFee, baseFee: Number(e.target.value) })}\n                  className=\"mt-2\"\n                  data-testid=\"input-fee-amount\"\n                />\n                <p className=\"text-sm text-muted-foreground mt-1\">\n                  Total fee will be ${newFee.baseFee + PLATFORM_SERVICE_CHARGE} (includes ${PLATFORM_SERVICE_CHARGE} platform charge)\n                </p>\n              </div>\n            </div>\n            <DialogFooter>\n              <Button variant=\"outline\" onClick={() => setIsFeeDialogOpen(false)}>\n                Cancel\n              </Button>\n              <Button\n                onClick={() => {\n                  toast({ title: \"Fee rule added\", description: `New fee rule for ${newFee.country} created` });\n                  setIsFeeDialogOpen(false);\n                  setNewFee({ country: \"\", baseFee: 0, currency: \"USD\" });\n                }}\n                disabled={!newFee.country || newFee.baseFee < 0}\n                data-testid=\"button-save-fee\"\n              >\n                Save Fee Rule\n              </Button>\n            </DialogFooter>\n          </DialogContent>\n        </Dialog>\n\n        {/* Issue Letter Dialog */}\n        <Dialog open={isIssueDialogOpen} onOpenChange={(open) => { setIsIssueDialogOpen(open); if (!open) setUploadedDocument(null); }}>\n          <DialogContent>\n            <DialogHeader>\n              <DialogTitle className=\"flex items-center gap-2\">\n                <Upload className=\"h-5 w-5\" />\n                Issue Federation Letter\n              </DialogTitle>\n              <DialogDescription>\n                Upload the signed federation letter document for {selectedRequest?.athleteFullName}.\n              </DialogDescription>\n            </DialogHeader>\n            <div className=\"space-y-4\">\n              <div \n                className={`border-2 border-dashed rounded-lg p-6 text-center cursor-pointer transition-colors ${\n                  uploadedDocument ? \"border-green-500 bg-green-50 dark:bg-green-900/20\" : \"border-muted-foreground/30 hover:border-primary\"\n                }`}\n                onClick={() => document.getElementById(\"issue-file-input\")?.click()}\n              >\n                <input\n                  id=\"issue-file-input\"\n                  type=\"file\"\n                  accept=\".pdf,.doc,.docx\"\n                  className=\"hidden\"\n                  onChange={(e) => {\n                    const file = e.target.files?.[0];\n                    if (file) setUploadedDocument(file);\n                  }}\n                  data-testid=\"input-issue-file\"\n                />\n                {uploadedDocument ? (\n                  <div className=\"flex items-center justify-center gap-2\">\n                    <FileCheck className=\"h-8 w-8 text-green-600\" />\n                    <div className=\"text-left\">\n                      <p className=\"font-medium\">{uploadedDocument.name}</p>\n                      <p className=\"text-sm text-muted-foreground\">\n                        {(uploadedDocument.size / 1024).toFixed(1)} KB\n                      </p>\n                    </div>\n                  </div>\n                ) : (\n                  <>\n                    <Upload className=\"h-8 w-8 mx-auto text-muted-foreground mb-2\" />\n                    <p className=\"text-sm text-muted-foreground\">\n                      Click to upload the signed federation letter\n                    </p>\n                    <p className=\"text-xs text-muted-foreground mt-1\">\n                      PDF, DOC, or DOCX (max 10MB)\n                    </p>\n                  </>\n                )}\n              </div>\n              {uploadedDocument && (\n                <Button \n                  variant=\"outline\" \n                  size=\"sm\" \n                  onClick={() => setUploadedDocument(null)}\n                  className=\"w-full\"\n                >\n                  <X className=\"h-4 w-4 mr-1\" />\n                  Remove File\n                </Button>\n              )}\n            </div>\n            <DialogFooter>\n              <Button variant=\"outline\" onClick={() => { setIsIssueDialogOpen(false); setUploadedDocument(null); }}>\n                Cancel\n              </Button>\n              <Button\n                onClick={() => {\n                  if (selectedRequest && uploadedDocument) {\n                    issueMutation.mutate({\n                      id: selectedRequest.id,\n                      file: uploadedDocument,\n                    });\n                    setIsIssueDialogOpen(false);\n                    setUploadedDocument(null);\n                  }\n                }}\n                disabled={!uploadedDocument || issueMutation.isPending}\n                data-testid=\"button-confirm-issue\"\n              >\n                {issueMutation.isPending ? <LoadingSpinner /> : (\n                  <>\n                    <FileCheck className=\"h-4 w-4 mr-1\" />\n                    Issue Letter\n                  </>\n                )}\n              </Button>\n            </DialogFooter>\n          </DialogContent>\n        </Dialog>\n      </div>\n    </div>\n  );\n}\n","path":null,"size_bytes":47493,"size_tokens":null},"server/replit_integrations/object_storage/objectStorage.ts":{"content":"import { Storage, File } from \"@google-cloud/storage\";\nimport { Response } from \"express\";\nimport { randomUUID } from \"crypto\";\nimport {\n  ObjectAclPolicy,\n  ObjectPermission,\n  canAccessObject,\n  getObjectAclPolicy,\n  setObjectAclPolicy,\n} from \"./objectAcl\";\n\nconst REPLIT_SIDECAR_ENDPOINT = \"http://127.0.0.1:1106\";\n\n// The object storage client is used to interact with the object storage service.\nexport const objectStorageClient = new Storage({\n  credentials: {\n    audience: \"replit\",\n    subject_token_type: \"access_token\",\n    token_url: `${REPLIT_SIDECAR_ENDPOINT}/token`,\n    type: \"external_account\",\n    credential_source: {\n      url: `${REPLIT_SIDECAR_ENDPOINT}/credential`,\n      format: {\n        type: \"json\",\n        subject_token_field_name: \"access_token\",\n      },\n    },\n    universe_domain: \"googleapis.com\",\n  },\n  projectId: \"\",\n});\n\nexport class ObjectNotFoundError extends Error {\n  constructor() {\n    super(\"Object not found\");\n    this.name = \"ObjectNotFoundError\";\n    Object.setPrototypeOf(this, ObjectNotFoundError.prototype);\n  }\n}\n\n// The object storage service is used to interact with the object storage service.\nexport class ObjectStorageService {\n  constructor() {}\n\n  // Gets the public object search paths.\n  getPublicObjectSearchPaths(): Array<string> {\n    const pathsStr = process.env.PUBLIC_OBJECT_SEARCH_PATHS || \"\";\n    const paths = Array.from(\n      new Set(\n        pathsStr\n          .split(\",\")\n          .map((path) => path.trim())\n          .filter((path) => path.length > 0)\n      )\n    );\n    if (paths.length === 0) {\n      throw new Error(\n        \"PUBLIC_OBJECT_SEARCH_PATHS not set. Create a bucket in 'Object Storage' \" +\n          \"tool and set PUBLIC_OBJECT_SEARCH_PATHS env var (comma-separated paths).\"\n      );\n    }\n    return paths;\n  }\n\n  // Gets the private object directory.\n  getPrivateObjectDir(): string {\n    const dir = process.env.PRIVATE_OBJECT_DIR || \"\";\n    if (!dir) {\n      throw new Error(\n        \"PRIVATE_OBJECT_DIR not set. Create a bucket in 'Object Storage' \" +\n          \"tool and set PRIVATE_OBJECT_DIR env var.\"\n      );\n    }\n    return dir;\n  }\n\n  // Search for a public object from the search paths.\n  async searchPublicObject(filePath: string): Promise<File | null> {\n    for (const searchPath of this.getPublicObjectSearchPaths()) {\n      const fullPath = `${searchPath}/${filePath}`;\n\n      // Full path format: /<bucket_name>/<object_name>\n      const { bucketName, objectName } = parseObjectPath(fullPath);\n      const bucket = objectStorageClient.bucket(bucketName);\n      const file = bucket.file(objectName);\n\n      // Check if file exists\n      const [exists] = await file.exists();\n      if (exists) {\n        return file;\n      }\n    }\n\n    return null;\n  }\n\n  // Downloads an object to the response.\n  async downloadObject(file: File, res: Response, cacheTtlSec: number = 3600) {\n    try {\n      // Get file metadata\n      const [metadata] = await file.getMetadata();\n      // Get the ACL policy for the object.\n      const aclPolicy = await getObjectAclPolicy(file);\n      const isPublic = aclPolicy?.visibility === \"public\";\n      // Set appropriate headers\n      res.set({\n        \"Content-Type\": metadata.contentType || \"application/octet-stream\",\n        \"Content-Length\": metadata.size,\n        \"Cache-Control\": `${\n          isPublic ? \"public\" : \"private\"\n        }, max-age=${cacheTtlSec}`,\n      });\n\n      // Stream the file to the response\n      const stream = file.createReadStream();\n\n      stream.on(\"error\", (err) => {\n        console.error(\"Stream error:\", err);\n        if (!res.headersSent) {\n          res.status(500).json({ error: \"Error streaming file\" });\n        }\n      });\n\n      stream.pipe(res);\n    } catch (error) {\n      console.error(\"Error downloading file:\", error);\n      if (!res.headersSent) {\n        res.status(500).json({ error: \"Error downloading file\" });\n      }\n    }\n  }\n\n  // Gets the upload URL for an object entity.\n  async getObjectEntityUploadURL(): Promise<string> {\n    const privateObjectDir = this.getPrivateObjectDir();\n    if (!privateObjectDir) {\n      throw new Error(\n        \"PRIVATE_OBJECT_DIR not set. Create a bucket in 'Object Storage' \" +\n          \"tool and set PRIVATE_OBJECT_DIR env var.\"\n      );\n    }\n\n    const objectId = randomUUID();\n    const fullPath = `${privateObjectDir}/uploads/${objectId}`;\n\n    const { bucketName, objectName } = parseObjectPath(fullPath);\n\n    // Sign URL for PUT method with TTL\n    return signObjectURL({\n      bucketName,\n      objectName,\n      method: \"PUT\",\n      ttlSec: 900,\n    });\n  }\n\n  // Gets the object entity file from the object path.\n  async getObjectEntityFile(objectPath: string): Promise<File> {\n    if (!objectPath.startsWith(\"/objects/\")) {\n      throw new ObjectNotFoundError();\n    }\n\n    const parts = objectPath.slice(1).split(\"/\");\n    if (parts.length < 2) {\n      throw new ObjectNotFoundError();\n    }\n\n    const entityId = parts.slice(1).join(\"/\");\n    let entityDir = this.getPrivateObjectDir();\n    if (!entityDir.endsWith(\"/\")) {\n      entityDir = `${entityDir}/`;\n    }\n    const objectEntityPath = `${entityDir}${entityId}`;\n    const { bucketName, objectName } = parseObjectPath(objectEntityPath);\n    const bucket = objectStorageClient.bucket(bucketName);\n    const objectFile = bucket.file(objectName);\n    const [exists] = await objectFile.exists();\n    if (!exists) {\n      throw new ObjectNotFoundError();\n    }\n    return objectFile;\n  }\n\n  normalizeObjectEntityPath(\n    rawPath: string,\n  ): string {\n    if (!rawPath.startsWith(\"https://storage.googleapis.com/\")) {\n      return rawPath;\n    }\n  \n    // Extract the path from the URL by removing query parameters and domain\n    const url = new URL(rawPath);\n    const rawObjectPath = url.pathname;\n  \n    let objectEntityDir = this.getPrivateObjectDir();\n    if (!objectEntityDir.endsWith(\"/\")) {\n      objectEntityDir = `${objectEntityDir}/`;\n    }\n  \n    if (!rawObjectPath.startsWith(objectEntityDir)) {\n      return rawObjectPath;\n    }\n  \n    // Extract the entity ID from the path\n    const entityId = rawObjectPath.slice(objectEntityDir.length);\n    return `/objects/${entityId}`;\n  }\n\n  // Tries to set the ACL policy for the object entity and return the normalized path.\n  async trySetObjectEntityAclPolicy(\n    rawPath: string,\n    aclPolicy: ObjectAclPolicy\n  ): Promise<string> {\n    const normalizedPath = this.normalizeObjectEntityPath(rawPath);\n    if (!normalizedPath.startsWith(\"/\")) {\n      return normalizedPath;\n    }\n\n    const objectFile = await this.getObjectEntityFile(normalizedPath);\n    await setObjectAclPolicy(objectFile, aclPolicy);\n    return normalizedPath;\n  }\n\n  // Checks if the user can access the object entity.\n  async canAccessObjectEntity({\n    userId,\n    objectFile,\n    requestedPermission,\n  }: {\n    userId?: string;\n    objectFile: File;\n    requestedPermission?: ObjectPermission;\n  }): Promise<boolean> {\n    return canAccessObject({\n      userId,\n      objectFile,\n      requestedPermission: requestedPermission ?? ObjectPermission.READ,\n    });\n  }\n}\n\nfunction parseObjectPath(path: string): {\n  bucketName: string;\n  objectName: string;\n} {\n  if (!path.startsWith(\"/\")) {\n    path = `/${path}`;\n  }\n  const pathParts = path.split(\"/\");\n  if (pathParts.length < 3) {\n    throw new Error(\"Invalid path: must contain at least a bucket name\");\n  }\n\n  const bucketName = pathParts[1];\n  const objectName = pathParts.slice(2).join(\"/\");\n\n  return {\n    bucketName,\n    objectName,\n  };\n}\n\nasync function signObjectURL({\n  bucketName,\n  objectName,\n  method,\n  ttlSec,\n}: {\n  bucketName: string;\n  objectName: string;\n  method: \"GET\" | \"PUT\" | \"DELETE\" | \"HEAD\";\n  ttlSec: number;\n}): Promise<string> {\n  const request = {\n    bucket_name: bucketName,\n    object_name: objectName,\n    method,\n    expires_at: new Date(Date.now() + ttlSec * 1000).toISOString(),\n  };\n  const response = await fetch(\n    `${REPLIT_SIDECAR_ENDPOINT}/object-storage/signed-object-url`,\n    {\n      method: \"POST\",\n      headers: {\n        \"Content-Type\": \"application/json\",\n      },\n      body: JSON.stringify(request),\n    }\n  );\n  if (!response.ok) {\n    throw new Error(\n      `Failed to sign object URL, errorcode: ${response.status}, ` +\n        `make sure you're running on Replit`\n    );\n  }\n\n  const { signed_url: signedURL } = await response.json();\n  return signedURL;\n}\n\n","path":null,"size_bytes":8409,"size_tokens":null},"client/src/components/VideoPlayer.tsx":{"content":"import { useState } from \"react\";\nimport { Dialog, DialogContent, DialogDescription, DialogHeader, DialogTitle, DialogFooter } from \"@/components/ui/dialog\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { ScrollArea } from \"@/components/ui/scroll-area\";\nimport { Play, X, Calendar, Clock, Trophy, Users, Video } from \"lucide-react\";\nimport type { Video as VideoType } from \"@shared/schema\";\n\ninterface VideoPlayerProps {\n  video: VideoType | null;\n  isOpen: boolean;\n  onClose: () => void;\n}\n\nexport default function VideoPlayer({ video, isOpen, onClose }: VideoPlayerProps) {\n  return (\n    <Dialog open={isOpen} onOpenChange={(open) => !open && onClose()}>\n      <DialogContent className=\"max-w-4xl max-h-[90vh]\">\n        <DialogHeader className=\"flex flex-row items-center justify-between gap-4\">\n          <div>\n            <DialogTitle className=\"flex items-center gap-2\">\n              <Play className=\"h-5 w-5 text-primary\" />\n              Video Player\n            </DialogTitle>\n            <DialogDescription>\n              {video?.title}\n            </DialogDescription>\n          </div>\n          <Button \n            size=\"icon\" \n            variant=\"ghost\" \n            onClick={onClose}\n            data-testid=\"button-close-video-player\"\n          >\n            <X className=\"h-5 w-5\" />\n          </Button>\n        </DialogHeader>\n        \n        <ScrollArea className=\"max-h-[calc(90vh-140px)]\">\n          <div className=\"space-y-4 pr-4\">\n            <div className=\"aspect-video bg-muted rounded-md flex items-center justify-center overflow-hidden\">\n              {video?.fileUrl ? (\n                <video \n                  controls \n                  autoPlay\n                  className=\"w-full h-full rounded-md\"\n                  src={video.fileUrl}\n                  data-testid=\"video-player-element\"\n                >\n                  Your browser does not support the video tag.\n                </video>\n              ) : (\n                <div className=\"text-center text-muted-foreground p-8\">\n                  <Video className=\"h-16 w-16 mx-auto mb-4 opacity-50\" />\n                  <p className=\"font-medium\">No Video Available</p>\n                  <p className=\"text-sm mt-2\">This video has no playable file attached.</p>\n                </div>\n              )}\n            </div>\n\n            <div className=\"grid grid-cols-2 md:grid-cols-4 gap-3 text-sm\">\n              {video?.matchDate && (\n                <div className=\"p-3 bg-muted/50 rounded-md\">\n                  <div className=\"flex items-center gap-1 text-muted-foreground text-xs mb-1\">\n                    <Calendar className=\"h-3 w-3\" />\n                    Match Date\n                  </div>\n                  <p className=\"font-medium\">{video.matchDate}</p>\n                </div>\n              )}\n              {video?.competition && (\n                <div className=\"p-3 bg-muted/50 rounded-md\">\n                  <div className=\"flex items-center gap-1 text-muted-foreground text-xs mb-1\">\n                    <Trophy className=\"h-3 w-3\" />\n                    Competition\n                  </div>\n                  <p className=\"font-medium\">{video.competition}</p>\n                </div>\n              )}\n              {video?.opponent && (\n                <div className=\"p-3 bg-muted/50 rounded-md\">\n                  <div className=\"flex items-center gap-1 text-muted-foreground text-xs mb-1\">\n                    <Users className=\"h-3 w-3\" />\n                    Opponent\n                  </div>\n                  <p className=\"font-medium\">{video.opponent}</p>\n                </div>\n              )}\n              {video?.duration && (\n                <div className=\"p-3 bg-muted/50 rounded-md\">\n                  <div className=\"flex items-center gap-1 text-muted-foreground text-xs mb-1\">\n                    <Clock className=\"h-3 w-3\" />\n                    Duration\n                  </div>\n                  <p className=\"font-medium\">{video.duration}</p>\n                </div>\n              )}\n            </div>\n\n            {video?.minutesPlayed && (\n              <div className=\"flex items-center gap-2\">\n                <Badge variant=\"secondary\">\n                  {video.minutesPlayed} minutes played\n                </Badge>\n                {video.processed && (\n                  <Badge variant=\"outline\">AI Analyzed</Badge>\n                )}\n              </div>\n            )}\n\n            <div className=\"flex items-center gap-2 text-xs text-muted-foreground\">\n              <span>Source: {video?.source || \"Manual Upload\"}</span>\n              {video?.uploadDate && (\n                <span>Uploaded: {new Date(video.uploadDate).toLocaleDateString()}</span>\n              )}\n            </div>\n          </div>\n        </ScrollArea>\n\n        <DialogFooter>\n          <Button variant=\"default\" onClick={onClose} data-testid=\"button-exit-video-player\">\n            <X className=\"h-4 w-4 mr-2\" />\n            Close\n          </Button>\n        </DialogFooter>\n      </DialogContent>\n    </Dialog>\n  );\n}\n","path":null,"size_bytes":5099,"size_tokens":null},"client/src/pages/token-bank.tsx":{"content":"import { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Progress } from \"@/components/ui/progress\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { Separator } from \"@/components/ui/separator\";\nimport { ScrollArea } from \"@/components/ui/scroll-area\";\nimport { Coins, TrendingUp, TrendingDown, Clock, User, Video, Eye, Star, MessageSquare, Zap, Package, CreditCard, History, FileText, Send } from \"lucide-react\";\nimport { format } from \"date-fns\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\n\ninterface TokenBalance {\n  id: string;\n  userId: string;\n  balance: number;\n  lifetimePurchased: number;\n  lifetimeSpent: number;\n  createdAt: string;\n  updatedAt: string;\n}\n\ninterface TokenTransaction {\n  id: string;\n  userId: string;\n  amount: number;\n  type: \"credit\" | \"debit\";\n  action: string;\n  description: string;\n  playerId?: string;\n  videoId?: string;\n  packId?: string;\n  balanceAfter: number;\n  expiresAt?: string;\n  createdAt: string;\n}\n\ninterface TokenPack {\n  id: string;\n  name: string;\n  tokens: number;\n  priceUsd: number;\n  description: string;\n  isActive: boolean;\n  sortOrder: number;\n}\n\ntype TokenCosts = Record<string, number>;\n\nconst actionIcons: Record<string, any> = {\n  view_profile: User,\n  shortlist: Star,\n  video_analysis: Zap,\n  watch_video: Video,\n  contact_request: MessageSquare,\n  scouting_messaging: Send,\n  transfer_report: FileText,\n  welcome_bonus: Coins,\n  purchase: Package,\n};\n\nconst actionLabels: Record<string, string> = {\n  view_profile: \"View Profile\",\n  shortlist: \"Shortlist Player\",\n  video_analysis: \"Video Analysis\",\n  watch_video: \"Watch Video\",\n  contact_request: \"Contact Request\",\n  scouting_messaging: \"Scouting Message\",\n  transfer_report: \"Transfer Report\",\n  welcome_bonus: \"Welcome Bonus\",\n  purchase: \"Token Purchase\",\n};\n\nexport default function TokenBank() {\n  const { toast } = useToast();\n\n  const { data: balance, isLoading: loadingBalance } = useQuery<TokenBalance>({\n    queryKey: [\"/api/tokens/balance\"],\n  });\n\n  const { data: transactions = [], isLoading: loadingTransactions } = useQuery<TokenTransaction[]>({\n    queryKey: [\"/api/tokens/transactions\"],\n  });\n\n  const { data: packs = [], isLoading: loadingPacks } = useQuery<TokenPack[]>({\n    queryKey: [\"/api/tokens/packs\"],\n  });\n\n  const { data: costs } = useQuery<TokenCosts>({\n    queryKey: [\"/api/tokens/costs\"],\n  });\n\n  const purchaseMutation = useMutation({\n    mutationFn: async (packId: string) => {\n      const result = await apiRequest(\"POST\", \"/api/tokens/purchase\", { packId });\n      return result.json();\n    },\n    onSuccess: async (data) => {\n      if (data.simulatedCheckout) {\n        const confirmResult = await apiRequest(\"POST\", `/api/tokens/purchase/${data.purchase.id}/confirm`, {});\n        const confirmed = await confirmResult.json();\n        queryClient.invalidateQueries({ queryKey: [\"/api/tokens/balance\"] });\n        queryClient.invalidateQueries({ queryKey: [\"/api/tokens/transactions\"] });\n        toast({\n          title: \"Tokens Added\",\n          description: `${confirmed.tokensAdded} tokens have been added to your account.`,\n        });\n      }\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Purchase Failed\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const getSpendingBreakdown = () => {\n    const breakdown: Record<string, number> = {};\n    transactions.filter(t => t.type === \"debit\").forEach(t => {\n      breakdown[t.action] = (breakdown[t.action] || 0) + t.amount;\n    });\n    return breakdown;\n  };\n\n  const spendingBreakdown = getSpendingBreakdown();\n  const totalSpent = Object.values(spendingBreakdown).reduce((a, b) => a + b, 0);\n\n  if (loadingBalance) {\n    return (\n      <div className=\"flex items-center justify-center h-full\">\n        <div className=\"animate-pulse text-muted-foreground\">Loading token balance...</div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"p-6 space-y-6\">\n      <div className=\"flex items-center justify-between gap-4 flex-wrap\">\n        <div>\n          <h1 className=\"text-2xl font-semibold\" data-testid=\"text-page-title\">Token Bank</h1>\n          <p className=\"text-muted-foreground\">Manage your tokens and track usage</p>\n        </div>\n        <Badge variant=\"outline\" className=\"text-lg px-4 py-2\" data-testid=\"badge-token-balance\">\n          <Coins className=\"w-5 h-5 mr-2\" />\n          {balance?.balance || 0} Tokens\n        </Badge>\n      </div>\n\n      <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\n        <Card data-testid=\"card-current-balance\">\n          <CardHeader className=\"flex flex-row items-center justify-between gap-2 pb-2\">\n            <CardTitle className=\"text-sm font-medium\">Current Balance</CardTitle>\n            <Coins className=\"w-4 h-4 text-muted-foreground\" />\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-3xl font-bold\">{balance?.balance || 0}</div>\n            <p className=\"text-xs text-muted-foreground\">Available tokens</p>\n          </CardContent>\n        </Card>\n\n        <Card data-testid=\"card-total-purchased\">\n          <CardHeader className=\"flex flex-row items-center justify-between gap-2 pb-2\">\n            <CardTitle className=\"text-sm font-medium\">Total Purchased</CardTitle>\n            <TrendingUp className=\"w-4 h-4 text-green-500\" />\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-3xl font-bold text-green-600\">{balance?.lifetimePurchased || 0}</div>\n            <p className=\"text-xs text-muted-foreground\">Lifetime tokens acquired</p>\n          </CardContent>\n        </Card>\n\n        <Card data-testid=\"card-total-spent\">\n          <CardHeader className=\"flex flex-row items-center justify-between gap-2 pb-2\">\n            <CardTitle className=\"text-sm font-medium\">Total Spent</CardTitle>\n            <TrendingDown className=\"w-4 h-4 text-orange-500\" />\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-3xl font-bold text-orange-600\">{balance?.lifetimeSpent || 0}</div>\n            <p className=\"text-xs text-muted-foreground\">Lifetime tokens used</p>\n          </CardContent>\n        </Card>\n      </div>\n\n      <Tabs defaultValue=\"packs\" className=\"space-y-4\">\n        <TabsList>\n          <TabsTrigger value=\"packs\" data-testid=\"tab-buy-tokens\">\n            <Package className=\"w-4 h-4 mr-2\" />\n            Buy Tokens\n          </TabsTrigger>\n          <TabsTrigger value=\"usage\" data-testid=\"tab-usage\">\n            <Eye className=\"w-4 h-4 mr-2\" />\n            Usage Breakdown\n          </TabsTrigger>\n          <TabsTrigger value=\"history\" data-testid=\"tab-history\">\n            <History className=\"w-4 h-4 mr-2\" />\n            Transaction History\n          </TabsTrigger>\n        </TabsList>\n\n        <TabsContent value=\"packs\" className=\"space-y-4\">\n          <Card>\n            <CardHeader>\n              <CardTitle>Token Packs</CardTitle>\n              <CardDescription>\n                Purchase tokens to unlock player profiles, videos, and more. Tokens expire after 6 months and are non-transferable.\n              </CardDescription>\n            </CardHeader>\n            <CardContent>\n              <div className=\"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4\">\n                {loadingPacks ? (\n                  <div className=\"col-span-full text-center py-8 text-muted-foreground\">Loading packs...</div>\n                ) : (\n                  packs.map((pack) => (\n                    <Card key={pack.id} className=\"relative\" data-testid={`card-pack-${pack.tokens}`}>\n                      {pack.tokens === 100 && (\n                        <Badge className=\"absolute -top-2 -right-2 bg-primary\">Best Value</Badge>\n                      )}\n                      <CardHeader className=\"pb-2\">\n                        <CardTitle className=\"text-lg\">{pack.name}</CardTitle>\n                        <CardDescription>{pack.description}</CardDescription>\n                      </CardHeader>\n                      <CardContent className=\"space-y-4\">\n                        <div className=\"flex items-baseline gap-1\">\n                          <span className=\"text-3xl font-bold\">${(pack.priceUsd / 100).toFixed(2)}</span>\n                          <span className=\"text-muted-foreground\">USD</span>\n                        </div>\n                        <div className=\"flex items-center gap-2\">\n                          <Coins className=\"w-5 h-5 text-amber-500\" />\n                          <span className=\"text-xl font-semibold\">{pack.tokens} tokens</span>\n                        </div>\n                        <Button \n                          className=\"w-full\" \n                          onClick={() => purchaseMutation.mutate(pack.id)}\n                          disabled={purchaseMutation.isPending}\n                          data-testid={`button-buy-pack-${pack.tokens}`}\n                        >\n                          <CreditCard className=\"w-4 h-4 mr-2\" />\n                          {purchaseMutation.isPending ? \"Processing...\" : \"Buy Now\"}\n                        </Button>\n                      </CardContent>\n                    </Card>\n                  ))\n                )}\n              </div>\n            </CardContent>\n          </Card>\n\n          {costs && (\n            <Card>\n              <CardHeader>\n                <CardTitle>Token Costs</CardTitle>\n                <CardDescription>How many tokens each action costs for your role</CardDescription>\n              </CardHeader>\n              <CardContent>\n                <div className=\"grid grid-cols-2 sm:grid-cols-3 gap-4\">\n                  {Object.entries(costs).map(([action, cost]) => {\n                    const Icon = actionIcons[action] || Coins;\n                    const iconColors: Record<string, string> = {\n                      view_profile: \"text-blue-500\",\n                      shortlist: \"text-amber-500\",\n                      video_analysis: \"text-purple-500\",\n                      watch_video: \"text-green-500\",\n                      contact_request: \"text-pink-500\",\n                      scouting_messaging: \"text-cyan-500\",\n                      transfer_report: \"text-orange-500\",\n                    };\n                    return (\n                      <div \n                        key={action}\n                        className=\"flex flex-col items-center p-4 rounded-md bg-muted/50\" \n                        data-testid={`cost-${action}`}\n                      >\n                        <Icon className={`w-8 h-8 mb-2 ${iconColors[action] || \"text-muted-foreground\"}`} />\n                        <span className=\"font-medium text-center\">{actionLabels[action] || action}</span>\n                        <Badge variant=\"secondary\">{cost} {cost === 1 ? \"token\" : \"tokens\"}</Badge>\n                      </div>\n                    );\n                  })}\n                </div>\n              </CardContent>\n            </Card>\n          )}\n        </TabsContent>\n\n        <TabsContent value=\"usage\" className=\"space-y-4\">\n          <Card>\n            <CardHeader>\n              <CardTitle>Spending Breakdown</CardTitle>\n              <CardDescription>How you've been using your tokens</CardDescription>\n            </CardHeader>\n            <CardContent className=\"space-y-6\">\n              {totalSpent === 0 ? (\n                <div className=\"text-center py-8 text-muted-foreground\">\n                  <Coins className=\"w-12 h-12 mx-auto mb-4 opacity-50\" />\n                  <p>No tokens spent yet</p>\n                  <p className=\"text-sm\">Start exploring player profiles to use your tokens</p>\n                </div>\n              ) : (\n                Object.entries(spendingBreakdown).map(([action, amount]) => {\n                  const Icon = actionIcons[action] || Coins;\n                  const percentage = (amount / totalSpent) * 100;\n                  return (\n                    <div key={action} className=\"space-y-2\" data-testid={`breakdown-${action}`}>\n                      <div className=\"flex items-center justify-between gap-2\">\n                        <div className=\"flex items-center gap-2\">\n                          <Icon className=\"w-4 h-4\" />\n                          <span className=\"font-medium\">{actionLabels[action] || action}</span>\n                        </div>\n                        <span className=\"text-sm text-muted-foreground\">{amount} tokens ({percentage.toFixed(1)}%)</span>\n                      </div>\n                      <Progress value={percentage} className=\"h-2\" />\n                    </div>\n                  );\n                })\n              )}\n            </CardContent>\n          </Card>\n        </TabsContent>\n\n        <TabsContent value=\"history\" className=\"space-y-4\">\n          <Card>\n            <CardHeader>\n              <CardTitle>Transaction History</CardTitle>\n              <CardDescription>Complete audit trail of all token activity</CardDescription>\n            </CardHeader>\n            <CardContent>\n              <ScrollArea className=\"h-[500px]\">\n                {loadingTransactions ? (\n                  <div className=\"text-center py-8 text-muted-foreground\">Loading transactions...</div>\n                ) : transactions.length === 0 ? (\n                  <div className=\"text-center py-8 text-muted-foreground\">\n                    <History className=\"w-12 h-12 mx-auto mb-4 opacity-50\" />\n                    <p>No transactions yet</p>\n                  </div>\n                ) : (\n                  <div className=\"space-y-4\">\n                    {transactions.map((tx) => {\n                      const Icon = actionIcons[tx.action] || Coins;\n                      const isCredit = tx.type === \"credit\";\n                      return (\n                        <div \n                          key={tx.id} \n                          className=\"flex items-center justify-between p-4 rounded-md border\"\n                          data-testid={`transaction-${tx.id}`}\n                        >\n                          <div className=\"flex items-center gap-4\">\n                            <div className={`p-2 rounded-full ${isCredit ? \"bg-green-100 dark:bg-green-900\" : \"bg-orange-100 dark:bg-orange-900\"}`}>\n                              <Icon className={`w-4 h-4 ${isCredit ? \"text-green-600\" : \"text-orange-600\"}`} />\n                            </div>\n                            <div>\n                              <p className=\"font-medium\">{tx.description || actionLabels[tx.action] || tx.action}</p>\n                              <div className=\"flex items-center gap-2 text-sm text-muted-foreground\">\n                                <Clock className=\"w-3 h-3\" />\n                                {format(new Date(tx.createdAt), \"MMM d, yyyy 'at' h:mm a\")}\n                              </div>\n                              {tx.expiresAt && (\n                                <p className=\"text-xs text-muted-foreground\">\n                                  Expires: {format(new Date(tx.expiresAt), \"MMM d, yyyy\")}\n                                </p>\n                              )}\n                            </div>\n                          </div>\n                          <div className=\"text-right\">\n                            <p className={`text-lg font-semibold ${isCredit ? \"text-green-600\" : \"text-orange-600\"}`}>\n                              {isCredit ? \"+\" : \"-\"}{tx.amount}\n                            </p>\n                            <p className=\"text-sm text-muted-foreground\">Balance: {tx.balanceAfter}</p>\n                          </div>\n                        </div>\n                      );\n                    })}\n                  </div>\n                )}\n              </ScrollArea>\n            </CardContent>\n          </Card>\n        </TabsContent>\n      </Tabs>\n    </div>\n  );\n}\n","path":null,"size_bytes":16100,"size_tokens":null},"client/src/hooks/use-tokens.ts":{"content":"import { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\n\nexport interface TokenBalance {\n  id: string;\n  userId: string;\n  balance: number;\n  lifetimePurchased: number;\n  lifetimeSpent: number;\n  lastUpdated: string;\n}\n\nexport type ScoutTokenAction = \"view_profile\" | \"shortlist\" | \"video_analysis\" | \"watch_video\" | \"contact_request\";\nexport type TeamTokenAction = \"video_analysis\" | \"scouting_messaging\" | \"transfer_report\";\nexport type TokenAction = ScoutTokenAction | TeamTokenAction;\n\nexport interface SpendTokensRequest {\n  action: TokenAction;\n  playerId?: string;\n  videoId?: string;\n}\n\nconst SCOUT_TOKEN_COSTS: Record<ScoutTokenAction, number> = {\n  view_profile: 2,\n  shortlist: 1,\n  video_analysis: 8,\n  watch_video: 1,\n  contact_request: 2,\n};\n\nconst TEAM_TOKEN_COSTS: Record<TeamTokenAction, number> = {\n  video_analysis: 8,\n  scouting_messaging: 3,\n  transfer_report: 5,\n};\n\nexport function useTokenBalance() {\n  return useQuery<TokenBalance>({\n    queryKey: [\"/api/tokens/balance\"],\n    staleTime: 30000,\n  });\n}\n\nexport function useSpendTokens() {\n  const queryClient = useQueryClient();\n  const { toast } = useToast();\n\n  return useMutation({\n    mutationFn: async (data: SpendTokensRequest) => {\n      const response = await apiRequest(\"POST\", \"/api/tokens/spend\", data);\n      if (!response.ok) {\n        const error = await response.json();\n        throw new Error(error.error || \"Failed to spend tokens\");\n      }\n      return response.json();\n    },\n    onSuccess: (result) => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/tokens/balance\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/tokens/transactions\"] });\n      toast({\n        title: \"Tokens Spent\",\n        description: `${result.cost} token(s) used. Balance: ${result.newBalance}`,\n      });\n    },\n    onError: (error: Error) => {\n      toast({\n        title: \"Insufficient Tokens\",\n        description: error.message || \"You don't have enough tokens for this action.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n}\n\nexport function useCheckTokens(role: \"scout\" | \"team\" = \"scout\") {\n  const { data: balance } = useTokenBalance();\n  const costs = role === \"scout\" ? SCOUT_TOKEN_COSTS : TEAM_TOKEN_COSTS;\n  \n  return {\n    balance: balance?.balance || 0,\n    canAfford: (action: TokenAction) => {\n      if (!balance) return false;\n      const cost = (costs as Record<string, number>)[action];\n      return cost ? balance.balance >= cost : false;\n    },\n    getCost: (action: TokenAction) => (costs as Record<string, number>)[action] || 0,\n    TOKEN_COSTS: costs,\n    SCOUT_TOKEN_COSTS,\n    TEAM_TOKEN_COSTS,\n  };\n}\n","path":null,"size_bytes":2748,"size_tokens":null},"client/src/components/TokenBalanceIndicator.tsx":{"content":"import { useTokenBalance } from \"@/hooks/use-tokens\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Coins } from \"lucide-react\";\nimport { Link } from \"wouter\";\n\nexport default function TokenBalanceIndicator() {\n  const { data: tokenBalance, isLoading } = useTokenBalance();\n\n  if (isLoading) {\n    return (\n      <Badge variant=\"outline\" className=\"gap-1 opacity-50\">\n        <Coins className=\"h-3 w-3\" />\n        ...\n      </Badge>\n    );\n  }\n\n  const balance = tokenBalance?.balance || 0;\n\n  return (\n    <Link href=\"/token-bank\">\n      <Badge \n        variant={balance < 10 ? \"destructive\" : \"secondary\"} \n        className=\"gap-1 cursor-pointer\"\n        data-testid=\"badge-token-balance\"\n      >\n        <Coins className=\"h-3 w-3\" />\n        {balance} tokens\n      </Badge>\n    </Link>\n  );\n}\n","path":null,"size_bytes":807,"size_tokens":null}},"version":2}